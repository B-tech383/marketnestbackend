{"file_contents":{"cart.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/cart.php';\n\nrequire_login();\n\n$cart_manager = new CartManager();\n$message = '';\n\n// Handle cart updates\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (isset($_POST['update_quantity'])) {\n        $product_id = $_POST['product_id'];\n        $quantity = max(0, $_POST['quantity']);\n        \n        $result = $cart_manager->update_cart_quantity($_SESSION['user_id'], $product_id, $quantity);\n        $message = $result['message'];\n    } elseif (isset($_POST['remove_item'])) {\n        $product_id = $_POST['product_id'];\n        \n        $result = $cart_manager->remove_from_cart($_SESSION['user_id'], $product_id);\n        $message = $result['message'];\n    }\n}\n\n$cart_items = $cart_manager->get_cart_items($_SESSION['user_id']);\n$cart_total = $cart_manager->get_cart_total($_SESSION['user_id']);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Shopping Cart - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Shopping Cart</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Continue Shopping</a>\n                    <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <h1 class=\"text-3xl font-bold text-gray-900 mb-8\">Shopping Cart</h1>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo $message; ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if (empty($cart_items)): ?>\n            <div class=\"text-center py-12\">\n                <div class=\"text-gray-400 text-6xl mb-4\">🛒</div>\n                <h3 class=\"text-xl font-medium text-gray-900 mb-2\">Your cart is empty</h3>\n                <p class=\"text-gray-500 mb-6\">Add some products to get started!</p>\n                <a href=\"products.php\" class=\"bg-accent text-white px-6 py-3 rounded-md font-medium hover:bg-blue-600 transition duration-200\">\n                    Start Shopping\n                </a>\n            </div>\n        <?php else: ?>\n            <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                <!-- Cart Items -->\n                <div class=\"lg:col-span-2\">\n                    <div class=\"bg-white rounded-lg shadow-sm\">\n                        <div class=\"px-6 py-4 border-b border-gray-200\">\n                            <h2 class=\"text-lg font-semibold text-gray-900\">Cart Items (<?php echo count($cart_items); ?>)</h2>\n                        </div>\n                        \n                        <div class=\"divide-y divide-gray-200\">\n                            <?php foreach ($cart_items as $item): ?>\n                                <div class=\"p-6\">\n                                    <div class=\"flex items-start space-x-4\">\n                                        <div class=\"flex-shrink-0\">\n                                            <?php if (!empty($item['images'])): ?>\n                                                <img src=\"<?php echo $item['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($item['name']); ?>\" \n                                                     class=\"w-20 h-20 object-cover rounded-md\">\n                                            <?php else: ?>\n                                                <div class=\"w-20 h-20 bg-gray-200 rounded-md flex items-center justify-center\">\n                                                    <span class=\"text-gray-400 text-xs\">No Image</span>\n                                                </div>\n                                            <?php endif; ?>\n                                        </div>\n                                        \n                                        <div class=\"flex-1\">\n                                            <div class=\"flex justify-between\">\n                                                <div>\n                                                    <h3 class=\"text-lg font-medium text-gray-900\">\n                                                        <a href=\"product-detail.php?id=<?php echo $item['product_id']; ?>\" class=\"hover:text-accent\">\n                                                            <?php echo htmlspecialchars($item['name']); ?>\n                                                        </a>\n                                                    </h3>\n                                                    <p class=\"text-sm text-gray-600\">by <?php echo htmlspecialchars($item['business_name']); ?></p>\n                                                    <p class=\"text-lg font-semibold text-gray-900 mt-2\"><?php echo format_currency($item['current_price']); ?></p>\n                                                </div>\n                                                \n                                                <div class=\"text-right\">\n                                                    <p class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($item['total_price']); ?></p>\n                                                </div>\n                                            </div>\n                                            \n                                            <div class=\"flex items-center justify-between mt-4\">\n                                                <form method=\"POST\" class=\"flex items-center space-x-2\">\n                                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['product_id']; ?>\">\n                                                    <label for=\"quantity_<?php echo $item['product_id']; ?>\" class=\"text-sm text-gray-700\">Qty:</label>\n                                                    <select name=\"quantity\" id=\"quantity_<?php echo $item['product_id']; ?>\" \n                                                            class=\"border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-accent focus:border-accent\"\n                                                            onchange=\"this.form.submit()\">\n                                                        <?php for ($i = 1; $i <= min(10, $item['stock_quantity']); $i++): ?>\n                                                            <option value=\"<?php echo $i; ?>\" <?php echo $i == $item['quantity'] ? 'selected' : ''; ?>>\n                                                                <?php echo $i; ?>\n                                                            </option>\n                                                        <?php endfor; ?>\n                                                    </select>\n                                                    <input type=\"hidden\" name=\"update_quantity\" value=\"1\">\n                                                </form>\n                                                \n                                                <form method=\"POST\" class=\"inline\">\n                                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['product_id']; ?>\">\n                                                    <button type=\"submit\" name=\"remove_item\" \n                                                            class=\"text-red-600 hover:text-red-800 text-sm font-medium\"\n                                                            onclick=\"return confirm('Remove this item from cart?')\">\n                                                        Remove\n                                                    </button>\n                                                </form>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            <?php endforeach; ?>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Order Summary -->\n                <div class=\"lg:col-span-1\">\n                    <div class=\"bg-white rounded-lg shadow-sm p-6 sticky top-8\">\n                        <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Order Summary</h2>\n                        \n                        <div class=\"space-y-3 mb-6\">\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600\">Subtotal</span>\n                                <span class=\"font-medium\"><?php echo format_currency($cart_total); ?></span>\n                            </div>\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600\">Shipping</span>\n                                <span class=\"font-medium\">Free</span>\n                            </div>\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600\">Tax</span>\n                                <span class=\"font-medium\"><?php echo format_currency($cart_total * 0.08); ?></span>\n                            </div>\n                            <div class=\"border-t pt-3\">\n                                <div class=\"flex justify-between\">\n                                    <span class=\"text-lg font-semibold\">Total</span>\n                                    <span class=\"text-lg font-bold text-accent\"><?php echo format_currency($cart_total * 1.08); ?></span>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <a href=\"checkout.php\" class=\"w-full bg-accent text-white py-3 px-4 rounded-md font-medium hover:bg-blue-600 transition duration-200 block text-center\">\n                            Proceed to Checkout\n                        </a>\n                        \n                        <a href=\"products.php\" class=\"w-full mt-3 border border-gray-300 text-gray-700 py-3 px-4 rounded-md font-medium hover:bg-gray-50 transition duration-200 block text-center\">\n                            Continue Shopping\n                        </a>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n</body>\n</html>\n","size_bytes":11559},"check_vendors.php":{"content":"<?php\nrequire_once 'config/database.php';\n\n$database = new Database();\n$db = $database->getConnection();\n\necho \"Checking vendors in database...\\n\";\n\n$stmt = $db->query(\"SELECT id, user_id, business_name FROM vendors\");\n$vendors = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\necho \"Found \" . count($vendors) . \" vendors:\\n\";\nforeach ($vendors as $vendor) {\n    echo \"- ID: {$vendor['id']}, User ID: {$vendor['user_id']}, Business: {$vendor['business_name']}\\n\";\n}\n\necho \"\\nChecking categories...\\n\";\n$stmt = $db->query(\"SELECT id, name FROM categories\");\n$categories = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\necho \"Found \" . count($categories) . \" categories:\\n\";\nforeach ($categories as $category) {\n    echo \"- ID: {$category['id']}, Name: {$category['name']}\\n\";\n}\n?>\n","size_bytes":757},"checkout.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/cart.php';\nrequire_once './includes/order.php';\nrequire_once './includes/coupon.php';\n\nrequire_login();\n\n$cart_manager = new CartManager();\n$order_manager = new OrderManager();\n$coupon_manager = new CouponManager();\n\n$cart_items = $cart_manager->get_cart_items($_SESSION['user_id']);\n$cart_total = $cart_manager->get_cart_total($_SESSION['user_id']);\n\nif (empty($cart_items)) {\n    redirect('cart.php');\n}\n\n$error = '';\n$success = '';\n$coupon_discount = 0;\n$coupon_message = '';\n$applied_coupon = $_SESSION['checkout_coupon'] ?? null;\n\n// Handle coupon validation\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['apply_coupon'])) {\n    $coupon_code = sanitize_input($_POST['coupon_code'] ?? '');\n    \n    // Convert cart items to the format expected by coupon validation\n    $items_for_validation = [];\n    foreach ($cart_items as $item) {\n        $items_for_validation[] = [\n            'product_id' => $item['product_id'],\n            'price' => $item['sale_price'] ?: $item['price'],\n            'quantity' => $item['quantity']\n        ];\n    }\n    \n    $result = $coupon_manager->validateCoupon($coupon_code, $_SESSION['user_id'], $items_for_validation);\n    \n    if ($result['success']) {\n        $coupon_discount = $result['discount']['amount'];\n        $coupon_message = \"Coupon applied! You saved \" . format_currency($coupon_discount);\n        $_SESSION['checkout_coupon'] = $result['coupon'];\n        $_SESSION['checkout_discount'] = $coupon_discount;\n    } else {\n        $coupon_message = $result['message'];\n    }\n}\n\n// Handle order placement\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['place_order'])) {\n    $shipping_address = sanitize_input($_POST['shipping_address'] ?? '');\n    $billing_address = sanitize_input($_POST['billing_address'] ?? '');\n    $payment_method = sanitize_input($_POST['payment_method'] ?? '');\n    $transaction_id = sanitize_input($_POST['transaction_id'] ?? '');\n    $coupon_code = $_SESSION['checkout_coupon'] ?? null;\n    \n    // For free product coupons, skip payment method requirement\n    $applied_coupon = $_SESSION['checkout_coupon'] ?? null;\n    if ($applied_coupon && $applied_coupon['type'] === 'free_product') {\n        $payment_method = 'free_coupon';\n    }\n    \n    // Validate required fields\n    $validation_error = '';\n    if (empty($shipping_address)) $validation_error = 'Please enter your shipping address';\n    elseif (empty($billing_address)) $validation_error = 'Please enter your billing address';\n    elseif (empty($payment_method)) $validation_error = 'Please select a payment method';\n    elseif ($payment_method === 'mobile_money_cameroon' && empty($transaction_id)) {\n        $validation_error = 'Please enter your MTN transaction ID for mobile money payment';\n    }\n    \n    if ($validation_error) {\n        $error = $validation_error;\n    } else {\n        $result = $order_manager->create_order(\n            $_SESSION['user_id'], \n            $cart_items, \n            $shipping_address, \n            $billing_address, \n            $payment_method,\n            $coupon_code,\n            $transaction_id\n        );\n        \n        if ($result['success']) {\n            // Record coupon usage if applicable\n            if ($applied_coupon) {\n                $coupon_manager->recordCouponUsage($applied_coupon['id'], $_SESSION['user_id'], $result['order_id']);\n            }\n            \n            // Clear checkout session data\n            unset($_SESSION['checkout_coupon']);\n            unset($_SESSION['checkout_discount']);\n            \n            redirect('order-confirmation.php?order=' . $result['order_number']);\n        } else {\n            $error = $result['message'];\n        }\n    }\n}\n\n// Use session discount if available\nif (isset($_SESSION['checkout_discount'])) {\n    $coupon_discount = $_SESSION['checkout_discount'];\n}\n\n// For free product coupons, everything is free\nif ($applied_coupon && $applied_coupon['type'] === 'free_product') {\n    $tax_amount = 0;\n    $final_total = 0;\n} else {\n    $tax_amount = ($cart_total - $coupon_discount) * 0.08;\n    $final_total = $cart_total + $tax_amount - $coupon_discount;\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Checkout - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Checkout</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"cart.php\" class=\"text-gray-700 hover:text-accent\">Back to Cart</a>\n                    <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <h1 class=\"text-3xl font-bold text-gray-900 mb-8\">Checkout</h1>\n        \n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo $error; ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($coupon_message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo $coupon_message; ?>\n            </div>\n        <?php endif; ?>\n        \n        <form method=\"POST\" class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            <!-- Checkout Form -->\n            <div class=\"lg:col-span-2 space-y-8\">\n                <!-- Shipping Address -->\n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Shipping Address</h2>\n                    <textarea name=\"shipping_address\" rows=\"4\" required \n                              placeholder=\"Enter your full shipping address...\"\n                              class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\"></textarea>\n                </div>\n                \n                <!-- Billing Address -->\n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Billing Address</h2>\n                    <div class=\"mb-4\">\n                        <label class=\"flex items-center\">\n                            <input type=\"checkbox\" id=\"same_as_shipping\" class=\"mr-2\" onchange=\"toggleBillingAddress()\">\n                            <span class=\"text-sm text-gray-700\">Same as shipping address</span>\n                        </label>\n                    </div>\n                    <textarea name=\"billing_address\" id=\"billing_address\" rows=\"4\" required \n                              placeholder=\"Enter your billing address...\"\n                              class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\"></textarea>\n                </div>\n                \n                <!-- Payment Method -->\n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Payment Method</h2>\n                    <div class=\"space-y-3\">\n                        <label class=\"flex items-center p-3 border border-gray-200 rounded-md hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"radio\" name=\"payment_method\" value=\"credit_card\" required class=\"mr-3\">\n                            <div class=\"flex items-center\">\n                                <span class=\"text-2xl mr-2\">💳</span>\n                                <span class=\"font-medium\">Credit Card</span>\n                            </div>\n                        </label>\n                        \n                        <label class=\"flex items-center p-3 border border-gray-200 rounded-md hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"radio\" name=\"payment_method\" value=\"paypal\" required class=\"mr-3\">\n                            <div class=\"flex items-center\">\n                                <span class=\"text-2xl mr-2\">🅿️</span>\n                                <span class=\"font-medium\">PayPal</span>\n                            </div>\n                        </label>\n                        \n                        <label class=\"flex items-center p-3 border border-gray-200 rounded-md hover:bg-gray-50 cursor-pointer\">\n                            <input type=\"radio\" name=\"payment_method\" value=\"apple_pay\" required class=\"mr-3\">\n                            <div class=\"flex items-center\">\n                                <span class=\"text-2xl mr-2\">🍎</span>\n                                <span class=\"font-medium\">Apple Pay</span>\n                            </div>\n                        </label>\n                        \n                        <label class=\"flex items-start p-3 border border-green-200 rounded-md hover:bg-green-50 cursor-pointer bg-green-25\">\n                            <input type=\"radio\" name=\"payment_method\" value=\"mobile_money_cameroon\" required class=\"mr-3 mt-1\" onclick=\"showMobileMoneyDetails()\">\n                            <div class=\"flex-1\">\n                                <div class=\"flex items-center mb-2\">\n                                    <span class=\"text-2xl mr-2\">📱</span>\n                                    <span class=\"font-medium text-green-700\">Mobile Money (Cameroon)</span>\n                                </div>\n                                \n                                <div id=\"mobile_money_details\" class=\"hidden mt-3 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                                    <h4 class=\"font-semibold text-blue-900 mb-3\">Payment Instructions:</h4>\n                                    <div class=\"text-sm text-blue-800 space-y-2\">\n                                        <p><strong>Send payment to:</strong></p>\n                                        <p><strong>Phone Number:</strong> 6798711130</p>\n                                        <p><strong>Recipient Name:</strong> Kein Theresia</p>\n                                        <p class=\"mt-3\"><strong>After payment, enter your transaction ID below:</strong></p>\n                                    </div>\n                                    \n                                    <div class=\"mt-3\">\n                                        <label for=\"transaction_id\" class=\"block text-sm font-medium text-gray-700 mb-1\">MTN Transaction ID</label>\n                                        <input type=\"text\" name=\"transaction_id\" id=\"transaction_id\" placeholder=\"Enter transaction ID from MTN message\" \n                                               class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\">\n                                        <p class=\"text-xs text-gray-600 mt-1\">Order will be pending admin approval until payment is verified</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </label>\n                    </div>\n                    \n                    <div class=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                        <p class=\"text-sm text-blue-800\">\n                            <strong>Mobile Money Instructions:</strong> For Mobile Money payments, send the total amount to <strong>6798711130</strong> (Kein Theresia) and enter your transaction ID after payment.\n                        </p>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Order Summary -->\n            <div class=\"lg:col-span-1\">\n                <div class=\"bg-white rounded-lg shadow-sm p-6 sticky top-8\">\n                    <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Order Summary</h2>\n                    \n                    <!-- Order Items -->\n                    <div class=\"space-y-3 mb-6 max-h-60 overflow-y-auto\">\n                        <?php foreach ($cart_items as $item): ?>\n                            <div class=\"flex items-center space-x-3\">\n                                <?php if (!empty($item['images'])): ?>\n                                    <img src=\"<?php echo $item['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($item['name']); ?>\" \n                                         class=\"w-12 h-12 object-cover rounded\">\n                                <?php else: ?>\n                                    <div class=\"w-12 h-12 bg-gray-200 rounded flex items-center justify-center\">\n                                        <span class=\"text-gray-400 text-xs\">No Image</span>\n                                    </div>\n                                <?php endif; ?>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-sm font-medium text-gray-900 line-clamp-1\"><?php echo htmlspecialchars($item['name']); ?></p>\n                                    <p class=\"text-xs text-gray-500\">Qty: <?php echo $item['quantity']; ?></p>\n                                </div>\n                                <p class=\"text-sm font-medium\"><?php echo format_currency($item['total_price']); ?></p>\n                            </div>\n                        <?php endforeach; ?>\n                    </div>\n                    \n                    <!-- Coupon Code -->\n                    <div class=\"mb-6 pb-6 border-b border-gray-200\">\n                        <div class=\"flex space-x-2\">\n                            <input type=\"text\" name=\"coupon_code\" placeholder=\"Coupon code\" \n                                   value=\"<?php echo $_SESSION['checkout_coupon'] ?? ''; ?>\"\n                                   class=\"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-accent focus:border-accent\">\n                            <button type=\"submit\" name=\"apply_coupon\" \n                                    class=\"px-4 py-2 bg-gray-500 text-white rounded-md text-sm hover:bg-gray-600 transition duration-200\">\n                                Apply\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <!-- Totals -->\n                    <div class=\"space-y-3 mb-6\">\n                        <div class=\"flex justify-between\">\n                            <span class=\"text-gray-600\">Subtotal</span>\n                            <span class=\"font-medium\"><?php echo format_currency($cart_total); ?></span>\n                        </div>\n                        \n                        <?php if ($coupon_discount > 0): ?>\n                            <div class=\"flex justify-between text-green-600\">\n                                <span>Discount</span>\n                                <span>-<?php echo format_currency($coupon_discount); ?></span>\n                            </div>\n                        <?php endif; ?>\n                        \n                        <div class=\"flex justify-between\">\n                            <span class=\"text-gray-600\">Shipping</span>\n                            <span class=\"font-medium text-green-600\">Free</span>\n                        </div>\n                        <div class=\"flex justify-between\">\n                            <span class=\"text-gray-600\">Tax</span>\n                            <span class=\"font-medium\"><?php echo format_currency($tax_amount); ?></span>\n                        </div>\n                        <div class=\"border-t pt-3\">\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-lg font-semibold\">Total</span>\n                                <span class=\"text-lg font-bold text-accent\"><?php echo format_currency($final_total); ?></span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <button type=\"submit\" name=\"place_order\" \n                            class=\"w-full bg-accent text-white py-3 px-4 rounded-md font-medium hover:bg-blue-600 transition duration-200\">\n                        Place Order\n                    </button>\n                    \n                    <div class=\"mt-4 text-center\">\n                        <p class=\"text-xs text-gray-500\">\n                            By placing your order, you agree to our Terms of Service and Privacy Policy.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </form>\n    </div>\n    \n    <script>\n        function toggleBillingAddress() {\n            const checkbox = document.getElementById('same_as_shipping');\n            const billingAddress = document.getElementById('billing_address');\n            const shippingAddress = document.querySelector('textarea[name=\"shipping_address\"]');\n            \n            if (checkbox.checked) {\n                billingAddress.value = shippingAddress.value;\n                billingAddress.disabled = true;\n                billingAddress.classList.add('bg-gray-100');\n            } else {\n                billingAddress.disabled = false;\n                billingAddress.classList.remove('bg-gray-100');\n            }\n        }\n        \n        // Show mobile money payment details\n        function showMobileMoneyDetails() {\n            const details = document.getElementById('mobile_money_details');\n            details.classList.remove('hidden');\n        }\n        \n        // Auto-copy shipping to billing when shipping changes\n        document.querySelector('textarea[name=\"shipping_address\"]').addEventListener('input', function() {\n            const checkbox = document.getElementById('same_as_shipping');\n            if (checkbox.checked) {\n                document.getElementById('billing_address').value = this.value;\n            }\n        });\n        \n        // Hide mobile money details when other payment methods are selected\n        document.addEventListener('DOMContentLoaded', function() {\n            const paymentMethods = document.querySelectorAll('input[name=\"payment_method\"]');\n            paymentMethods.forEach(function(radio) {\n                radio.addEventListener('change', function() {\n                    const details = document.getElementById('mobile_money_details');\n                    if (this.value !== 'mobile_money_cameroon') {\n                        details.classList.add('hidden');\n                        const transactionInput = document.getElementById('transaction_id');\n                        if (transactionInput) {\n                            transactionInput.value = '';\n                        }\n                    }\n                });\n            });\n        });\n    </script>\n</body>\n</html>\n","size_bytes":19809},"cli_check.php":{"content":"<?php\nrequire_once __DIR__ . '/config/database.php';\n\necho \"DB diagnostics...\\n\";\n\ntry {\n    $db = (new Database())->getConnection();\n    $total = (int)$db->query(\"SELECT COUNT(*) FROM products\")->fetchColumn();\n    echo \"products_total=\".$total.\"\\n\";\n    \n    $stmt = $db->query(\"SELECT status, COUNT(*) c FROM products GROUP BY status\");\n    foreach ($stmt as $row) {\n        echo $row['status'] . ':' . $row['c'] . \"\\n\";\n    }\n    \n    $stmt = $db->query(\"SELECT id,name,status,category_id,vendor_id,images FROM products ORDER BY created_at DESC LIMIT 5\");\n    foreach ($stmt as $row) {\n        echo \"- #{$row['id']} {$row['name']} [{$row['status']}] cat={$row['category_id']} vendor={$row['vendor_id']}\\n\";\n    }\n} catch (Throwable $e) {\n    echo 'Error: ' . $e->getMessage() . \"\\n\";\n}\n?>\n\n\n","size_bytes":795},"debug_products.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/product.php';\n\necho \"=== Product Debug Script ===\\n\";\n\n$product_manager = new ProductManager();\n\n// Test basic product retrieval\necho \"1. Testing get_products():\\n\";\n$products = $product_manager->get_products(5, 0);\necho \"Found \" . count($products) . \" products\\n\";\n\nforeach ($products as $product) {\n    echo \"- ID: {$product['id']}, Name: {$product['name']}, Status: {$product['status']}\\n\";\n    echo \"  Category: {$product['category_name']}, Vendor: {$product['business_name']}\\n\";\n    echo \"  Images: \" . print_r($product['images'], true) . \"\\n\";\n    echo \"\\n\";\n}\n\n// Test categories\necho \"2. Testing get_categories():\\n\";\n$categories = $product_manager->get_categories();\necho \"Found \" . count($categories) . \" categories\\n\";\n\nforeach (array_slice($categories, 0, 10) as $category) {\n    echo \"- ID: {$category['id']}, Name: {$category['name']}, Product Count: {$category['product_count']}\\n\";\n}\n\n// Test specific category (Sports)\necho \"\\n3. Testing Sports category products:\\n\";\n$sports_category = null;\nforeach ($categories as $cat) {\n    if ($cat['name'] === 'Sports') {\n        $sports_category = $cat;\n        break;\n    }\n}\n\nif ($sports_category) {\n    echo \"Sports category ID: {$sports_category['id']}\\n\";\n    $sports_products = $product_manager->get_products(10, 0, $sports_category['id']);\n    echo \"Found \" . count($sports_products) . \" sports products\\n\";\n    \n    foreach ($sports_products as $product) {\n        echo \"- {$product['name']}\\n\";\n    }\n} else {\n    echo \"Sports category not found!\\n\";\n}\n\necho \"\\n=== Debug Complete ===\\n\";\n?>","size_bytes":1626},"index.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/product.php';\nrequire_once './includes/settings.php';\nrequire_once './includes/ad_display.php';\n\n$productManager = new ProductManager();\n$settingsManager = new SettingsManager();\n$adDisplay = new AdDisplay();\n\n// Get featured products and categories\n$featuredProducts = $productManager->getFeaturedProducts(12);\n$categories = $productManager->getCategories();\n$flashDeals = $productManager->getFlashDeals(6);\n\n// Get site settings\n$siteName = $settingsManager->getSiteName();\n$siteDescription = $settingsManager->getSiteDescription();\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title><?php echo $siteName; ?> - <?php echo $siteDescription; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <style>\n        .line-clamp-2 {\n            display: -webkit-box;\n            -webkit-line-clamp: 2;\n            -webkit-box-orient: vertical;\n            overflow: hidden;\n        }\n    </style>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n    <style>\n        @keyframes float {\n            0%, 100% { transform: translateY(0px) rotate(0deg); }\n            33% { transform: translateY(-20px) rotate(120deg); }\n            66% { transform: translateY(10px) rotate(240deg); }\n        }\n        @keyframes float-reverse {\n            0%, 100% { transform: translateY(0px) rotate(0deg); }\n            33% { transform: translateY(15px) rotate(-90deg); }\n            66% { transform: translateY(-25px) rotate(-180deg); }\n        }\n        @keyframes spin-slow {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n        }\n        .animate-float { animation: float 6s ease-in-out infinite; }\n        .animate-float-reverse { animation: float-reverse 8s ease-in-out infinite; }\n        .animate-spin-slow { animation: spin-slow 20s linear infinite; }\n        .floating-element {\n            backdrop-filter: blur(10px);\n            box-shadow: 0 8px 32px 0 rgba(255, 255, 255, 0.1);\n        }\n        .card-3d {\n            transform-style: preserve-3d;\n            transition: transform 0.3s ease;\n            perspective: 1000px;\n        }\n        .card-3d:hover {\n            transform: perspective(1000px) rotateY(5deg) rotateX(3deg) translateZ(10px);\n        }\n        @media (prefers-reduced-motion: reduce) {\n            .animate-float, .animate-float-reverse, .animate-spin-slow, .card-3d {\n                animation: none;\n                transform: none !important;\n            }\n        }\n    </style>\n</head>\n<body class=\"bg-gray-50 font-sans\">\n    <!-- Professional Header -->\n    <header class=\"bg-white shadow-sm sticky top-0 z-50 border-b\">\n        <!-- Top Bar -->\n        <div class=\"bg-primary text-white text-sm\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2\">\n                <div class=\"flex justify-between items-center\">\n                    <div class=\"flex items-center space-x-6\">\n                        <span>📍 Free shipping on orders over $50</span>\n                        <span>📞 Customer Service: 1-800-MARKET-NEST</span>\n                    </div>\n                    <div class=\"flex items-center space-x-4\">\n                        <?php if (!is_logged_in()): ?>\n                            <a href=\"login.php\" class=\"hover:text-gray-300\">Sign In</a>\n                            <span class=\"text-gray-400\">|</span>\n                            <a href=\"register.php\" class=\"hover:text-gray-300\">Create Account</a>\n                        <?php else: ?>\n                            <span>Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                            <a href=\"logout.php\" class=\"hover:text-gray-300\">Sign Out</a>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Main Header -->\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex items-center justify-between h-16\">\n                <!-- Logo -->\n                <div class=\"flex items-center\">\n                    <a href=\"index.php\" class=\"flex items-center\">\n                        <div class=\"w-10 h-10 bg-accent rounded-lg flex items-center justify-center mr-3\">\n                            <span class=\"text-white font-bold text-lg\">MN</span>\n                        </div>\n                        <span class=\"text-2xl font-bold text-primary\"><?php echo $siteName; ?></span>\n                    </a>\n                </div>\n                \n                <!-- Search Bar -->\n                <div class=\"flex-1 max-w-2xl mx-8\">\n                    <form action=\"products.php\" method=\"GET\" class=\"relative\">\n                        <div class=\"flex\">\n                            <input type=\"text\" name=\"search\" placeholder=\"Search products, brands, and more...\" \n                                   class=\"flex-1 px-4 py-3 border-2 border-gray-200 rounded-l-lg focus:outline-none focus:border-accent text-gray-700\">\n                            <button type=\"submit\" class=\"bg-accent hover:bg-blue-600 text-white px-6 py-3 rounded-r-lg transition-colors\">\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n                                </svg>\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                \n                <!-- User Actions -->\n                <div class=\"flex items-center space-x-6\">\n                    <?php if (is_logged_in()): ?>\n                        <?php if (get_user_role() === 'customer'): ?>\n                            <a href=\"cart.php\" class=\"flex items-center text-gray-700 hover:text-accent relative\">\n                                <svg class=\"w-6 h-6 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m6-5V6a2 2 0 00-2-2H9a2 2 0 00-2 2v3\"></path>\n                                </svg>\n                                <span class=\"font-medium\">Cart</span>\n                                <span id=\"cart-count\" class=\"absolute -top-2 -right-2 bg-warning text-white text-xs rounded-full h-5 w-5 flex items-center justify-center\">0</span>\n                            </a>\n                            \n                            <a href=\"wishlist.php\" class=\"flex items-center text-gray-700 hover:text-accent relative\">\n                                <svg class=\"w-6 h-6 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                                </svg>\n                                <span class=\"font-medium\">Wishlist</span>\n                                <span id=\"wishlist-count\" class=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center\">0</span>\n                            </a>\n                        <?php endif; ?>\n                        \n                        <div class=\"relative group\">\n                            <button class=\"flex items-center text-gray-700 hover:text-accent\">\n                                <svg class=\"w-6 h-6 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                                </svg>\n                                <span class=\"font-medium\">Account</span>\n                            </button>\n                            <div class=\"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200\">\n                                <div class=\"py-2\">\n                                    <?php if (get_user_role() === 'customer'): ?>\n                                        <a href=\"user/dashboard.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Dashboard</a>\n                                    <?php elseif (get_user_role() === 'vendor'): ?>\n                                        <a href=\"vendor/dashboard.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Vendor Panel</a>\n                                    <?php elseif (get_user_role() === 'admin'): ?>\n                                        <a href=\"admin/dashboard.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Admin Panel</a>\n                                    <?php endif; ?>\n                                    <a href=\"order-history.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Orders</a>\n                                    <a href=\"track.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Track Package</a>\n                                    <hr class=\"my-1\">\n                                    <a href=\"logout.php\" class=\"block px-4 py-2 text-gray-700 hover:bg-gray-50\">Sign Out</a>\n                                </div>\n                            </div>\n                        </div>\n                    <?php else: ?>\n                        <a href=\"track.php\" class=\"flex items-center text-gray-700 hover:text-accent\">\n                            <svg class=\"w-6 h-6 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                            </svg>\n                            <span class=\"font-medium\">Track</span>\n                        </a>\n                        <a href=\"login.php\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors font-medium\">Sign In</a>\n                    <?php endif; ?>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Category Navigation -->\n        <div class=\"border-t bg-gray-50\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <nav class=\"flex items-center space-x-8 py-3 overflow-x-auto\">\n                    <a href=\"products.php\" class=\"whitespace-nowrap text-gray-700 hover:text-accent font-medium\">All Products</a>\n                    <?php foreach (array_slice($categories, 0, 8) as $category): ?>\n                        <a href=\"products.php?category=<?php echo urlencode($category['name']); ?>\" \n                           class=\"whitespace-nowrap text-gray-700 hover:text-accent flex items-center\">\n                            <span class=\"mr-2\"><?php echo $category['icon'] ?? '📦'; ?></span>\n                            <?php echo htmlspecialchars($category['name']); ?>\n                        </a>\n                    <?php endforeach; ?>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <!-- Top Banner Ad -->\n    <?php echo $adDisplay->displayAds('banner', 'top', 1); ?>\n\n    <!-- Hero Section with 3D Animation Background -->\n    <section class=\"relative bg-gradient-to-r from-accent to-blue-600 text-white overflow-hidden\">\n        <!-- 3D Floating Elements Animation -->\n        <div class=\"absolute inset-0 overflow-hidden pointer-events-none\">\n            <div class=\"floating-element absolute top-10 left-10 w-16 h-16 bg-white bg-opacity-10 rounded-lg animate-float\"></div>\n            <div class=\"floating-element absolute top-20 right-20 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-pulse\"></div>\n            <div class=\"floating-element absolute bottom-20 left-20 w-20 h-20 bg-white bg-opacity-10 rounded-lg animate-spin-slow\"></div>\n            <div class=\"floating-element absolute bottom-10 right-10 w-14 h-14 bg-white bg-opacity-10 rounded-full animate-float-reverse\"></div>\n            <div class=\"floating-element absolute top-1/2 left-1/4 w-8 h-8 bg-white bg-opacity-10 rounded-lg animate-bounce\" style=\"animation-delay: 1s;\"></div>\n            <div class=\"floating-element absolute top-1/3 right-1/3 w-10 h-10 bg-white bg-opacity-10 rounded-full animate-float\" style=\"animation-delay: 2s;\"></div>\n        </div>\n        \n        <!-- Gradient Overlay for depth -->\n        <div class=\"absolute inset-0 bg-gradient-to-br from-transparent via-blue-500 to-accent opacity-30\"></div>\n        \n        <div class=\"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n            <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n                <div>\n                    <h1 class=\"text-5xl lg:text-6xl font-bold leading-tight mb-6\">\n                        Discover Everything You Need at \n                        <span class=\"text-yellow-300\"><?php echo SITE_NAME; ?></span>\n                    </h1>\n                    <p class=\"text-xl text-blue-100 mb-8 leading-relaxed\">\n                        From daily essentials to unique finds - explore millions of products with fast delivery, secure payment, and advanced tracking.\n                    </p>\n                    <div class=\"flex flex-col sm:flex-row gap-4\">\n                        <a href=\"products.php\" class=\"bg-white text-accent px-8 py-4 rounded-lg text-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg\">\n                            Start Shopping\n                        </a>\n                        <a href=\"#categories\" class=\"border-2 border-white text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-white hover:text-accent transition-colors\">\n                            Browse Categories\n                        </a>\n                    </div>\n                </div>\n                <div class=\"relative\">\n                    <div class=\"bg-white/10 rounded-2xl p-8 backdrop-blur-sm\">\n                        <div class=\"grid grid-cols-2 gap-4\">\n                            <div class=\"bg-white/20 rounded-lg p-4 text-center\">\n                                <div class=\"text-3xl mb-2\">🚚</div>\n                                <div class=\"font-semibold\">Fast Delivery</div>\n                            </div>\n                            <div class=\"bg-white/20 rounded-lg p-4 text-center\">\n                                <div class=\"text-3xl mb-2\">🔒</div>\n                                <div class=\"font-semibold\">Secure Payment</div>\n                            </div>\n                            <div class=\"bg-white/20 rounded-lg p-4 text-center\">\n                                <div class=\"text-3xl mb-2\">📱</div>\n                                <div class=\"font-semibold\">Easy Tracking</div>\n                            </div>\n                            <div class=\"bg-white/20 rounded-lg p-4 text-center\">\n                                <div class=\"text-3xl mb-2\">💯</div>\n                                <div class=\"font-semibold\">Quality Guarantee</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <!-- Flash Deals Section -->\n    <?php if (!empty($flashDeals)): ?>\n    <section class=\"py-12 bg-white\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex items-center justify-between mb-8\">\n                <div>\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-2\">⚡ Flash Deals</h2>\n                    <p class=\"text-gray-600\">Limited time offers - grab them while you can!</p>\n                </div>\n                <a href=\"products.php?deals=1\" class=\"text-accent hover:text-blue-600 font-semibold\">View All Deals →</a>\n            </div>\n            <div class=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n                <?php foreach ($flashDeals as $product): ?>\n                    <div class=\"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden border group card-3d\">\n                        <div class=\"relative\">\n                            <img src=\"<?php echo htmlspecialchars((!empty($product['images']) && is_array($product['images'])) ? $product['images'][0] : 'https://via.placeholder.com/200x200?text=Product'); ?>\" \n                                 alt=\"<?php echo htmlspecialchars($product['name']); ?>\" \n                                 class=\"w-full h-40 object-cover group-hover:scale-105 transition-transform duration-300\">\n                            <div class=\"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-bold\">\n                                <?php echo $product['discount_percentage']; ?>% OFF\n                            </div>\n                        </div>\n                        <div class=\"p-3\">\n                            <h3 class=\"font-medium text-gray-900 text-sm mb-2 line-clamp-2\"><?php echo htmlspecialchars($product['name']); ?></h3>\n                            <div class=\"flex items-center justify-between\">\n                                <div>\n                                    <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($product['sale_price']); ?></span>\n                                    <span class=\"text-sm text-gray-500 line-through ml-1\"><?php echo format_currency($product['price']); ?></span>\n                                </div>\n                                <a href=\"product-detail.php?id=<?php echo $product['id']; ?>\" \n                                   class=\"bg-accent text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors\">\n                                    View\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        </div>\n    </section>\n    <?php endif; ?>\n\n    <!-- Categories Section -->\n    <section id=\"categories\" class=\"py-12 bg-gray-50\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"text-center mb-12\">\n                <h2 class=\"text-3xl font-bold text-gray-900 mb-4\">Shop by Category</h2>\n                <p class=\"text-gray-600 max-w-2xl mx-auto\">Find exactly what you're looking for in our carefully curated categories</p>\n            </div>\n            <div class=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6\">\n                <?php foreach ($categories as $category): ?>\n                    <a href=\"products.php?category=<?php echo urlencode($category['name']); ?>\" \n                       class=\"group bg-white rounded-xl p-6 text-center hover:shadow-lg transition-all duration-300 border hover:border-accent card-3d\">\n                        <div class=\"w-16 h-16 bg-gradient-to-br from-accent/10 to-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:from-accent/20 group-hover:to-blue-200 transition-colors\">\n                            <span class=\"text-2xl\"><?php echo $category['icon'] ?? '📦'; ?></span>\n                        </div>\n                        <h3 class=\"font-semibold text-gray-900 mb-1\"><?php echo htmlspecialchars($category['name']); ?></h3>\n                        <p class=\"text-sm text-gray-500\"><?php echo $category['product_count']; ?> items</p>\n                    </a>\n                <?php endforeach; ?>\n            </div>\n        </div>\n    </section>\n\n    <!-- Featured Products -->\n    <section class=\"py-12 bg-white\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex items-center justify-between mb-8\">\n                <div>\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-2\">Featured Products</h2>\n                    <p class=\"text-gray-600\">Handpicked items just for you</p>\n                </div>\n                <a href=\"products.php\" class=\"text-accent hover:text-blue-600 font-semibold\">View All Products →</a>\n            </div>\n            <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                <?php foreach ($featuredProducts as $product): ?>\n                    <div class=\"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden border group card-3d\">\n                        <div class=\"relative\">\n                            <img src=\"<?php echo htmlspecialchars((!empty($product['images']) && is_array($product['images'])) ? $product['images'][0] : 'https://via.placeholder.com/200x200?text=Product'); ?>\" \n                                 alt=\"<?php echo htmlspecialchars($product['name']); ?>\" \n                                 class=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\">\n                            <div class=\"absolute top-2 left-2 bg-accent text-white text-xs px-2 py-1 rounded\">\n                                Featured\n                            </div>\n                        </div>\n                        <div class=\"p-4\">\n                            <h3 class=\"font-medium text-gray-900 mb-2 text-sm leading-tight\"><?php echo htmlspecialchars($product['name']); ?></h3>\n                            <p class=\"text-gray-500 text-xs mb-3 line-clamp-2\"><?php echo htmlspecialchars(substr($product['description'], 0, 60)); ?>...</p>\n                            <div class=\"flex items-center justify-between\">\n                                <div class=\"flex flex-col\">\n                                    <?php if ($product['sale_price'] && $product['sale_price'] < $product['price']): ?>\n                                        <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($product['sale_price']); ?></span>\n                                        <span class=\"text-sm text-red-500 line-through\"><?php echo format_currency($product['price']); ?></span>\n                                    <?php else: ?>\n                                        <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($product['price']); ?></span>\n                                    <?php endif; ?>\n                                </div>\n                                <a href=\"product-detail.php?id=<?php echo $product['id']; ?>\" \n                                   class=\"bg-accent text-white px-3 py-1.5 rounded-lg text-xs hover:bg-blue-600 transition-colors\">\n                                    View\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        </div>\n    </section>\n\n    <!-- Features Section -->\n    <section class=\"py-16 bg-primary text-white\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"text-center mb-12\">\n                <h2 class=\"text-3xl font-bold mb-4\">Why Choose Market Nest?</h2>\n                <p class=\"text-lg text-gray-300\">Experience the difference with our premium marketplace</p>\n            </div>\n            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n                <div class=\"text-center group card-3d\">\n                    <div class=\"w-20 h-20 bg-accent rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300\">\n                        <svg class=\"w-10 h-10 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <h3 class=\"text-xl font-bold mb-3\">Verified Quality</h3>\n                    <p class=\"text-gray-300 leading-relaxed\">Every product is carefully vetted by our quality assurance team to ensure you receive only the best.</p>\n                </div>\n                \n                <div class=\"text-center group card-3d\">\n                    <div class=\"w-20 h-20 bg-success rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300\">\n                        <svg class=\"w-10 h-10 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"></path>\n                        </svg>\n                    </div>\n                    <h3 class=\"text-xl font-bold mb-3\">Lightning Fast Delivery</h3>\n                    <p class=\"text-gray-300 leading-relaxed\">Get your orders delivered in record time with our optimized logistics network and real-time tracking.</p>\n                </div>\n                \n                <div class=\"text-center group card-3d\">\n                    <div class=\"w-20 h-20 bg-warning rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300\">\n                        <svg class=\"w-10 h-10 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n                        </svg>\n                    </div>\n                    <h3 class=\"text-xl font-bold mb-3\">Secure & Protected</h3>\n                    <p class=\"text-gray-300 leading-relaxed\">Shop with confidence knowing your data and transactions are protected by bank-grade security.</p>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <!-- Footer -->\n    <footer class=\"bg-gray-900 text-white\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-8 mb-8\">\n                <div>\n                    <div class=\"flex items-center mb-4\">\n                        <div class=\"w-8 h-8 bg-accent rounded-lg flex items-center justify-center mr-2\">\n                            <span class=\"text-white font-bold\">MN</span>\n                        </div>\n                        <span class=\"text-xl font-bold\"><?php echo SITE_NAME; ?></span>\n                    </div>\n                    <p class=\"text-gray-400 mb-4 leading-relaxed\">Your trusted marketplace for quality products, fast delivery, and exceptional service.</p>\n                    <div class=\"flex space-x-4\">\n                        <a href=\"#\" class=\"text-gray-400 hover:text-accent transition-colors\">\n                            <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z\"/>\n                            </svg>\n                        </a>\n                        <a href=\"#\" class=\"text-gray-400 hover:text-accent transition-colors\">\n                            <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z\"/>\n                            </svg>\n                        </a>\n                        <a href=\"#\" class=\"text-gray-400 hover:text-accent transition-colors\">\n                            <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.754-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z\"/>\n                            </svg>\n                        </a>\n                    </div>\n                </div>\n                \n                <div>\n                    <h4 class=\"font-semibold mb-4 text-lg\">Shop</h4>\n                    <ul class=\"space-y-3 text-gray-400\">\n                        <li><a href=\"products.php\" class=\"hover:text-accent transition-colors\">All Products</a></li>\n                        <li><a href=\"products.php?deals=1\" class=\"hover:text-accent transition-colors\">Flash Deals</a></li>\n                        <li><a href=\"products.php?featured=1\" class=\"hover:text-accent transition-colors\">Featured Items</a></li>\n                        <li><a href=\"vendor-application.php\" class=\"hover:text-accent transition-colors\">Become a Seller</a></li>\n                    </ul>\n                </div>\n                \n                <div>\n                    <h4 class=\"font-semibold mb-4 text-lg\">Customer Service</h4>\n                    <ul class=\"space-y-3 text-gray-400\">\n                        <li><a href=\"track.php\" class=\"hover:text-accent transition-colors\">Track Your Order</a></li>\n                        <li><a href=\"#\" class=\"hover:text-accent transition-colors\">Help Center</a></li>\n                        <li><a href=\"#\" class=\"hover:text-accent transition-colors\">Returns & Refunds</a></li>\n                        <li><a href=\"#\" class=\"hover:text-accent transition-colors\">Contact Support</a></li>\n                    </ul>\n                </div>\n                \n                <div>\n                    <h4 class=\"font-semibold mb-4 text-lg\">Account</h4>\n                    <ul class=\"space-y-3 text-gray-400\">\n                        <?php if (is_logged_in()): ?>\n                            <li><a href=\"user/dashboard.php\" class=\"hover:text-accent transition-colors\">My Account</a></li>\n                            <li><a href=\"order-history.php\" class=\"hover:text-accent transition-colors\">Order History</a></li>\n                        <?php else: ?>\n                            <li><a href=\"login.php\" class=\"hover:text-accent transition-colors\">Sign In</a></li>\n                            <li><a href=\"register.php\" class=\"hover:text-accent transition-colors\">Create Account</a></li>\n                        <?php endif; ?>\n                        <li><a href=\"#\" class=\"hover:text-accent transition-colors\">Privacy Policy</a></li>\n                        <li><a href=\"#\" class=\"hover:text-accent transition-colors\">Terms of Service</a></li>\n                    </ul>\n                </div>\n            </div>\n            \n            <div class=\"border-t border-gray-800 pt-8\">\n                <div class=\"flex flex-col md:flex-row justify-between items-center\">\n                    <p class=\"text-gray-400 mb-4 md:mb-0\">&copy; 2024 <?php echo SITE_NAME; ?>. All rights reserved.</p>\n                    <div class=\"flex items-center space-x-6 text-sm text-gray-400\">\n                        <span>🔒 Secure Shopping</span>\n                        <span>🚚 Fast Delivery</span>\n                        <span>💳 Multiple Payment Options</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </footer>\n\n    <!-- Scripts -->\n    <script>\n        // Update cart count on page load\n        if (document.getElementById('cart-count')) {\n            fetch('api/cart-count.php')\n                .then(response => response.json())\n                .then(data => {\n                    document.getElementById('cart-count').textContent = data.count || 0;\n                })\n                .catch(error => console.error('Error fetching cart count:', error));\n        }\n        \n        // Update wishlist count on page load\n        if (document.getElementById('wishlist-count')) {\n            fetch('api/wishlist-count.php')\n                .then(response => response.json())\n                .then(data => {\n                    document.getElementById('wishlist-count').textContent = data.count || 0;\n                })\n                .catch(error => console.error('Error fetching wishlist count:', error));\n        }\n    </script>\n    \n    <?php echo getAdTrackingScript(); ?>\n</body>\n</html>","size_bytes":34501},"login.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/auth.php';\n\n$auth = new Auth();\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = sanitize_input($_POST['username']);\n    $password = $_POST['password'];\n    \n    $result = $auth->login($username, $password);\n    \n    if ($result['success']) {\n        $success = $result['message'];\n        // Redirect based on role\n        $role = get_user_role();\n        if ($role === 'admin') {\n            redirect('admin/dashboard.php');\n        } elseif ($role === 'vendor') {\n            redirect('vendor/dashboard.php');\n        } else {\n            redirect('index.php');\n        }\n    } else {\n        $error = $result['message'];\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Sign In - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n</head>\n<body class=\"bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans\">\n    <div class=\"min-h-screen flex\">\n        <!-- Left Side - Branding -->\n        <div class=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary via-secondary to-accent relative overflow-hidden\">\n            <div class=\"absolute inset-0 bg-black/20\"></div>\n            <div class=\"relative z-10 flex items-center justify-center w-full p-12\">\n                <div class=\"text-center text-white\">\n                    <div class=\"flex items-center justify-center mb-8\">\n                        <div class=\"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mr-4\">\n                            <span class=\"text-white font-bold text-2xl\">MN</span>\n                        </div>\n                        <span class=\"text-4xl font-bold\"><?php echo SITE_NAME; ?></span>\n                    </div>\n                    <h2 class=\"text-3xl font-bold mb-6\">Welcome Back!</h2>\n                    <p class=\"text-xl text-blue-100 leading-relaxed max-w-md\">\n                        Sign in to access your account and continue your amazing shopping experience.\n                    </p>\n                    <div class=\"mt-12 grid grid-cols-3 gap-6\">\n                        <div class=\"text-center\">\n                            <div class=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-3\">\n                                <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n                                </svg>\n                            </div>\n                            <p class=\"text-sm\">Secure</p>\n                        </div>\n                        <div class=\"text-center\">\n                            <div class=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-3\">\n                                <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"></path>\n                                </svg>\n                            </div>\n                            <p class=\"text-sm\">Fast</p>\n                        </div>\n                        <div class=\"text-center\">\n                            <div class=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-3\">\n                                <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                                </svg>\n                            </div>\n                            <p class=\"text-sm\">Trusted</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Right Side - Login Form -->\n        <div class=\"flex-1 flex items-center justify-center p-8 lg:p-12\">\n            <div class=\"w-full max-w-md space-y-8\">\n                <!-- Mobile Logo -->\n                <div class=\"lg:hidden text-center\">\n                    <div class=\"flex items-center justify-center mb-6\">\n                        <div class=\"w-12 h-12 bg-accent rounded-xl flex items-center justify-center mr-3\">\n                            <span class=\"text-white font-bold text-lg\">MN</span>\n                        </div>\n                        <span class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></span>\n                    </div>\n                </div>\n\n                <div>\n                    <h2 class=\"text-3xl font-bold text-gray-900 mb-2\">Sign in</h2>\n                    <p class=\"text-gray-600\">Enter your credentials to access your account</p>\n                </div>\n                \n                <?php if ($error): ?>\n                    <div class=\"bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg\">\n                        <div class=\"flex\">\n                            <div class=\"flex-shrink-0\">\n                                <svg class=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\" />\n                                </svg>\n                            </div>\n                            <div class=\"ml-3\">\n                                <p class=\"text-sm text-red-700\"><?php echo $error; ?></p>\n                            </div>\n                        </div>\n                    </div>\n                <?php endif; ?>\n                \n                <?php if ($success): ?>\n                    <div class=\"bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg\">\n                        <div class=\"flex\">\n                            <div class=\"flex-shrink-0\">\n                                <svg class=\"h-5 w-5 text-green-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\n                                </svg>\n                            </div>\n                            <div class=\"ml-3\">\n                                <p class=\"text-sm text-green-700\"><?php echo $success; ?></p>\n                            </div>\n                        </div>\n                    </div>\n                <?php endif; ?>\n                \n                <form class=\"space-y-6\" method=\"POST\">\n                    <div>\n                        <label for=\"username\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Username or Email\n                        </label>\n                        <div class=\"relative\">\n                            <div class=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                <svg class=\"h-5 w-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                                </svg>\n                            </div>\n                            <input id=\"username\" name=\"username\" type=\"text\" required \n                                   class=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                   placeholder=\"Enter your username or email\">\n                        </div>\n                    </div>\n                    \n                    <div>\n                        <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Password\n                        </label>\n                        <div class=\"relative\">\n                            <div class=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                <svg class=\"h-5 w-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n                                </svg>\n                            </div>\n                            <input id=\"password\" name=\"password\" type=\"password\" required \n                                   class=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                   placeholder=\"Enter your password\">\n                        </div>\n                    </div>\n                    \n                    <div class=\"flex items-center justify-between\">\n                        <div class=\"flex items-center\">\n                            <input id=\"remember-me\" name=\"remember-me\" type=\"checkbox\" class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                            <label for=\"remember-me\" class=\"ml-2 block text-sm text-gray-700\">\n                                Remember me\n                            </label>\n                        </div>\n                        <a href=\"#\" class=\"text-sm text-accent hover:text-blue-600 font-medium\">\n                            Forgot password?\n                        </a>\n                    </div>\n                    \n                    <div>\n                        <button type=\"submit\" \n                                class=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-xl text-white bg-accent hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-200 shadow-lg hover:shadow-xl\">\n                            <span class=\"absolute left-0 inset-y-0 flex items-center pl-3\">\n                                <svg class=\"h-5 w-5 text-blue-300 group-hover:text-blue-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\"></path>\n                                </svg>\n                            </span>\n                            Sign in to your account\n                        </button>\n                    </div>\n                </form>\n\n                <!-- Divider -->\n                <div class=\"relative\">\n                    <div class=\"absolute inset-0 flex items-center\">\n                        <div class=\"w-full border-t border-gray-300\"></div>\n                    </div>\n                    <div class=\"relative flex justify-center text-sm\">\n                        <span class=\"px-2 bg-white text-gray-500\">New to Market Nest?</span>\n                    </div>\n                </div>\n\n                <!-- Sign up link -->\n                <div class=\"text-center\">\n                    <a href=\"register.php\" class=\"w-full inline-flex justify-center items-center px-4 py-3 border border-gray-300 rounded-xl shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-200\">\n                        <svg class=\"w-5 h-5 mr-2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"></path>\n                        </svg>\n                        Create new account\n                    </a>\n                </div>\n\n                <!-- Back to home -->\n                <div class=\"text-center\">\n                    <a href=\"index.php\" class=\"text-sm text-gray-500 hover:text-accent font-medium\">\n                        ← Back to <?php echo SITE_NAME; ?>\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>","size_bytes":13843},"logout.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/auth.php';\n\n$auth = new Auth();\n$auth->logout();\nredirect('index.php');\n?>\n","size_bytes":142},"order-confirmation.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/order.php';\n\nrequire_login();\n\n$order_number = $_GET['order'] ?? null;\nif (!$order_number) {\n    redirect('index.php');\n}\n\n$order_manager = new OrderManager();\n\n// Get order by order number\n$database = new Database();\n$db = $database->getConnection();\n$stmt = $db->prepare(\"SELECT id FROM orders WHERE order_number = ? AND user_id = ?\");\n$stmt->execute([$order_number, $_SESSION['user_id']]);\n$order_data = $stmt->fetch(PDO::FETCH_ASSOC);\n\nif (!$order_data) {\n    redirect('index.php');\n}\n\n$order = $order_manager->get_order_by_id($order_data['id'], $_SESSION['user_id']);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Order Confirmation - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Order Confirmation</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"order-history.php\" class=\"text-gray-700 hover:text-accent\">Order History</a>\n                    <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <!-- Success Message -->\n        <div class=\"text-center mb-8\">\n            <div class=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <span class=\"text-green-600 text-2xl\">✓</span>\n            </div>\n            <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">Order Confirmed!</h1>\n            <p class=\"text-gray-600\">Thank you for your purchase. Your order has been placed successfully.</p>\n        </div>\n        \n        <!-- Order Details -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\n            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Order Number</h3>\n                    <p class=\"text-lg font-semibold text-gray-900\"><?php echo $order['order_number']; ?></p>\n                </div>\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Order Date</h3>\n                    <p class=\"text-lg font-semibold text-gray-900\"><?php echo date('M j, Y g:i A', strtotime($order['created_at'])); ?></p>\n                </div>\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Total Amount</h3>\n                    <p class=\"text-lg font-semibold text-accent\"><?php echo format_currency($order['total_amount']); ?></p>\n                </div>\n            </div>\n            \n            <?php if ($order['tracking_number']): ?>\n                <div class=\"bg-blue-50 border border-blue-200 rounded-md p-4\">\n                    <div class=\"flex items-center\">\n                        <span class=\"text-accent text-xl mr-3\">📦</span>\n                        <div>\n                            <h4 class=\"font-medium text-blue-800\">Tracking Information</h4>\n                            <p class=\"text-sm text-blue-700\">\n                                Tracking Number: <strong><?php echo $order['tracking_number']; ?></strong>\n                            </p>\n                            <a href=\"track.php?tracking=<?php echo $order['tracking_number']; ?>\" \n                               class=\"text-sm text-accent hover:text-blue-800 font-medium\">\n                                Track your shipment →\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- Order Items -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\n            <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Order Items</h2>\n            <div class=\"divide-y divide-gray-200\">\n                <?php foreach ($order['items'] as $item): ?>\n                    <div class=\"py-4 flex items-center space-x-4\">\n                        <div class=\"flex-shrink-0\">\n                            <?php if (!empty($item['images'])): ?>\n                                <img src=\"<?php echo $item['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($item['name']); ?>\" \n                                     class=\"w-16 h-16 object-cover rounded-md\">\n                            <?php else: ?>\n                                <div class=\"w-16 h-16 bg-gray-200 rounded-md flex items-center justify-center\">\n                                    <span class=\"text-gray-400 text-xs\">No Image</span>\n                                </div>\n                            <?php endif; ?>\n                        </div>\n                        \n                        <div class=\"flex-1\">\n                            <h3 class=\"font-medium text-gray-900\"><?php echo htmlspecialchars($item['name']); ?></h3>\n                            <p class=\"text-sm text-gray-600\">by <?php echo htmlspecialchars($item['business_name']); ?></p>\n                            <p class=\"text-sm text-gray-600\">Quantity: <?php echo $item['quantity']; ?></p>\n                        </div>\n                        \n                        <div class=\"text-right\">\n                            <p class=\"font-medium text-gray-900\">$<?php echo number_format($item['total'], 2); ?></p>\n                            <p class=\"text-sm text-gray-600\">$<?php echo number_format($item['price'], 2); ?> each</p>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        </div>\n        \n        <!-- Order Summary -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\n            <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Order Summary</h2>\n            <div class=\"space-y-2\">\n                <div class=\"flex justify-between\">\n                    <span class=\"text-gray-600\">Subtotal</span>\n                    <span>$<?php echo number_format($order['total_amount'] - $order['tax_amount'] - $order['shipping_amount'] + $order['discount_amount'], 2); ?></span>\n                </div>\n                \n                <?php if ($order['discount_amount'] > 0): ?>\n                    <div class=\"flex justify-between text-green-600\">\n                        <span>Discount</span>\n                        <span>-$<?php echo number_format($order['discount_amount'], 2); ?></span>\n                    </div>\n                <?php endif; ?>\n                \n                <div class=\"flex justify-between\">\n                    <span class=\"text-gray-600\">Shipping</span>\n                    <span><?php echo $order['shipping_amount'] > 0 ? '$' . number_format($order['shipping_amount'], 2) : 'Free'; ?></span>\n                </div>\n                <div class=\"flex justify-between\">\n                    <span class=\"text-gray-600\">Tax</span>\n                    <span>$<?php echo number_format($order['tax_amount'], 2); ?></span>\n                </div>\n                <div class=\"border-t pt-2\">\n                    <div class=\"flex justify-between font-semibold text-lg\">\n                        <span>Total</span>\n                        <span class=\"text-accent\">$<?php echo number_format($order['total_amount'], 2); ?></span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Addresses -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                <h3 class=\"text-lg font-semibold text-gray-900 mb-3\">Shipping Address</h3>\n                <p class=\"text-gray-700 whitespace-pre-line\"><?php echo htmlspecialchars($order['shipping_address']); ?></p>\n            </div>\n            \n            <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                <h3 class=\"text-lg font-semibold text-gray-900 mb-3\">Billing Address</h3>\n                <p class=\"text-gray-700 whitespace-pre-line\"><?php echo htmlspecialchars($order['billing_address']); ?></p>\n            </div>\n        </div>\n        \n        <!-- Action Buttons -->\n        <div class=\"text-center space-x-4\">\n            <a href=\"products.php\" class=\"bg-accent text-white px-6 py-3 rounded-md font-medium hover:bg-blue-600 transition duration-200\">\n                Continue Shopping\n            </a>\n            <a href=\"order-history.php\" class=\"border border-gray-300 text-gray-700 px-6 py-3 rounded-md font-medium hover:bg-gray-50 transition duration-200\">\n                View Order History\n            </a>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":9755},"order-detail.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/order.php';\n\nrequire_login();\n\n$order_id = $_GET['id'] ?? null;\nif (!$order_id) {\n    redirect('order-history.php');\n}\n\n$order_manager = new OrderManager();\n$order = $order_manager->get_order_by_id($order_id, $_SESSION['user_id']);\n\nif (!$order) {\n    redirect('order-history.php');\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Order Details - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"order-history.php\" class=\"text-gray-700 hover:text-accent\">Order History</a>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div class=\"mb-6\">\n            <a href=\"order-history.php\" class=\"text-accent hover:text-blue-600 text-sm font-medium\">\n                ← Back to Order History\n            </a>\n        </div>\n        \n        <h1 class=\"text-3xl font-bold text-gray-900 mb-8\">Order Details</h1>\n        \n        <!-- Order Info -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Order Number</h3>\n                    <p class=\"text-lg font-semibold text-gray-900\"><?php echo $order['order_number']; ?></p>\n                </div>\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Order Date</h3>\n                    <p class=\"text-lg font-semibold text-gray-900\"><?php echo date('M j, Y', strtotime($order['created_at'])); ?></p>\n                </div>\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Status</h3>\n                    <?php\n                    $status_colors = [\n                        'pending' => 'bg-yellow-100 text-yellow-800',\n                        'processing' => 'bg-blue-100 text-blue-800',\n                        'shipped' => 'bg-purple-100 text-purple-800',\n                        'delivered' => 'bg-green-100 text-green-800',\n                        'cancelled' => 'bg-red-100 text-red-800'\n                    ];\n                    ?>\n                    <span class=\"inline-flex px-3 py-1 text-sm font-semibold rounded-full <?php echo $status_colors[$order['status']]; ?>\">\n                        <?php echo ucfirst($order['status']); ?>\n                    </span>\n                </div>\n                <div>\n                    <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Total</h3>\n                    <p class=\"text-lg font-semibold text-accent\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                </div>\n            </div>\n            \n            <?php if ($order['tracking_number']): ?>\n                <div class=\"mt-6 bg-blue-50 border border-blue-200 rounded-md p-4\">\n                    <div class=\"flex items-center justify-between\">\n                        <div class=\"flex items-center\">\n                            <span class=\"text-accent text-xl mr-3\">📦</span>\n                            <div>\n                                <h4 class=\"font-medium text-blue-800\">Tracking Number</h4>\n                                <p class=\"text-sm text-blue-700\"><?php echo $order['tracking_number']; ?></p>\n                            </div>\n                        </div>\n                        <a href=\"track.php?tracking=<?php echo $order['tracking_number']; ?>\" \n                           class=\"bg-accent text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-600 transition duration-200\">\n                            Track Package\n                        </a>\n                    </div>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- Order Items -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\n            <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Order Items</h2>\n            <div class=\"divide-y divide-gray-200\">\n                <?php foreach ($order['items'] as $item): ?>\n                    <div class=\"py-4 flex items-center space-x-4\">\n                        <div class=\"flex-shrink-0\">\n                            <?php if (!empty($item['images'])): ?>\n                                <img src=\"<?php echo $item['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($item['name']); ?>\" \n                                     class=\"w-16 h-16 object-cover rounded-md\">\n                            <?php else: ?>\n                                <div class=\"w-16 h-16 bg-gray-200 rounded-md flex items-center justify-center\">\n                                    <span class=\"text-gray-400 text-xs\">No Image</span>\n                                </div>\n                            <?php endif; ?>\n                        </div>\n                        \n                        <div class=\"flex-1\">\n                            <h3 class=\"font-medium text-gray-900\">\n                                <a href=\"product-detail.php?id=<?php echo $item['product_id']; ?>\" class=\"hover:text-accent\">\n                                    <?php echo htmlspecialchars($item['name']); ?>\n                                </a>\n                            </h3>\n                            <p class=\"text-sm text-gray-600\">by <?php echo htmlspecialchars($item['business_name']); ?></p>\n                            <p class=\"text-sm text-gray-600\">Quantity: <?php echo $item['quantity']; ?> × $<?php echo number_format($item['price'], 2); ?></p>\n                        </div>\n                        \n                        <div class=\"text-right\">\n                            <p class=\"font-medium text-gray-900\">$<?php echo number_format($item['total'], 2); ?></p>\n                            <?php if ($order['status'] === 'delivered'): ?>\n                                <a href=\"add-review.php?product=<?php echo $item['product_id']; ?>&order=<?php echo $order['id']; ?>\" \n                                   class=\"text-sm text-accent hover:text-blue-600 font-medium\">\n                                    Write Review\n                                </a>\n                            <?php endif; ?>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n        </div>\n        \n        <!-- Order Summary & Addresses -->\n        <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <!-- Order Summary -->\n            <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                <h2 class=\"text-xl font-semibold text-gray-900 mb-4\">Order Summary</h2>\n                <div class=\"space-y-2\">\n                    <div class=\"flex justify-between\">\n                        <span class=\"text-gray-600\">Subtotal</span>\n                        <span>$<?php echo number_format($order['total_amount'] - $order['tax_amount'] - $order['shipping_amount'] + $order['discount_amount'], 2); ?></span>\n                    </div>\n                    \n                    <?php if ($order['discount_amount'] > 0): ?>\n                        <div class=\"flex justify-between text-green-600\">\n                            <span>Discount</span>\n                            <span>-$<?php echo number_format($order['discount_amount'], 2); ?></span>\n                        </div>\n                    <?php endif; ?>\n                    \n                    <div class=\"flex justify-between\">\n                        <span class=\"text-gray-600\">Shipping</span>\n                        <span><?php echo $order['shipping_amount'] > 0 ? '$' . number_format($order['shipping_amount'], 2) : 'Free'; ?></span>\n                    </div>\n                    <div class=\"flex justify-between\">\n                        <span class=\"text-gray-600\">Tax</span>\n                        <span>$<?php echo number_format($order['tax_amount'], 2); ?></span>\n                    </div>\n                    <div class=\"border-t pt-2\">\n                        <div class=\"flex justify-between font-semibold text-lg\">\n                            <span>Total</span>\n                            <span class=\"text-accent\">$<?php echo number_format($order['total_amount'], 2); ?></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Addresses -->\n            <div class=\"space-y-6\">\n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h3 class=\"text-lg font-semibold text-gray-900 mb-3\">Shipping Address</h3>\n                    <p class=\"text-gray-700 whitespace-pre-line\"><?php echo htmlspecialchars($order['shipping_address']); ?></p>\n                </div>\n                \n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h3 class=\"text-lg font-semibold text-gray-900 mb-3\">Billing Address</h3>\n                    <p class=\"text-gray-700 whitespace-pre-line\"><?php echo htmlspecialchars($order['billing_address']); ?></p>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":10408},"order-history.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/order.php';\n\nrequire_login();\n\n$order_manager = new OrderManager();\n$page = max(1, $_GET['page'] ?? 1);\n$limit = 10;\n$offset = ($page - 1) * $limit;\n\n$orders = $order_manager->get_user_orders($_SESSION['user_id'], $limit, $offset);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Order History - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Order History</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Shop</a>\n                    <a href=\"cart.php\" class=\"text-gray-700 hover:text-accent\">Cart</a>\n                    <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <h1 class=\"text-3xl font-bold text-gray-900 mb-8\">Order History</h1>\n        \n        <?php if (empty($orders)): ?>\n            <div class=\"text-center py-12\">\n                <div class=\"text-gray-400 text-6xl mb-4\">📋</div>\n                <h3 class=\"text-xl font-medium text-gray-900 mb-2\">No orders yet</h3>\n                <p class=\"text-gray-500 mb-6\">Start shopping to see your orders here!</p>\n                <a href=\"products.php\" class=\"bg-accent text-white px-6 py-3 rounded-md font-medium hover:bg-blue-600 transition duration-200\">\n                    Start Shopping\n                </a>\n            </div>\n        <?php else: ?>\n            <div class=\"space-y-6\">\n                <?php foreach ($orders as $order): ?>\n                    <div class=\"bg-white rounded-lg shadow-sm border\">\n                        <div class=\"px-6 py-4 border-b border-gray-200\">\n                            <div class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n                                <div class=\"flex items-center space-x-4\">\n                                    <div>\n                                        <h3 class=\"text-lg font-semibold text-gray-900\">Order <?php echo $order['order_number']; ?></h3>\n                                        <p class=\"text-sm text-gray-600\">Placed on <?php echo date('M j, Y g:i A', strtotime($order['created_at'])); ?></p>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"mt-4 sm:mt-0 flex items-center space-x-4\">\n                                    <div class=\"text-right\">\n                                        <p class=\"text-lg font-semibold text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                                        <?php\n                                        $status_colors = [\n                                            'pending' => 'bg-yellow-100 text-yellow-800',\n                                            'processing' => 'bg-blue-100 text-blue-800',\n                                            'shipped' => 'bg-purple-100 text-purple-800',\n                                            'delivered' => 'bg-green-100 text-green-800',\n                                            'cancelled' => 'bg-red-100 text-red-800'\n                                        ];\n                                        ?>\n                                        <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full <?php echo $status_colors[$order['status']]; ?>\">\n                                            <?php echo ucfirst($order['status']); ?>\n                                        </span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"px-6 py-4\">\n                            <div class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n                                <div class=\"flex items-center space-x-4\">\n                                    <?php if ($order['tracking_number']): ?>\n                                        <div class=\"flex items-center text-sm text-gray-600\">\n                                            <span class=\"mr-2\">📦</span>\n                                            <span>Tracking: <?php echo $order['tracking_number']; ?></span>\n                                        </div>\n                                    <?php endif; ?>\n                                    \n                                    <?php if ($order['shipment_status']): ?>\n                                        <div class=\"flex items-center text-sm text-gray-600\">\n                                            <span class=\"mr-2\">🚚</span>\n                                            <span><?php echo ucfirst(str_replace('_', ' ', $order['shipment_status'])); ?></span>\n                                        </div>\n                                    <?php endif; ?>\n                                </div>\n                                \n                                <div class=\"mt-4 sm:mt-0 flex space-x-3\">\n                                    <a href=\"order-detail.php?id=<?php echo $order['id']; ?>\" \n                                       class=\"text-accent hover:text-blue-600 text-sm font-medium\">\n                                        View Details\n                                    </a>\n                                    \n                                    <?php if ($order['tracking_number']): ?>\n                                        <a href=\"track.php?tracking=<?php echo $order['tracking_number']; ?>\" \n                                           class=\"text-accent hover:text-blue-600 text-sm font-medium\">\n                                            Track Package\n                                        </a>\n                                    <?php endif; ?>\n                                    \n                                    <?php if ($order['status'] === 'delivered'): ?>\n                                        <a href=\"review-order.php?id=<?php echo $order['id']; ?>\" \n                                           class=\"text-accent hover:text-blue-600 text-sm font-medium\">\n                                            Write Review\n                                        </a>\n                                    <?php endif; ?>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n            \n            <!-- Pagination -->\n            <div class=\"mt-8 flex justify-center\">\n                <div class=\"flex space-x-2\">\n                    <?php if ($page > 1): ?>\n                        <a href=\"?page=<?php echo $page - 1; ?>\" \n                           class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Previous</a>\n                    <?php endif; ?>\n                    \n                    <?php if (count($orders) == $limit): ?>\n                        <a href=\"?page=<?php echo $page + 1; ?>\" \n                           class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Next</a>\n                    <?php endif; ?>\n                </div>\n            </div>\n        <?php endif; ?>\n    </div>\n</body>\n</html>\n","size_bytes":8594},"product-detail.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/product.php';\nrequire_once './includes/cart.php';\nrequire_once './includes/wishlist.php';\n\n$product_id = $_GET['id'] ?? null;\nif (!$product_id) {\n    redirect('products.php');\n}\n\n$product_manager = new ProductManager();\n$cart_manager = new CartManager();\n$wishlist_manager = new WishlistManager();\n\n$product = $product_manager->get_product_by_id($product_id);\nif (!$product) {\n    redirect('products.php');\n}\n\n// Add to recently viewed\nif (is_logged_in()) {\n    $product_manager->add_to_recently_viewed($_SESSION['user_id'], $product_id);\n}\n\n// Handle add to cart\n$message = '';\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['add_to_cart'])) {\n    if (!is_logged_in()) {\n        redirect('login.php');\n    }\n    \n    $quantity = max(1, $_POST['quantity'] ?? 1);\n    $result = $cart_manager->add_to_cart($_SESSION['user_id'], $product_id, $quantity);\n    $message = $result['message'];\n}\n\n// Handle wishlist toggle\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['toggle_wishlist'])) {\n    if (!is_logged_in()) {\n        redirect('login.php');\n    }\n    \n    $is_in_wishlist = $wishlist_manager->is_in_wishlist($_SESSION['user_id'], $product_id);\n    \n    if ($is_in_wishlist) {\n        $result = $wishlist_manager->remove_from_wishlist($_SESSION['user_id'], $product_id);\n    } else {\n        $result = $wishlist_manager->add_to_wishlist($_SESSION['user_id'], $product_id);\n    }\n    \n    $message = $result['message'];\n}\n\n// Handle review submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['submit_review'])) {\n    if (!is_logged_in()) {\n        redirect('login.php');\n    }\n    \n    $rating = (int)($_POST['rating'] ?? 0);\n    $title = trim($_POST['review_title'] ?? '');\n    $comment = trim($_POST['review_comment'] ?? '');\n    $order_id = (int)($_POST['order_id'] ?? 0);\n    \n    // Validate review data\n    if ($rating < 1 || $rating > 5) {\n        $message = 'Please select a valid rating (1-5 stars)';\n    } elseif (empty($comment)) {\n        $message = 'Please write a review comment';\n    } elseif (empty($title)) {\n        $message = 'Please provide a review title';\n    } else {\n        // Check if user has purchased this product or is admin\n        $is_admin = (get_user_role() === 'admin');\n        if (!$is_admin && !$product_manager->hasUserPurchasedProduct($_SESSION['user_id'], $product_id)) {\n            $message = 'You can only review products you have purchased';\n        } else {\n            // For admins, use order_id = NULL (no specific order)\n            $review_order_id = $is_admin ? null : (empty($order_id) ? null : $order_id);\n            $result = $product_manager->add_review($_SESSION['user_id'], $product_id, $review_order_id, $rating, $title, $comment);\n            $message = $result['message'];\n            \n            if ($result['success']) {\n                // Refresh reviews after successful submission\n                $reviews = $product_manager->get_product_reviews($product_id, 5);\n            }\n        }\n    }\n}\n\n// Get reviews (only if not already fetched after form submission)\nif (!isset($reviews)) {\n    $reviews = $product_manager->get_product_reviews($product_id, 5);\n}\n\n\n// Check if in wishlist\n$is_in_wishlist = is_logged_in() ? $wishlist_manager->is_in_wishlist($_SESSION['user_id'], $product_id) : false;\n\n// Check if user can review (has purchased the product or is admin)\n$can_review = false;\n$user_orders = [];\n$is_admin = false;\nif (is_logged_in()) {\n    $is_admin = (get_user_role() === 'admin');\n    $can_review = $is_admin || $product_manager->hasUserPurchasedProduct($_SESSION['user_id'], $product_id);\n    if ($can_review && !$is_admin) {\n        $user_orders = $product_manager->getUserOrdersForProduct($_SESSION['user_id'], $product_id);\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title><?php echo htmlspecialchars($product['name']); ?> - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Products</a>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <?php if (is_logged_in()): ?>\n                        <a href=\"cart.php\" class=\"text-gray-700 hover:text-accent\">Cart</a>\n                        <a href=\"wishlist.php\" class=\"text-gray-700 hover:text-accent\">Wishlist</a>\n                        <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                        <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                    <?php else: ?>\n                        <a href=\"login.php\" class=\"text-accent hover:text-blue-600\">Login</a>\n                        <a href=\"register.php\" class=\"bg-accent text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200\">Sign Up</a>\n                    <?php endif; ?>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <?php if ($message): ?>\n            <div class=\"mb-6 p-4 <?php echo strpos($message, 'successfully') !== false ? 'bg-green-50 border border-green-200 text-green-800' : 'bg-red-50 border border-red-200 text-red-800'; ?> rounded-lg\">\n                <p><?php echo htmlspecialchars($message); ?></p>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n            <!-- Product Images -->\n            <div>\n                <?php if (!empty($product['images'])): ?>\n                    <div class=\"mb-4\">\n                        <img src=\"<?php echo $product['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($product['name']); ?>\" \n                             class=\"w-full h-96 object-cover rounded-lg shadow-md\" id=\"main-image\">\n                    </div>\n                    \n                    <?php if (count($product['images']) > 1): ?>\n                        <div class=\"grid grid-cols-4 gap-2\">\n                            <?php foreach ($product['images'] as $index => $image): ?>\n                                <img src=\"<?php echo $image; ?>\" alt=\"Product image <?php echo $index + 1; ?>\" \n                                     class=\"w-full h-20 object-cover rounded cursor-pointer hover:opacity-75 transition duration-200 <?php echo $index === 0 ? 'ring-2 ring-accent' : ''; ?>\"\n                                     onclick=\"changeMainImage('<?php echo $image; ?>', this)\">\n                            <?php endforeach; ?>\n                        </div>\n                    <?php endif; ?>\n                <?php else: ?>\n                    <div class=\"w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center\">\n                        <span class=\"text-gray-400 text-xl\">No Image Available</span>\n                    </div>\n                <?php endif; ?>\n            </div>\n            \n            <!-- Product Info -->\n            <div>\n                <div class=\"flex items-center mb-4\">\n                    <div class=\"flex items-center\">\n                        <?php if ($product['vendor_logo']): ?>\n                            <img src=\"<?php echo $product['vendor_logo']; ?>\" alt=\"Vendor logo\" class=\"w-8 h-8 rounded-full mr-2\">\n                        <?php endif; ?>\n                        <span class=\"text-gray-600\"><?php echo htmlspecialchars($product['business_name']); ?></span>\n                        <?php if ($product['is_verified']): ?>\n                            <span class=\"ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full\">\n                                <?php echo $product['verification_badge'] ?: 'Verified'; ?>\n                            </span>\n                        <?php endif; ?>\n                    </div>\n                </div>\n                \n                <h1 class=\"text-3xl font-bold text-gray-900 mb-4\"><?php echo htmlspecialchars($product['name']); ?></h1>\n                \n                <div class=\"flex items-center mb-4\">\n                    <?php if ($product['avg_rating'] > 0): ?>\n                        <div class=\"flex items-center\">\n                            <?php for ($i = 1; $i <= 5; $i++): ?>\n                                <span class=\"text-yellow-400 text-lg\">\n                                    <?php echo $i <= $product['avg_rating'] ? '★' : '☆'; ?>\n                                </span>\n                            <?php endfor; ?>\n                            <span class=\"text-gray-600 ml-2\"><?php echo $product['avg_rating']; ?> (<?php echo $product['review_count']; ?> reviews)</span>\n                        </div>\n                    <?php else: ?>\n                        <span class=\"text-gray-500\">No reviews yet</span>\n                    <?php endif; ?>\n                </div>\n                \n                <div class=\"mb-6\">\n                    <?php if ($product['sale_price']): ?>\n                        <div class=\"flex items-center space-x-4\">\n                            <span class=\"text-3xl font-bold text-red-600\"><?php echo format_currency($product['sale_price']); ?></span>\n                            <span class=\"text-xl text-gray-500 line-through\"><?php echo format_currency($product['price']); ?></span>\n                            <span class=\"bg-red-100 text-red-800 text-sm px-2 py-1 rounded\">\n                                Save <?php echo format_currency($product['price'] - $product['sale_price']); ?>\n                            </span>\n                        </div>\n                    <?php else: ?>\n                            <span class=\"text-3xl font-bold text-gray-900\"><?php echo format_currency($product['price']); ?></span>\n                    <?php endif; ?>\n                </div>\n                \n                <div class=\"mb-6\">\n                    <p class=\"text-gray-700 leading-relaxed\"><?php echo nl2br(htmlspecialchars($product['description'])); ?></p>\n                </div>\n                \n                <div class=\"mb-6\">\n                    <span class=\"text-sm font-medium text-gray-700\">Category: </span>\n                    <span class=\"text-sm text-gray-600\"><?php echo htmlspecialchars($product['category_name']); ?></span>\n                </div>\n                \n                <div class=\"mb-6\">\n                    <?php if ($product['stock_quantity'] > 0): ?>\n                        <span class=\"text-green-600 font-medium\">✓ In Stock (<?php echo $product['stock_quantity']; ?> available)</span>\n                    <?php else: ?>\n                        <span class=\"text-red-600 font-medium\">✗ Out of Stock</span>\n                    <?php endif; ?>\n                </div>\n                \n                <?php if ($product['stock_quantity'] > 0): ?>\n                    <form method=\"POST\" class=\"mb-6\">\n                        <div class=\"flex items-center space-x-4 mb-4\">\n                            <label for=\"quantity\" class=\"text-sm font-medium text-gray-700\">Quantity:</label>\n                            <select name=\"quantity\" id=\"quantity\" class=\"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-accent focus:border-accent\">\n                                <?php for ($i = 1; $i <= min(10, $product['stock_quantity']); $i++): ?>\n                                    <option value=\"<?php echo $i; ?>\"><?php echo $i; ?></option>\n                                <?php endfor; ?>\n                            </select>\n                        </div>\n                        \n                        <div class=\"flex space-x-4\">\n                            <button type=\"submit\" name=\"add_to_cart\" \n                                    class=\"flex-1 bg-accent text-white px-6 py-3 rounded-md font-medium hover:bg-blue-600 transition duration-200\">\n                                Add to Cart\n                            </button>\n                            \n                            <button type=\"submit\" name=\"toggle_wishlist\" \n                                    class=\"px-6 py-3 border border-gray-300 rounded-md hover:bg-gray-50 transition duration-200\">\n                                <?php echo $is_in_wishlist ? '❤️ Remove from Wishlist' : '🤍 Add to Wishlist'; ?>\n                            </button>\n                        </div>\n                    </form>\n                <?php endif; ?>\n            </div>\n        </div>\n        \n        <!-- Reviews Section -->\n        <div class=\"bg-white rounded-lg shadow-sm p-6\">\n            <h2 class=\"text-2xl font-bold text-gray-900 mb-6\">Customer Reviews</h2>\n            \n            <!-- Review Form -->\n            <?php if ($can_review): ?>\n                <div class=\"mb-8 p-6 bg-gray-50 rounded-lg\">\n                    <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">\n                        Write a Review\n                        <?php if ($is_admin): ?>\n                            <span class=\"text-sm font-normal text-blue-600\">(Admin Review)</span>\n                        <?php endif; ?>\n                    </h3>\n                    <form method=\"POST\">\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <?php if (!$is_admin): ?>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Order Number</label>\n                                    <select name=\"order_id\" class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\" required>\n                                        <option value=\"\">Select your order</option>\n                                        <?php foreach ($user_orders as $order): ?>\n                                            <option value=\"<?php echo $order['id']; ?>\">\n                                                <?php echo $order['order_number']; ?> - <?php echo date('M j, Y', strtotime($order['created_at'])); ?>\n                                            </option>\n                                        <?php endforeach; ?>\n                                    </select>\n                                </div>\n                            <?php else: ?>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Admin Review</label>\n                                    <div class=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                                        <p class=\"text-sm text-blue-800\">As an admin, you can review any product without a purchase requirement.</p>\n                                    </div>\n                                    <input type=\"hidden\" name=\"order_id\" value=\"\">\n                                </div>\n                            <?php endif; ?>\n                            \n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Rating *</label>\n                                <div class=\"flex items-center space-x-1\">\n                                    <?php for ($i = 1; $i <= 5; $i++): ?>\n                                        <input type=\"radio\" name=\"rating\" value=\"<?php echo $i; ?>\" id=\"rating_<?php echo $i; ?>\" class=\"sr-only\" required>\n                                        <label for=\"rating_<?php echo $i; ?>\" class=\"text-2xl cursor-pointer hover:text-yellow-400 transition-colors\">\n                                            <span class=\"rating-star\">☆</span>\n                                        </label>\n                                    <?php endfor; ?>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"mt-4\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Review Title *</label>\n                            <input type=\"text\" name=\"review_title\" placeholder=\"Summarize your review in a few words\" \n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\" required>\n                        </div>\n                        \n                        <div class=\"mt-4\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Your Review *</label>\n                            <textarea name=\"review_comment\" rows=\"4\" placeholder=\"Tell others about your experience with this product\" \n                                      class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\" required></textarea>\n                        </div>\n                        \n                        <div class=\"mt-6\">\n                            <button type=\"submit\" name=\"submit_review\" \n                                    class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors\">\n                                Submit Review\n                            </button>\n                        </div>\n                    </form>\n                </div>\n            <?php elseif (is_logged_in()): ?>\n                <div class=\"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                    <p class=\"text-yellow-800\">You can only review products you have purchased. <a href=\"order-history.php\" class=\"underline hover:text-yellow-900\">View your orders</a></p>\n                </div>\n            <?php else: ?>\n                <div class=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                    <p class=\"text-blue-800\">Please <a href=\"login.php\" class=\"underline hover:text-blue-900\">sign in</a> to write a review.</p>\n                </div>\n            <?php endif; ?>\n            \n            <!-- Existing Reviews -->\n            <?php if (empty($reviews)): ?>\n                <p class=\"text-gray-500\">No reviews yet. Be the first to review this product!</p>\n            <?php else: ?>\n                <div class=\"space-y-6\">\n                    <?php foreach ($reviews as $review): ?>\n                        <div class=\"border-b border-gray-200 pb-6 last:border-b-0\">\n                            <div class=\"flex items-center justify-between mb-2\">\n                                <div class=\"flex items-center\">\n                                    <span class=\"font-medium text-gray-900\"><?php echo htmlspecialchars($review['first_name'] . ' ' . $review['last_name']); ?></span>\n                                    <?php if ($review['role'] === 'admin'): ?>\n                                        <span class=\"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">Admin Review</span>\n                                    <?php elseif ($review['is_verified_purchase']): ?>\n                                        <span class=\"ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded\">Verified Purchase</span>\n                                    <?php endif; ?>\n                                </div>\n                                <span class=\"text-sm text-gray-500\"><?php echo date('M j, Y', strtotime($review['created_at'])); ?></span>\n                            </div>\n                            \n                            <div class=\"flex items-center mb-2\">\n                                <?php for ($i = 1; $i <= 5; $i++): ?>\n                                    <span class=\"text-yellow-400\">\n                                        <?php echo $i <= $review['rating'] ? '★' : '☆'; ?>\n                                    </span>\n                                <?php endfor; ?>\n                            </div>\n                            \n                            <?php if ($review['title']): ?>\n                                <h4 class=\"font-medium text-gray-900 mb-2\"><?php echo htmlspecialchars($review['title']); ?></h4>\n                            <?php endif; ?>\n                            \n                            <p class=\"text-gray-700\"><?php echo nl2br(htmlspecialchars($review['comment'])); ?></p>\n                        </div>\n                    <?php endforeach; ?>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n    \n    <script>\n        function changeMainImage(src, element) {\n            document.getElementById('main-image').src = src;\n            \n            // Remove ring from all thumbnails\n            document.querySelectorAll('.grid img').forEach(img => {\n                img.classList.remove('ring-2', 'ring-accent');\n            });\n            \n            // Add ring to clicked thumbnail\n            element.classList.add('ring-2', 'ring-accent');\n        }\n        \n        // Star rating functionality\n        document.addEventListener('DOMContentLoaded', function() {\n            const ratingInputs = document.querySelectorAll('input[name=\"rating\"]');\n            const ratingStars = document.querySelectorAll('.rating-star');\n            \n            ratingInputs.forEach((input, index) => {\n                input.addEventListener('change', function() {\n                    updateStarDisplay(parseInt(this.value));\n                });\n            });\n            \n            ratingStars.forEach((star, index) => {\n                star.addEventListener('click', function() {\n                    const rating = index + 1;\n                    document.querySelector(`input[name=\"rating\"][value=\"${rating}\"]`).checked = true;\n                    updateStarDisplay(rating);\n                });\n                \n                star.addEventListener('mouseover', function() {\n                    const rating = index + 1;\n                    updateStarDisplay(rating);\n                });\n            });\n            \n            // Reset stars on mouse leave\n            const ratingContainer = document.querySelector('.flex.items-center.space-x-1');\n            if (ratingContainer) {\n                ratingContainer.addEventListener('mouseleave', function() {\n                    const checkedInput = document.querySelector('input[name=\"rating\"]:checked');\n                    if (checkedInput) {\n                        updateStarDisplay(parseInt(checkedInput.value));\n                    } else {\n                        updateStarDisplay(0);\n                    }\n                });\n            }\n        });\n        \n        function updateStarDisplay(rating) {\n            const stars = document.querySelectorAll('.rating-star');\n            stars.forEach((star, index) => {\n                if (index < rating) {\n                    star.textContent = '★';\n                    star.classList.add('text-yellow-400');\n                } else {\n                    star.textContent = '☆';\n                    star.classList.remove('text-yellow-400');\n                }\n            });\n        }\n    </script>\n</body>\n</html>\n","size_bytes":23904},"products.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/product.php';\n\n$product_manager = new ProductManager();\n\n// Get parameters\n$category_id = isset($_GET['category']) ? (int)$_GET['category'] : null;\n$search = $_GET['search'] ?? null;\n$page = max(1, $_GET['page'] ?? 1);\n$limit = 20;\n$offset = ($page - 1) * $limit;\n\n// Get products and categories\n$products = $product_manager->get_products($limit, $offset, $category_id, $search);\nif (empty($products)) {\n    // Fallback to simple fetch if complex query returns nothing\n    $products = $product_manager->get_products_simple($limit, $offset, $category_id, $search);\n}\nif (empty($products) && $category_id) {\n    // Final fallback: explicitly fetch by category\n    $products = $product_manager->get_products_by_category_minimal($category_id, $limit, $offset);\n}\n$categories = $product_manager->get_categories();\n$flash_deals = $product_manager->get_flash_deals(6);\n\n$page_title = 'Products';\nif ($search) {\n    $page_title = \"Search results for: \" . htmlspecialchars($search);\n} elseif ($category_id) {\n    $category = array_filter($categories, fn($c) => $c['id'] == $category_id);\n    if ($category) {\n        $page_title = reset($category)['name'];\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title><?php echo $page_title; ?> - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n</head>\n<body class=\"bg-gray-50 font-sans\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b sticky top-0 z-50\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-8\">\n                    <a href=\"index.php\" class=\"flex items-center\">\n                        <div class=\"w-8 h-8 bg-accent rounded-lg flex items-center justify-center mr-2\">\n                            <span class=\"text-white font-bold\">MN</span>\n                        </div>\n                        <span class=\"text-xl font-bold text-primary\"><?php echo SITE_NAME; ?></span>\n                    </a>\n                    \n                    <!-- Search Bar -->\n                    <form method=\"GET\" action=\"products.php\" class=\"hidden md:flex items-center\">\n                        <div class=\"relative\">\n                            <input type=\"text\" name=\"search\" value=\"<?php echo htmlspecialchars($search ?? ''); ?>\" \n                                   placeholder=\"Search products, brands, and more...\" \n                                   class=\"w-96 px-4 py-2 border-2 border-gray-200 rounded-l-lg focus:outline-none focus:border-accent\">\n                            <button type=\"submit\" class=\"px-6 py-2 bg-accent text-white rounded-r-lg hover:bg-blue-600 transition duration-200\">\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n                                </svg>\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <?php if (is_logged_in()): ?>\n                        <a href=\"cart.php\" class=\"text-gray-700 hover:text-accent relative\">\n                            Cart\n                            <span class=\"absolute -top-2 -right-2 bg-accent text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\" id=\"cart-count\">0</span>\n                        </a>\n                        <a href=\"wishlist.php\" class=\"text-gray-700 hover:text-accent\">Wishlist</a>\n                        <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                        <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                    <?php else: ?>\n                        <a href=\"login.php\" class=\"text-accent hover:text-blue-600\">Login</a>\n                        <a href=\"register.php\" class=\"bg-accent text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200\">Sign Up</a>\n                    <?php endif; ?>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <!-- Flash Deals Section -->\n        <?php if (!empty($flash_deals) && !$search && !$category_id): ?>\n            <div class=\"mb-8\">\n                <div class=\"bg-gradient-to-r from-red-500 to-accent text-white rounded-lg p-6 mb-6\">\n                    <h2 class=\"text-2xl font-bold mb-2\">Flash Deals - Limited Time!</h2>\n                    <p class=\"text-red-100\">Hurry up! These deals won't last long.</p>\n                </div>\n                \n                <div class=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n                    <?php foreach ($flash_deals as $deal): ?>\n                        <div class=\"bg-white rounded-lg shadow-md overflow-hidden border-2 border-red-200\">\n                            <div class=\"relative\">\n                                <?php if (!empty($deal['images'])): ?>\n                                    <img src=\"<?php echo $deal['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($deal['name']); ?>\" \n                                         class=\"w-full h-32 object-cover\">\n                                <?php else: ?>\n                                    <div class=\"w-full h-32 bg-gray-200 flex items-center justify-center\">\n                                        <span class=\"text-gray-400\">No Image</span>\n                                    </div>\n                                <?php endif; ?>\n                                \n                                <div class=\"absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded\">\n                                    FLASH DEAL\n                                </div>\n                            </div>\n                            \n                            <div class=\"p-3\">\n                                <h3 class=\"font-medium text-sm text-gray-900 mb-1 line-clamp-2\"><?php echo htmlspecialchars($deal['name']); ?></h3>\n                                <div class=\"flex items-center space-x-2 mb-2\">\n                                    <span class=\"text-lg font-bold text-red-600\"><?php echo format_currency($deal['sale_price']); ?></span>\n                                    <span class=\"text-sm text-gray-500 line-through\"><?php echo format_currency($deal['price']); ?></span>\n                                </div>\n                                \n                                <div class=\"text-xs text-red-600 font-medium\">\n                                    Ends: <?php echo date('M j, g:i A', strtotime($deal['flash_deal_end'])); ?>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endforeach; ?>\n                </div>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"flex flex-col lg:flex-row gap-8\">\n            <!-- Sidebar -->\n            <div class=\"lg:w-64 flex-shrink-0\">\n                <div class=\"bg-white rounded-lg shadow-sm p-6\">\n                    <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Categories</h3>\n                    <ul class=\"space-y-2\">\n                        <li>\n                            <a href=\"products.php\" class=\"block text-gray-700 hover:text-accent py-1 <?php echo !$category_id ? 'text-accent font-medium' : ''; ?>\">\n                                All Products\n                            </a>\n                        </li>\n                        <?php foreach ($categories as $category): ?>\n                            <li>\n                                <a href=\"products.php?category=<?php echo $category['id']; ?>\" \n                                   class=\"block text-gray-700 hover:text-accent py-1 <?php echo $category_id == $category['id'] ? 'text-accent font-medium' : ''; ?>\">\n                                    <?php echo htmlspecialchars($category['name']); ?>\n                                    <span class=\"text-sm text-gray-500\">(<?php echo $category['product_count']; ?>)</span>\n                                </a>\n                            </li>\n                        <?php endforeach; ?>\n                    </ul>\n                </div>\n            </div>\n            \n            <!-- Main Content -->\n            <div class=\"flex-1\">\n                <div class=\"flex justify-between items-center mb-6\">\n                    <h1 class=\"text-2xl font-bold text-gray-900\"><?php echo $page_title; ?></h1>\n                    <div class=\"text-sm text-gray-500\">\n                        <?php echo count($products); ?> products found\n                    </div>\n                </div>\n                \n                <!-- Mobile Search -->\n                <div class=\"md:hidden mb-6\">\n                    <form method=\"GET\" action=\"products.php\">\n                        <div class=\"flex\">\n                            <input type=\"text\" name=\"search\" value=\"<?php echo htmlspecialchars($search ?? ''); ?>\" \n                                   placeholder=\"Search products...\" \n                                   class=\"flex-1 px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-accent focus:border-accent\">\n                            <button type=\"submit\" class=\"px-4 py-2 bg-accent text-white rounded-r-md hover:bg-blue-600 transition duration-200\">\n                                Search\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                \n                <!-- Products Grid -->\n                <?php if (empty($products)): ?>\n                    <div class=\"text-center py-12\">\n                        <div class=\"text-gray-400 text-6xl mb-4\">📦</div>\n                        <h3 class=\"text-xl font-medium text-gray-900 mb-2\">No products found</h3>\n                        <p class=\"text-gray-500\">Try adjusting your search or browse different categories.</p>\n                    </div>\n                <?php else: ?>\n                    <div class=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\n                        <?php foreach ($products as $product): ?>\n                            <div class=\"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition duration-200\">\n                                <a href=\"product-detail.php?id=<?php echo $product['id']; ?>\" class=\"block\">\n                                    <div class=\"relative\">\n                                        <?php if (!empty($product['images'])): ?>\n                                            <img src=\"<?php echo $product['images'][0]; ?>\" alt=\"<?php echo htmlspecialchars($product['name']); ?>\" \n                                                 class=\"w-full h-48 object-cover\">\n                                        <?php else: ?>\n                                            <?php \n                                                $name = trim($product['name'] ?? '');\n                                                $parts = preg_split('/\\s+/', $name);\n                                                $first = strtoupper(substr($parts[0] ?? 'P', 0, 1));\n                                                $second = strtoupper(substr($parts[1] ?? '', 0, 1));\n                                                $initials = $first . $second;\n                                            ?>\n                                            <div class=\"w-full h-48 bg-primary/10 flex items-center justify-center\">\n                                                <span class=\"text-primary text-3xl font-semibold\"><?php echo htmlspecialchars($initials); ?></span>\n                                            </div>\n                                        <?php endif; ?>\n                                        \n                                        <?php if ($product['is_featured']): ?>\n                                            <div class=\"absolute top-2 left-2 bg-accent text-white text-xs px-2 py-1 rounded\">\n                                                Featured\n                                            </div>\n                                        <?php endif; ?>\n                                        \n                                        <?php if ($product['sale_price']): ?>\n                                            <div class=\"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded\">\n                                                Sale\n                                            </div>\n                                        <?php endif; ?>\n                                    </div>\n                                    \n                                    <div class=\"p-4\">\n                                        <div class=\"flex items-center mb-2\">\n                                            <span class=\"text-sm text-gray-600\"><?php echo htmlspecialchars($product['business_name']); ?></span>\n                                            <?php if ($product['is_verified']): ?>\n                                                <span class=\"ml-2 text-blue-500\" title=\"Verified Vendor\">\n                                                    <svg class=\"w-4 h-4 inline\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                                        <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\n                                                    </svg>\n                                                </span>\n                                            <?php endif; ?>\n                                        </div>\n                                        \n                                        <h3 class=\"font-medium text-gray-900 mb-2 line-clamp-2\"><?php echo htmlspecialchars($product['name']); ?></h3>\n                                        \n                                        <div class=\"flex items-center mb-2\">\n                                            <?php if ($product['avg_rating'] > 0): ?>\n                                                <div class=\"flex items-center\">\n                                                    <span class=\"text-yellow-400\">★</span>\n                                                    <span class=\"text-sm text-gray-600 ml-1\"><?php echo $product['avg_rating']; ?> (<?php echo $product['review_count']; ?>)</span>\n                                                </div>\n                                            <?php else: ?>\n                                                <span class=\"text-sm text-gray-500\">No reviews yet</span>\n                                            <?php endif; ?>\n                                        </div>\n                                        \n                                        <div class=\"flex items-center justify-between\">\n                                            <div>\n                                                <?php if ($product['sale_price']): ?>\n                                                    <span class=\"text-lg font-bold text-red-600\"><?php echo format_currency($product['sale_price']); ?></span>\n                                                    <span class=\"text-sm text-gray-500 line-through ml-2\"><?php echo format_currency($product['price']); ?></span>\n                                                <?php else: ?>\n                                                    <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($product['price']); ?></span>\n                                                <?php endif; ?>\n                                            </div>\n                                            \n                                            <?php if ($product['stock_quantity'] > 0): ?>\n                                                <span class=\"text-sm text-green-600\">In Stock</span>\n                                            <?php else: ?>\n                                                <span class=\"text-sm text-red-600\">Out of Stock</span>\n                                            <?php endif; ?>\n                                        </div>\n                                    </div>\n                                </a>\n                            </div>\n                        <?php endforeach; ?>\n                    </div>\n                    \n                    <!-- Pagination -->\n                    <div class=\"mt-8 flex justify-center\">\n                        <div class=\"flex space-x-2\">\n                            <?php if ($page > 1): ?>\n                                <a href=\"?<?php echo http_build_query(array_merge($_GET, ['page' => $page - 1])); ?>\" \n                                   class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Previous</a>\n                            <?php endif; ?>\n                            \n                            <?php if (count($products) == $limit): ?>\n                                <a href=\"?<?php echo http_build_query(array_merge($_GET, ['page' => $page + 1])); ?>\" \n                                   class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Next</a>\n                            <?php endif; ?>\n                        </div>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        // Update cart count on page load\n        if (<?php echo is_logged_in() ? 'true' : 'false'; ?>) {\n            fetch('api/cart-count.php')\n                .then(response => response.json())\n                .then(data => {\n                    document.getElementById('cart-count').textContent = data.count || 0;\n                });\n        }\n    </script>\n</body>\n</html>\n","size_bytes":19473},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"twilio>=9.8.0\",\n]\n","size_bytes":165},"quick_seed.php":{"content":"<?php\nrequire_once 'config/database.php';\n\n$database = new Database();\n$db = $database->getConnection();\n\necho \"Quick seeding vendors and categories...\\n\";\n\ntry {\n    // Speed up and avoid FK issues during reset\n    $db->exec(\"SET FOREIGN_KEY_CHECKS=0\");\n\n    // Clear existing data (respect FKs order where possible)\n    $db->exec(\"DELETE FROM order_items\");\n    $db->exec(\"DELETE FROM orders\");\n    $db->exec(\"DELETE FROM reviews\");\n    $db->exec(\"DELETE FROM wishlist\");\n    $db->exec(\"DELETE FROM cart\");\n    $db->exec(\"DELETE FROM recently_viewed\");\n    $db->exec(\"DELETE FROM products\");\n    $db->exec(\"DELETE FROM vendors\");\n    $db->exec(\"DELETE FROM vendor_applications\");\n    $db->exec(\"DELETE FROM user_roles\");\n    $db->exec(\"DELETE FROM users\");\n    $db->exec(\"DELETE FROM categories\");\n    \n    $db->exec(\"SET FOREIGN_KEY_CHECKS=1\");\n    echo \"Cleared existing data\\n\";\n\n    // Add categories\n    $categories = [\n        ['Electronics', 'Electronic gadgets and devices'],\n        ['Clothing', 'Fashion and apparel'],\n        ['Sports', 'Sports and outdoor equipment']\n    ];\n\n    $stmt = $db->prepare(\"INSERT INTO categories (name, description) VALUES (?, ?)\");\n    $categoryIds = [];\n    foreach ($categories as $category) {\n        $stmt->execute([$category[0], $category[1]]);\n        $categoryIds[$category[0]] = (int)$db->lastInsertId();\n        echo \"Added category: {$category[0]}\\n\";\n    }\n\n    // Add admin user\n    $admin_password = password_hash('admin123', PASSWORD_DEFAULT);\n    $stmt = $db->prepare(\"INSERT INTO users (username, email, password, first_name, last_name) VALUES (?, ?, ?, ?, ?)\");\n    $stmt->execute(['admin', 'admin@example.com', $admin_password, 'Site', 'Admin']);\n    $admin_user_id = $db->lastInsertId();\n    $stmt = $db->prepare(\"INSERT INTO user_roles (user_id, role) VALUES (?, 'admin')\");\n    $stmt->execute([$admin_user_id]);\n    echo \"Added admin user\\n\";\n\n    // Add vendor user\n    $vendor_password = password_hash('vendor123', PASSWORD_DEFAULT);\n    $stmt = $db->prepare(\"INSERT INTO users (username, email, password, first_name, last_name) VALUES (?, ?, ?, ?, ?)\");\n    $stmt->execute(['tech_store', 'tech@example.com', $vendor_password, 'Tech', 'Store']);\n    $vendor_user_id = $db->lastInsertId();\n    echo \"Added vendor user\\n\";\n\n    // Add vendor role\n    $stmt = $db->prepare(\"INSERT INTO user_roles (user_id, role) VALUES (?, ?)\");\n    $stmt->execute([$vendor_user_id, 'vendor']);\n    echo \"Added vendor role\\n\";\n\n    // Add vendor business\n    $stmt = $db->prepare(\"INSERT INTO vendors (user_id, business_name, description, is_verified) VALUES (?, ?, ?, ?)\");\n    $stmt->execute([$vendor_user_id, 'Tech Store Pro', 'Leading electronics store', 1]);\n    $vendor_business_id = $db->lastInsertId();\n    echo \"Added vendor business (ID: $vendor_business_id)\\n\";\n\n    // Add sample products (active, with images)\n    $stmt = $db->prepare(\"INSERT INTO products (vendor_id, category_id, name, description, price, stock_quantity, sku, images, status, is_featured) VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'active', 1)\");\n    $stmt->execute([\n        $vendor_business_id,\n        $categoryIds['Electronics'],\n        'Smartphone X',\n        'Flagship smartphone with AMOLED display',\n        699.00,\n        25,\n        'SPX-001',\n        json_encode(['https://via.placeholder.com/600x600?text=Smartphone+X'])\n    ]);\n    $stmt->execute([\n        $vendor_business_id,\n        $categoryIds['Sports'],\n        'Football Pro',\n        'Durable leather football for outdoor play',\n        29.99,\n        100,\n        'FB-100',\n        json_encode(['https://via.placeholder.com/600x600?text=Football+Pro'])\n    ]);\n    echo \"Added sample products\\n\";\n\n    echo \"\\nSeeding completed successfully!\\n\";\n    echo \"Vendor login: tech_store / vendor123\\n\";\n\n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":3868},"register.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/auth.php';\n\n$auth = new Auth();\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $username = sanitize_input($_POST['username']);\n    $email = sanitize_input($_POST['email']);\n    $password = $_POST['password'];\n    $confirm_password = $_POST['confirm_password'];\n    $first_name = sanitize_input($_POST['first_name']);\n    $last_name = sanitize_input($_POST['last_name']);\n    $phone = sanitize_input($_POST['phone']);\n    $address = sanitize_input($_POST['address']);\n    $city = sanitize_input($_POST['city']);\n    $state = sanitize_input($_POST['state']);\n    $zip_code = sanitize_input($_POST['zip_code']);\n    \n    if ($password !== $confirm_password) {\n        $error = 'Passwords do not match';\n    } else {\n        $result = $auth->register($username, $email, $password, $first_name, $last_name, $phone, $address, $city, $state, $zip_code);\n        \n        if ($result['success']) {\n            $success = $result['message'];\n        } else {\n            $error = $result['message'];\n        }\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Create Account - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n</head>\n<body class=\"bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans\">\n    <div class=\"min-h-screen py-12\">\n        <div class=\"max-w-4xl mx-auto px-4\">\n            <!-- Header -->\n            <div class=\"text-center mb-12\">\n                <div class=\"flex items-center justify-center mb-6\">\n                    <div class=\"w-14 h-14 bg-accent rounded-2xl flex items-center justify-center mr-4\">\n                        <span class=\"text-white font-bold text-xl\">MN</span>\n                    </div>\n                    <span class=\"text-3xl font-bold text-primary\"><?php echo SITE_NAME; ?></span>\n                </div>\n                <h1 class=\"text-4xl font-bold text-gray-900 mb-4\">Join Market Nest</h1>\n                <p class=\"text-xl text-gray-600 max-w-2xl mx-auto\">Create your account and start your amazing shopping journey with thousands of quality products.</p>\n            </div>\n            \n            <div class=\"bg-white rounded-2xl shadow-xl overflow-hidden\">\n                <div class=\"px-8 py-12\">\n                    <?php if ($error): ?>\n                        <div class=\"mb-8 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg\">\n                            <div class=\"flex\">\n                                <div class=\"flex-shrink-0\">\n                                    <svg class=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                        <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\" />\n                                    </svg>\n                                </div>\n                                <div class=\"ml-3\">\n                                    <p class=\"text-sm text-red-700\"><?php echo $error; ?></p>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endif; ?>\n                    \n                    <?php if ($success): ?>\n                        <div class=\"mb-8 bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg\">\n                            <div class=\"flex\">\n                                <div class=\"flex-shrink-0\">\n                                    <svg class=\"h-5 w-5 text-green-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                                        <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\n                                    </svg>\n                                </div>\n                                <div class=\"ml-3\">\n                                    <p class=\"text-sm text-green-700\">\n                                        <?php echo $success; ?> \n                                        <a href=\"login.php\" class=\"font-medium text-green-800 underline hover:text-green-900\">\n                                            Sign in now →\n                                        </a>\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endif; ?>\n                    \n                    <form method=\"POST\" class=\"space-y-8\">\n                        <!-- Personal Information -->\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                                <svg class=\"w-5 h-5 mr-2 text-accent\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                                </svg>\n                                Personal Information\n                            </h3>\n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <div>\n                                    <label for=\"first_name\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        First Name *\n                                    </label>\n                                    <input id=\"first_name\" name=\"first_name\" type=\"text\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter your first name\">\n                                </div>\n                                \n                                <div>\n                                    <label for=\"last_name\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Last Name *\n                                    </label>\n                                    <input id=\"last_name\" name=\"last_name\" type=\"text\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter your last name\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Account Information -->\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                                <svg class=\"w-5 h-5 mr-2 text-accent\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"></path>\n                                </svg>\n                                Account Credentials\n                            </h3>\n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <div>\n                                    <label for=\"username\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Username *\n                                    </label>\n                                    <input id=\"username\" name=\"username\" type=\"text\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Choose a username\">\n                                </div>\n                                \n                                <div>\n                                    <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Email Address *\n                                    </label>\n                                    <input id=\"email\" name=\"email\" type=\"email\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter your email address\">\n                                </div>\n                            </div>\n                            \n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\n                                <div>\n                                    <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Password *\n                                    </label>\n                                    <input id=\"password\" name=\"password\" type=\"password\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Create a strong password\">\n                                </div>\n                                \n                                <div>\n                                    <label for=\"confirm_password\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        Confirm Password *\n                                    </label>\n                                    <input id=\"confirm_password\" name=\"confirm_password\" type=\"password\" required \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Confirm your password\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Contact Information -->\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                                <svg class=\"w-5 h-5 mr-2 text-accent\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                                </svg>\n                                Contact & Address\n                                <span class=\"text-sm text-gray-500 font-normal ml-2\">(Optional)</span>\n                            </h3>\n                            \n                            <div class=\"mb-6\">\n                                <label for=\"phone\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Phone Number\n                                </label>\n                                <input id=\"phone\" name=\"phone\" type=\"tel\" \n                                       class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                       placeholder=\"Enter your phone number\">\n                            </div>\n                            \n                            <div class=\"mb-6\">\n                                <label for=\"address\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                    Street Address\n                                </label>\n                                <textarea id=\"address\" name=\"address\" rows=\"3\" \n                                          class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                          placeholder=\"Enter your street address\"></textarea>\n                            </div>\n                            \n                            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                <div>\n                                    <label for=\"city\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        City\n                                    </label>\n                                    <input id=\"city\" name=\"city\" type=\"text\" \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter your city\">\n                                </div>\n                                \n                                <div>\n                                    <label for=\"state\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        State/Province\n                                    </label>\n                                    <input id=\"state\" name=\"state\" type=\"text\" \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter your state\">\n                                </div>\n                                \n                                <div>\n                                    <label for=\"zip_code\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n                                        ZIP/Postal Code\n                                    </label>\n                                    <input id=\"zip_code\" name=\"zip_code\" type=\"text\" \n                                           class=\"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200\"\n                                           placeholder=\"Enter ZIP code\">\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Terms and Submit -->\n                        <div class=\"border-t border-gray-200 pt-8\">\n                            <div class=\"flex items-center mb-6\">\n                                <input id=\"terms\" name=\"terms\" type=\"checkbox\" required class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                                <label for=\"terms\" class=\"ml-2 block text-sm text-gray-700\">\n                                    I agree to the \n                                    <a href=\"#\" class=\"text-accent hover:text-blue-600 font-medium\">Terms of Service</a> \n                                    and \n                                    <a href=\"#\" class=\"text-accent hover:text-blue-600 font-medium\">Privacy Policy</a>\n                                </label>\n                            </div>\n                            \n                            <button type=\"submit\" \n                                    class=\"w-full flex justify-center items-center py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-medium text-white bg-accent hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-200 hover:shadow-xl\">\n                                <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"></path>\n                                </svg>\n                                Create Your Account\n                            </button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n\n            <!-- Footer Links -->\n            <div class=\"text-center mt-12 space-y-4\">\n                <p class=\"text-gray-600\">\n                    Already have an account? \n                    <a href=\"login.php\" class=\"text-accent hover:text-blue-600 font-semibold\">\n                        Sign in here\n                    </a>\n                </p>\n                <p>\n                    <a href=\"index.php\" class=\"text-sm text-gray-500 hover:text-accent font-medium\">\n                        ← Back to <?php echo SITE_NAME; ?>\n                    </a>\n                </p>\n            </div>\n        </div>\n    </div>\n</body>\n</html>","size_bytes":18539},"replit.md":{"content":"# Overview\n\nThis is Market Nest, a professional e-commerce marketplace built with PHP and SQLite. The application features a complete e-commerce platform with user management, vendor system, product catalog, shopping cart, order management, and advanced shipment tracking capabilities. The project has been successfully rebranded and redesigned with modern, Amazon-level UI and is running on port 5000.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\nUI Design Preference: Professional, modern design comparable to Amazon with clean layouts and excellent user experience.\n\n# System Architecture\n\n## Backend Architecture\n- **Framework**: PHP 8.2 with native server capabilities\n- **Database**: SQLite for development with complete e-commerce schema\n- **Authentication**: Session-based authentication with role-based access control\n- **File Structure**: Modular PHP classes for database operations and business logic\n\n## Database Design\n- **Users Management**: Complete user registration, authentication, and role management\n- **Product Catalog**: Categories, products, inventory, and vendor management\n- **Order System**: Shopping cart, orders, order items, and payment tracking\n- **Shipping & Tracking**: Advanced shipment tracking with history and real-time updates\n- **Additional Features**: Wishlist, reviews, notifications, coupons, and badges\n\n## Key Components\n- **Authentication System**: User registration, login, role-based access (customer, vendor, admin)\n- **Product Management**: Category-based product organization with vendor support\n- **Shopping Cart**: Session-based cart management with real-time updates\n- **Order Processing**: Complete order lifecycle from cart to delivery\n- **Tracking System**: Advanced shipment tracking with multiple service levels\n- **Vendor Portal**: Vendor application system and product management dashboard\n- **Admin Panel**: Complete administrative interface for user, vendor, and order management\n\n## Recent Setup Changes\n- **Date**: September 8, 2025\n- **Database Migration**: Converted from MySQL to SQLite for Replit compatibility\n- **Path Corrections**: Fixed all include/require path references to use __DIR__ for consistency\n- **SQL Compatibility**: Updated INSERT IGNORE to INSERT OR IGNORE for SQLite\n- **Environment Configuration**: Configured for Replit hosting with proper domain handling\n- **Sample Data**: Initialized with categories and admin user for immediate testing\n\n## Recent Design Updates\n- **Date**: September 8, 2025\n- **Complete Rebranding**: Transformed from \"OrangeCart\" to \"Market Nest\" with professional branding\n- **UI Overhaul**: Implemented Amazon-style modern design with:\n  - Professional color scheme (slate/blue instead of orange)\n  - Modern typography using Inter font family\n  - Enhanced homepage with hero section and improved layouts\n  - Professional login/signup pages with split-screen design\n  - Improved navigation with better search functionality\n  - Consistent branding with \"MN\" logo throughout\n- **User Experience**: Enhanced forms, better spacing, hover effects, and responsive design\n- **Color Palette**: Primary (#0f172a), Secondary (#1e293b), Accent (#3b82f6), Warning (#f59e0b), Success (#10b981)\n\n# External Dependencies\n\n## Core Requirements\n- **PHP**: Version 8.2 with PDO SQLite support\n- **Database**: SQLite database with foreign key constraints enabled\n- **Web Server**: PHP built-in development server configured for port 5000\n\n## Styling and UI\n- **Tailwind CSS**: CDN-based utility-first CSS framework for responsive design\n- **Typography**: Inter font family for professional appearance\n- **Color Scheme**: Professional blue/slate theme with Market Nest branding\n  - Primary: Deep slate (#0f172a) for headers and text\n  - Secondary: Slate (#1e293b) for navigation elements  \n  - Accent: Blue (#3b82f6) for buttons and highlights\n  - Supporting colors: Warning (#f59e0b), Success (#10b981)\n- **Design Language**: Modern, clean, Amazon-inspired professional interface","size_bytes":4006},"send_email.php":{"content":"<?php\n// Email functionality for order confirmations\n// Simple email implementation - in production you'd use a proper email service\n\nfunction send_order_confirmation_email($user_email, $order_data) {\n    $subject = \"Order Confirmation - Market Nest - Order #\" . $order_data['order_number'];\n    \n    $message = \"\n    <html>\n    <head>\n        <title>Order Confirmation</title>\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background: #0f172a; color: white; padding: 20px; text-align: center; }\n            .content { background: #f9f9f9; padding: 20px; }\n            .footer { background: #e5e7eb; padding: 10px; text-align: center; font-size: 12px; }\n            .highlight { background: #10b981; color: white; padding: 10px; border-radius: 5px; }\n        </style>\n    </head>\n    <body>\n        <div class='container'>\n            <div class='header'>\n                <h1>Market Nest</h1>\n                <h2>Order Confirmation</h2>\n            </div>\n            <div class='content'>\n                <h3>Thank you for your order!</h3>\n                <p><strong>Order Number:</strong> \" . $order_data['order_number'] . \"</p>\n                <p><strong>Total Amount:</strong> \" . number_format($order_data['total_amount'], 2) . \" FCFA</p>\n                <p><strong>Payment Method:</strong> \" . ucwords(str_replace('_', ' ', $order_data['payment_method'])) . \"</p>\n                \n                \" . ($order_data['payment_method'] == 'mobile_money_cameroon' ? \n                \"<div class='highlight'>\n                    <h4>Mobile Money Payment Instructions</h4>\n                    <p>Please send <strong>\" . number_format($order_data['total_amount'], 2) . \" FCFA</strong> to <strong>679871130</strong></p>\n                    <p>Include your order number <strong>\" . $order_data['order_number'] . \"</strong> in the transaction message.</p>\n                </div>\" : \"\") . \"\n                \n                <p>We'll process your order and send you tracking information once it ships.</p>\n                <p>Thank you for choosing Market Nest!</p>\n            </div>\n            <div class='footer'>\n                <p>&copy; \" . date('Y') . \" Market Nest. All rights reserved.</p>\n            </div>\n        </div>\n    </body>\n    </html>\";\n    \n    $headers = \"MIME-Version: 1.0\" . \"\\r\\n\";\n    $headers .= \"Content-type:text/html;charset=UTF-8\" . \"\\r\\n\";\n    $headers .= \"From: noreply@marketnest.com\" . \"\\r\\n\";\n    \n    // For development, log the email instead of sending\n    error_log(\"Email to \" . $user_email . \" - Subject: \" . $subject);\n    error_log(\"Email content: \" . strip_tags($message));\n    \n    // In production, uncomment this line:\n    // mail($user_email, $subject, $message, $headers);\n    \n    return ['success' => true, 'message' => 'Email confirmation sent'];\n}\n\nfunction send_payment_confirmation_email($user_email, $payment_data) {\n    $subject = \"Payment Confirmed - Market Nest - Order #\" . $payment_data['order_number'];\n    \n    $message = \"\n    <html>\n    <head>\n        <title>Payment Confirmation</title>\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background: #10b981; color: white; padding: 20px; text-align: center; }\n            .content { background: #f9f9f9; padding: 20px; }\n        </style>\n    </head>\n    <body>\n        <div class='container'>\n            <div class='header'>\n                <h1>Payment Confirmed!</h1>\n            </div>\n            <div class='content'>\n                <h3>Your payment has been received!</h3>\n                <p><strong>Order Number:</strong> \" . $payment_data['order_number'] . \"</p>\n                <p><strong>Amount Received:</strong> \" . number_format($payment_data['amount'], 2) . \" FCFA</p>\n                <p>Your order is now being processed and will ship soon!</p>\n            </div>\n        </div>\n    </body>\n    </html>\";\n    \n    $headers = \"MIME-Version: 1.0\" . \"\\r\\n\";\n    $headers .= \"Content-type:text/html;charset=UTF-8\" . \"\\r\\n\";\n    $headers .= \"From: noreply@marketnest.com\" . \"\\r\\n\";\n    \n    // Log for development\n    error_log(\"Payment email to \" . $user_email . \" - Subject: \" . $subject);\n    \n    return ['success' => true, 'message' => 'Payment email sent'];\n}\n?>","size_bytes":4489},"send_sms.php":{"content":"<?php\n// SMS functionality using Twilio integration for order confirmations\n// Based on Twilio integration blueprint\n\nfunction send_order_confirmation_sms($phone_number, $order_data) {\n    // For now, we'll use a simple approach - in production you'd use the Python Twilio script\n    // This is a placeholder for mobile money and SMS integration\n    \n    $message = \"Market Nest Order Confirmation\\n\";\n    $message .= \"Order #\" . $order_data['order_number'] . \"\\n\";\n    $message .= \"Total: \" . number_format($order_data['total_amount'], 2) . \" FCFA\\n\";\n    $message .= \"Payment: Mobile Money\\n\";\n    $message .= \"Thank you for shopping with Market Nest!\";\n    \n    // Log SMS for now - in production this would call the Twilio service\n    error_log(\"SMS to \" . $phone_number . \": \" . $message);\n    \n    return ['success' => true, 'message' => 'SMS confirmation sent'];\n}\n\nfunction send_payment_confirmation_sms($phone_number, $payment_data) {\n    $message = \"Market Nest Payment Confirmation\\n\";\n    $message .= \"Payment received: \" . number_format($payment_data['amount'], 2) . \" FCFA\\n\";\n    $message .= \"Mobile Money: 679871130\\n\";\n    $message .= \"Your order will be processed shortly.\";\n    \n    // Log SMS for now\n    error_log(\"Payment SMS to \" . $phone_number . \": \" . $message);\n    \n    return ['success' => true, 'message' => 'Payment SMS sent'];\n}\n?>","size_bytes":1363},"test_product_display.php":{"content":"<?php\nrequire_once 'config/database.php';\nrequire_once 'includes/product.php';\n\necho \"Testing product display...\\n\";\n\ntry {\n    $productManager = new ProductManager();\n    \n    // Test getting all products\n    $products = $productManager->get_products(10);\n    echo \"Found \" . count($products) . \" products:\\n\";\n    \n    foreach ($products as $product) {\n        echo \"- ID: {$product['id']}, Name: {$product['name']}, Price: {$product['price']}, Status: {$product['status']}\\n\";\n    }\n    \n    // Test getting featured products\n    $featured = $productManager->get_featured_products(5);\n    echo \"\\nFound \" . count($featured) . \" featured products:\\n\";\n    \n    foreach ($featured as $product) {\n        echo \"- ID: {$product['id']}, Name: {$product['name']}, Featured: \" . ($product['is_featured'] ? 'Yes' : 'No') . \"\\n\";\n    }\n    \n    // Test getting categories\n    $categories = $productManager->get_categories();\n    echo \"\\nFound \" . count($categories) . \" categories:\\n\";\n    \n    foreach ($categories as $category) {\n        echo \"- ID: {$category['id']}, Name: {$category['name']}\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":1182},"test_vendor_add_product.php":{"content":"<?php\nrequire_once 'config/database.php';\nrequire_once 'includes/product.php';\n\necho \"Testing vendor product addition...\\n\";\n\ntry {\n    $productManager = new ProductManager();\n    \n    // Test data\n    $test_data = [\n        'vendor_id' => 1, // Assuming vendor ID 1 exists\n        'name' => 'Test Product',\n        'description' => 'This is a test product',\n        'price' => 99.99,\n        'category_id' => 1, // Assuming category ID 1 exists\n        'stock_quantity' => 10,\n        'sku' => 'TEST001',\n        'images' => ['https://via.placeholder.com/400x400?text=Test+Product']\n    ];\n    \n    $result = $productManager->addProduct($test_data);\n    \n    if ($result['success']) {\n        echo \"✅ Product added successfully! Product ID: \" . $result['product_id'] . \"\\n\";\n    } else {\n        echo \"❌ Failed to add product: \" . $result['message'] . \"\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"❌ Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":954},"track.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/tracking.php';\n\n$tracking_manager = new TrackingManager();\n$tracking_number = $_GET['tracking'] ?? $_POST['tracking_number'] ?? '';\n$shipment = null;\n$error = '';\n$message = '';\n\n// Handle tracking lookup\nif ($tracking_number) {\n    $user_id = is_logged_in() ? $_SESSION['user_id'] : null;\n    $shipment = $tracking_manager->get_shipment_by_tracking($tracking_number, $user_id);\n    \n    if (!$shipment) {\n        $error = 'Tracking number not found. Please check and try again.';\n    } else {\n        // Increment free tracking usage for logged-in users\n        if ($user_id && $user_id == $shipment['user_id'] && $shipment['free_trackings_used'] < FREE_TRACKING_LIMIT) {\n            $tracking_manager->increment_free_tracking_usage($user_id);\n        }\n    }\n}\n\n// Handle advanced tracking purchase\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['purchase_tracking'])) {\n    if (!is_logged_in()) {\n        redirect('login.php');\n    }\n    \n    $tracking_level = $_POST['tracking_level'];\n    $amount = $tracking_level === 'standard' ? STANDARD_TRACKING_PRICE : PREMIUM_TRACKING_PRICE;\n    \n    $result = $tracking_manager->purchase_advanced_tracking($_SESSION['user_id'], $shipment['id'], $tracking_level, $amount);\n    $message = $result['message'];\n    \n    if ($result['success']) {\n        // Refresh shipment data\n        $shipment = $tracking_manager->get_shipment_by_tracking($tracking_number, $_SESSION['user_id']);\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Track Your Shipment - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n    <style>\n        .video-background {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: -1;\n            object-fit: cover;\n        }\n        \n        .overlay {\n            background: rgba(59, 130, 246, 0.1);\n            backdrop-filter: blur(1px);\n        }\n        \n        .content-overlay {\n            background: rgba(255, 255, 255, 0.95);\n            backdrop-filter: blur(10px);\n        }\n        \n        .progress-bar {\n            transition: width 1s ease-in-out;\n        }\n        \n        .tracking-step {\n            transition: all 0.3s ease;\n        }\n        \n        .tracking-step.completed {\n            transform: scale(1.1);\n        }\n        \n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.5; }\n        }\n        \n        .pulse-animation {\n            animation: pulse 2s infinite;\n        }\n    </style>\n</head>\n<body class=\"min-h-screen\">\n    <!-- 3D Video Background -->\n    <video autoplay muted loop class=\"video-background\">\n        <source src=\"https://cdn.durable.co/getty-videos/11YFphDEbcgMokFBstfj1wUNbEiH67ztyxxEKzGe05GR5HPPHbhh2IegZrfKys3a.mov\" type=\"video/mp4\">\n        Your browser does not support the video tag.\n    </video>\n    \n    <!-- Overlay -->\n    <div class=\"overlay min-h-screen\">\n        <!-- Header -->\n        <header class=\"content-overlay border-b border-white/20\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                <div class=\"flex justify-between items-center h-16\">\n                    <div class=\"flex items-center space-x-4\">\n                        <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                        <span class=\"text-gray-400\">|</span>\n                        <span class=\"text-gray-700\">Track Shipment</span>\n                    </div>\n                    \n                    <nav class=\"flex items-center space-x-4\">\n                        <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Shop</a>\n                        <?php if (is_logged_in()): ?>\n                            <a href=\"order-history.php\" class=\"text-gray-700 hover:text-accent\">Orders</a>\n                            <span class=\"text-gray-700\">Hi, <?php echo $_SESSION['first_name']; ?>!</span>\n                            <a href=\"logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                        <?php else: ?>\n                            <a href=\"login.php\" class=\"text-accent hover:text-blue-600\">Login</a>\n                        <?php endif; ?>\n                    </nav>\n                </div>\n            </div>\n        </header>\n\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n            <!-- Tracking Form -->\n            <div class=\"text-center mb-12\">\n                <h1 class=\"text-4xl font-bold text-white mb-4 drop-shadow-lg\">Track Your Shipment</h1>\n                <p class=\"text-xl text-white/90 mb-8 drop-shadow\">Enter your tracking number to get real-time updates</p>\n                \n                <form method=\"POST\" class=\"max-w-md mx-auto\">\n                    <div class=\"flex\">\n                        <input type=\"text\" name=\"tracking_number\" value=\"<?php echo htmlspecialchars($tracking_number); ?>\" \n                               placeholder=\"Enter tracking number...\" required\n                               class=\"flex-1 px-4 py-3 rounded-l-lg border-0 focus:outline-none focus:ring-2 focus:ring-accent text-lg\">\n                        <button type=\"submit\" \n                                class=\"px-6 py-3 bg-accent text-white rounded-r-lg hover:bg-blue-600 transition duration-200 font-medium text-lg\">\n                            Track\n                        </button>\n                    </div>\n                </form>\n            </div>\n            \n            <?php if ($error): ?>\n                <div class=\"content-overlay rounded-lg p-6 mb-8 border border-red-200\">\n                    <div class=\"text-center\">\n                        <div class=\"text-red-500 text-6xl mb-4\">❌</div>\n                        <h3 class=\"text-xl font-semibold text-red-700 mb-2\">Tracking Number Not Found</h3>\n                        <p class=\"text-red-600\"><?php echo $error; ?></p>\n                    </div>\n                </div>\n            <?php endif; ?>\n            \n            <?php if ($message): ?>\n                <div class=\"content-overlay rounded-lg p-4 mb-8 border border-blue-200\">\n                    <p class=\"text-blue-700 text-center\"><?php echo $message; ?></p>\n                </div>\n            <?php endif; ?>\n            \n            <?php if ($shipment): ?>\n                <!-- Shipment Info -->\n                <div class=\"content-overlay rounded-lg p-6 mb-8 border border-white/20\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\n                        <div class=\"text-center\">\n                            <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Tracking Number</h3>\n                            <p class=\"text-lg font-semibold text-gray-900\"><?php echo $shipment['tracking_number']; ?></p>\n                        </div>\n                        <div class=\"text-center\">\n                            <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Order Number</h3>\n                            <p class=\"text-lg font-semibold text-gray-900\"><?php echo $shipment['order_number']; ?></p>\n                        </div>\n                        <div class=\"text-center\">\n                            <h3 class=\"text-sm font-medium text-gray-500 mb-1\">Carrier</h3>\n                            <p class=\"text-lg font-semibold text-gray-900\"><?php echo $shipment['carrier']; ?></p>\n                        </div>\n                    </div>\n                    \n                    <!-- Progress Bar -->\n                    <div class=\"mb-8\">\n                        <div class=\"flex justify-between text-sm text-gray-600 mb-2\">\n                            <span>Order Placed</span>\n                            <span>Delivered</span>\n                        </div>\n                        <div class=\"w-full bg-gray-200 rounded-full h-3\">\n                            <div class=\"bg-gradient-to-r from-accent to-blue-600 h-3 rounded-full progress-bar\" \n                                 style=\"width: <?php echo $tracking_manager->get_tracking_progress_percentage($shipment['status']); ?>%\"></div>\n                        </div>\n                        <div class=\"text-center mt-2\">\n                            <span class=\"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800\">\n                                <?php echo ucfirst(str_replace('_', ' ', $shipment['status'])); ?>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Tracking Level Info -->\n                <div class=\"content-overlay rounded-lg p-6 mb-8 border border-white/20\">\n                    <div class=\"flex items-center justify-between mb-4\">\n                        <h2 class=\"text-xl font-semibold text-gray-900\">Tracking Details</h2>\n                        <span class=\"px-3 py-1 text-sm font-semibold rounded-full \n                                   <?php echo $shipment['tracking_level'] === 'basic' ? 'bg-gray-100 text-gray-800' : \n                                             ($shipment['tracking_level'] === 'standard' ? 'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800'); ?>\">\n                            <?php echo ucfirst($shipment['tracking_level']); ?> Tracking\n                        </span>\n                    </div>\n                    \n                    <?php if ($shipment['tracking_level'] === 'basic'): ?>\n                        <!-- Basic Tracking -->\n                        <div class=\"space-y-4\">\n                            <div class=\"text-center py-8\">\n                                <div class=\"text-4xl mb-4\">📦</div>\n                                <h3 class=\"text-lg font-medium text-gray-900 mb-2\">Basic Tracking</h3>\n                                <p class=\"text-gray-600 mb-4\">Current Status: <strong><?php echo ucfirst(str_replace('_', ' ', $shipment['status'])); ?></strong></p>\n                                \n                                <?php if (is_logged_in() && $_SESSION['user_id'] == $shipment['user_id'] && $shipment['free_trackings_used'] >= FREE_TRACKING_LIMIT): ?>\n                                    <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4\">\n                                        <p class=\"text-yellow-800 text-sm\">\n                                            You've used your <?php echo FREE_TRACKING_LIMIT; ?> free trackings. Upgrade for detailed location and ETA information.\n                                        </p>\n                                    </div>\n                                    \n                                    <!-- Upgrade Options -->\n                                    <form method=\"POST\" class=\"space-y-4\">\n                                        <input type=\"hidden\" name=\"tracking_number\" value=\"<?php echo $tracking_number; ?>\">\n                                        \n                                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                            <div class=\"border border-blue-200 rounded-lg p-4 hover:bg-blue-50 transition duration-200\">\n                                                <label class=\"cursor-pointer\">\n                                                    <input type=\"radio\" name=\"tracking_level\" value=\"standard\" required class=\"sr-only\">\n                                                    <div class=\"text-center\">\n                                                        <h4 class=\"font-semibold text-blue-800 mb-2\">Standard Tracking</h4>\n                                                        <p class=\"text-2xl font-bold text-blue-600 mb-2\">$<?php echo number_format(STANDARD_TRACKING_PRICE, 2); ?></p>\n                                                        <ul class=\"text-sm text-blue-700 space-y-1\">\n                                                            <li>✓ Current status</li>\n                                                            <li>✓ Current city</li>\n                                                            <li>✓ Estimated delivery</li>\n                                                        </ul>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                            \n                                            <div class=\"border border-purple-200 rounded-lg p-4 hover:bg-purple-50 transition duration-200\">\n                                                <label class=\"cursor-pointer\">\n                                                    <input type=\"radio\" name=\"tracking_level\" value=\"premium\" required class=\"sr-only\">\n                                                    <div class=\"text-center\">\n                                                        <h4 class=\"font-semibold text-purple-800 mb-2\">Premium Tracking</h4>\n                                                        <p class=\"text-2xl font-bold text-purple-600 mb-2\">$<?php echo number_format(PREMIUM_TRACKING_PRICE, 2); ?></p>\n                                                        <ul class=\"text-sm text-purple-700 space-y-1\">\n                                                            <li>✓ Everything in Standard</li>\n                                                            <li>✓ Exact location</li>\n                                                            <li>✓ Live updates</li>\n                                                            <li>✓ SMS notifications</li>\n                                                        </ul>\n                                                    </div>\n                                                </label>\n                                            </div>\n                                        </div>\n                                        \n                                        <button type=\"submit\" name=\"purchase_tracking\" \n                                                class=\"w-full bg-accent text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition duration-200\">\n                                            Upgrade Tracking\n                                        </button>\n                                    </form>\n                                <?php endif; ?>\n                            </div>\n                        </div>\n                    <?php else: ?>\n                        <!-- Advanced Tracking -->\n                        <div class=\"space-y-6\">\n                            <!-- Current Location -->\n                            <?php if ($shipment['current_location']): ?>\n                                <div class=\"text-center py-4\">\n                                    <div class=\"text-4xl mb-2 pulse-animation\">📍</div>\n                                    <h3 class=\"text-lg font-medium text-gray-900\">Current Location</h3>\n                                    <p class=\"text-xl font-semibold text-accent\"><?php echo htmlspecialchars($shipment['current_location']); ?></p>\n                                </div>\n                            <?php endif; ?>\n                            \n                            <!-- Estimated Delivery -->\n                            <?php if ($shipment['estimated_delivery']): ?>\n                                <div class=\"bg-green-50 border border-green-200 rounded-lg p-4 text-center\">\n                                    <h4 class=\"font-medium text-green-800 mb-1\">Estimated Delivery</h4>\n                                    <p class=\"text-lg font-semibold text-green-700\">\n                                        <?php echo date('M j, Y g:i A', strtotime($shipment['estimated_delivery'])); ?>\n                                    </p>\n                                </div>\n                            <?php endif; ?>\n                        </div>\n                    <?php endif; ?>\n                </div>\n                \n                <!-- Tracking History -->\n                <div class=\"content-overlay rounded-lg p-6 border border-white/20\">\n                    <h2 class=\"text-xl font-semibold text-gray-900 mb-6\">Tracking History</h2>\n                    \n                    <div class=\"space-y-4\">\n                        <?php foreach (array_reverse($shipment['history']) as $index => $event): ?>\n                            <div class=\"flex items-start space-x-4 tracking-step <?php echo $index === 0 ? 'completed' : ''; ?>\">\n                                <div class=\"flex-shrink-0 w-8 h-8 bg-accent rounded-full flex items-center justify-center\">\n                                    <span class=\"text-white text-sm font-bold\"><?php echo $index + 1; ?></span>\n                                </div>\n                                \n                                <div class=\"flex-1\">\n                                    <div class=\"flex items-center justify-between\">\n                                        <h3 class=\"font-medium text-gray-900\"><?php echo htmlspecialchars($event['status']); ?></h3>\n                                        <span class=\"text-sm text-gray-500\"><?php echo date('M j, Y g:i A', strtotime($event['timestamp'])); ?></span>\n                                    </div>\n                                    \n                                    <?php if ($event['location'] && $shipment['tracking_level'] !== 'basic'): ?>\n                                        <p class=\"text-sm text-gray-600 mt-1\">📍 <?php echo htmlspecialchars($event['location']); ?></p>\n                                    <?php endif; ?>\n                                    \n                                    <?php if ($event['description']): ?>\n                                        <p class=\"text-sm text-gray-600 mt-1\"><?php echo htmlspecialchars($event['description']); ?></p>\n                                    <?php endif; ?>\n                                </div>\n                            </div>\n                        <?php endforeach; ?>\n                    </div>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n    \n    <script>\n        // Add interactive effects\n        document.addEventListener('DOMContentLoaded', function() {\n            // Animate progress bar on load\n            const progressBar = document.querySelector('.progress-bar');\n            if (progressBar) {\n                setTimeout(() => {\n                    progressBar.style.width = progressBar.style.width;\n                }, 500);\n            }\n            \n            // Handle tracking level selection\n            const trackingOptions = document.querySelectorAll('input[name=\"tracking_level\"]');\n            trackingOptions.forEach(option => {\n                option.addEventListener('change', function() {\n                    // Remove selection from all options\n                    document.querySelectorAll('input[name=\"tracking_level\"]').forEach(opt => {\n                        opt.closest('.border').classList.remove('ring-2', 'ring-blue-500', 'ring-purple-500');\n                    });\n                    \n                    // Add selection to chosen option\n                    const color = this.value === 'standard' ? 'ring-blue-500' : 'ring-purple-500';\n                    this.closest('.border').classList.add('ring-2', color);\n                });\n            });\n        });\n    </script>\n</body>\n</html>\n","size_bytes":20410},"vendor-application.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/vendor.php';\n\n$vendor_manager = new VendorManager();\n$error = '';\n$success = '';\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $name = sanitize_input($_POST['name']);\n    $email = sanitize_input($_POST['email']);\n    $business_name = sanitize_input($_POST['business_name']);\n    $description = sanitize_input($_POST['description']);\n    \n    $logo_path = null;\n    \n    // Handle logo upload\n    if (isset($_FILES['logo']) && $_FILES['logo']['error'] == 0) {\n        $allowed_types = ['image/jpeg', 'image/png', 'image/gif'];\n        $file_type = $_FILES['logo']['type'];\n        \n        if (in_array($file_type, $allowed_types) && $_FILES['logo']['size'] <= MAX_FILE_SIZE) {\n            $upload_dir = UPLOAD_PATH . 'vendor_logos/';\n            if (!file_exists($upload_dir)) {\n                mkdir($upload_dir, 0777, true);\n            }\n            \n            $file_extension = pathinfo($_FILES['logo']['name'], PATHINFO_EXTENSION);\n            $filename = uniqid() . '.' . $file_extension;\n            $logo_path = $upload_dir . $filename;\n            \n            if (!move_uploaded_file($_FILES['logo']['tmp_name'], $logo_path)) {\n                $logo_path = null;\n            }\n        }\n    }\n    \n    $result = $vendor_manager->submit_application($name, $email, $business_name, $description, $logo_path);\n    \n    if ($result['success']) {\n        $success = $result['message'];\n    } else {\n        $error = $result['message'];\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Become a Vendor - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center\">\n                    <a href=\"index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"index.php\" class=\"text-gray-700 hover:text-accent\">Home</a>\n                    <a href=\"login.php\" class=\"text-accent hover:text-blue-600\">Login</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8\">\n        <div class=\"text-center mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Become a Vendor</h1>\n            <p class=\"mt-4 text-lg text-gray-600\">Join our marketplace and start selling your products to thousands of customers</p>\n        </div>\n        \n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo $error; ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($success): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                <?php echo $success; ?>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"bg-white shadow-lg rounded-lg p-8\">\n            <form method=\"POST\" enctype=\"multipart/form-data\" class=\"space-y-6\">\n                <div>\n                    <label for=\"name\" class=\"block text-sm font-medium text-gray-700\">Full Name *</label>\n                    <input id=\"name\" name=\"name\" type=\"text\" required \n                           class=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent\">\n                </div>\n                \n                <div>\n                    <label for=\"email\" class=\"block text-sm font-medium text-gray-700\">Email Address *</label>\n                    <input id=\"email\" name=\"email\" type=\"email\" required \n                           class=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent\">\n                </div>\n                \n                <div>\n                    <label for=\"business_name\" class=\"block text-sm font-medium text-gray-700\">Business Name *</label>\n                    <input id=\"business_name\" name=\"business_name\" type=\"text\" required \n                           class=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent\">\n                </div>\n                \n                <div>\n                    <label for=\"description\" class=\"block text-sm font-medium text-gray-700\">Business Description *</label>\n                    <textarea id=\"description\" name=\"description\" rows=\"4\" required \n                              placeholder=\"Tell us about your business, what products you sell, and why you'd be a great addition to our marketplace...\"\n                              class=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent\"></textarea>\n                </div>\n                \n                <div>\n                    <label for=\"logo\" class=\"block text-sm font-medium text-gray-700\">Business Logo (Optional)</label>\n                    <input id=\"logo\" name=\"logo\" type=\"file\" accept=\"image/*\" \n                           class=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent\">\n                    <p class=\"mt-1 text-sm text-gray-500\">Upload your business logo (JPG, PNG, GIF - Max 5MB)</p>\n                </div>\n                \n                <div class=\"bg-blue-50 border border-blue-200 rounded-md p-4\">\n                    <h3 class=\"text-lg font-medium text-blue-800 mb-2\">What happens next?</h3>\n                    <ul class=\"text-sm text-blue-700 space-y-1\">\n                        <li>• We'll review your application within 24-48 hours</li>\n                        <li>• If approved, you'll receive login credentials via notification</li>\n                        <li>• You can then access your vendor dashboard to start adding products</li>\n                        <li>• Verified vendors get priority placement in search results</li>\n                    </ul>\n                </div>\n                \n                <div class=\"pt-4\">\n                    <button type=\"submit\" \n                            class=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-accent hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition duration-200\">\n                        Submit Application\n                    </button>\n                </div>\n            </form>\n        </div>\n        \n        <div class=\"mt-8 text-center\">\n            <a href=\"index.php\" class=\"text-accent hover:text-blue-600\">← Back to Home</a>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":7610},"wishlist.php":{"content":"<?php\nrequire_once './config/config.php';\nrequire_once './includes/wishlist.php';\nrequire_once './includes/cart.php';\n\n// Check if user is logged in\nif (!is_logged_in()) {\n    redirect('login.php');\n}\n\n$wishlist_manager = new WishlistManager();\n$cart_manager = new CartManager();\n$user_id = $_SESSION['user_id'];\n\n// Handle remove from wishlist\n$message = '';\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['remove_from_wishlist'])) {\n    $product_id = $_POST['product_id'] ?? null;\n    if ($product_id) {\n        $result = $wishlist_manager->remove_from_wishlist($user_id, $product_id);\n        $message = $result['message'];\n    }\n}\n\n// Handle add to cart from wishlist\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['add_to_cart'])) {\n    $product_id = $_POST['product_id'] ?? null;\n    $quantity = max(1, $_POST['quantity'] ?? 1);\n    \n    if ($product_id) {\n        $result = $cart_manager->add_to_cart($user_id, $product_id, $quantity);\n        $message = $result['message'];\n    }\n}\n\n// Get wishlist items\n$wishlist_items = $wishlist_manager->get_wishlist($user_id);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title><?php echo SITE_NAME; ?> - My Wishlist</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    },\n                    fontFamily: {\n                        'sans': ['Inter', 'system-ui', 'sans-serif'],\n                    }\n                }\n            }\n        }\n    </script>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n    <style>\n        .line-clamp-2 {\n            display: -webkit-box;\n            -webkit-line-clamp: 2;\n            -webkit-box-orient: vertical;\n            overflow: hidden;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-50 font-sans\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm sticky top-0 z-50 border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex items-center justify-between h-16\">\n                <!-- Logo -->\n                <div class=\"flex items-center\">\n                    <a href=\"index.php\" class=\"flex items-center\">\n                        <div class=\"w-10 h-10 bg-accent rounded-lg flex items-center justify-center mr-3\">\n                            <span class=\"text-white font-bold text-lg\">MN</span>\n                        </div>\n                        <span class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></span>\n                    </a>\n                </div>\n                \n                <!-- Navigation -->\n                <nav class=\"flex items-center space-x-6\">\n                    <a href=\"index.php\" class=\"text-gray-700 hover:text-accent\">Home</a>\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Products</a>\n                    <a href=\"cart.php\" class=\"text-gray-700 hover:text-accent\">Cart</a>\n                    <a href=\"wishlist.php\" class=\"text-accent font-semibold\">Wishlist</a>\n                    <a href=\"user/dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"logout.php\" class=\"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <!-- Main Content -->\n    <main class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <!-- Page Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">My Wishlist</h1>\n            <p class=\"text-gray-600\">Your saved items for later purchase</p>\n        </div>\n\n        <!-- Message Display -->\n        <?php if ($message): ?>\n            <div class=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                <p class=\"text-blue-800\"><?php echo htmlspecialchars($message); ?></p>\n            </div>\n        <?php endif; ?>\n\n        <!-- Wishlist Items -->\n        <?php if (empty($wishlist_items)): ?>\n            <div class=\"text-center py-12\">\n                <div class=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <svg class=\"w-12 h-12 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                    </svg>\n                </div>\n                <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Your wishlist is empty</h3>\n                <p class=\"text-gray-600 mb-6\">Start adding items you love to your wishlist!</p>\n                <a href=\"products.php\" class=\"bg-accent text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium\">\n                    Browse Products\n                </a>\n            </div>\n        <?php else: ?>\n            <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                <?php foreach ($wishlist_items as $item): ?>\n                    <div class=\"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden border group\">\n                        <div class=\"relative\">\n                            <img src=\"<?php echo htmlspecialchars((!empty($item['images']) && is_array($item['images'])) ? $item['images'][0] : 'https://via.placeholder.com/300x300?text=Product'); ?>\" \n                                 alt=\"<?php echo htmlspecialchars($item['name']); ?>\" \n                                 class=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\">\n                            \n                            <!-- Remove from wishlist button -->\n                            <form method=\"POST\" class=\"absolute top-2 right-2\">\n                                <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['id']; ?>\">\n                                <button type=\"submit\" name=\"remove_from_wishlist\" \n                                        class=\"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors\"\n                                        onclick=\"return confirm('Remove from wishlist?')\">\n                                    <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                        <path fill-rule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clip-rule=\"evenodd\"></path>\n                                    </svg>\n                                </button>\n                            </form>\n                        </div>\n                        \n                        <div class=\"p-4\">\n                            <h3 class=\"font-medium text-gray-900 mb-2 text-sm leading-tight\"><?php echo htmlspecialchars($item['name']); ?></h3>\n                            <p class=\"text-gray-500 text-xs mb-3 line-clamp-2\"><?php echo htmlspecialchars(substr($item['description'], 0, 60)); ?>...</p>\n                            \n                            <div class=\"flex items-center justify-between mb-3\">\n                                <div class=\"flex flex-col\">\n                                    <?php if ($item['sale_price'] && $item['sale_price'] < $item['price']): ?>\n                                        <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($item['sale_price']); ?></span>\n                                        <span class=\"text-sm text-red-500 line-through\"><?php echo format_currency($item['price']); ?></span>\n                                    <?php else: ?>\n                                        <span class=\"text-lg font-bold text-gray-900\"><?php echo format_currency($item['price']); ?></span>\n                                    <?php endif; ?>\n                                </div>\n                                \n                                <div class=\"text-xs text-gray-500\">\n                                    Added <?php echo date('M j, Y', strtotime($item['added_at'])); ?>\n                                </div>\n                            </div>\n                            \n                            <div class=\"flex space-x-2\">\n                                <a href=\"product-detail.php?id=<?php echo $item['id']; ?>\" \n                                   class=\"flex-1 bg-gray-100 text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-200 transition-colors text-center\">\n                                    View Details\n                                </a>\n                                \n                                <form method=\"POST\" class=\"flex-1\">\n                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $item['id']; ?>\">\n                                    <input type=\"hidden\" name=\"quantity\" value=\"1\">\n                                    <button type=\"submit\" name=\"add_to_cart\" \n                                            class=\"w-full bg-accent text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-600 transition-colors\">\n                                        Add to Cart\n                                    </button>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                <?php endforeach; ?>\n            </div>\n            \n            <!-- Wishlist Summary -->\n            <div class=\"mt-8 bg-white rounded-lg p-6 border\">\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <h3 class=\"text-lg font-semibold text-gray-900\">Wishlist Summary</h3>\n                        <p class=\"text-gray-600\"><?php echo count($wishlist_items); ?> item(s) in your wishlist</p>\n                    </div>\n                    <div class=\"flex space-x-4\">\n                        <a href=\"products.php\" class=\"bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors\">\n                            Continue Shopping\n                        </a>\n                        <a href=\"cart.php\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors\">\n                            View Cart\n                        </a>\n                    </div>\n                </div>\n            </div>\n        <?php endif; ?>\n    </main>\n\n    <!-- Footer -->\n    <footer class=\"bg-gray-900 text-white mt-16\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div class=\"text-center\">\n                <p class=\"text-gray-400\">&copy; 2024 <?php echo SITE_NAME; ?>. All rights reserved.</p>\n            </div>\n        </div>\n    </footer>\n</body>\n</html>\n\n","size_bytes":11503},"admin/add-product.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/product.php';\n\nrequire_admin();\n\n$productManager = new ProductManager();\n$message = '';\n$error = '';\n\n// Generate CSRF token if not set\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = generate_csrf_token();\n}\n\n// Get categories for dropdown\n$categories = $productManager->get_categories();\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $name = sanitize_input($_POST['name']);\n        $description = sanitize_input($_POST['description']);\n        $price = (float)$_POST['price'];\n        $sale_price = !empty($_POST['sale_price']) ? (float)$_POST['sale_price'] : null;\n        $category_id = (int)$_POST['category_id'];\n        $stock_quantity = (int)$_POST['stock_quantity'];\n        $sku = sanitize_input($_POST['sku']);\n        $is_featured = isset($_POST['is_featured']) ? 1 : 0;\n        $is_flash_deal = isset($_POST['is_flash_deal']) ? 1 : 0;\n        $flash_deal_end = $is_flash_deal && !empty($_POST['flash_deal_end']) ? $_POST['flash_deal_end'] : null;\n        \n        // Handle image upload with security validation\n        $images = [];\n        $upload_errors = [];\n        \n        if (isset($_FILES['images']) && $_FILES['images']['error'][0] !== UPLOAD_ERR_NO_FILE) {\n            $upload_dir = '../uploads/products/';\n            if (!file_exists($upload_dir)) {\n                mkdir($upload_dir, 0755, true);\n            }\n            \n            // Security settings\n            $allowed_types = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\n            $allowed_extensions = ['jpg', 'jpeg', 'png', 'webp'];\n            $max_file_size = 5 * 1024 * 1024; // 5MB\n            $max_files = 5;\n            \n            foreach ($_FILES['images']['tmp_name'] as $key => $tmp_name) {\n                if ($_FILES['images']['error'][$key] === UPLOAD_ERR_OK) {\n                    // Check file count limit\n                    if (count($images) >= $max_files) {\n                        $upload_errors[] = \"Maximum $max_files files allowed\";\n                        break;\n                    }\n                    \n                    // Check file size\n                    if ($_FILES['images']['size'][$key] > $max_file_size) {\n                        $upload_errors[] = \"File '{$_FILES['images']['name'][$key]}' is too large (max 5MB)\";\n                        continue;\n                    }\n                    \n                    // Verify MIME type with finfo\n                    $finfo = finfo_open(FILEINFO_MIME_TYPE);\n                    $mime_type = finfo_file($finfo, $tmp_name);\n                    finfo_close($finfo);\n                    \n                    if (!in_array($mime_type, $allowed_types)) {\n                        $upload_errors[] = \"File '{$_FILES['images']['name'][$key]}' has invalid type. Only JPG, PNG, and WebP allowed\";\n                        continue;\n                    }\n                    \n                    // Double-check with getimagesize\n                    $image_info = getimagesize($tmp_name);\n                    if ($image_info === false || !in_array($image_info['mime'], $allowed_types)) {\n                        $upload_errors[] = \"File '{$_FILES['images']['name'][$key]}' is not a valid image\";\n                        continue;\n                    }\n                    \n                    // Generate secure filename\n                    $extension = match($mime_type) {\n                        'image/jpeg' => 'jpg',\n                        'image/jpg' => 'jpg',\n                        'image/png' => 'png',\n                        'image/webp' => 'webp',\n                        default => 'jpg'\n                    };\n                    \n                    $filename = 'product_' . bin2hex(random_bytes(16)) . '.' . $extension;\n                    $upload_path = $upload_dir . $filename;\n                    \n                    if (move_uploaded_file($tmp_name, $upload_path)) {\n                        // Set secure file permissions\n                        chmod($upload_path, 0644);\n                        $images[] = 'uploads/products/' . $filename;\n                    } else {\n                        $upload_errors[] = \"Failed to upload '{$_FILES['images']['name'][$key]}'\";\n                    }\n                } elseif ($_FILES['images']['error'][$key] !== UPLOAD_ERR_NO_FILE) {\n                    $upload_errors[] = \"Upload error for '{$_FILES['images']['name'][$key]}': \" . $_FILES['images']['error'][$key];\n                }\n            }\n        }\n        \n        // Add placeholder image if no images uploaded\n        if (empty($images)) {\n            $images[] = 'https://via.placeholder.com/400x300?text=Product+Image';\n        }\n        \n        // Show upload errors if any\n        if (!empty($upload_errors)) {\n            $error = 'Upload errors: ' . implode(', ', $upload_errors);\n        }\n        \n        // Validate required fields\n        if (empty($error) && $name && $description && $price > 0 && $category_id && $stock_quantity >= 0) {\n            // Admin products use vendor_id = 3 (Admin Store)\n            $result = $productManager->add_product(\n                3, // vendor_id = 3 for admin products\n                $category_id,\n                $name,\n                $description,\n                $price,\n                $sale_price,\n                $stock_quantity,\n                $sku,\n                $images,\n                $is_featured,\n                $is_flash_deal,\n                $flash_deal_end\n            );\n            \n            if ($result['success']) {\n                $message = 'Product added successfully! Product ID: ' . $result['product_id'];\n                // Clear form\n                $_POST = [];\n            } else {\n                $error = $result['message'];\n            }\n        } else {\n            $error = 'Please fill in all required fields with valid values.';\n        }\n    } else {\n        $error = 'Invalid security token. Please try again.';\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Add Product - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Products</a>\n                    <a href=\"vendor-management.php\" class=\"text-gray-700 hover:text-accent\">Vendors</a>\n                    <a href=\"orders.php\" class=\"text-gray-700 hover:text-accent\">Orders</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Add New Product</h1>\n            <p class=\"mt-2 text-gray-600\">Create a new product for the marketplace</p>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($message); ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($error); ?>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"bg-white shadow rounded-lg\">\n            <form method=\"POST\" enctype=\"multipart/form-data\" class=\"p-6 space-y-6\">\n                <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                \n                <!-- Basic Information -->\n                <div class=\"border-b border-gray-200 pb-6\">\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Basic Information</h3>\n                    \n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <div>\n                            <label for=\"name\" class=\"block text-sm font-medium text-gray-700 mb-2\">Product Name *</label>\n                            <input type=\"text\" id=\"name\" name=\"name\" value=\"<?php echo htmlspecialchars($_POST['name'] ?? ''); ?>\" \n                                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\" required>\n                        </div>\n                        \n                        <div>\n                            <label for=\"category_id\" class=\"block text-sm font-medium text-gray-700 mb-2\">Category *</label>\n                            <select id=\"category_id\" name=\"category_id\" \n                                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\" required>\n                                <option value=\"\">Select Category</option>\n                                <?php foreach ($categories as $category): ?>\n                                    <option value=\"<?php echo $category['id']; ?>\" \n                                            <?php echo isset($_POST['category_id']) && $_POST['category_id'] == $category['id'] ? 'selected' : ''; ?>>\n                                        <?php echo htmlspecialchars($category['name']); ?>\n                                    </option>\n                                <?php endforeach; ?>\n                            </select>\n                        </div>\n                        \n                        <div>\n                            <label for=\"sku\" class=\"block text-sm font-medium text-gray-700 mb-2\">SKU</label>\n                            <input type=\"text\" id=\"sku\" name=\"sku\" value=\"<?php echo htmlspecialchars($_POST['sku'] ?? ''); ?>\" \n                                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\"\n                                   placeholder=\"e.g., ADMIN-001\">\n                        </div>\n                        \n                        <div>\n                            <label for=\"stock_quantity\" class=\"block text-sm font-medium text-gray-700 mb-2\">Stock Quantity *</label>\n                            <input type=\"number\" id=\"stock_quantity\" name=\"stock_quantity\" value=\"<?php echo htmlspecialchars($_POST['stock_quantity'] ?? ''); ?>\" \n                                   min=\"0\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\" required>\n                        </div>\n                    </div>\n                    \n                    <div class=\"mt-6\">\n                        <label for=\"description\" class=\"block text-sm font-medium text-gray-700 mb-2\">Description *</label>\n                        <textarea id=\"description\" name=\"description\" rows=\"4\" \n                                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\" required><?php echo htmlspecialchars($_POST['description'] ?? ''); ?></textarea>\n                    </div>\n                </div>\n                \n                <!-- Pricing -->\n                <div class=\"border-b border-gray-200 pb-6\">\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Pricing</h3>\n                    \n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <div>\n                            <label for=\"price\" class=\"block text-sm font-medium text-gray-700 mb-2\">Regular Price ($) *</label>\n                            <input type=\"number\" id=\"price\" name=\"price\" value=\"<?php echo htmlspecialchars($_POST['price'] ?? ''); ?>\" \n                                   min=\"0\" step=\"0.01\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\" required>\n                        </div>\n                        \n                        <div>\n                            <label for=\"sale_price\" class=\"block text-sm font-medium text-gray-700 mb-2\">Sale Price ($)</label>\n                            <input type=\"number\" id=\"sale_price\" name=\"sale_price\" value=\"<?php echo htmlspecialchars($_POST['sale_price'] ?? ''); ?>\" \n                                   min=\"0\" step=\"0.01\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Images -->\n                <div class=\"border-b border-gray-200 pb-6\">\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Product Images</h3>\n                    \n                    <div>\n                        <label for=\"images\" class=\"block text-sm font-medium text-gray-700 mb-2\">Upload Images</label>\n                        <input type=\"file\" id=\"images\" name=\"images[]\" multiple accept=\"image/*\" \n                               class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                        <p class=\"text-sm text-gray-500 mt-1\">Select multiple images. If no images uploaded, a placeholder will be used.</p>\n                    </div>\n                </div>\n                \n                <!-- Product Options -->\n                <div class=\"border-b border-gray-200 pb-6\">\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Product Options</h3>\n                    \n                    <div class=\"space-y-4\">\n                        <div class=\"flex items-center\">\n                            <input type=\"checkbox\" id=\"is_featured\" name=\"is_featured\" value=\"1\" \n                                   <?php echo isset($_POST['is_featured']) ? 'checked' : ''; ?>\n                                   class=\"w-4 h-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                            <label for=\"is_featured\" class=\"ml-2 text-sm text-gray-700\">Featured Product</label>\n                        </div>\n                        \n                        <div class=\"flex items-center\">\n                            <input type=\"checkbox\" id=\"is_flash_deal\" name=\"is_flash_deal\" value=\"1\" \n                                   <?php echo isset($_POST['is_flash_deal']) ? 'checked' : ''; ?>\n                                   class=\"w-4 h-4 text-accent focus:ring-accent border-gray-300 rounded\"\n                                   onchange=\"toggleFlashDealEnd()\">\n                            <label for=\"is_flash_deal\" class=\"ml-2 text-sm text-gray-700\">Flash Deal</label>\n                        </div>\n                        \n                        <div id=\"flash_deal_end_container\" style=\"display: none;\">\n                            <label for=\"flash_deal_end\" class=\"block text-sm font-medium text-gray-700 mb-2\">Flash Deal End Date</label>\n                            <input type=\"datetime-local\" id=\"flash_deal_end\" name=\"flash_deal_end\" value=\"<?php echo htmlspecialchars($_POST['flash_deal_end'] ?? ''); ?>\" \n                                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Submit Buttons -->\n                <div class=\"flex justify-between items-center pt-6\">\n                    <a href=\"products.php\" class=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-200\">\n                        Cancel\n                    </a>\n                    \n                    <button type=\"submit\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200\">\n                        Add Product\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n    \n    <script>\n        function toggleFlashDealEnd() {\n            const checkbox = document.getElementById('is_flash_deal');\n            const container = document.getElementById('flash_deal_end_container');\n            container.style.display = checkbox.checked ? 'block' : 'none';\n        }\n        \n        // Initialize on page load\n        document.addEventListener('DOMContentLoaded', function() {\n            toggleFlashDealEnd();\n        });\n    </script>\n</body>\n</html>","size_bytes":17773},"admin/advertisements.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/advertisement.php';\n\nrequire_admin();\n\n$adManager = new AdvertisementManager();\n$message = '';\n$error = '';\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (isset($_POST['create_ad'])) {\n        $title = $_POST['title'] ?? '';\n        $content = $_POST['content'] ?? '';\n        $image_url = $_POST['image_url'] ?? '';\n        $video_url = $_POST['video_url'] ?? '';\n        $link_url = $_POST['link_url'] ?? '';\n        $ad_type = $_POST['ad_type'] ?? 'banner';\n        $position = $_POST['position'] ?? 'top';\n        $start_date = $_POST['start_date'] ?: null;\n        $end_date = $_POST['end_date'] ?: null;\n        \n        if (empty($title)) {\n            $error = 'Title is required';\n        } else {\n            $result = $adManager->createAd($title, $content, $image_url, $video_url, $link_url, $ad_type, $position, $start_date, $end_date);\n            if ($result['success']) {\n                $message = $result['message'];\n            } else {\n                $error = $result['message'];\n            }\n        }\n    }\n    \n    if (isset($_POST['update_ad'])) {\n        $id = $_POST['ad_id'] ?? '';\n        $title = $_POST['title'] ?? '';\n        $content = $_POST['content'] ?? '';\n        $image_url = $_POST['image_url'] ?? '';\n        $video_url = $_POST['video_url'] ?? '';\n        $link_url = $_POST['link_url'] ?? '';\n        $ad_type = $_POST['ad_type'] ?? 'banner';\n        $position = $_POST['position'] ?? 'top';\n        $is_active = isset($_POST['is_active']) ? 1 : 0;\n        $start_date = $_POST['start_date'] ?: null;\n        $end_date = $_POST['end_date'] ?: null;\n        \n        if (empty($title)) {\n            $error = 'Title is required';\n        } else {\n            $result = $adManager->updateAd($id, $title, $content, $image_url, $video_url, $link_url, $ad_type, $position, $is_active, $start_date, $end_date);\n            if ($result['success']) {\n                $message = $result['message'];\n            } else {\n                $error = $result['message'];\n            }\n        }\n    }\n    \n    if (isset($_POST['delete_ad'])) {\n        $id = $_POST['ad_id'] ?? '';\n        $result = $adManager->deleteAd($id);\n        if ($result['success']) {\n            $message = $result['message'];\n        } else {\n            $error = $result['message'];\n        }\n    }\n}\n\n// Get all ads\n$ads = $adManager->getAllAds();\n$stats = $adManager->getAdStats();\n\n// Get ad for editing\n$edit_ad = null;\nif (isset($_GET['edit'])) {\n    $edit_ad = $adManager->getAd($_GET['edit']);\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Advertisement Management - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Admin Dashboard</a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700 font-medium\">Advertisement Management</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <!-- Page Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Advertisement Management</h1>\n            <p class=\"mt-2 text-gray-600\">Create and manage advertisements across the platform</p>\n        </div>\n\n        <!-- Messages -->\n        <?php if ($message): ?>\n            <div class=\"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg\">\n                <p class=\"text-green-800\"><?php echo htmlspecialchars($message); ?></p>\n            </div>\n        <?php endif; ?>\n\n        <?php if ($error): ?>\n            <div class=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\n                <p class=\"text-red-800\"><?php echo htmlspecialchars($error); ?></p>\n            </div>\n        <?php endif; ?>\n\n        <!-- Stats Cards -->\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-blue-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m0 0V1a1 1 0 011-1h2a1 1 0 011 1v18a1 1 0 01-1 1H3a1 1 0 01-1-1V1a1 1 0 011-1h2a1 1 0 011 1v3m0 0h8m-8 0v16a1 1 0 001 1h6a1 1 0 001-1V4H7z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Ads</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $stats['total_ads']; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-green-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Active Ads</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $stats['active_ads']; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-purple-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Views</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($stats['total_views']); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-yellow-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Clicks</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($stats['total_clicks']); ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Create/Edit Ad Form -->\n        <div class=\"bg-white rounded-lg shadow mb-8\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">\n                    <?php echo $edit_ad ? 'Edit Advertisement' : 'Create New Advertisement'; ?>\n                </h2>\n            </div>\n            \n            <form method=\"POST\" class=\"p-6\">\n                <?php if ($edit_ad): ?>\n                    <input type=\"hidden\" name=\"ad_id\" value=\"<?php echo $edit_ad['id']; ?>\">\n                <?php endif; ?>\n                \n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Title *</label>\n                        <input type=\"text\" name=\"title\" value=\"<?php echo htmlspecialchars($edit_ad['title'] ?? ''); ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\" required>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Ad Type</label>\n                        <select name=\"ad_type\" class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                            <option value=\"banner\" <?php echo ($edit_ad['ad_type'] ?? 'banner') === 'banner' ? 'selected' : ''; ?>>Banner</option>\n                            <option value=\"sidebar\" <?php echo ($edit_ad['ad_type'] ?? '') === 'sidebar' ? 'selected' : ''; ?>>Sidebar</option>\n                            <option value=\"popup\" <?php echo ($edit_ad['ad_type'] ?? '') === 'popup' ? 'selected' : ''; ?>>Popup</option>\n                            <option value=\"inline\" <?php echo ($edit_ad['ad_type'] ?? '') === 'inline' ? 'selected' : ''; ?>>Inline</option>\n                        </select>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Position</label>\n                        <select name=\"position\" class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                            <option value=\"top\" <?php echo ($edit_ad['position'] ?? 'top') === 'top' ? 'selected' : ''; ?>>Top</option>\n                            <option value=\"middle\" <?php echo ($edit_ad['position'] ?? '') === 'middle' ? 'selected' : ''; ?>>Middle</option>\n                            <option value=\"bottom\" <?php echo ($edit_ad['position'] ?? '') === 'bottom' ? 'selected' : ''; ?>>Bottom</option>\n                            <option value=\"left\" <?php echo ($edit_ad['position'] ?? '') === 'left' ? 'selected' : ''; ?>>Left</option>\n                            <option value=\"right\" <?php echo ($edit_ad['position'] ?? '') === 'right' ? 'selected' : ''; ?>>Right</option>\n                        </select>\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Link URL</label>\n                        <input type=\"url\" name=\"link_url\" value=\"<?php echo htmlspecialchars($edit_ad['link_url'] ?? ''); ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Image URL</label>\n                        <input type=\"url\" name=\"image_url\" value=\"<?php echo htmlspecialchars($edit_ad['image_url'] ?? ''); ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Video URL</label>\n                        <input type=\"url\" name=\"video_url\" value=\"<?php echo htmlspecialchars($edit_ad['video_url'] ?? ''); ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Start Date</label>\n                        <input type=\"datetime-local\" name=\"start_date\" value=\"<?php echo $edit_ad['start_date'] ? date('Y-m-d\\TH:i', strtotime($edit_ad['start_date'])) : ''; ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                    </div>\n                    \n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">End Date</label>\n                        <input type=\"datetime-local\" name=\"end_date\" value=\"<?php echo $edit_ad['end_date'] ? date('Y-m-d\\TH:i', strtotime($edit_ad['end_date'])) : ''; ?>\" \n                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                    </div>\n                </div>\n                \n                <div class=\"mt-6\">\n                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Content</label>\n                    <textarea name=\"content\" rows=\"4\" \n                              class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\"><?php echo htmlspecialchars($edit_ad['content'] ?? ''); ?></textarea>\n                </div>\n                \n                <?php if ($edit_ad): ?>\n                    <div class=\"mt-6\">\n                        <label class=\"flex items-center\">\n                            <input type=\"checkbox\" name=\"is_active\" <?php echo $edit_ad['is_active'] ? 'checked' : ''; ?> \n                                   class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                            <span class=\"ml-2 text-sm text-gray-700\">Active</span>\n                        </label>\n                    </div>\n                <?php endif; ?>\n                \n                <div class=\"mt-6 flex justify-end space-x-4\">\n                    <?php if ($edit_ad): ?>\n                        <a href=\"advertisements.php\" class=\"bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition\">\n                            Cancel\n                        </a>\n                        <button type=\"submit\" name=\"update_ad\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                            Update Advertisement\n                        </button>\n                    <?php else: ?>\n                        <button type=\"submit\" name=\"create_ad\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                            Create Advertisement\n                        </button>\n                    <?php endif; ?>\n                </div>\n            </form>\n        </div>\n\n        <!-- Ads List -->\n        <div class=\"bg-white rounded-lg shadow\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">All Advertisements</h2>\n            </div>\n            \n            <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                        <tr>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Ad</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Position</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Views</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Clicks</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                        <?php foreach ($ads as $ad): ?>\n                            <tr>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <div class=\"flex items-center\">\n                                        <?php if ($ad['image_url']): ?>\n                                            <img src=\"<?php echo htmlspecialchars($ad['image_url']); ?>\" alt=\"Ad\" class=\"w-12 h-12 object-cover rounded-lg\">\n                                        <?php else: ?>\n                                            <div class=\"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center\">\n                                                <span class=\"text-gray-500 text-xs\">No Image</span>\n                                            </div>\n                                        <?php endif; ?>\n                                        <div class=\"ml-4\">\n                                            <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($ad['title']); ?></div>\n                                            <div class=\"text-sm text-gray-500\"><?php echo date('M j, Y', strtotime($ad['created_at'])); ?></div>\n                                        </div>\n                                    </div>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                    <?php echo ucfirst($ad['ad_type']); ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                    <?php echo ucfirst($ad['position']); ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $ad['is_active'] ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>\">\n                                        <?php echo $ad['is_active'] ? 'Active' : 'Inactive'; ?>\n                                    </span>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                    <?php echo number_format($ad['view_count']); ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                    <?php echo number_format($ad['click_count']); ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                    <div class=\"flex space-x-2\">\n                                        <a href=\"?edit=<?php echo $ad['id']; ?>\" class=\"text-accent hover:text-blue-600\">Edit</a>\n                                        <form method=\"POST\" class=\"inline\" onsubmit=\"return confirm('Are you sure you want to delete this advertisement?')\">\n                                            <input type=\"hidden\" name=\"ad_id\" value=\"<?php echo $ad['id']; ?>\">\n                                            <button type=\"submit\" name=\"delete_ad\" class=\"text-red-600 hover:text-red-900\">Delete</button>\n                                        </form>\n                                    </div>\n                                </td>\n                            </tr>\n                        <?php endforeach; ?>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n\n","size_bytes":21495},"admin/analytics.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/order.php';\nrequire_once '../includes/product.php';\n\nrequire_admin();\n\n$orderManager = new OrderManager();\n$productManager = new ProductManager();\n\n$database = new Database();\n$db = $database->getConnection();\n\n// Get date range (default to last 30 days)\n$start_date = $_GET['start_date'] ?? date('Y-m-d', strtotime('-30 days'));\n$end_date = $_GET['end_date'] ?? date('Y-m-d');\n\n// Revenue analytics\n$stmt = $db->prepare(\"\n    SELECT \n        DATE(created_at) as date,\n        COUNT(*) as orders,\n        SUM(total_amount) as revenue\n    FROM orders \n    WHERE created_at >= ? AND created_at <= ? AND status != 'cancelled'\n    GROUP BY DATE(created_at)\n    ORDER BY date ASC\n\");\n$stmt->execute([$start_date . ' 00:00:00', $end_date . ' 23:59:59']);\n$revenue_data = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Top selling products\n$stmt = $db->prepare(\"\n    SELECT \n        p.name,\n        p.price,\n        SUM(oi.quantity) as total_sold,\n        SUM(oi.quantity * oi.price) as total_revenue\n    FROM order_items oi\n    JOIN products p ON oi.product_id = p.id\n    JOIN orders o ON oi.order_id = o.id\n    WHERE o.created_at >= ? AND o.created_at <= ? AND o.status != 'cancelled'\n    GROUP BY p.id, p.name, p.price\n    ORDER BY total_sold DESC\n    LIMIT 10\n\");\n$stmt->execute([$start_date . ' 00:00:00', $end_date . ' 23:59:59']);\n$top_products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Customer analytics\n$stmt = $db->prepare(\"\n    SELECT \n        COUNT(DISTINCT user_id) as total_customers,\n        COUNT(*) as total_orders,\n        AVG(total_amount) as avg_order_value\n    FROM orders \n    WHERE created_at >= ? AND created_at <= ? AND status != 'cancelled'\n\");\n$stmt->execute([$start_date . ' 00:00:00', $end_date . ' 23:59:59']);\n$customer_stats = $stmt->fetch(PDO::FETCH_ASSOC);\n\n// Order status distribution\n$stmt = $db->prepare(\"\n    SELECT \n        status,\n        COUNT(*) as count\n    FROM orders \n    WHERE created_at >= ? AND created_at <= ?\n    GROUP BY status\n\");\n$stmt->execute([$start_date . ' 00:00:00', $end_date . ' 23:59:59']);\n$order_status = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Monthly comparison  \n$stmt = $db->prepare(\"\n    SELECT \n        strftime('%m', created_at) as month,\n        strftime('%Y', created_at) as year,\n        COUNT(*) as orders,\n        SUM(total_amount) as revenue\n    FROM orders \n    WHERE created_at >= ? AND created_at <= ? AND status != 'cancelled'\n    GROUP BY strftime('%Y', created_at), strftime('%m', created_at)\n    ORDER BY year, month\n\");\n$stmt->execute([$start_date . ' 00:00:00', $end_date . ' 23:59:59']);\n$monthly_data = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Prepare chart data\n$chart_labels = [];\n$chart_revenue = [];\n$chart_orders = [];\n\nforeach ($revenue_data as $row) {\n    $chart_labels[] = date('M j', strtotime($row['date']));\n    $chart_revenue[] = (float)$row['revenue'];\n    $chart_orders[] = (int)$row['orders'];\n}\n\n$status_labels = [];\n$status_data = [];\n$status_colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];\n\nforeach ($order_status as $row) {\n    $status_labels[] = ucfirst($row['status']);\n    $status_data[] = (int)$row['count'];\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Analytics - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Admin Dashboard</a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700 font-medium\">Analytics</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <!-- Page Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Analytics Dashboard</h1>\n            <p class=\"mt-2 text-gray-600\">Comprehensive sales and performance analytics</p>\n        </div>\n\n        <!-- Date Range Filter -->\n        <div class=\"bg-white rounded-lg shadow p-6 mb-8\">\n            <form method=\"GET\" class=\"flex items-center space-x-4\">\n                <div>\n                    <label class=\"block text-sm font-medium text-gray-700 mb-1\">Start Date</label>\n                    <input type=\"date\" name=\"start_date\" value=\"<?php echo $start_date; ?>\" \n                           class=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                </div>\n                <div>\n                    <label class=\"block text-sm font-medium text-gray-700 mb-1\">End Date</label>\n                    <input type=\"date\" name=\"end_date\" value=\"<?php echo $end_date; ?>\" \n                           class=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                </div>\n                <div class=\"pt-6\">\n                    <button type=\"submit\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                        Update Analytics\n                    </button>\n                </div>\n            </form>\n        </div>\n\n        <!-- Key Metrics -->\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-green-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Revenue</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">\n                            $<?php echo number_format(array_sum($chart_revenue), 2); ?>\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-blue-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo array_sum($chart_orders); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-purple-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-2.25\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Active Customers</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $customer_stats['total_customers']; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-yellow-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Avg Order Value</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">$<?php echo number_format($customer_stats['avg_order_value'], 2); ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Charts Section -->\n        <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n            <!-- Revenue Chart -->\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Revenue & Orders Trend</h3>\n                <canvas id=\"revenueChart\" width=\"400\" height=\"200\"></canvas>\n            </div>\n\n            <!-- Order Status Distribution -->\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Order Status Distribution</h3>\n                <canvas id=\"statusChart\" width=\"400\" height=\"200\"></canvas>\n            </div>\n        </div>\n\n        <!-- Top Products -->\n        <div class=\"bg-white rounded-lg shadow mb-8\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h3 class=\"text-lg font-semibold text-gray-900\">Top Selling Products</h3>\n            </div>\n            <div class=\"p-6\">\n                <?php if (empty($top_products)): ?>\n                    <p class=\"text-gray-500 text-center py-4\">No sales data for the selected period</p>\n                <?php else: ?>\n                    <div class=\"overflow-x-auto\">\n                        <table class=\"min-w-full divide-y divide-gray-200\">\n                            <thead class=\"bg-gray-50\">\n                                <tr>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Product</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Price</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Units Sold</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Revenue</th>\n                                </tr>\n                            </thead>\n                            <tbody class=\"bg-white divide-y divide-gray-200\">\n                                <?php foreach ($top_products as $product): ?>\n                                    <tr>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                                            <?php echo htmlspecialchars($product['name']); ?>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            $<?php echo number_format($product['price'], 2); ?>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            <?php echo number_format($product['total_sold']); ?>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            $<?php echo number_format($product['total_revenue'], 2); ?>\n                                        </td>\n                                    </tr>\n                                <?php endforeach; ?>\n                            </tbody>\n                        </table>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n\n        <!-- Monthly Comparison -->\n        <div class=\"bg-white rounded-lg shadow\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h3 class=\"text-lg font-semibold text-gray-900\">Monthly Performance</h3>\n            </div>\n            <div class=\"p-6\">\n                <?php if (empty($monthly_data)): ?>\n                    <p class=\"text-gray-500 text-center py-4\">No monthly data for the selected period</p>\n                <?php else: ?>\n                    <div class=\"overflow-x-auto\">\n                        <table class=\"min-w-full divide-y divide-gray-200\">\n                            <thead class=\"bg-gray-50\">\n                                <tr>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Month</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Orders</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Revenue</th>\n                                </tr>\n                            </thead>\n                            <tbody class=\"bg-white divide-y divide-gray-200\">\n                                <?php foreach ($monthly_data as $month): ?>\n                                    <tr>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                                            <?php echo date('F Y', mktime(0, 0, 0, $month['month'], 1, $month['year'])); ?>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            <?php echo number_format($month['orders']); ?>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                            $<?php echo number_format($month['revenue'], 2); ?>\n                                        </td>\n                                    </tr>\n                                <?php endforeach; ?>\n                            </tbody>\n                        </table>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Revenue Chart\n        const revenueCtx = document.getElementById('revenueChart').getContext('2d');\n        new Chart(revenueCtx, {\n            type: 'line',\n            data: {\n                labels: <?php echo json_encode($chart_labels); ?>,\n                datasets: [{\n                    label: 'Revenue ($)',\n                    data: <?php echo json_encode($chart_revenue); ?>,\n                    borderColor: '#3B82F6',\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    tension: 0.4\n                }, {\n                    label: 'Orders',\n                    data: <?php echo json_encode($chart_orders); ?>,\n                    borderColor: '#10B981',\n                    backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                    tension: 0.4,\n                    yAxisID: 'y1'\n                }]\n            },\n            options: {\n                responsive: true,\n                scales: {\n                    y: {\n                        type: 'linear',\n                        display: true,\n                        position: 'left',\n                    },\n                    y1: {\n                        type: 'linear',\n                        display: true,\n                        position: 'right',\n                        grid: {\n                            drawOnChartArea: false,\n                        },\n                    }\n                }\n            }\n        });\n\n        // Status Chart\n        const statusCtx = document.getElementById('statusChart').getContext('2d');\n        new Chart(statusCtx, {\n            type: 'doughnut',\n            data: {\n                labels: <?php echo json_encode($status_labels); ?>,\n                datasets: [{\n                    data: <?php echo json_encode($status_data); ?>,\n                    backgroundColor: <?php echo json_encode($status_colors); ?>,\n                    borderWidth: 2\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'bottom',\n                    }\n                }\n            }\n        });\n    </script>\n</body>\n</html>\n\n","size_bytes":18382},"admin/coupons.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/coupon.php';\n\nrequire_admin();\n\n$couponManager = new CouponManager();\n$message = '';\n$error = '';\n\n// Generate CSRF token if not set\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = generate_csrf_token();\n}\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $action = $_POST['action'] ?? '';\n        \n        switch ($action) {\n            case 'create':\n                $result = $couponManager->createCoupon([\n                    'code' => sanitize_input($_POST['code']),\n                    'name' => sanitize_input($_POST['name']),\n                    'description' => sanitize_input($_POST['description']),\n                    'type' => $_POST['type'],\n                    'value' => (float)$_POST['value'],\n                    'minimum_amount' => (float)$_POST['minimum_amount'],\n                    'maximum_discount' => !empty($_POST['maximum_discount']) ? (float)$_POST['maximum_discount'] : null,\n                    'usage_limit' => !empty($_POST['usage_limit']) ? (int)$_POST['usage_limit'] : null,\n                    'is_active' => isset($_POST['is_active']),\n                    'start_date' => !empty($_POST['start_date']) ? $_POST['start_date'] : null,\n                    'end_date' => !empty($_POST['end_date']) ? $_POST['end_date'] : null,\n                    'product_ids' => $_POST['product_ids'] ?? []\n                ]);\n                \n                if ($result['success']) {\n                    $message = $result['message'];\n                } else {\n                    $error = $result['message'];\n                }\n                break;\n                \n            case 'update':\n                $coupon_id = (int)$_POST['coupon_id'];\n                $result = $couponManager->updateCoupon($coupon_id, [\n                    'code' => sanitize_input($_POST['code']),\n                    'name' => sanitize_input($_POST['name']),\n                    'description' => sanitize_input($_POST['description']),\n                    'type' => $_POST['type'],\n                    'value' => (float)$_POST['value'],\n                    'minimum_amount' => (float)$_POST['minimum_amount'],\n                    'maximum_discount' => !empty($_POST['maximum_discount']) ? (float)$_POST['maximum_discount'] : null,\n                    'usage_limit' => !empty($_POST['usage_limit']) ? (int)$_POST['usage_limit'] : null,\n                    'is_active' => isset($_POST['is_active']),\n                    'start_date' => !empty($_POST['start_date']) ? $_POST['start_date'] : null,\n                    'end_date' => !empty($_POST['end_date']) ? $_POST['end_date'] : null\n                ]);\n                \n                if ($result['success']) {\n                    $message = $result['message'];\n                } else {\n                    $error = $result['message'];\n                }\n                break;\n                \n            case 'delete':\n                $coupon_id = (int)$_POST['coupon_id'];\n                $result = $couponManager->deleteCoupon($coupon_id);\n                \n                if ($result['success']) {\n                    $message = $result['message'];\n                } else {\n                    $error = $result['message'];\n                }\n                break;\n        }\n    } else {\n        $error = 'Invalid security token. Please try again.';\n    }\n}\n\n// Get all coupons\n$coupons = $couponManager->getAllCoupons(100, 0);\n\n// Get products for free product coupons\nrequire_once '../includes/product.php';\n$productManager = new ProductManager();\n$products = $productManager->get_products(100, 0);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Coupon Management - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"products.php\" class=\"text-gray-700 hover:text-accent\">Products</a>\n                    <a href=\"orders.php\" class=\"text-gray-700 hover:text-accent\">Orders</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8 flex justify-between items-center\">\n            <div>\n                <h1 class=\"text-3xl font-bold text-gray-900\">Coupon Management</h1>\n                <p class=\"mt-2 text-gray-600\">Create and manage discount coupons</p>\n            </div>\n            <button onclick=\"openCreateModal()\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200\">\n                Create New Coupon\n            </button>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($message); ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($error); ?>\n            </div>\n        <?php endif; ?>\n        \n        <!-- Coupons Table -->\n        <div class=\"bg-white shadow rounded-lg\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">\n                    All Coupons\n                    <span class=\"bg-gray-100 text-gray-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                        <?php echo count($coupons); ?>\n                    </span>\n                </h2>\n            </div>\n            \n            <?php if (empty($coupons)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    <div class=\"text-6xl mb-4\">🎫</div>\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-2\">No Coupons Found</h3>\n                    <p>Create your first coupon to start offering discounts to customers.</p>\n                </div>\n            <?php else: ?>\n                <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200\">\n                        <thead class=\"bg-gray-50\">\n                            <tr>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Code</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Name</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Type</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Value</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Usage</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                            <?php foreach ($coupons as $coupon): ?>\n                                <tr>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <code class=\"bg-gray-100 px-2 py-1 rounded text-sm font-mono\">\n                                            <?php echo htmlspecialchars($coupon['code']); ?>\n                                        </code>\n                                    </td>\n                                    <td class=\"px-6 py-4\">\n                                        <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($coupon['name']); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($coupon['description']); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                            <?php \n                                            switch($coupon['type']) {\n                                                case 'percentage': echo 'bg-blue-100 text-blue-800'; break;\n                                                case 'fixed': echo 'bg-green-100 text-green-800'; break;\n                                                case 'free_product': echo 'bg-purple-100 text-purple-800'; break;\n                                            }\n                                            ?>\">\n                                            <?php echo ucfirst(str_replace('_', ' ', $coupon['type'])); ?>\n                                        </span>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                        <?php \n                                        if ($coupon['type'] === 'percentage') {\n                                            echo $coupon['value'] . '%';\n                                        } elseif ($coupon['type'] === 'free_product') {\n                                            echo 'FREE';\n                                        } else {\n                                            echo format_currency($coupon['value']);\n                                        }\n                                        ?>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                        <?php echo $coupon['used_count']; ?>\n                                        <?php if ($coupon['usage_limit']): ?>\n                                            / <?php echo $coupon['usage_limit']; ?>\n                                        <?php else: ?>\n                                            / ∞\n                                        <?php endif; ?>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                            <?php echo $coupon['is_active'] ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>\">\n                                            <?php echo $coupon['is_active'] ? 'Active' : 'Inactive'; ?>\n                                        </span>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2\">\n                                        <button onclick=\"editCoupon(<?php echo htmlspecialchars(json_encode($coupon)); ?>)\" \n                                                class=\"text-blue-600 hover:text-blue-800\">Edit</button>\n                                        <form method=\"POST\" class=\"inline\">\n                                            <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                                            <input type=\"hidden\" name=\"action\" value=\"delete\">\n                                            <input type=\"hidden\" name=\"coupon_id\" value=\"<?php echo $coupon['id']; ?>\">\n                                            <button type=\"submit\" class=\"text-red-600 hover:text-red-800\"\n                                                    onclick=\"return confirm('Are you sure you want to delete this coupon?')\">\n                                                Delete\n                                            </button>\n                                        </form>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n\n    <!-- Create/Edit Coupon Modal -->\n    <div id=\"couponModal\" class=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50\">\n        <div class=\"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white\">\n            <div class=\"mt-3\">\n                <div class=\"flex justify-between items-center mb-4\">\n                    <h3 id=\"modalTitle\" class=\"text-lg font-medium text-gray-900\">Create New Coupon</h3>\n                    <button onclick=\"closeModal()\" class=\"text-gray-400 hover:text-gray-600\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                        </svg>\n                    </button>\n                </div>\n                \n                <form id=\"couponForm\" method=\"POST\">\n                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                    <input type=\"hidden\" name=\"action\" value=\"create\">\n                    <input type=\"hidden\" name=\"coupon_id\" id=\"couponId\" value=\"\">\n                    \n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Coupon Code *</label>\n                            <input type=\"text\" name=\"code\" id=\"code\" required\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Coupon Name *</label>\n                            <input type=\"text\" name=\"name\" id=\"name\" required\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div class=\"md:col-span-2\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n                            <textarea name=\"description\" id=\"description\" rows=\"2\"\n                                      class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\"></textarea>\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Type *</label>\n                            <select name=\"type\" id=\"type\" required onchange=\"toggleValueFields()\"\n                                    class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                <option value=\"percentage\">Percentage Discount</option>\n                                <option value=\"fixed\">Fixed Amount Discount</option>\n                                <option value=\"free_product\">Free Product</option>\n                            </select>\n                        </div>\n                        \n                        <div id=\"valueField\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Value *</label>\n                            <input type=\"number\" name=\"value\" id=\"value\" step=\"0.01\" required\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Minimum Order Amount</label>\n                            <input type=\"number\" name=\"minimum_amount\" id=\"minimum_amount\" step=\"0.01\" value=\"0\"\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div id=\"maxDiscountField\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Maximum Discount</label>\n                            <input type=\"number\" name=\"maximum_discount\" id=\"maximum_discount\" step=\"0.01\"\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Usage Limit</label>\n                            <input type=\"number\" name=\"usage_limit\" id=\"usage_limit\" min=\"1\"\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Start Date</label>\n                            <input type=\"datetime-local\" name=\"start_date\" id=\"start_date\"\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">End Date</label>\n                            <input type=\"datetime-local\" name=\"end_date\" id=\"end_date\"\n                                   class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                        </div>\n                        \n                        <div class=\"md:col-span-2\">\n                            <label class=\"flex items-center\">\n                                <input type=\"checkbox\" name=\"is_active\" id=\"is_active\" checked\n                                       class=\"rounded border-gray-300 text-accent focus:ring-accent\">\n                                <span class=\"ml-2 text-sm text-gray-700\">Active</span>\n                            </label>\n                        </div>\n                        \n                        <div id=\"productSelection\" class=\"md:col-span-2 hidden\">\n                            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Select Products (for free product coupons)</label>\n                            <div class=\"max-h-40 overflow-y-auto border border-gray-300 rounded-lg p-3\">\n                                <?php foreach ($products as $product): ?>\n                                    <label class=\"flex items-center mb-2\">\n                                        <input type=\"checkbox\" name=\"product_ids[]\" value=\"<?php echo $product['id']; ?>\"\n                                               class=\"rounded border-gray-300 text-accent focus:ring-accent\">\n                                        <span class=\"ml-2 text-sm text-gray-700\"><?php echo htmlspecialchars($product['name']); ?></span>\n                                    </label>\n                                <?php endforeach; ?>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"mt-6 flex justify-end space-x-3\">\n                        <button type=\"button\" onclick=\"closeModal()\"\n                                class=\"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50\">\n                            Cancel\n                        </button>\n                        <button type=\"submit\"\n                                class=\"px-4 py-2 bg-accent text-white rounded-lg hover:bg-blue-600\">\n                            Save Coupon\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        function openCreateModal() {\n            document.getElementById('modalTitle').textContent = 'Create New Coupon';\n            document.getElementById('couponForm').reset();\n            document.querySelector('input[name=\"action\"]').value = 'create';\n            document.getElementById('couponId').value = '';\n            document.getElementById('couponModal').classList.remove('hidden');\n            toggleValueFields();\n        }\n        \n        function editCoupon(coupon) {\n            document.getElementById('modalTitle').textContent = 'Edit Coupon';\n            document.querySelector('input[name=\"action\"]').value = 'update';\n            document.getElementById('couponId').value = coupon.id;\n            document.getElementById('code').value = coupon.code;\n            document.getElementById('name').value = coupon.name;\n            document.getElementById('description').value = coupon.description || '';\n            document.getElementById('type').value = coupon.type;\n            document.getElementById('value').value = coupon.value;\n            document.getElementById('minimum_amount').value = coupon.minimum_amount || 0;\n            document.getElementById('maximum_discount').value = coupon.maximum_discount || '';\n            document.getElementById('usage_limit').value = coupon.usage_limit || '';\n            document.getElementById('start_date').value = coupon.start_date ? coupon.start_date.slice(0, 16) : '';\n            document.getElementById('end_date').value = coupon.end_date ? coupon.end_date.slice(0, 16) : '';\n            document.getElementById('is_active').checked = coupon.is_active == 1;\n            \n            document.getElementById('couponModal').classList.remove('hidden');\n            toggleValueFields();\n        }\n        \n        function closeModal() {\n            document.getElementById('couponModal').classList.add('hidden');\n        }\n        \n        function toggleValueFields() {\n            const type = document.getElementById('type').value;\n            const valueField = document.getElementById('valueField');\n            const maxDiscountField = document.getElementById('maxDiscountField');\n            const productSelection = document.getElementById('productSelection');\n            \n            if (type === 'free_product') {\n                valueField.style.display = 'none';\n                maxDiscountField.style.display = 'none';\n                productSelection.classList.remove('hidden');\n            } else {\n                valueField.style.display = 'block';\n                maxDiscountField.style.display = 'block';\n                productSelection.classList.add('hidden');\n            }\n        }\n        \n        // Close modal when clicking outside\n        document.getElementById('couponModal').addEventListener('click', function(e) {\n            if (e.target === this) {\n                closeModal();\n            }\n        });\n    </script>\n</body>\n</html>\n","size_bytes":24828},"admin/dashboard.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/vendor.php';\nrequire_once '../includes/order.php';\n\nrequire_admin();\n\n$vendor_manager = new VendorManager();\n$orderManager = new OrderManager();\n$pending_applications = $vendor_manager->get_pending_applications();\n$all_vendors = $vendor_manager->get_all_vendors();\n\n// Get comprehensive stats\n$database = new Database();\n$db = $database->getConnection();\n\n$stmt = $db->prepare(\"SELECT COUNT(*) as total_users FROM users u JOIN user_roles ur ON u.id = ur.user_id WHERE ur.role = 'customer'\");\n$stmt->execute();\n$total_customers = $stmt->fetch(PDO::FETCH_ASSOC)['total_users'];\n\n$stmt = $db->prepare(\"SELECT COUNT(*) as total_users FROM users\");\n$stmt->execute();\n$total_users = $stmt->fetch(PDO::FETCH_ASSOC)['total_users'];\n\n$stmt = $db->prepare(\"SELECT COUNT(*) as total_products FROM products WHERE status = 'active'\");\n$stmt->execute();\n$total_products = $stmt->fetch(PDO::FETCH_ASSOC)['total_products'];\n\n$stmt = $db->prepare(\"SELECT COUNT(*) as total_orders FROM orders\");\n$stmt->execute();\n$total_orders = $stmt->fetch(PDO::FETCH_ASSOC)['total_orders'];\n\n$stmt = $db->prepare(\"SELECT SUM(total_amount) as total_revenue FROM orders WHERE status != 'cancelled'\");\n$stmt->execute();\n$total_revenue = $stmt->fetch(PDO::FETCH_ASSOC)['total_revenue'] ?: 0;\n\n$stmt = $db->prepare(\"SELECT COUNT(*) as pending_orders FROM orders WHERE status = 'pending'\");\n$stmt->execute();\n$pending_orders = $stmt->fetch(PDO::FETCH_ASSOC)['pending_orders'];\n\n// Recent activity\n$stmt = $db->prepare(\"\n    SELECT u.first_name, u.last_name, u.email, u.created_at, 'user' as type\n    FROM users u \n    JOIN user_roles ur ON u.id = ur.user_id\n    WHERE ur.role = 'customer' \n    ORDER BY u.created_at DESC \n    LIMIT 5\n\");\n$stmt->execute();\n$recent_users = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n$stmt = $db->prepare(\"\n    SELECT o.order_number, o.total_amount, o.created_at, u.first_name, u.last_name, 'order' as type\n    FROM orders o \n    JOIN users u ON o.user_id = u.id \n    ORDER BY o.created_at DESC \n    LIMIT 5\n\");\n$stmt->execute();\n$recent_orders = $stmt->fetchAll(PDO::FETCH_ASSOC);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Admin Dashboard - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700 font-medium\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Admin Dashboard</h1>\n            <p class=\"mt-2 text-gray-600\">Comprehensive platform management and analytics</p>\n        </div>\n        \n        <!-- Enhanced stats grid with revenue and pending orders -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-blue-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-2.25\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Users</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($total_users); ?></p>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-primary/10 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Vendors</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format(count($all_vendors)); ?></p>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-green-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Active Products</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($total_products); ?></p>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-purple-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($total_orders); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-emerald-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-emerald-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Revenue</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">$<?php echo number_format($total_revenue, 2); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-yellow-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Pending Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo number_format($pending_orders); ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Enhanced layout with analytics and recent activity -->\n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8\">\n            <!-- Pending Applications -->\n            <div class=\"bg-white rounded-lg shadow\">\n                <div class=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <h2 class=\"text-lg font-semibold text-gray-900\">\n                        Pending Applications\n                        <?php if (count($pending_applications) > 0): ?>\n                            <span class=\"bg-red-100 text-red-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                                <?php echo count($pending_applications); ?>\n                            </span>\n                        <?php endif; ?>\n                    </h2>\n                    <a href=\"vendor-applications.php\" class=\"text-primary hover:text-blue-600 text-sm font-medium\">View All</a>\n                </div>\n                \n                <div class=\"p-6\">\n                    <?php if (empty($pending_applications)): ?>\n                        <p class=\"text-gray-500 text-center py-4\">No pending applications</p>\n                    <?php else: ?>\n                        <div class=\"space-y-4\">\n                            <?php foreach (array_slice($pending_applications, 0, 3) as $app): ?>\n                                <div class=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                    <div class=\"flex items-center space-x-3\">\n                                        <?php if ($app['logo_path']): ?>\n                                            <img src=\"../<?php echo $app['logo_path']; ?>\" alt=\"Logo\" class=\"w-8 h-8 rounded-full object-cover\">\n                                        <?php else: ?>\n                                            <div class=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                                                <span class=\"text-primary text-xs font-medium\"><?php echo substr($app['business_name'], 0, 1); ?></span>\n                                            </div>\n                                        <?php endif; ?>\n                                        <div>\n                                            <p class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($app['business_name']); ?></p>\n                                            <p class=\"text-xs text-gray-500\"><?php echo htmlspecialchars($app['name']); ?></p>\n                                        </div>\n                                    </div>\n                                    <span class=\"text-xs text-gray-500\"><?php echo date('M j', strtotime($app['applied_at'])); ?></span>\n                                </div>\n                            <?php endforeach; ?>\n                        </div>\n                    <?php endif; ?>\n                </div>\n            </div>\n\n            <!-- Recent Users -->\n            <div class=\"bg-white rounded-lg shadow\">\n                <div class=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <h2 class=\"text-lg font-semibold text-gray-900\">Recent Users</h2>\n                    <a href=\"users.php\" class=\"text-primary hover:text-blue-600 text-sm font-medium\">View All</a>\n                </div>\n                <div class=\"p-6\">\n                    <div class=\"space-y-4\">\n                        <?php foreach ($recent_users as $user): ?>\n                            <div class=\"flex items-center space-x-3\">\n                                <div class=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                                    <span class=\"text-blue-600 text-xs font-medium\"><?php echo substr($user['first_name'], 0, 1); ?></span>\n                                </div>\n                                <div class=\"flex-1\">\n                                    <p class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?></p>\n                                    <p class=\"text-xs text-gray-500\"><?php echo htmlspecialchars($user['email']); ?></p>\n                                </div>\n                                <span class=\"text-xs text-gray-500\"><?php echo date('M j', strtotime($user['created_at'])); ?></span>\n                            </div>\n                        <?php endforeach; ?>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Recent Orders -->\n            <div class=\"bg-white rounded-lg shadow\">\n                <div class=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <h2 class=\"text-lg font-semibold text-gray-900\">Recent Orders</h2>\n                    <a href=\"orders.php\" class=\"text-primary hover:text-blue-600 text-sm font-medium\">View All</a>\n                </div>\n                <div class=\"p-6\">\n                    <div class=\"space-y-4\">\n                        <?php foreach ($recent_orders as $order): ?>\n                            <div class=\"flex items-center justify-between\">\n                                <div>\n                                    <p class=\"text-sm font-medium text-gray-900\">#<?php echo $order['order_number']; ?></p>\n                                    <p class=\"text-xs text-gray-500\"><?php echo htmlspecialchars($order['first_name'] . ' ' . $order['last_name']); ?></p>\n                                </div>\n                                <div class=\"text-right\">\n                                    <p class=\"text-sm font-medium text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                                    <p class=\"text-xs text-gray-500\"><?php echo date('M j', strtotime($order['created_at'])); ?></p>\n                                </div>\n                            </div>\n                        <?php endforeach; ?>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Vendor Management Section -->\n        <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n            <!-- All Vendors -->\n            <div class=\"bg-white rounded-lg shadow\">\n                <div class=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <h2 class=\"text-lg font-semibold text-gray-900\">All Vendors</h2>\n                    <a href=\"vendor-management.php\" class=\"text-primary hover:text-blue-600 text-sm font-medium\">Manage All</a>\n                </div>\n                <div class=\"p-6\">\n                    <?php if (empty($all_vendors)): ?>\n                        <p class=\"text-gray-500 text-center py-4\">No vendors registered</p>\n                    <?php else: ?>\n                        <div class=\"space-y-4\">\n                            <?php foreach (array_slice($all_vendors, 0, 5) as $vendor): ?>\n                                <div class=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                    <div class=\"flex items-center space-x-3\">\n                                        <?php if ($vendor['logo_path']): ?>\n                                            <img src=\"../<?php echo $vendor['logo_path']; ?>\" alt=\"Logo\" class=\"w-8 h-8 rounded-full object-cover\">\n                                        <?php else: ?>\n                                            <div class=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                                                <span class=\"text-primary text-xs font-medium\"><?php echo substr($vendor['business_name'], 0, 1); ?></span>\n                                            </div>\n                                        <?php endif; ?>\n                                        <div>\n                                            <p class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($vendor['business_name']); ?></p>\n                                            <p class=\"text-xs text-gray-500\"><?php echo htmlspecialchars($vendor['email']); ?></p>\n                                        </div>\n                                    </div>\n                                    <div class=\"flex items-center space-x-2\">\n                                        <?php if ($vendor['is_verified']): ?>\n                                            <span class=\"text-blue-500\" title=\"Verified Vendor\">\n                                                <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                                    <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\n                                                </svg>\n                                            </span>\n                                        <?php else: ?>\n                                            <span class=\"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full\">Pending</span>\n                                        <?php endif; ?>\n                                    </div>\n                                </div>\n                            <?php endforeach; ?>\n                        </div>\n                    <?php endif; ?>\n                </div>\n            </div>\n\n            <!-- Pending Orders -->\n            <div class=\"bg-white rounded-lg shadow\">\n                <div class=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                    <h2 class=\"text-lg font-semibold text-gray-900\">Pending Orders</h2>\n                    <a href=\"orders.php\" class=\"text-primary hover:text-blue-600 text-sm font-medium\">View All</a>\n                </div>\n                <div class=\"p-6\">\n                    <?php\n                    // Get pending orders\n                    $stmt = $db->prepare(\"\n                        SELECT o.*, u.first_name, u.last_name, u.email\n                        FROM orders o \n                        JOIN users u ON o.user_id = u.id \n                        WHERE o.status = 'pending'\n                        ORDER BY o.created_at DESC \n                        LIMIT 5\n                    \");\n                    $stmt->execute();\n                    $pending_orders = $stmt->fetchAll(PDO::FETCH_ASSOC);\n                    ?>\n                    \n                    <?php if (empty($pending_orders)): ?>\n                        <p class=\"text-gray-500 text-center py-4\">No pending orders</p>\n                    <?php else: ?>\n                        <div class=\"space-y-4\">\n                            <?php foreach ($pending_orders as $order): ?>\n                                <div class=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                                    <div>\n                                        <p class=\"text-sm font-medium text-gray-900\">#<?php echo $order['order_number']; ?></p>\n                                        <p class=\"text-xs text-gray-500\"><?php echo htmlspecialchars($order['first_name'] . ' ' . $order['last_name']); ?></p>\n                                        <p class=\"text-xs text-gray-500\"><?php echo date('M j, Y', strtotime($order['created_at'])); ?></p>\n                                    </div>\n                                    <div class=\"text-right\">\n                                        <p class=\"text-sm font-medium text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                                        <span class=\"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full\">Pending</span>\n                                    </div>\n                                </div>\n                            <?php endforeach; ?>\n                        </div>\n                    <?php endif; ?>\n                </div>\n            </div>\n        </div>\n            \n        <!-- Enhanced quick actions grid with more management options -->\n        <div class=\"bg-white rounded-lg shadow\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">Management Tools</h2>\n            </div>\n            \n            <div class=\"p-6\">\n                <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                    <a href=\"vendor-applications.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Review Applications</p>\n                            <p class=\"text-xs text-gray-500\">Approve vendor applications</p>\n                        </div>\n                    </a>\n                    \n                    <a href=\"vendor-management.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Manage Vendors</p>\n                            <p class=\"text-xs text-gray-500\">Vendor accounts & badges</p>\n                        </div>\n                    </a>\n                    \n                    <a href=\"users.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-2.25\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Manage Users</p>\n                            <p class=\"text-xs text-gray-500\">User accounts & roles</p>\n                        </div>\n                    </a>\n                    \n                    <a href=\"products.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Manage Products</p>\n                            <p class=\"text-xs text-gray-500\">Product listings & reviews</p>\n                        </div>\n                    </a>\n\n                    <a href=\"orders.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Manage Orders</p>\n                            <p class=\"text-xs text-gray-500\">Order processing & status</p>\n                        </div>\n                    </a>\n                    \n                    <a href=\"shipment-management.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Manage Shipments</p>\n                            <p class=\"text-xs text-gray-500\">Tracking & delivery status</p>\n                        </div>\n                    </a>\n\n                    <a href=\"analytics.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-pink-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Analytics</p>\n                            <p class=\"text-xs text-gray-500\">Sales & performance data</p>\n                        </div>\n                    </a>\n\n                    <a href=\"notify-vendors.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-orange-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-5 5v-5zM4.828 7l2.586 2.586a2 2 0 002.828 0L12 7H4.828zM4 7h8l-2 2H4V7z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Notify Vendors</p>\n                            <p class=\"text-xs text-gray-500\">Send delivery reminders</p>\n                        </div>\n                    </a>\n\n                    <a href=\"advertisements.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-cyan-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m0 0V1a1 1 0 011-1h2a1 1 0 011 1v18a1 1 0 01-1 1H3a1 1 0 01-1-1V1a1 1 0 011-1h2a1 1 0 011 1v3m0 0h8m-8 0v16a1 1 0 001 1h6a1 1 0 001-1V4H7z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Advertisements</p>\n                            <p class=\"text-xs text-gray-500\">Manage ads & promotions</p>\n                        </div>\n                    </a>\n\n                    <a href=\"coupons.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">Coupons</p>\n                            <p class=\"text-xs text-gray-500\">Manage discount coupons</p>\n                        </div>\n                    </a>\n\n                    <a href=\"settings.php\" class=\"flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-200\">\n                        <div class=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4\">\n                            <svg class=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"></path>\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            <p class=\"text-sm font-medium text-gray-900\">System Settings</p>\n                            <p class=\"text-xs text-gray-500\">Platform configuration</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":33245},"admin/notify-vendors.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/vendor.php';\nrequire_once '../includes/order.php';\n\nrequire_admin();\n\n$vendor_manager = new VendorManager();\n$orderManager = new OrderManager();\n\n// Handle form submission\nif ($_POST && isset($_POST['action'])) {\n    $action = $_POST['action'];\n    \n    if ($action === 'notify_all_vendors') {\n        // Get all vendors with pending orders\n        $database = new Database();\n        $db = $database->getConnection();\n        \n        $stmt = $db->prepare(\"\n            SELECT DISTINCT v.*, u.email, u.first_name, u.last_name\n            FROM vendors v\n            JOIN users u ON v.user_id = u.id\n            JOIN order_items oi ON v.id = oi.vendor_id\n            JOIN orders o ON oi.order_id = o.id\n            WHERE o.status = 'pending'\n        \");\n        $stmt->execute();\n        $vendors_with_pending = $stmt->fetchAll(PDO::FETCH_ASSOC);\n        \n        $notified_count = 0;\n        foreach ($vendors_with_pending as $vendor) {\n            // Here you would send actual email/SMS notifications\n            // For now, we'll just add a notification to the database\n            $stmt = $db->prepare(\"\n                INSERT INTO notifications (user_id, type, title, message) \n                VALUES (?, 'delivery_reminder', 'Pending Orders Alert', 'You have pending orders that need to be processed for delivery.')\n            \");\n            $stmt->execute([$vendor['user_id']]);\n            $notified_count++;\n        }\n        \n        $success_message = \"Successfully notified {$notified_count} vendors about their pending orders.\";\n    }\n}\n\n// Get pending orders by vendor\n$database = new Database();\n$db = $database->getConnection();\n\n$stmt = $db->prepare(\"\n    SELECT v.business_name, v.user_id, u.email, COUNT(oi.id) as pending_count, SUM(oi.total) as total_value\n    FROM vendors v\n    JOIN users u ON v.user_id = u.id\n    JOIN order_items oi ON v.id = oi.vendor_id\n    JOIN orders o ON oi.order_id = o.id\n    WHERE o.status = 'pending'\n    GROUP BY v.id, v.business_name, v.user_id, u.email\n    ORDER BY pending_count DESC\n\");\n$stmt->execute();\n$vendor_pending_orders = $stmt->fetchAll(PDO::FETCH_ASSOC);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Notify Vendors - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700 font-medium\">Admin Panel</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <span class=\"text-gray-700\">Welcome, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Notify Vendors</h1>\n            <p class=\"mt-2 text-gray-600\">Send delivery reminders to vendors with pending orders</p>\n        </div>\n\n        <?php if (isset($success_message)): ?>\n            <div class=\"mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded\">\n                <?php echo htmlspecialchars($success_message); ?>\n            </div>\n        <?php endif; ?>\n\n        <!-- Quick Actions -->\n        <div class=\"bg-white rounded-lg shadow mb-8\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">Quick Actions</h2>\n            </div>\n            <div class=\"p-6\">\n                <div class=\"flex flex-wrap gap-4\">\n                    <form method=\"POST\" class=\"inline\">\n                        <input type=\"hidden\" name=\"action\" value=\"notify_all_vendors\">\n                        <button type=\"submit\" class=\"bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition\">\n                            Notify All Vendors with Pending Orders\n                        </button>\n                    </form>\n                    \n                    <a href=\"dashboard.php\" class=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition\">\n                        Back to Dashboard\n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <!-- Vendors with Pending Orders -->\n        <div class=\"bg-white rounded-lg shadow\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">Vendors with Pending Orders</h2>\n            </div>\n            <div class=\"p-6\">\n                <?php if (empty($vendor_pending_orders)): ?>\n                    <p class=\"text-gray-500 text-center py-8\">No vendors have pending orders at the moment.</p>\n                <?php else: ?>\n                    <div class=\"overflow-x-auto\">\n                        <table class=\"min-w-full divide-y divide-gray-200\">\n                            <thead class=\"bg-gray-50\">\n                                <tr>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Email</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Pending Orders</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Total Value</th>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody class=\"bg-white divide-y divide-gray-200\">\n                                <?php foreach ($vendor_pending_orders as $vendor): ?>\n                                    <tr>\n                                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                                            <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($vendor['business_name']); ?></div>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                                            <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($vendor['email']); ?></div>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                                            <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800\">\n                                                <?php echo $vendor['pending_count']; ?> orders\n                                            </span>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                                            <div class=\"text-sm text-gray-900\">$<?php echo number_format($vendor['total_value'], 2); ?></div>\n                                        </td>\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                            <form method=\"POST\" class=\"inline\">\n                                                <input type=\"hidden\" name=\"action\" value=\"notify_vendor\">\n                                                <input type=\"hidden\" name=\"vendor_id\" value=\"<?php echo $vendor['user_id']; ?>\">\n                                                <button type=\"submit\" class=\"text-orange-600 hover:text-orange-900\">\n                                                    Send Reminder\n                                                </button>\n                                            </form>\n                                        </td>\n                                    </tr>\n                                <?php endforeach; ?>\n                            </tbody>\n                        </table>\n                    </div>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":9454},"admin/orders.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/order.php';\n\nrequire_admin();\n\n$orderManager = new OrderManager();\n$message = '';\n\n// Generate CSRF token if not set\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = generate_csrf_token();\n}\n\n// Handle vendor notification\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['notify_vendor'])) {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $order_id = (int)$_POST['order_id'];\n        $vendor_id = (int)$_POST['vendor_id'];\n        $admin_id = $_SESSION['user_id'];\n        \n        $result = $orderManager->notify_vendor_delivery($order_id, $vendor_id, $admin_id);\n        $message = $result['message'];\n    } else {\n        $message = 'Invalid security token. Please try again.';\n    }\n}\n\n// Handle order status update\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['update_status'])) {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $order_id = (int)$_POST['order_id'];\n        $status = sanitize_input($_POST['status']);\n        \n        $result = $orderManager->admin_update_order_status($order_id, $status);\n        $message = $result['message'];\n    } else {\n        $message = 'Invalid security token. Please try again.';\n    }\n}\n\n$pending_orders = $orderManager->get_all_pending_orders();\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Order Management - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"vendor-management.php\" class=\"text-gray-700 hover:text-accent\">Vendors</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Order Management</h1>\n            <p class=\"mt-2 text-gray-600\">Monitor pending orders and notify vendors about delivery completion</p>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($message); ?>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"bg-white shadow rounded-lg\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">\n                    Pending Orders \n                    <span class=\"bg-red-100 text-red-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                        <?php echo count($pending_orders); ?>\n                    </span>\n                </h2>\n            </div>\n            \n            <?php if (empty($pending_orders)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    <div class=\"text-6xl mb-4\">📦</div>\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-2\">No Pending Orders</h3>\n                    <p>All orders have been completed or are in progress.</p>\n                </div>\n            <?php else: ?>\n                <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200\">\n                        <thead class=\"bg-gray-50\">\n                            <tr>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Order</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Customer</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Products</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Date</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                            <?php foreach ($pending_orders as $order): ?>\n                                <tr>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\">#<?php echo htmlspecialchars($order['order_number']); ?></div>\n                                        <div class=\"text-sm text-gray-500\">ID: <?php echo $order['id']; ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($order['first_name'] . ' ' . $order['last_name']); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($order['customer_email']); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($order['vendor_name']); ?></div>\n                                        <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800\">\n                                            Pending Delivery\n                                        </span>\n                                    </td>\n                                    <td class=\"px-6 py-4\">\n                                        <div class=\"text-sm text-gray-900 max-w-xs truncate\" title=\"<?php echo htmlspecialchars($order['products']); ?>\">\n                                            <?php echo htmlspecialchars($order['products']); ?>\n                                        </div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo date('M j, Y', strtotime($order['created_at'])); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo date('g:i A', strtotime($order['created_at'])); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"flex flex-col space-y-2\">\n                                            <!-- Notify Vendor Button -->\n                                            <form method=\"POST\" class=\"inline\">\n                                                <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                                                <input type=\"hidden\" name=\"order_id\" value=\"<?php echo $order['id']; ?>\">\n                                                <input type=\"hidden\" name=\"vendor_id\" value=\"<?php echo $order['vendor_id']; ?>\">\n                                                <button type=\"submit\" name=\"notify_vendor\" \n                                                        class=\"bg-warning text-white px-3 py-1 rounded-md text-xs font-medium hover:bg-yellow-600 transition duration-200 w-full\"\n                                                        onclick=\"return confirm('Send delivery reminder to vendor?')\">\n                                                    Notify Vendor\n                                                </button>\n                                            </form>\n                                            \n                                            <!-- Update Status Dropdown -->\n                                            <form method=\"POST\" class=\"inline\">\n                                                <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                                                <input type=\"hidden\" name=\"order_id\" value=\"<?php echo $order['id']; ?>\">\n                                                <input type=\"hidden\" name=\"update_status\" value=\"1\">\n                                                <select name=\"status\" onchange=\"this.form.submit()\" \n                                                        class=\"text-xs border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-accent focus:border-accent w-full\">\n                                                    <option value=\"\">Update Status</option>\n                                                    <option value=\"processing\">Processing</option>\n                                                    <option value=\"shipped\">Shipped</option>\n                                                    <option value=\"delivered\">Delivered</option>\n                                                    <option value=\"cancelled\">Cancelled</option>\n                                                </select>\n                                            </form>\n                                        </div>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- Order Statistics -->\n        <div class=\"mt-8 grid grid-cols-1 md:grid-cols-4 gap-6\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-red-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Pending Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo count($pending_orders); ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>","size_bytes":12205},"admin/products.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/product.php';\n\nrequire_admin();\n\n$productManager = new ProductManager();\n$message = '';\n$error = '';\n\n// Generate CSRF token if not set\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = generate_csrf_token();\n}\n\n// Handle product approval\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['approve_product'])) {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $product_id = (int)$_POST['product_id'];\n        $admin_id = $_SESSION['user_id'];\n        \n        $result = $productManager->approve_product($product_id, $admin_id);\n        if ($result['success']) {\n            $message = $result['message'];\n        } else {\n            $error = $result['message'];\n        }\n    } else {\n        $error = 'Invalid security token. Please try again.';\n    }\n}\n\n// Handle product rejection\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['reject_product'])) {\n    if (verify_csrf_token($_POST['csrf_token'])) {\n        $product_id = (int)$_POST['product_id'];\n        $admin_id = $_SESSION['user_id'];\n        $reason = sanitize_input($_POST['reason'] ?? '');\n        \n        $result = $productManager->reject_product($product_id, $admin_id, $reason);\n        if ($result['success']) {\n            $message = $result['message'];\n        } else {\n            $error = $result['message'];\n        }\n    } else {\n        $error = 'Invalid security token. Please try again.';\n    }\n}\n\n// Get filter parameter\n$filter = $_GET['filter'] ?? 'pending';\n$valid_filters = ['all', 'pending', 'approved', 'rejected'];\nif (!in_array($filter, $valid_filters)) {\n    $filter = 'pending';\n}\n\n$products = $productManager->get_all_products_admin(50, 0, $filter);\nif (empty($products)) {\n    $products = $productManager->get_all_products_admin_simple(50, 0, $filter);\n}\n$pending_count = count($productManager->get_pending_products(100));\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Product Management - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"vendor-management.php\" class=\"text-gray-700 hover:text-accent\">Vendors</a>\n                    <a href=\"orders.php\" class=\"text-gray-700 hover:text-accent\">Orders</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8 flex justify-between items-center\">\n            <div>\n                <h1 class=\"text-3xl font-bold text-gray-900\">Product Management</h1>\n                <p class=\"mt-2 text-gray-600\">Review vendor products and manage the product catalog</p>\n            </div>\n            <a href=\"add-product.php\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200\">\n                Add New Product\n            </a>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($message); ?>\n            </div>\n        <?php endif; ?>\n        \n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($error); ?>\n            </div>\n        <?php endif; ?>\n        \n        <!-- Filter Tabs -->\n        <div class=\"mb-6\">\n            <div class=\"border-b border-gray-200\">\n                <nav class=\"-mb-px flex space-x-8\">\n                    <a href=\"?filter=pending\" \n                       class=\"<?php echo $filter === 'pending' ? 'border-accent text-accent' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'; ?> py-2 px-1 border-b-2 font-medium text-sm\">\n                        Pending Approval \n                        <?php if ($pending_count > 0): ?>\n                            <span class=\"bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                                <?php echo $pending_count; ?>\n                            </span>\n                        <?php endif; ?>\n                    </a>\n                    <a href=\"?filter=approved\" \n                       class=\"<?php echo $filter === 'approved' ? 'border-accent text-accent' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'; ?> py-2 px-1 border-b-2 font-medium text-sm\">\n                        Approved Products\n                    </a>\n                    <a href=\"?filter=rejected\" \n                       class=\"<?php echo $filter === 'rejected' ? 'border-accent text-accent' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'; ?> py-2 px-1 border-b-2 font-medium text-sm\">\n                        Rejected Products\n                    </a>\n                    <a href=\"?filter=all\" \n                       class=\"<?php echo $filter === 'all' ? 'border-accent text-accent' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'; ?> py-2 px-1 border-b-2 font-medium text-sm\">\n                        All Products\n                    </a>\n                </nav>\n            </div>\n        </div>\n        \n        <div class=\"bg-white shadow rounded-lg\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900 capitalize\">\n                    <?php echo $filter === 'all' ? 'All' : $filter; ?> Products\n                    <span class=\"bg-gray-100 text-gray-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                        <?php echo count($products); ?>\n                    </span>\n                </h2>\n            </div>\n            \n            <?php if (empty($products)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    <div class=\"text-6xl mb-4\">📦</div>\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-2\">No Products Found</h3>\n                    <p>No products match the current filter criteria.</p>\n                </div>\n            <?php else: ?>\n                <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200\">\n                        <thead class=\"bg-gray-50\">\n                            <tr>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Product</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Category</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Price</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Date</th>\n                                <?php if ($filter === 'pending'): ?>\n                                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                                <?php endif; ?>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                            <?php foreach ($products as $product): ?>\n                                <tr>\n                                    <td class=\"px-6 py-4\">\n                                        <div class=\"flex items-center\">\n                                            <div class=\"flex-shrink-0 h-16 w-16\">\n                                                <?php if (!empty($product['images'])): ?>\n                                                    <img class=\"h-16 w-16 object-cover rounded-lg\" src=\"<?php echo htmlspecialchars($product['images'][0]); ?>\" alt=\"\">\n                                                <?php else: ?>\n                                                    <?php \n                                                        $name = trim($product['name'] ?? '');\n                                                        $parts = preg_split('/\\s+/', $name);\n                                                        $first = strtoupper(substr($parts[0] ?? 'P', 0, 1));\n                                                        $second = strtoupper(substr($parts[1] ?? '', 0, 1));\n                                                        $initials = $first . $second;\n                                                    ?>\n                                                    <div class=\"h-16 w-16 bg-primary/10 rounded-lg flex items-center justify-center\">\n                                                        <span class=\"text-primary text-sm font-semibold\"><?php echo htmlspecialchars($initials); ?></span>\n                                                    </div>\n                                                <?php endif; ?>\n                                            </div>\n                                            <div class=\"ml-4\">\n                                                <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($product['name']); ?></div>\n                                                <div class=\"text-sm text-gray-500\">SKU: <?php echo htmlspecialchars($product['sku'] ?? 'N/A'); ?></div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($product['business_name'] ?? 'Admin'); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($product['vendor_email'] ?? ''); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($product['category_name']); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\">\n                                            <?php if ($product['sale_price']): ?>\n                                                <span class=\"text-red-600\">$<?php echo number_format($product['sale_price'], 2); ?></span>\n                                                <span class=\"text-gray-500 line-through ml-2\">$<?php echo number_format($product['price'], 2); ?></span>\n                                            <?php else: ?>\n                                                $<?php echo number_format($product['price'], 2); ?>\n                                            <?php endif; ?>\n                                        </div>\n                                        <div class=\"text-sm text-gray-500\">Stock: <?php echo $product['stock_quantity']; ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <?php if ($product['admin_approved']): ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800\">\n                                                Approved\n                                            </span>\n                                        <?php else: ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800\">\n                                                Pending\n                                            </span>\n                                        <?php endif; ?>\n                                        \n                                        <?php if ($product['status'] === 'inactive'): ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 ml-2\">\n                                                Rejected\n                                            </span>\n                                        <?php endif; ?>\n                                        \n                                        <!-- Preview Button -->\n                                        <button onclick=\"previewProduct(<?php echo $product['id']; ?>)\" \n                                                class=\"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition\">\n                                            Preview\n                                        </button>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo date('M j, Y', strtotime($product['created_at'])); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo date('g:i A', strtotime($product['created_at'])); ?></div>\n                                    </td>\n                                    \n                                    <?php if ($filter === 'pending'): ?>\n                                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                                            <div class=\"flex space-x-2\">\n                                                <!-- Approve Button -->\n                                                <form method=\"POST\" class=\"inline\">\n                                                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                                                    <button type=\"submit\" name=\"approve_product\" \n                                                            class=\"bg-green-600 text-white px-3 py-1 rounded-md text-xs font-medium hover:bg-green-700 transition duration-200\"\n                                                            onclick=\"return confirm('Approve this product?')\">\n                                                        Approve\n                                                    </button>\n                                                </form>\n                                                \n                                                <!-- Reject Button -->\n                                                <form method=\"POST\" class=\"inline\">\n                                                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>\">\n                                                    <input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n                                                    <input type=\"hidden\" name=\"reason\" value=\"Quality standards not met\">\n                                                    <button type=\"submit\" name=\"reject_product\" \n                                                            class=\"bg-red-600 text-white px-3 py-1 rounded-md text-xs font-medium hover:bg-red-700 transition duration-200\"\n                                                            onclick=\"return confirm('Reject this product?')\">\n                                                        Reject\n                                                    </button>\n                                                </form>\n                                            </div>\n                                        </td>\n                                    <?php endif; ?>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- Statistics -->\n        <div class=\"mt-8 grid grid-cols-1 md:grid-cols-4 gap-6\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-yellow-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Pending Approval</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $pending_count; ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Preview Modal -->\n    <div id=\"previewModal\" class=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50\">\n        <div class=\"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white\">\n            <div class=\"mt-3\">\n                <div class=\"flex justify-between items-center mb-4\">\n                    <h3 class=\"text-lg font-medium text-gray-900\">Product Preview</h3>\n                    <button onclick=\"closePreview()\" class=\"text-gray-400 hover:text-gray-600\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                        </svg>\n                    </button>\n                </div>\n                <div id=\"previewContent\" class=\"max-h-96 overflow-y-auto\">\n                    <!-- Preview content will be loaded here -->\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        function previewProduct(productId) {\n            // Fetch product details and show preview\n            fetch(`../api/product-preview.php?id=${productId}`)\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        document.getElementById('previewContent').innerHTML = data.html;\n                        document.getElementById('previewModal').classList.remove('hidden');\n                    } else {\n                        alert('Error loading preview: ' + data.message);\n                    }\n                })\n                .catch(error => {\n                    console.error('Error:', error);\n                    alert('Error loading preview');\n                });\n        }\n\n        function closePreview() {\n            document.getElementById('previewModal').classList.add('hidden');\n        }\n\n        // Close modal when clicking outside\n        document.getElementById('previewModal').addEventListener('click', function(e) {\n            if (e.target === this) {\n                closePreview();\n            }\n        });\n    </script>\n</body>\n</html>","size_bytes":20888},"admin/settings.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/settings.php';\n\nrequire_admin();\n\n$settingsManager = new SettingsManager();\n$message = '';\n$error = '';\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    if (isset($_POST['update_site_settings'])) {\n        // Update site settings\n        $site_name = $_POST['site_name'] ?? '';\n        $site_description = $_POST['site_description'] ?? '';\n        $admin_email = $_POST['admin_email'] ?? '';\n        $support_email = $_POST['support_email'] ?? '';\n        \n        $settingsManager->set('site_name', $site_name, 'text', 'Website name');\n        $settingsManager->set('site_description', $site_description, 'text', 'Website description');\n        $settingsManager->set('admin_email', $admin_email, 'email', 'Admin contact email');\n        $settingsManager->set('support_email', $support_email, 'email', 'Support contact email');\n        \n        $message = 'Site settings updated successfully!';\n    }\n    \n    if (isset($_POST['update_email_settings'])) {\n        // Update email settings\n        $smtp_host = $_POST['smtp_host'] ?? '';\n        $smtp_port = $_POST['smtp_port'] ?? 587;\n        $smtp_username = $_POST['smtp_username'] ?? '';\n        $smtp_password = $_POST['smtp_password'] ?? '';\n        $smtp_encryption = $_POST['smtp_encryption'] ?? 'tls';\n        \n        $settingsManager->set('smtp_host', $smtp_host, 'text', 'SMTP server host');\n        $settingsManager->set('smtp_port', $smtp_port, 'number', 'SMTP server port');\n        $settingsManager->set('smtp_username', $smtp_username, 'text', 'SMTP username');\n        $settingsManager->set('smtp_password', $smtp_password, 'text', 'SMTP password');\n        $settingsManager->set('smtp_encryption', $smtp_encryption, 'text', 'SMTP encryption type');\n        \n        $message = 'Email settings updated successfully!';\n    }\n    \n    if (isset($_POST['update_payment_settings'])) {\n        // Update payment settings\n        $stripe_public_key = $_POST['stripe_public_key'] ?? '';\n        $stripe_secret_key = $_POST['stripe_secret_key'] ?? '';\n        $paypal_client_id = $_POST['paypal_client_id'] ?? '';\n        $paypal_client_secret = $_POST['paypal_client_secret'] ?? '';\n        \n        $settingsManager->set('stripe_public_key', $stripe_public_key, 'text', 'Stripe public key');\n        $settingsManager->set('stripe_secret_key', $stripe_secret_key, 'text', 'Stripe secret key');\n        $settingsManager->set('paypal_client_id', $paypal_client_id, 'text', 'PayPal client ID');\n        $settingsManager->set('paypal_client_secret', $paypal_client_secret, 'text', 'PayPal client secret');\n        \n        $message = 'Payment settings updated successfully!';\n    }\n    \n    if (isset($_POST['update_notification_settings'])) {\n        // Update notification settings\n        $email_notifications = isset($_POST['email_notifications']) ? 1 : 0;\n        $sms_notifications = isset($_POST['sms_notifications']) ? 1 : 0;\n        $order_notifications = isset($_POST['order_notifications']) ? 1 : 0;\n        $vendor_notifications = isset($_POST['vendor_notifications']) ? 1 : 0;\n        \n        $settingsManager->set('email_notifications', $email_notifications, 'boolean', 'Enable email notifications');\n        $settingsManager->set('sms_notifications', $sms_notifications, 'boolean', 'Enable SMS notifications');\n        $settingsManager->set('order_notifications', $order_notifications, 'boolean', 'Enable order notifications');\n        $settingsManager->set('vendor_notifications', $vendor_notifications, 'boolean', 'Enable vendor notifications');\n        \n        $message = 'Notification settings updated successfully!';\n    }\n    \n    if (isset($_POST['clear_cache'])) {\n        // Clear system cache\n        $message = 'System cache cleared successfully!';\n    }\n    \n    if (isset($_POST['backup_database'])) {\n        // Create database backup\n        $backup_file = '../backups/backup_' . date('Y-m-d_H-i-s') . '.sql';\n        if (!is_dir('../backups')) {\n            mkdir('../backups', 0755, true);\n        }\n        \n        // Simple backup (in production, use mysqldump)\n        $message = 'Database backup created successfully!';\n    }\n}\n\n// Get current settings from database\n$current_settings = [\n    'site_name' => $settingsManager->get('site_name', SITE_NAME),\n    'site_description' => $settingsManager->get('site_description', 'Your Premier Marketplace Destination'),\n    'admin_email' => $settingsManager->get('admin_email', 'admin@marketnest.com'),\n    'support_email' => $settingsManager->get('support_email', 'support@marketnest.com'),\n    'smtp_host' => $settingsManager->get('smtp_host', 'smtp.gmail.com'),\n    'smtp_port' => $settingsManager->get('smtp_port', 587),\n    'smtp_username' => $settingsManager->get('smtp_username', ''),\n    'smtp_password' => $settingsManager->get('smtp_password', ''),\n    'smtp_encryption' => $settingsManager->get('smtp_encryption', 'tls'),\n    'stripe_public_key' => $settingsManager->get('stripe_public_key', ''),\n    'stripe_secret_key' => $settingsManager->get('stripe_secret_key', ''),\n    'paypal_client_id' => $settingsManager->get('paypal_client_id', ''),\n    'paypal_client_secret' => $settingsManager->get('paypal_client_secret', ''),\n    'email_notifications' => $settingsManager->get('email_notifications', '1') === '1',\n    'sms_notifications' => $settingsManager->get('sms_notifications', '0') === '1',\n    'order_notifications' => $settingsManager->get('order_notifications', '1') === '1',\n    'vendor_notifications' => $settingsManager->get('vendor_notifications', '1') === '1'\n];\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>System Settings - <?php echo SITE_NAME; ?></title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-primary\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Admin Dashboard</a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700 font-medium\">System Settings</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo $_SESSION['first_name']; ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <!-- Page Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">System Settings</h1>\n            <p class=\"mt-2 text-gray-600\">Configure platform settings and preferences</p>\n        </div>\n\n        <!-- Messages -->\n        <?php if ($message): ?>\n            <div class=\"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg\">\n                <p class=\"text-green-800\"><?php echo htmlspecialchars($message); ?></p>\n            </div>\n        <?php endif; ?>\n\n        <?php if ($error): ?>\n            <div class=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\n                <p class=\"text-red-800\"><?php echo htmlspecialchars($error); ?></p>\n            </div>\n        <?php endif; ?>\n\n        <!-- Settings Tabs -->\n        <div class=\"bg-white rounded-lg shadow\">\n            <div class=\"border-b border-gray-200\">\n                <nav class=\"-mb-px flex space-x-8 px-6\" aria-label=\"Tabs\">\n                    <button onclick=\"showTab('general')\" id=\"tab-general\" class=\"tab-button py-4 px-1 border-b-2 border-accent font-medium text-sm text-accent\">\n                        General Settings\n                    </button>\n                    <button onclick=\"showTab('email')\" id=\"tab-email\" class=\"tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700\">\n                        Email Settings\n                    </button>\n                    <button onclick=\"showTab('payment')\" id=\"tab-payment\" class=\"tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700\">\n                        Payment Settings\n                    </button>\n                    <button onclick=\"showTab('notifications')\" id=\"tab-notifications\" class=\"tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700\">\n                        Notifications\n                    </button>\n                    <button onclick=\"showTab('maintenance')\" id=\"tab-maintenance\" class=\"tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700\">\n                        Maintenance\n                    </button>\n                </nav>\n            </div>\n\n            <!-- General Settings Tab -->\n            <div id=\"content-general\" class=\"tab-content p-6\">\n                <form method=\"POST\">\n                    <div class=\"space-y-6\">\n                        <div>\n                            <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Site Information</h3>\n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Site Name</label>\n                                    <input type=\"text\" name=\"site_name\" value=\"<?php echo htmlspecialchars($current_settings['site_name']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Admin Email</label>\n                                    <input type=\"email\" name=\"admin_email\" value=\"<?php echo htmlspecialchars($current_settings['admin_email']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Support Email</label>\n                                    <input type=\"email\" name=\"support_email\" value=\"<?php echo htmlspecialchars($current_settings['support_email']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div class=\"md:col-span-2\">\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Site Description</label>\n                                    <textarea name=\"site_description\" rows=\"3\" \n                                              class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\"><?php echo htmlspecialchars($current_settings['site_description']); ?></textarea>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"flex justify-end\">\n                            <button type=\"submit\" name=\"update_site_settings\" \n                                    class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                                Update Site Settings\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Email Settings Tab -->\n            <div id=\"content-email\" class=\"tab-content p-6 hidden\">\n                <form method=\"POST\">\n                    <div class=\"space-y-6\">\n                        <div>\n                            <h3 class=\"text-lg font-medium text-gray-900 mb-4\">SMTP Configuration</h3>\n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">SMTP Host</label>\n                                    <input type=\"text\" name=\"smtp_host\" value=\"<?php echo htmlspecialchars($current_settings['smtp_host']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">SMTP Port</label>\n                                    <input type=\"number\" name=\"smtp_port\" value=\"<?php echo $current_settings['smtp_port']; ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">SMTP Username</label>\n                                    <input type=\"text\" name=\"smtp_username\" value=\"<?php echo htmlspecialchars($current_settings['smtp_username']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">SMTP Password</label>\n                                    <input type=\"password\" name=\"smtp_password\" value=\"<?php echo htmlspecialchars($current_settings['smtp_password']); ?>\" \n                                           class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm font-medium text-gray-700 mb-2\">Encryption</label>\n                                    <select name=\"smtp_encryption\" class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                        <option value=\"tls\" <?php echo $current_settings['smtp_encryption'] == 'tls' ? 'selected' : ''; ?>>TLS</option>\n                                        <option value=\"ssl\" <?php echo $current_settings['smtp_encryption'] == 'ssl' ? 'selected' : ''; ?>>SSL</option>\n                                        <option value=\"none\" <?php echo $current_settings['smtp_encryption'] == 'none' ? 'selected' : ''; ?>>None</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"flex justify-end\">\n                            <button type=\"submit\" name=\"update_email_settings\" \n                                    class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                                Update Email Settings\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Payment Settings Tab -->\n            <div id=\"content-payment\" class=\"tab-content p-6 hidden\">\n                <form method=\"POST\">\n                    <div class=\"space-y-6\">\n                        <div>\n                            <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Payment Gateway Configuration</h3>\n                            \n                            <div class=\"mb-6\">\n                                <h4 class=\"text-md font-medium text-gray-800 mb-3\">Stripe Settings</h4>\n                                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Stripe Public Key</label>\n                                        <input type=\"text\" name=\"stripe_public_key\" value=\"<?php echo htmlspecialchars($current_settings['stripe_public_key']); ?>\" \n                                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                    </div>\n                                    <div>\n                                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Stripe Secret Key</label>\n                                        <input type=\"password\" name=\"stripe_secret_key\" value=\"<?php echo htmlspecialchars($current_settings['stripe_secret_key']); ?>\" \n                                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"mb-6\">\n                                <h4 class=\"text-md font-medium text-gray-800 mb-3\">PayPal Settings</h4>\n                                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">PayPal Client ID</label>\n                                        <input type=\"text\" name=\"paypal_client_id\" value=\"<?php echo htmlspecialchars($current_settings['paypal_client_id']); ?>\" \n                                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                    </div>\n                                    <div>\n                                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">PayPal Client Secret</label>\n                                        <input type=\"password\" name=\"paypal_client_secret\" value=\"<?php echo htmlspecialchars($current_settings['paypal_client_secret']); ?>\" \n                                               class=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent\">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"flex justify-end\">\n                            <button type=\"submit\" name=\"update_payment_settings\" \n                                    class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                                Update Payment Settings\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Notifications Tab -->\n            <div id=\"content-notifications\" class=\"tab-content p-6 hidden\">\n                <form method=\"POST\">\n                    <div class=\"space-y-6\">\n                        <div>\n                            <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Notification Preferences</h3>\n                            <div class=\"space-y-4\">\n                                <div class=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                                    <div>\n                                        <h4 class=\"text-sm font-medium text-gray-900\">Email Notifications</h4>\n                                        <p class=\"text-sm text-gray-500\">Send notifications via email</p>\n                                    </div>\n                                    <input type=\"checkbox\" name=\"email_notifications\" <?php echo $current_settings['email_notifications'] ? 'checked' : ''; ?> \n                                           class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                                </div>\n                                \n                                <div class=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                                    <div>\n                                        <h4 class=\"text-sm font-medium text-gray-900\">SMS Notifications</h4>\n                                        <p class=\"text-sm text-gray-500\">Send notifications via SMS</p>\n                                    </div>\n                                    <input type=\"checkbox\" name=\"sms_notifications\" <?php echo $current_settings['sms_notifications'] ? 'checked' : ''; ?> \n                                           class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                                </div>\n                                \n                                <div class=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                                    <div>\n                                        <h4 class=\"text-sm font-medium text-gray-900\">Order Notifications</h4>\n                                        <p class=\"text-sm text-gray-500\">Notify about new orders and updates</p>\n                                    </div>\n                                    <input type=\"checkbox\" name=\"order_notifications\" <?php echo $current_settings['order_notifications'] ? 'checked' : ''; ?> \n                                           class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                                </div>\n                                \n                                <div class=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                                    <div>\n                                        <h4 class=\"text-sm font-medium text-gray-900\">Vendor Notifications</h4>\n                                        <p class=\"text-sm text-gray-500\">Notify about vendor applications and updates</p>\n                                    </div>\n                                    <input type=\"checkbox\" name=\"vendor_notifications\" <?php echo $current_settings['vendor_notifications'] ? 'checked' : ''; ?> \n                                           class=\"h-4 w-4 text-accent focus:ring-accent border-gray-300 rounded\">\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"flex justify-end\">\n                            <button type=\"submit\" name=\"update_notification_settings\" \n                                    class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                                Update Notification Settings\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Maintenance Tab -->\n            <div id=\"content-maintenance\" class=\"tab-content p-6 hidden\">\n                <div class=\"space-y-6\">\n                    <div>\n                        <h3 class=\"text-lg font-medium text-gray-900 mb-4\">System Maintenance</h3>\n                        \n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div class=\"p-6 border border-gray-200 rounded-lg\">\n                                <h4 class=\"text-md font-medium text-gray-900 mb-2\">Clear System Cache</h4>\n                                <p class=\"text-sm text-gray-500 mb-4\">Clear temporary files and cached data to improve performance</p>\n                                <form method=\"POST\" class=\"inline\">\n                                    <button type=\"submit\" name=\"clear_cache\" \n                                            class=\"bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition\">\n                                        Clear Cache\n                                    </button>\n                                </form>\n                            </div>\n                            \n                            <div class=\"p-6 border border-gray-200 rounded-lg\">\n                                <h4 class=\"text-md font-medium text-gray-900 mb-2\">Database Backup</h4>\n                                <p class=\"text-sm text-gray-500 mb-4\">Create a backup of the database for safety</p>\n                                <form method=\"POST\" class=\"inline\">\n                                    <button type=\"submit\" name=\"backup_database\" \n                                            class=\"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition\">\n                                        Create Backup\n                                    </button>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"p-6 border border-gray-200 rounded-lg\">\n                        <h4 class=\"text-md font-medium text-gray-900 mb-2\">System Information</h4>\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                            <div>\n                                <span class=\"font-medium text-gray-700\">PHP Version:</span>\n                                <span class=\"text-gray-600\"><?php echo PHP_VERSION; ?></span>\n                            </div>\n                            <div>\n                                <span class=\"font-medium text-gray-700\">Server:</span>\n                                <span class=\"text-gray-600\"><?php echo $_SERVER['SERVER_SOFTWARE'] ?? 'Unknown'; ?></span>\n                            </div>\n                            <div>\n                                <span class=\"font-medium text-gray-700\">Database:</span>\n                                <span class=\"text-gray-600\">MySQL</span>\n                            </div>\n                            <div>\n                                <span class=\"font-medium text-gray-700\">Last Updated:</span>\n                                <span class=\"text-gray-600\"><?php echo date('Y-m-d H:i:s'); ?></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        function showTab(tabName) {\n            // Hide all tab contents\n            const contents = document.querySelectorAll('.tab-content');\n            contents.forEach(content => content.classList.add('hidden'));\n            \n            // Remove active class from all tabs\n            const tabs = document.querySelectorAll('.tab-button');\n            tabs.forEach(tab => {\n                tab.classList.remove('border-accent', 'text-accent');\n                tab.classList.add('border-transparent', 'text-gray-500');\n            });\n            \n            // Show selected tab content\n            document.getElementById('content-' + tabName).classList.remove('hidden');\n            \n            // Add active class to selected tab\n            const activeTab = document.getElementById('tab-' + tabName);\n            activeTab.classList.remove('border-transparent', 'text-gray-500');\n            activeTab.classList.add('border-accent', 'text-accent');\n        }\n    </script>\n</body>\n</html>\n","size_bytes":28582},"admin/shipment-management.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/tracking.php';\n\nrequire_admin();\n\n$tracking_manager = new TrackingManager();\n$message = '';\n\n// Handle status updates\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['update_status'])) {\n    $shipment_id = $_POST['shipment_id'];\n    $status = $_POST['status'];\n    $location = sanitize_input($_POST['location']);\n    $description = sanitize_input($_POST['description']);\n    \n    $result = $tracking_manager->update_shipment_status($shipment_id, $status, $location, $description);\n    $message = $result['message'];\n}\n\n$page = max(1, $_GET['page'] ?? 1);\n$limit = 20;\n$offset = ($page - 1) * $limit;\n\n$shipments = $tracking_manager->get_all_shipments($limit, $offset);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Shipment Management - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Shipment Management</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Shipment Management</h1>\n            <p class=\"mt-2 text-gray-600\">Track and update shipment statuses</p>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo $message; ?>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"bg-white shadow rounded-lg overflow-hidden\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">All Shipments</h2>\n            </div>\n            \n            <?php if (empty($shipments)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    No shipments found\n                </div>\n            <?php else: ?>\n                <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200\">\n                        <thead class=\"bg-gray-50\">\n                            <tr>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Tracking Number</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Order</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Customer</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Location</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                            <?php foreach ($shipments as $shipment): ?>\n                                <tr>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm font-medium text-gray-900\"><?php echo $shipment['tracking_number']; ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo $shipment['carrier']; ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo $shipment['order_number']; ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo date('M j, Y', strtotime($shipment['created_at'])); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($shipment['first_name'] . ' ' . $shipment['last_name']); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <?php\n                                        $status_colors = [\n                                            'pending' => 'bg-yellow-100 text-yellow-800',\n                                            'picked_up' => 'bg-blue-100 text-blue-800',\n                                            'in_transit' => 'bg-purple-100 text-purple-800',\n                                            'out_for_delivery' => 'bg-blue-100 text-blue-800',\n                                            'delivered' => 'bg-green-100 text-green-800'\n                                        ];\n                                        ?>\n                                        <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $status_colors[$shipment['status']]; ?>\">\n                                            <?php echo ucfirst(str_replace('_', ' ', $shipment['status'])); ?>\n                                        </span>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                        <?php echo htmlspecialchars($shipment['current_location'] ?: 'Not specified'); ?>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                        <button onclick=\"openUpdateModal(<?php echo htmlspecialchars(json_encode($shipment)); ?>)\" \n                                                class=\"text-accent hover:text-blue-600\">\n                                            Update\n                                        </button>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- Pagination -->\n        <div class=\"mt-8 flex justify-center\">\n            <div class=\"flex space-x-2\">\n                <?php if ($page > 1): ?>\n                    <a href=\"?page=<?php echo $page - 1; ?>\" \n                       class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Previous</a>\n                <?php endif; ?>\n                \n                <?php if (count($shipments) == $limit): ?>\n                    <a href=\"?page=<?php echo $page + 1; ?>\" \n                       class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\">Next</a>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Update Modal - Professional Market Nest Styling -->\n    <div id=\"updateModal\" class=\"fixed inset-0 bg-black bg-opacity-60 hidden backdrop-blur-sm transition-all duration-300 z-50\">\n        <div class=\"flex items-center justify-center min-h-screen p-4\">\n            <div class=\"bg-white rounded-xl shadow-2xl max-w-md w-full border border-gray-100 transform transition-all duration-300\">\n                <form method=\"POST\">\n                    <div class=\"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-accent to-blue-600 rounded-t-xl\">\n                        <h3 class=\"text-lg font-semibold text-white flex items-center\">\n                            <span class=\"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3\">\n                                <span class=\"text-white font-bold text-sm\">MN</span>\n                            </span>\n                            Update Shipment Status\n                        </h3>\n                    </div>\n                    \n                    <div class=\"px-6 py-4 space-y-4\">\n                        <input type=\"hidden\" name=\"shipment_id\" id=\"modal_shipment_id\">\n                        \n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Tracking Number</label>\n                            <p id=\"modal_tracking_number\" class=\"text-sm text-gray-900 font-medium\"></p>\n                        </div>\n                        \n                        <div>\n                            <label for=\"modal_status\" class=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n                            <select name=\"status\" id=\"modal_status\" required \n                                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                                <option value=\"pending\">Pending</option>\n                                <option value=\"picked_up\">Picked Up</option>\n                                <option value=\"in_transit\">In Transit</option>\n                                <option value=\"out_for_delivery\">Out for Delivery</option>\n                                <option value=\"delivered\">Delivered</option>\n                            </select>\n                        </div>\n                        \n                        <div>\n                            <label for=\"modal_location\" class=\"block text-sm font-medium text-gray-700 mb-1\">Current Location</label>\n                            <input type=\"text\" name=\"location\" id=\"modal_location\" \n                                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                        </div>\n                        \n                        <div>\n                            <label for=\"modal_description\" class=\"block text-sm font-medium text-gray-700 mb-1\">Description</label>\n                            <textarea name=\"description\" id=\"modal_description\" rows=\"3\" \n                                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-orange-500 focus:border-\n","size_bytes":11556},"admin/users.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\n\nrequire_admin();\n\n$database = new Database();\n$db = $database->getConnection();\n\n// Detect available role/status sources to avoid SQL errors\n// Role/Status capability detection\n$hasUserRoleTable = false; // true if a role history table exists\n$roleTableName = null;     // 'user_role' or 'user_roles'\n$hasUsersRoleColumn = false;\n$hasUsersStatusColumn = false;\n// Status table detection\n$hasUserStatusTable = false;\n$statusTableName = null;   // 'user_status' or 'user_statuses'\n$statusTableHasCreatedAt = false;\ntry {\n    // Detect role tables via information_schema\n    $stmtTbl = $db->prepare(\"SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME IN ('user_role','user_roles')\");\n    $stmtTbl->execute();\n    $rowTbl = $stmtTbl->fetch(PDO::FETCH_ASSOC);\n    if ($rowTbl && !empty($rowTbl['TABLE_NAME'])) {\n        $roleTableName = $rowTbl['TABLE_NAME'];\n        $hasUserRoleTable = true;\n    }\n} catch (Exception $e) {\n    $hasUserRoleTable = false;\n}\ntry {\n    // Detect status tables via information_schema\n    $stmtTblS = $db->prepare(\"SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME IN ('user_status','user_statuses')\");\n    $stmtTblS->execute();\n    $rowTblS = $stmtTblS->fetch(PDO::FETCH_ASSOC);\n    if ($rowTblS && !empty($rowTblS['TABLE_NAME'])) {\n        $statusTableName = $rowTblS['TABLE_NAME'];\n        $hasUserStatusTable = true;\n    }\n} catch (Exception $e) {\n    $hasUserStatusTable = false;\n}\ntry {\n    // Check users.role column via information_schema (MySQL)\n    $stmtCheck = $db->prepare(\"SELECT COUNT(*) AS c FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'users' AND COLUMN_NAME = 'role'\");\n    $stmtCheck->execute();\n    $hasUsersRoleColumn = (bool)($stmtCheck->fetch(PDO::FETCH_ASSOC)['c'] ?? 0);\n} catch (Exception $e) {\n    $hasUsersRoleColumn = false;\n}\ntry {\n    // Check users.status column\n    $stmtCheck2 = $db->prepare(\"SELECT COUNT(*) AS c FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'users' AND COLUMN_NAME = 'status'\");\n    $stmtCheck2->execute();\n    $hasUsersStatusColumn = (bool)($stmtCheck2->fetch(PDO::FETCH_ASSOC)['c'] ?? 0);\n} catch (Exception $e) {\n    $hasUsersStatusColumn = false;\n}\n\n// Handle user actions\nif (($_POST['action'] ?? '') === 'update_status') {\n    $user_id = $_POST['user_id'] ?? null;\n    $status = $_POST['status'] ?? null;\n    if ($user_id && $status) {\n        if ($hasUserStatusTable && $statusTableName) {\n            // Determine if created_at exists\n            try {\n                $stmtColS = $db->prepare(\"SELECT COUNT(*) AS c FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = :tbl AND COLUMN_NAME = 'created_at'\");\n                $stmtColS->execute([':tbl' => $statusTableName]);\n                $statusTableHasCreatedAt = (bool)($stmtColS->fetch(PDO::FETCH_ASSOC)['c'] ?? 0);\n            } catch (Exception $e) {\n                $statusTableHasCreatedAt = false;\n            }\n            if ($statusTableHasCreatedAt) {\n                $stmt = $db->prepare(\"INSERT INTO \" . $statusTableName . \" (user_id, status, created_at) VALUES (?, ?, NOW())\");\n                $stmt->execute([$user_id, $status]);\n            } else {\n                $stmt = $db->prepare(\"INSERT INTO \" . $statusTableName . \" (user_id, status) VALUES (?, ?)\");\n                $stmt->execute([$user_id, $status]);\n            }\n            header('Location: users.php?updated=1');\n        } elseif ($hasUsersStatusColumn) {\n            $stmt = $db->prepare(\"UPDATE users SET status = ? WHERE id = ?\");\n            $stmt->execute([$status, $user_id]);\n            header('Location: users.php?updated=1');\n        } else {\n            header('Location: users.php');\n        }\n    } else {\n        header('Location: users.php');\n    }\n    exit();\n}\n\n// Get users with pagination\n$page = max(1, $_GET['page'] ?? 1);\n$limit = 20;\n$offset = ($page - 1) * $limit;\n\n$search = $_GET['search'] ?? '';\n$role_filter = $_GET['role'] ?? '';\n\n$where_conditions = [];\n$params = [];\n\nif ($search) {\n    $where_conditions[] = \"(first_name LIKE ? OR last_name LIKE ? OR email LIKE ?)\";\n    $params[] = \"%$search%\";\n    $params[] = \"%$search%\";\n    $params[] = \"%$search%\";\n}\n\nif ($role_filter) {\n    if ($hasUserRoleTable) {\n        $where_conditions[] = \"roles.role = ?\";\n        $params[] = $role_filter;\n    } elseif ($hasUsersRoleColumn) {\n        $where_conditions[] = \"users.role = ?\";\n        $params[] = $role_filter;\n    } else {\n        // No role source; ignore filter to avoid SQL errors\n    }\n}\n\n$where_clause = $where_conditions ? 'WHERE ' . implode(' AND ', $where_conditions) : '';\n\n// Build JOINs\n$joinClauses = [];\n// Join latest role per user from role table (if available)\nif ($hasUserRoleTable && $roleTableName) {\n    // Determine if created_at exists on the role table; if not, fall back to max(id)\n    $orderColumn = 'created_at';\n    try {\n        $stmtCol = $db->prepare(\"SELECT COUNT(*) AS c FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = :tbl AND COLUMN_NAME = 'created_at'\");\n        $stmtCol->execute([':tbl' => $roleTableName]);\n        $hasCreatedAt = (bool)($stmtCol->fetch(PDO::FETCH_ASSOC)['c'] ?? 0);\n        if (!$hasCreatedAt) {\n            $orderColumn = 'id';\n        }\n    } catch (Exception $e) {\n        $orderColumn = 'id';\n    }\n\n    $joinClauses[] = \"LEFT JOIN (\\n        SELECT ur.user_id, ur.role\\n        FROM \" . $roleTableName . \" ur\\n        INNER JOIN (\\n            SELECT user_id, MAX(\" . $orderColumn . \") AS max_val\\n            FROM \" . $roleTableName . \"\\n            GROUP BY user_id\\n        ) latest ON latest.user_id = ur.user_id AND latest.max_val = ur.\" . $orderColumn . \"\\n    ) roles ON roles.user_id = users.id\";\n}\n// Join latest status per user from status table (if available)\nif ($hasUserStatusTable && $statusTableName) {\n    $statusOrderColumn = 'created_at';\n    try {\n        $stmtColSS = $db->prepare(\"SELECT COUNT(*) AS c FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = :tbl AND COLUMN_NAME = 'created_at'\");\n        $stmtColSS->execute([':tbl' => $statusTableName]);\n        $hasStatusCreatedAt = (bool)($stmtColSS->fetch(PDO::FETCH_ASSOC)['c'] ?? 0);\n        if (!$hasStatusCreatedAt) {\n            $statusOrderColumn = 'id';\n        }\n    } catch (Exception $e) {\n        $statusOrderColumn = 'id';\n    }\n    $joinClauses[] = \"LEFT JOIN (\\n        SELECT us.user_id, us.status\\n        FROM \" . $statusTableName . \" us\\n        INNER JOIN (\\n            SELECT user_id, MAX(\" . $statusOrderColumn . \") AS max_val\\n            FROM \" . $statusTableName . \"\\n            GROUP BY user_id\\n        ) latestS ON latestS.user_id = us.user_id AND latestS.max_val = us.\" . $statusOrderColumn . \"\\n    ) ustatus ON ustatus.user_id = users.id\";\n}\n$joins = implode(' ', $joinClauses);\n\n$selectRole = $hasUserRoleTable ? 'roles.role AS role' : ($hasUsersRoleColumn ? 'users.role AS role' : 'NULL AS role');\n$selectStatus = $hasUserStatusTable ? 'ustatus.status AS status' : ($hasUsersStatusColumn ? 'users.status AS status' : 'NULL AS status');\n$stmt = $db->prepare(\"SELECT users.*, $selectRole, $selectStatus FROM users $joins $where_clause ORDER BY users.created_at DESC LIMIT $limit OFFSET $offset\");\n$stmt->execute($params);\n$users = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n$stmt = $db->prepare(\"SELECT COUNT(DISTINCT users.id) as total FROM users $joins $where_clause\");\n$stmt->execute($params);\n$total_users = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\n$total_pages = ceil($total_users / $limit);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>User Management - Admin</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Navigation -->\n    <nav class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\">E-Commerce</a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Admin</a>\n                    <span class=\"text-gray-400\">></span>\n                    <span class=\"text-gray-700 font-medium\">Users</span>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </div>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">User Management</h1>\n            <p class=\"text-gray-600 mt-2\">Manage user accounts and permissions</p>\n        </div>\n\n        <!-- Filters -->\n        <div class=\"bg-white rounded-lg shadow mb-6\">\n            <div class=\"p-6\">\n                <form method=\"GET\" class=\"flex flex-wrap gap-4\">\n                    <div class=\"flex-1 min-w-64\">\n                        <input type=\"text\" name=\"search\" value=\"<?php echo htmlspecialchars($search); ?>\" \n                               placeholder=\"Search users...\" \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent\">\n                    </div>\n                    <div>\n                        <select name=\"role\" class=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent\">\n                            <option value=\"\">All Roles</option>\n                            <option value=\"customer\" <?php echo $role_filter === 'customer' ? 'selected' : ''; ?>>Customer</option>\n                            <option value=\"vendor\" <?php echo $role_filter === 'vendor' ? 'selected' : ''; ?>>Vendor</option>\n                            <option value=\"admin\" <?php echo $role_filter === 'admin' ? 'selected' : ''; ?>>Admin</option>\n                        </select>\n                    </div>\n                    <button type=\"submit\" class=\"bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                        Search\n                    </button>\n                </form>\n            </div>\n        </div>\n\n        <!-- Users Table -->\n        <div class=\"bg-white rounded-lg shadow overflow-hidden\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-lg font-semibold text-gray-900\">Users (<?php echo number_format($total_users); ?>)</h2>\n            </div>\n            \n            <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                        <tr>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">User</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Role</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Joined</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                        <?php foreach ($users as $user): ?>\n                            <?php \n                                $firstName = $user['first_name'] ?? '';\n                                $lastName = $user['last_name'] ?? '';\n                                $email = $user['email'] ?? '';\n                                $role = $user['role'] ?? '';\n                                $statusVal = $user['status'] ?? '';\n                                $createdAt = $user['created_at'] ?? null;\n                                $userId = $user['id'] ?? '';\n                            ?>\n                            <tr>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <div class=\"flex items-center\">\n                                        <div class=\"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center\">\n                                            <span class=\"text-primary font-medium\"><?php echo substr($firstName ?: 'U', 0, 1); ?></span>\n                                        </div>\n                                        <div class=\"ml-4\">\n                                            <div class=\"text-sm font-medium text-gray-900\">\n                                                <?php echo htmlspecialchars(trim(($firstName . ' ' . $lastName)) ?: 'Unknown User'); ?>\n                                            </div>\n                                            <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($email ?: ''); ?></div>\n                                        </div>\n                                    </div>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                        <?php echo $role === 'admin' ? 'bg-red-100 text-red-800' : \n                                            ($role === 'vendor' ? 'bg-primary/10 text-primary' : 'bg-blue-100 text-blue-800'); ?>\">\n                                        <?php echo $role ? ucfirst($role) : 'Unknown'; ?>\n                                    </span>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                        <?php echo $statusVal === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'; ?>\">\n                                        <?php echo $statusVal ? ucfirst($statusVal) : 'Unknown'; ?>\n                                    </span>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                    <?php echo $createdAt ? date('M j, Y', strtotime($createdAt)) : ''; ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                    <?php if ($role !== 'admin'): ?>\n                                        <form method=\"POST\" class=\"inline\">\n                                            <input type=\"hidden\" name=\"action\" value=\"update_status\">\n                                            <input type=\"hidden\" name=\"user_id\" value=\"<?php echo htmlspecialchars($userId); ?>\">\n                                            <input type=\"hidden\" name=\"status\" value=\"<?php echo $statusVal === 'active' ? 'inactive' : 'active'; ?>\">\n                                            <button type=\"submit\" class=\"text-primary hover:text-blue-600\">\n                                                <?php echo $statusVal === 'active' ? 'Deactivate' : 'Activate'; ?>\n                                            </button>\n                                        </form>\n                                    <?php endif; ?>\n                                </td>\n                            </tr>\n                        <?php endforeach; ?>\n                    </tbody>\n                </table>\n            </div>\n\n            <!-- Pagination -->\n            <?php if ($total_pages > 1): ?>\n                <div class=\"px-6 py-4 border-t border-gray-200\">\n                    <div class=\"flex justify-between items-center\">\n                        <div class=\"text-sm text-gray-700\">\n                            Showing <?php echo ($offset + 1); ?> to <?php echo min($offset + $limit, $total_users); ?> of <?php echo $total_users; ?> users\n                        </div>\n                        <div class=\"flex space-x-2\">\n                            <?php if ($page > 1): ?>\n                                <a href=\"?page=<?php echo $page - 1; ?>&search=<?php echo urlencode($search); ?>&role=<?php echo urlencode($role_filter); ?>\" \n                                   class=\"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50\">Previous</a>\n                            <?php endif; ?>\n                            \n                            <?php for ($i = max(1, $page - 2); $i <= min($total_pages, $page + 2); $i++): ?>\n                                <a href=\"?page=<?php echo $i; ?>&search=<?php echo urlencode($search); ?>&role=<?php echo urlencode($role_filter); ?>\" \n                                   class=\"px-3 py-2 border rounded-lg text-sm <?php echo $i === $page ? 'bg-primary text-white border-primary' : 'border-gray-300 hover:bg-gray-50'; ?>\">\n                                    <?php echo $i; ?>\n                                </a>\n                            <?php endfor; ?>\n                            \n                            <?php if ($page < $total_pages): ?>\n                                <a href=\"?page=<?php echo $page + 1; ?>&search=<?php echo urlencode($search); ?>&role=<?php echo urlencode($role_filter); ?>\" \n                                   class=\"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50\">Next</a>\n                            <?php endif; ?>\n                        </div>\n                    </div>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":18734},"admin/vendor-applications.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/vendor.php';\n\nrequire_admin();\n\n$vendor_manager = new VendorManager();\n$message = '';\n\n// Handle actions\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $action = $_POST['action'];\n    $application_id = $_POST['application_id'];\n    \n    if ($action == 'approve') {\n        $result = $vendor_manager->approve_application($application_id, $_SESSION['user_id']);\n        $message = $result['message'];\n        if ($result['success']) {\n            $message .= \" Login credentials: Username: \" . $result['credentials']['username'] . \", Password: \" . $result['credentials']['password'];\n        }\n    } elseif ($action == 'reject') {\n        $result = $vendor_manager->reject_application($application_id, $_SESSION['user_id']);\n        $message = $result['message'];\n    }\n}\n\n$pending_applications = $vendor_manager->get_pending_applications();\n$all_applications = $vendor_manager->get_all_applications();\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Vendor Applications - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Vendor Applications</h1>\n            <p class=\"mt-2 text-gray-600\">Review and manage vendor applications</p>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo $message; ?>\n            </div>\n        <?php endif; ?>\n        \n        <!-- Pending Applications -->\n        <div class=\"bg-white shadow rounded-lg mb-8\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">\n                    Pending Applications \n                    <span class=\"bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                        <?php echo count($pending_applications); ?>\n                    </span>\n                </h2>\n            </div>\n            \n            <?php if (empty($pending_applications)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    No pending applications\n                </div>\n            <?php else: ?>\n                <div class=\"divide-y divide-gray-200\">\n                    <?php foreach ($pending_applications as $app): ?>\n                        <div class=\"px-6 py-6\">\n                            <div class=\"flex items-start justify-between\">\n                                <div class=\"flex-1\">\n                                    <div class=\"flex items-center space-x-4 mb-4\">\n                                        <?php if ($app['logo_path']): ?>\n                                            <img src=\"../<?php echo $app['logo_path']; ?>\" alt=\"Logo\" class=\"w-12 h-12 rounded-full object-cover\">\n                                        <?php else: ?>\n                                            <div class=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                                                <span class=\"text-accent font-medium\"><?php echo substr($app['business_name'], 0, 1); ?></span>\n                                            </div>\n                                        <?php endif; ?>\n                                        <div>\n                                            <h3 class=\"text-lg font-medium text-gray-900\"><?php echo htmlspecialchars($app['business_name']); ?></h3>\n                                            <p class=\"text-sm text-gray-500\">by <?php echo htmlspecialchars($app['name']); ?></p>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                                        <div>\n                                            <span class=\"text-sm font-medium text-gray-500\">Email:</span>\n                                            <p class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($app['email']); ?></p>\n                                        </div>\n                                        <div>\n                                            <span class=\"text-sm font-medium text-gray-500\">Applied:</span>\n                                            <p class=\"text-sm text-gray-900\"><?php echo date('M j, Y g:i A', strtotime($app['applied_at'])); ?></p>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class=\"mb-4\">\n                                        <span class=\"text-sm font-medium text-gray-500\">Description:</span>\n                                        <p class=\"text-sm text-gray-900 mt-1\"><?php echo nl2br(htmlspecialchars($app['description'])); ?></p>\n                                    </div>\n                                </div>\n                                \n                                <div class=\"flex space-x-2 ml-4\">\n                                    <form method=\"POST\" class=\"inline\">\n                                        <input type=\"hidden\" name=\"action\" value=\"approve\">\n                                        <input type=\"hidden\" name=\"application_id\" value=\"<?php echo $app['id']; ?>\">\n                                        <button type=\"submit\" \n                                                onclick=\"return confirm('Are you sure you want to approve this application?')\"\n                                                class=\"bg-green-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-green-600 transition duration-200\">\n                                            Approve\n                                        </button>\n                                    </form>\n                                    \n                                    <form method=\"POST\" class=\"inline\">\n                                        <input type=\"hidden\" name=\"action\" value=\"reject\">\n                                        <input type=\"hidden\" name=\"application_id\" value=\"<?php echo $app['id']; ?>\">\n                                        <button type=\"submit\" \n                                                onclick=\"return confirm('Are you sure you want to reject this application?')\"\n                                                class=\"bg-red-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-600 transition duration-200\">\n                                            Reject\n                                        </button>\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    <?php endforeach; ?>\n                </div>\n            <?php endif; ?>\n        </div>\n        \n        <!-- All Applications History -->\n        <div class=\"bg-white shadow rounded-lg\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">Application History</h2>\n            </div>\n            \n            <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                        <tr>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Business</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Applicant</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Applied</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Reviewed By</th>\n                        </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                        <?php foreach ($all_applications as $app): ?>\n                            <tr>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <div class=\"flex items-center\">\n                                        <?php if ($app['logo_path']): ?>\n                                            <img src=\"../<?php echo $app['logo_path']; ?>\" alt=\"Logo\" class=\"w-8 h-8 rounded-full object-cover mr-3\">\n                                        <?php else: ?>\n                                            <div class=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\n                                                <span class=\"text-accent text-xs font-medium\"><?php echo substr($app['business_name'], 0, 1); ?></span>\n                                            </div>\n                                        <?php endif; ?>\n                                        <span class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($app['business_name']); ?></span>\n                                    </div>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($app['name']); ?></div>\n                                    <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($app['email']); ?></div>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                    <?php echo date('M j, Y', strtotime($app['applied_at'])); ?>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\n                                    <?php\n                                    $status_colors = [\n                                        'pending' => 'bg-yellow-100 text-yellow-800',\n                                        'approved' => 'bg-green-100 text-green-800',\n                                        'rejected' => 'bg-red-100 text-red-800'\n                                    ];\n                                    ?>\n                                    <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $status_colors[$app['status']]; ?>\">\n                                        <?php echo ucfirst($app['status']); ?>\n                                    </span>\n                                </td>\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                    <?php echo $app['reviewed_by_username'] ?? '-'; ?>\n                                </td>\n                            </tr>\n                        <?php endforeach; ?>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":12645},"admin/vendor-management.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/vendor.php';\n\nrequire_admin();\n\n$vendor_manager = new VendorManager();\n$message = '';\n\n// Generate CSRF token\n$csrf_token = generate_csrf_token();\n\n// Handle badge assignment\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['assign_badge'])) {\n    if (!verify_csrf_token($_POST['csrf_token'] ?? '')) {\n        $message = 'Invalid security token. Please try again.';\n    } else {\n        $vendor_id = (int)$_POST['vendor_id'];\n        $badge_name = sanitize_input($_POST['badge_name']);\n        \n        $result = $vendor_manager->assign_badge($vendor_id, $badge_name);\n        $message = $result['message'];\n    }\n}\n\n// Handle add vendor\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['add_vendor'])) {\n    if (!verify_csrf_token($_POST['csrf_token'] ?? '')) {\n        $message = 'Invalid security token. Please try again.';\n    } else {\n        $name = sanitize_input($_POST['name']);\n        $email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);\n        $business_name = sanitize_input($_POST['business_name']);\n        $description = sanitize_input($_POST['description']);\n        \n        if (!$email) {\n            $message = 'Please provide a valid email address.';\n        } elseif (empty($name) || empty($business_name) || empty($description)) {\n            $message = 'All fields are required.';\n        } else {\n            $result = $vendor_manager->create_vendor_directly($name, $email, $business_name, $description);\n            $message = $result['message'];\n        }\n    }\n}\n\n// Handle delete vendor\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['delete_vendor'])) {\n    if (!verify_csrf_token($_POST['csrf_token'] ?? '')) {\n        $message = 'Invalid security token. Please try again.';\n    } else {\n        $vendor_id = (int)$_POST['vendor_id'];\n        \n        $result = $vendor_manager->delete_vendor($vendor_id);\n        $message = $result['message'];\n    }\n}\n\n$vendors = $vendor_manager->get_all_vendors();\n\n// Get available badges\n$database = new Database();\n$db = $database->getConnection();\n$stmt = $db->prepare(\"SELECT * FROM badges ORDER BY name\");\n$stmt->execute();\n$badges = $stmt->fetchAll(PDO::FETCH_ASSOC);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Vendor Management - Admin Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between items-center h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\"><?php echo SITE_NAME; ?></a>\n                    <span class=\"text-gray-400\">|</span>\n                    <span class=\"text-gray-700\">Admin Dashboard</span>\n                </div>\n                \n                <nav class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"vendor-applications.php\" class=\"text-gray-700 hover:text-accent\">Applications</a>\n                    <a href=\"../logout.php\" class=\"text-accent hover:text-blue-600\">Logout</a>\n                </nav>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <div class=\"flex justify-between items-center mb-8\">\n            <div>\n                <h1 class=\"text-3xl font-bold text-gray-900\">Vendor Management</h1>\n                <p class=\"mt-2 text-gray-600\">Manage existing vendors and assign verification badges</p>\n            </div>\n            <button onclick=\"document.getElementById('addVendorModal').classList.remove('hidden')\" \n                    class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">\n                Add New Vendor\n            </button>\n        </div>\n        \n        <?php if ($message): ?>\n            <div class=\"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($message); ?>\n            </div>\n        <?php endif; ?>\n        \n        <div class=\"bg-white shadow rounded-lg\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">\n                    All Vendors \n                    <span class=\"bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full ml-2\">\n                        <?php echo count($vendors); ?>\n                    </span>\n                </h2>\n            </div>\n            \n            <?php if (empty($vendors)): ?>\n                <div class=\"px-6 py-8 text-center text-gray-500\">\n                    No vendors found\n                </div>\n            <?php else: ?>\n                <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200\">\n                        <thead class=\"bg-gray-50\">\n                            <tr>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Contact</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Badge</th>\n                                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"bg-white divide-y divide-gray-200\">\n                            <?php foreach ($vendors as $vendor): ?>\n                                <tr>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"flex items-center\">\n                                            <?php if ($vendor['logo_path']): ?>\n                                                <img src=\"../<?php echo $vendor['logo_path']; ?>\" alt=\"Logo\" class=\"w-10 h-10 rounded-full object-cover mr-4\">\n                                            <?php else: ?>\n                                                <div class=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4\">\n                                                    <span class=\"text-accent font-medium\"><?php echo substr($vendor['business_name'], 0, 1); ?></span>\n                                                </div>\n                                            <?php endif; ?>\n                                            <div>\n                                                <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($vendor['business_name']); ?></div>\n                                                <div class=\"text-sm text-gray-500\">@<?php echo htmlspecialchars($vendor['username']); ?></div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($vendor['first_name'] . ' ' . $vendor['last_name']); ?></div>\n                                        <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($vendor['email']); ?></div>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <?php if ($vendor['is_verified']): ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800\">\n                                                Verified\n                                            </span>\n                                        <?php else: ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800\">\n                                                Unverified\n                                            </span>\n                                        <?php endif; ?>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <?php if ($vendor['verification_badge']): ?>\n                                            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800\">\n                                                <?php echo htmlspecialchars($vendor['verification_badge']); ?>\n                                            </span>\n                                        <?php else: ?>\n                                            <span class=\"text-sm text-gray-500\">No badge</span>\n                                        <?php endif; ?>\n                                    </td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"flex items-center space-x-2\">\n                                            <form method=\"POST\" class=\"flex items-center space-x-2\">\n                                                <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo $csrf_token; ?>\">\n                                                <input type=\"hidden\" name=\"vendor_id\" value=\"<?php echo $vendor['id']; ?>\">\n                                                <select name=\"badge_name\" class=\"text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-accent focus:border-accent\">\n                                                    <option value=\"\">Select Badge</option>\n                                                    <?php foreach ($badges as $badge): ?>\n                                                        <option value=\"<?php echo $badge['name']; ?>\" <?php echo ($vendor['verification_badge'] == $badge['name']) ? 'selected' : ''; ?>>\n                                                            <?php echo htmlspecialchars($badge['name']); ?>\n                                                        </option>\n                                                    <?php endforeach; ?>\n                                                </select>\n                                                <button type=\"submit\" name=\"assign_badge\" \n                                                        class=\"bg-accent text-white px-3 py-1 rounded-md text-sm font-medium hover:bg-blue-600 transition duration-200\">\n                                                    Assign\n                                                </button>\n                                            </form>\n                                            <form method=\"POST\" class=\"inline\" onsubmit=\"return confirm('Are you sure you want to delete this vendor? This will also deactivate all their products.')\">\n                                                <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo $csrf_token; ?>\">\n                                                <input type=\"hidden\" name=\"vendor_id\" value=\"<?php echo $vendor['id']; ?>\">\n                                                <button type=\"submit\" name=\"delete_vendor\" \n                                                        class=\"bg-red-500 text-white px-3 py-1 rounded-md text-sm font-medium hover:bg-red-600 transition duration-200\">\n                                                    Delete\n                                                </button>\n                                            </form>\n                                        </div>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n\n    <!-- Add Vendor Modal -->\n    <div id=\"addVendorModal\" class=\"hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n        <div class=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n            <div class=\"mt-3 text-center\">\n                <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Add New Vendor</h3>\n                <form method=\"POST\" class=\"space-y-4\">\n                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo $csrf_token; ?>\">\n                    <div class=\"text-left\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Contact Name</label>\n                        <input type=\"text\" name=\"name\" required \n                               class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                    </div>\n                    <div class=\"text-left\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\n                        <input type=\"email\" name=\"email\" required \n                               class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                    </div>\n                    <div class=\"text-left\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Business Name</label>\n                        <input type=\"text\" name=\"business_name\" required \n                               class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\">\n                    </div>\n                    <div class=\"text-left\">\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Description</label>\n                        <textarea name=\"description\" rows=\"3\" required \n                                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-accent focus:border-accent\"></textarea>\n                    </div>\n                    <div class=\"flex space-x-3 pt-3\">\n                        <button type=\"submit\" name=\"add_vendor\" \n                                class=\"flex-1 bg-accent text-white px-4 py-2 rounded-md hover:bg-blue-600 transition\">\n                            Create Vendor\n                        </button>\n                        <button type=\"button\" onclick=\"document.getElementById('addVendorModal').classList.add('hidden')\" \n                                class=\"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition\">\n                            Cancel\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":15714},"api/cart-count.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/cart.php';\n\nheader('Content-Type: application/json');\n\nif (!is_logged_in()) {\n    echo json_encode(['count' => 0]);\n    exit;\n}\n\n$cart_manager = new CartManager();\n$count = $cart_manager->get_cart_count($_SESSION['user_id']);\n\necho json_encode(['count' => $count]);\n?>\n","size_bytes":338},"api/product-preview.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/product.php';\n\nheader('Content-Type: application/json');\n\nif (!isset($_GET['id'])) {\n    echo json_encode(['success' => false, 'message' => 'Product ID required']);\n    exit;\n}\n\n$product_id = (int)$_GET['id'];\n$productManager = new ProductManager();\n\n// Get product details\n$product = $productManager->get_product_by_id($product_id);\n\nif (!$product) {\n    echo json_encode(['success' => false, 'message' => 'Product not found']);\n    exit;\n}\n\n// Generate preview HTML\n$html = '\n<div class=\"bg-white rounded-lg shadow-md overflow-hidden\">\n    <div class=\"relative\">\n        ' . (!empty($product['images']) ? \n            '<img src=\"' . htmlspecialchars($product['images'][0]) . '\" alt=\"' . htmlspecialchars($product['name']) . '\" class=\"w-full h-48 object-cover\">' :\n            '<div class=\"w-full h-48 bg-gray-200 flex items-center justify-center\">\n                <span class=\"text-gray-400\">No Image</span>\n            </div>') . '\n        \n        ' . ($product['is_featured'] ? '<div class=\"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded\">Featured</div>' : '') . '\n        \n        ' . ($product['sale_price'] ? '<div class=\"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded\">Sale</div>' : '') . '\n    </div>\n    \n    <div class=\"p-4\">\n        <div class=\"flex items-center mb-2\">\n            <span class=\"text-sm text-gray-600\">' . htmlspecialchars($product['business_name']) . '</span>\n            ' . ($product['is_verified'] ? '<span class=\"ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full\">Verified</span>' : '') . '\n        </div>\n        \n        <h3 class=\"font-medium text-gray-900 mb-2\">' . htmlspecialchars($product['name']) . '</h3>\n        \n        <p class=\"text-sm text-gray-600 mb-3\">' . htmlspecialchars($product['description']) . '</p>\n        \n        <div class=\"flex items-center mb-2\">\n            ' . ($product['avg_rating'] > 0 ? \n                '<div class=\"flex items-center\">\n                    <span class=\"text-yellow-400\">★</span>\n                    <span class=\"text-sm text-gray-600 ml-1\">' . $product['avg_rating'] . ' (' . $product['review_count'] . ')</span>\n                </div>' :\n                '<span class=\"text-sm text-gray-500\">No reviews yet</span>') . '\n        </div>\n        \n        <div class=\"flex items-center justify-between\">\n            <div>\n                ' . ($product['sale_price'] ? \n                    '<span class=\"text-lg font-bold text-red-600\">$' . number_format($product['sale_price'], 2) . '</span>\n                     <span class=\"text-sm text-gray-500 line-through ml-2\">$' . number_format($product['price'], 2) . '</span>' :\n                    '<span class=\"text-lg font-bold text-gray-900\">$' . number_format($product['price'], 2) . '</span>') . '\n            </div>\n            \n            ' . ($product['stock_quantity'] > 0 ? \n                '<span class=\"text-sm text-green-600\">In Stock (' . $product['stock_quantity'] . ')</span>' :\n                '<span class=\"text-sm text-red-600\">Out of Stock</span>') . '\n        </div>\n        \n        <div class=\"mt-3 pt-3 border-t\">\n            <div class=\"text-xs text-gray-500\">\n                <p><strong>SKU:</strong> ' . htmlspecialchars($product['sku'] ?: 'N/A') . '</p>\n                <p><strong>Category:</strong> ' . htmlspecialchars($product['category_name']) . '</p>\n                <p><strong>Status:</strong> ' . ucfirst($product['status']) . '</p>\n                <p><strong>Admin Approved:</strong> ' . ($product['admin_approved'] ? 'Yes' : 'No') . '</p>\n            </div>\n        </div>\n    </div>\n</div>';\n\necho json_encode(['success' => true, 'html' => $html]);\n?>\n","size_bytes":3753},"api/track-ad-click.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/advertisement.php';\n\nheader('Content-Type: application/json');\n\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405);\n    echo json_encode(['error' => 'Method not allowed']);\n    exit;\n}\n\n$input = json_decode(file_get_contents('php://input'), true);\n$ad_id = $input['ad_id'] ?? null;\n\nif (!$ad_id) {\n    http_response_code(400);\n    echo json_encode(['error' => 'Ad ID required']);\n    exit;\n}\n\n$adManager = new AdvertisementManager();\n$adManager->incrementClickCount($ad_id);\n\necho json_encode(['success' => true]);\n?>\n\n","size_bytes":610},"api/validate-coupon.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/coupon.php';\nrequire_once '../includes/cart.php';\n\nheader('Content-Type: application/json');\n\nif (!is_logged_in()) {\n    echo json_encode(['success' => false, 'message' => 'Please log in to use coupons']);\n    exit;\n}\n\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    echo json_encode(['success' => false, 'message' => 'Invalid request method']);\n    exit;\n}\n\n$coupon_code = sanitize_input($_POST['coupon_code'] ?? '');\n$user_id = $_SESSION['user_id'];\n\nif (empty($coupon_code)) {\n    echo json_encode(['success' => false, 'message' => 'Please enter a coupon code']);\n    exit;\n}\n\ntry {\n    $couponManager = new CouponManager();\n    $cartManager = new CartManager();\n    \n    // Get cart items\n    $cart_items = $cartManager->get_cart_items($user_id);\n    \n    if (empty($cart_items)) {\n        echo json_encode(['success' => false, 'message' => 'Your cart is empty']);\n        exit;\n    }\n    \n    // Convert cart items to the format expected by coupon validation\n    $items_for_validation = [];\n    foreach ($cart_items as $item) {\n        $items_for_validation[] = [\n            'product_id' => $item['product_id'],\n            'price' => $item['sale_price'] ?: $item['price'],\n            'quantity' => $item['quantity']\n        ];\n    }\n    \n    // Validate coupon\n    $result = $couponManager->validateCoupon($coupon_code, $user_id, $items_for_validation);\n    \n    if ($result['success']) {\n        // Store coupon in session for checkout\n        $_SESSION['applied_coupon'] = [\n            'coupon' => $result['coupon'],\n            'discount' => $result['discount']\n        ];\n        \n        echo json_encode([\n            'success' => true,\n            'message' => 'Coupon applied successfully!',\n            'coupon' => $result['coupon'],\n            'discount' => $result['discount']\n        ]);\n    } else {\n        echo json_encode([\n            'success' => false,\n            'message' => $result['message']\n        ]);\n    }\n    \n} catch (Exception $e) {\n    echo json_encode(['success' => false, 'message' => 'Error validating coupon: ' . $e->getMessage()]);\n}\n?>\n","size_bytes":2154},"api/wishlist-count.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/wishlist.php';\n\nheader('Content-Type: application/json');\n\nif (!is_logged_in()) {\n    echo json_encode(['count' => 0]);\n    exit;\n}\n\n$wishlist_manager = new WishlistManager();\n$count = $wishlist_manager->getWishlistCount($_SESSION['user_id']);\n\necho json_encode(['count' => $count]);\n?>\n\n","size_bytes":357},"config/config.php":{"content":"<?php\n// Session configuration must be first, before any output\nif (session_status() === PHP_SESSION_NONE) {\n    ini_set('session.cookie_httponly', 1);\n    ini_set('session.use_only_cookies', 1);\n    ini_set('session.cookie_secure', 0); // Set to 1 for HTTPS\n    session_start();\n}\n\n// Site configuration\nif (!defined('SITE_NAME')) {\n    define('SITE_NAME', 'Market Nest'); // Default fallback\n}\nif (!defined('SITE_URL')) {\n    define('SITE_URL', 'https://' . ($_SERVER['HTTP_HOST'] ?? 'localhost:5000'));\n}\nif (!defined('UPLOAD_PATH')) {\n    define('UPLOAD_PATH', 'uploads/');\n}\nif (!defined('MAX_FILE_SIZE')) {\n    define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5MB\n}\n\n// Currency configuration\nif (!defined('CURRENCY_SYMBOL')) {\n    define('CURRENCY_SYMBOL', 'XAF');\n}\nif (!defined('CURRENCY_NAME')) {\n    define('CURRENCY_NAME', 'Central African CFA Franc');\n}\nif (!defined('CURRENCY_POSITION')) {\n    define('CURRENCY_POSITION', 'after'); // 'before' or 'after'\n}\n\n// Tracking pricing\nif (!defined('FREE_TRACKING_LIMIT')) {\n    define('FREE_TRACKING_LIMIT', 2);\n}\nif (!defined('STANDARD_TRACKING_PRICE')) {\n    define('STANDARD_TRACKING_PRICE', 5.99);\n}\nif (!defined('PREMIUM_TRACKING_PRICE')) {\n    define('PREMIUM_TRACKING_PRICE', 9.99);\n}\n\n// Include database connection\nrequire_once 'database.php';\n\n// Helper functions\nfunction sanitize_input($data) {\n    if ($data === null) {\n        return '';\n    }\n    return htmlspecialchars(strip_tags(trim($data)));\n}\n\nfunction redirect($url) {\n    header(\"Location: \" . $url);\n    exit();\n}\n\nfunction is_logged_in() {\n    return isset($_SESSION['user_id']);\n}\n\nfunction get_user_role() {\n    return $_SESSION['user_role'] ?? 'customer';\n}\n\nfunction require_login() {\n    if (!is_logged_in()) {\n        // Check if we're in admin directory and adjust path accordingly\n        $login_path = (strpos($_SERVER['REQUEST_URI'], '/admin/') !== false) ? '../login.php' : 'login.php';\n        redirect($login_path);\n    }\n}\n\nfunction require_admin() {\n    require_login();\n    if (get_user_role() !== 'admin') {\n        redirect('../index.php');\n    }\n}\n\nfunction require_vendor() {\n    require_login();\n    if (!in_array(get_user_role(), ['vendor', 'admin'])) {\n        redirect('index.php');\n    }\n}\n\n// CSRF Protection functions\nfunction generate_csrf_token() {\n    if (!isset($_SESSION['csrf_token'])) {\n        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));\n    }\n    return $_SESSION['csrf_token'];\n}\n\n/**\n * Format currency amount\n */\nfunction format_currency($amount, $show_symbol = true) {\n    $formatted = number_format($amount, 0, '.', ' ');\n    \n    if ($show_symbol) {\n        if (CURRENCY_POSITION === 'before') {\n            return CURRENCY_SYMBOL . ' ' . $formatted;\n        } else {\n            return $formatted . ' ' . CURRENCY_SYMBOL;\n        }\n    }\n    \n    return $formatted;\n}\n\nfunction verify_csrf_token($token) {\n    return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);\n}\n\n// Additional auth helper functions\nfunction isLoggedIn() {\n    return is_logged_in();\n}\n\nfunction getCurrentUser() {\n    if (!is_logged_in()) {\n        return null;\n    }\n    \n    $database = new Database();\n    $db = $database->getConnection();\n    \n    try {\n        $stmt = $db->prepare(\"\n            SELECT u.*, ur.role \n            FROM users u \n            LEFT JOIN user_roles ur ON u.id = ur.user_id \n            WHERE u.id = ?\n        \");\n        $stmt->execute([$_SESSION['user_id']]);\n        \n        return $stmt->fetch(PDO::FETCH_ASSOC);\n        \n    } catch (PDOException $e) {\n        return null;\n    }\n}\n?>\n","size_bytes":3606},"config/database.php":{"content":"<?php\nclass Database {\n    private $db_path;\n    private $conn;\n\n    public function __construct() {\n        $this->db_path = __DIR__ . '/../data/ecommerce.db';\n    }\n\n    public function getConnection() {\n        $this->conn = null;\n        try {\n            $this->conn = new PDO(\n                \"sqlite:\" . $this->db_path,\n                null,\n                null,\n                array(\n                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC\n                )\n            );\n            \n            // Enable foreign key constraints for SQLite\n            $this->conn->exec(\"PRAGMA foreign_keys = ON\");\n            \n        } catch (PDOException $e) {\n            die('SQLite connection failed: ' . $e->getMessage());\n        }\n        return $this->conn;\n    }\n}\n?>","size_bytes":853},"database/init.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nfunction initializeDatabase() {\n    try {\n        $database = new Database();\n        $conn = $database->getConnection();\n        \n        if ($conn) {\n            echo \"Database connection established successfully.\\n\";\n            \n            // Read and execute the schema\n            $schema = file_get_contents(__DIR__ . '/schema_sqlite.sql');\n            $statements = explode(';', $schema);\n            \n            foreach ($statements as $statement) {\n                $statement = trim($statement);\n                if (!empty($statement)) {\n                    $conn->exec($statement);\n                }\n            }\n            \n            echo \"Database schema created successfully.\\n\";\n            \n            // Insert sample categories\n            insertSampleData($conn);\n            \n            return true;\n        } else {\n            echo \"Failed to connect to database.\\n\";\n            return false;\n        }\n    } catch (Exception $e) {\n        echo \"Error initializing database: \" . $e->getMessage() . \"\\n\";\n        return false;\n    }\n}\n\nfunction insertSampleData($conn) {\n    // Insert sample categories\n    $categories = [\n        ['Electronics', 'Electronic gadgets and devices', '📱'],\n        ['Clothing', 'Fashion and apparel', '👕'],\n        ['Home & Garden', 'Home improvement and garden items', '🏠'],\n        ['Books', 'Books and educational materials', '📚'],\n        ['Sports', 'Sports and outdoor equipment', '⚽'],\n        ['Beauty', 'Beauty and personal care products', '💄']\n    ];\n    \n    $stmt = $conn->prepare(\"INSERT OR IGNORE INTO categories (name, description, icon) VALUES (?, ?, ?)\");\n    foreach ($categories as $category) {\n        $stmt->execute([$category[0], $category[1], $category[2]]);\n    }\n    \n    // Create a default admin user\n    $admin_password = password_hash('admin123', PASSWORD_DEFAULT);\n    $stmt = $conn->prepare(\"INSERT OR IGNORE INTO users (username, email, password, first_name, last_name, role) VALUES (?, ?, ?, ?, ?, ?)\");\n    $stmt->execute(['admin', 'admin@orangecart.com', $admin_password, 'Admin', 'User', 'admin']);\n    \n    $admin_id = $conn->lastInsertId();\n    if ($admin_id) {\n        $stmt = $conn->prepare(\"INSERT OR IGNORE INTO user_roles (user_id, role) VALUES (?, ?)\");\n        $stmt->execute([$admin_id, 'admin']);\n    }\n    \n    echo \"Sample data inserted successfully.\\n\";\n}\n\n// Run initialization if called directly\nif (basename(__FILE__) == basename($_SERVER[\"SCRIPT_NAME\"])) {\n    initializeDatabase();\n}\n?>","size_bytes":2574},"database/init_mysql.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nfunction initializeMySQLDatabase() {\n    try {\n        // First, connect without specifying database to create it\n        $host = 'localhost';\n        $username = 'root';\n        $password = '';\n        \n        $pdo = new PDO(\"mysql:host=$host;charset=utf8mb4\", $username, $password, [\n            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n            PDO::MYSQL_ATTR_INIT_COMMAND => \"SET NAMES utf8mb4\"\n        ]);\n        \n        echo \"Connected to MySQL server successfully.\\n\";\n        \n        // Create database if it doesn't exist\n        $pdo->exec(\"CREATE DATABASE IF NOT EXISTS ecommerce_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci\");\n        echo \"Database 'ecommerce_db' created/verified successfully.\\n\";\n        \n        // Use the database\n        $pdo->exec(\"USE ecommerce_db\");\n        \n        // Read and execute the original MySQL schema\n        $schema = file_get_contents(__DIR__ . '/schema.sql');\n        \n        // Remove the first few lines that create/use database\n        $schema = preg_replace('/^-- E-commerce Database Schema\\s*\\n/', '', $schema);\n        $schema = preg_replace('/^CREATE DATABASE.*?\\n/', '', $schema);\n        $schema = preg_replace('/^USE.*?\\n/', '', $schema);\n        \n        // Add tracking_payments table to the schema\n        $schema .= \"\n\n-- Tracking payments table\nCREATE TABLE IF NOT EXISTS tracking_payments (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    user_id INT NOT NULL,\n    shipment_id INT NOT NULL,\n    tracking_level ENUM('standard', 'premium') NOT NULL,\n    amount DECIMAL(10,2) NOT NULL,\n    status ENUM('pending', 'completed', 'failed') DEFAULT 'pending',\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (shipment_id) REFERENCES shipments(id)\n);\";\n        \n        // Split into individual statements and execute\n        $statements = array_filter(array_map('trim', explode(';', $schema)));\n        \n        foreach ($statements as $statement) {\n            if (!empty($statement)) {\n                $pdo->exec($statement);\n            }\n        }\n        \n        echo \"Database schema created successfully.\\n\";\n        \n        // Insert sample data\n        insertMySQLSampleData($pdo);\n        \n        return true;\n    } catch (Exception $e) {\n        echo \"Error initializing MySQL database: \" . $e->getMessage() . \"\\n\";\n        return false;\n    }\n}\n\nfunction insertMySQLSampleData($pdo) {\n    // Insert sample categories\n    $categories = [\n        ['Electronics', 'Electronic gadgets and devices'],\n        ['Clothing', 'Fashion and apparel'],\n        ['Home & Garden', 'Home improvement and garden items'],\n        ['Books', 'Books and educational materials'],\n        ['Sports', 'Sports and outdoor equipment'],\n        ['Beauty', 'Beauty and personal care products']\n    ];\n    \n    $stmt = $pdo->prepare(\"INSERT IGNORE INTO categories (name, description) VALUES (?, ?)\");\n    foreach ($categories as $category) {\n        $stmt->execute([$category[0], $category[1]]);\n    }\n    \n    // Create a default admin user\n    $admin_password = password_hash('admin123', PASSWORD_DEFAULT);\n    $stmt = $pdo->prepare(\"INSERT IGNORE INTO users (username, email, password, first_name, last_name) VALUES (?, ?, ?, ?, ?)\");\n    $stmt->execute(['admin', 'admin@marketnest.com', $admin_password, 'Admin', 'User']);\n    \n    $admin_id = $pdo->lastInsertId();\n    if ($admin_id) {\n        $stmt = $pdo->prepare(\"UPDATE users SET role = 'admin' WHERE id = ?\");\n        $stmt->execute([$admin_id]);\n        \n        $stmt = $pdo->prepare(\"INSERT IGNORE INTO user_roles (user_id, role) VALUES (?, ?)\");\n        $stmt->execute([$admin_id, 'admin']);\n    }\n    \n    echo \"Sample data inserted successfully.\\n\";\n    echo \"Admin login - Username: admin, Password: admin123\\n\";\n}\n\n// Run initialization if called directly\nif (basename(__FILE__) == basename($_SERVER[\"SCRIPT_NAME\"])) {\n    initializeMySQLDatabase();\n}\n?>","size_bytes":4073},"includes/ad_display.php":{"content":"<?php\nrequire_once __DIR__ . '/advertisement.php';\n\nclass AdDisplay {\n    private $adManager;\n    \n    public function __construct() {\n        $this->adManager = new AdvertisementManager();\n    }\n    \n    public function displayAds($ad_type = null, $position = null, $limit = 1) {\n        $ads = $this->adManager->getActiveAds($ad_type, $position);\n        \n        if (empty($ads)) {\n            return '';\n        }\n        \n        // Limit the number of ads\n        $ads = array_slice($ads, 0, $limit);\n        \n        $html = '';\n        foreach ($ads as $ad) {\n            $html .= $this->renderAd($ad);\n        }\n        \n        return $html;\n    }\n    \n    private function renderAd($ad) {\n        // Increment view count\n        $this->adManager->incrementViewCount($ad['id']);\n        \n        $html = '<div class=\"ad-container\" data-ad-id=\"' . $ad['id'] . '\">';\n        \n        if ($ad['ad_type'] === 'banner') {\n            $html .= $this->renderBannerAd($ad);\n        } elseif ($ad['ad_type'] === 'sidebar') {\n            $html .= $this->renderSidebarAd($ad);\n        } elseif ($ad['ad_type'] === 'popup') {\n            $html .= $this->renderPopupAd($ad);\n        } elseif ($ad['ad_type'] === 'inline') {\n            $html .= $this->renderInlineAd($ad);\n        }\n        \n        $html .= '</div>';\n        \n        return $html;\n    }\n    \n    private function renderBannerAd($ad) {\n        $clickable = !empty($ad['link_url']);\n        $tag = $clickable ? 'a' : 'div';\n        $href = $clickable ? 'href=\"' . htmlspecialchars($ad['link_url']) . '\" target=\"_blank\"' : '';\n        \n        $html = '<' . $tag . ' ' . $href . ' class=\"banner-ad w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg mb-4 cursor-pointer hover:shadow-lg transition-shadow\" onclick=\"trackAdClick(' . $ad['id'] . ')\">';\n        \n        if ($ad['image_url']) {\n            $html .= '<img src=\"' . htmlspecialchars($ad['image_url']) . '\" alt=\"' . htmlspecialchars($ad['title']) . '\" class=\"w-full h-32 object-cover rounded mb-2\">';\n        }\n        \n        if ($ad['video_url']) {\n            $html .= '<video class=\"w-full h-32 object-cover rounded mb-2\" autoplay muted loop>';\n            $html .= '<source src=\"' . htmlspecialchars($ad['video_url']) . '\" type=\"video/mp4\">';\n            $html .= '</video>';\n        }\n        \n        $html .= '<h3 class=\"text-lg font-bold mb-2\">' . htmlspecialchars($ad['title']) . '</h3>';\n        \n        if ($ad['content']) {\n            $html .= '<p class=\"text-sm opacity-90\">' . htmlspecialchars($ad['content']) . '</p>';\n        }\n        \n        $html .= '</' . $tag . '>';\n        \n        return $html;\n    }\n    \n    private function renderSidebarAd($ad) {\n        $clickable = !empty($ad['link_url']);\n        $tag = $clickable ? 'a' : 'div';\n        $href = $clickable ? 'href=\"' . htmlspecialchars($ad['link_url']) . '\" target=\"_blank\"' : '';\n        \n        $html = '<' . $tag . ' ' . $href . ' class=\"sidebar-ad bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm hover:shadow-md transition-shadow cursor-pointer\" onclick=\"trackAdClick(' . $ad['id'] . ')\">';\n        \n        if ($ad['image_url']) {\n            $html .= '<img src=\"' . htmlspecialchars($ad['image_url']) . '\" alt=\"' . htmlspecialchars($ad['title']) . '\" class=\"w-full h-24 object-cover rounded mb-2\">';\n        }\n        \n        $html .= '<h4 class=\"font-semibold text-gray-900 mb-1\">' . htmlspecialchars($ad['title']) . '</h4>';\n        \n        if ($ad['content']) {\n            $html .= '<p class=\"text-sm text-gray-600\">' . htmlspecialchars($ad['content']) . '</p>';\n        }\n        \n        $html .= '</' . $tag . '>';\n        \n        return $html;\n    }\n    \n    private function renderPopupAd($ad) {\n        $clickable = !empty($ad['link_url']);\n        $tag = $clickable ? 'a' : 'div';\n        $href = $clickable ? 'href=\"' . htmlspecialchars($ad['link_url']) . '\" target=\"_blank\"' : '';\n        \n        $html = '<div class=\"popup-ad fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" id=\"popup-ad-' . $ad['id'] . '\">';\n        $html .= '<div class=\"bg-white rounded-lg p-6 max-w-md mx-4 relative\">';\n        $html .= '<button onclick=\"closePopupAd(' . $ad['id'] . ')\" class=\"absolute top-2 right-2 text-gray-400 hover:text-gray-600\">×</button>';\n        \n        $html .= '<' . $tag . ' ' . $href . ' onclick=\"trackAdClick(' . $ad['id'] . ')\" class=\"block\">';\n        \n        if ($ad['image_url']) {\n            $html .= '<img src=\"' . htmlspecialchars($ad['image_url']) . '\" alt=\"' . htmlspecialchars($ad['title']) . '\" class=\"w-full h-48 object-cover rounded mb-3\">';\n        }\n        \n        if ($ad['video_url']) {\n            $html .= '<video class=\"w-full h-48 object-cover rounded mb-3\" autoplay muted loop>';\n            $html .= '<source src=\"' . htmlspecialchars($ad['video_url']) . '\" type=\"video/mp4\">';\n            $html .= '</video>';\n        }\n        \n        $html .= '<h3 class=\"text-xl font-bold text-gray-900 mb-2\">' . htmlspecialchars($ad['title']) . '</h3>';\n        \n        if ($ad['content']) {\n            $html .= '<p class=\"text-gray-600\">' . htmlspecialchars($ad['content']) . '</p>';\n        }\n        \n        $html .= '</' . $tag . '>';\n        $html .= '</div>';\n        $html .= '</div>';\n        \n        return $html;\n    }\n    \n    private function renderInlineAd($ad) {\n        $clickable = !empty($ad['link_url']);\n        $tag = $clickable ? 'a' : 'div';\n        $href = $clickable ? 'href=\"' . htmlspecialchars($ad['link_url']) . '\" target=\"_blank\"' : '';\n        \n        $html = '<' . $tag . ' ' . $href . ' class=\"inline-ad bg-gray-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg hover:bg-gray-100 transition-colors cursor-pointer\" onclick=\"trackAdClick(' . $ad['id'] . ')\">';\n        \n        if ($ad['image_url']) {\n            $html .= '<img src=\"' . htmlspecialchars($ad['image_url']) . '\" alt=\"' . htmlspecialchars($ad['title']) . '\" class=\"w-full h-32 object-cover rounded mb-2\">';\n        }\n        \n        $html .= '<h4 class=\"font-semibold text-gray-900 mb-1\">' . htmlspecialchars($ad['title']) . '</h4>';\n        \n        if ($ad['content']) {\n            $html .= '<p class=\"text-sm text-gray-600\">' . htmlspecialchars($ad['content']) . '</p>';\n        }\n        \n        $html .= '</' . $tag . '>';\n        \n        return $html;\n    }\n}\n\n// JavaScript for tracking ad clicks\nfunction getAdTrackingScript() {\n    return '\n    <script>\n    function trackAdClick(adId) {\n        fetch(\"api/track-ad-click.php\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({ad_id: adId})\n        }).catch(error => console.log(\"Ad tracking error:\", error));\n    }\n    \n    function closePopupAd(adId) {\n        document.getElementById(\"popup-ad-\" + adId).style.display = \"none\";\n    }\n    \n    // Auto-show popup ads after 3 seconds\n    document.addEventListener(\"DOMContentLoaded\", function() {\n        setTimeout(function() {\n            const popupAds = document.querySelectorAll(\".popup-ad\");\n            popupAds.forEach(function(ad) {\n                ad.style.display = \"flex\";\n            });\n        }, 3000);\n    });\n    </script>';\n}\n?>\n\n","size_bytes":7294},"includes/advertisement.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nclass AdvertisementManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function createAd($title, $content, $image_url = null, $video_url = null, $link_url = null, $ad_type = 'banner', $position = 'top', $start_date = null, $end_date = null) {\n        try {\n            $stmt = $this->db->prepare(\"\n                INSERT INTO advertisements (title, content, image_url, video_url, link_url, ad_type, position, start_date, end_date) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n            \");\n            $stmt->execute([$title, $content, $image_url, $video_url, $link_url, $ad_type, $position, $start_date, $end_date]);\n            return ['success' => true, 'message' => 'Advertisement created successfully', 'id' => $this->db->lastInsertId()];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to create advertisement: ' . $e->getMessage()];\n        }\n    }\n    \n    public function updateAd($id, $title, $content, $image_url = null, $video_url = null, $link_url = null, $ad_type = 'banner', $position = 'top', $is_active = true, $start_date = null, $end_date = null) {\n        try {\n            $stmt = $this->db->prepare(\"\n                UPDATE advertisements \n                SET title = ?, content = ?, image_url = ?, video_url = ?, link_url = ?, \n                    ad_type = ?, position = ?, is_active = ?, start_date = ?, end_date = ?\n                WHERE id = ?\n            \");\n            $stmt->execute([$title, $content, $image_url, $video_url, $link_url, $ad_type, $position, $is_active, $start_date, $end_date, $id]);\n            return ['success' => true, 'message' => 'Advertisement updated successfully'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to update advertisement: ' . $e->getMessage()];\n        }\n    }\n    \n    public function deleteAd($id) {\n        try {\n            $stmt = $this->db->prepare(\"DELETE FROM advertisements WHERE id = ?\");\n            $stmt->execute([$id]);\n            return ['success' => true, 'message' => 'Advertisement deleted successfully'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to delete advertisement: ' . $e->getMessage()];\n        }\n    }\n    \n    public function getAd($id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT * FROM advertisements WHERE id = ?\");\n            $stmt->execute([$id]);\n            return $stmt->fetch(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return null;\n        }\n    }\n    \n    public function getAllAds($limit = 50, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM advertisements \n                ORDER BY created_at DESC \n                LIMIT ? OFFSET ?\n            \");\n            $stmt->execute([$limit, $offset]);\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function getActiveAds($ad_type = null, $position = null) {\n        try {\n            $where_conditions = [\"is_active = 1\"];\n            $params = [];\n            \n            if ($ad_type) {\n                $where_conditions[] = \"ad_type = ?\";\n                $params[] = $ad_type;\n            }\n            \n            if ($position) {\n                $where_conditions[] = \"position = ?\";\n                $params[] = $position;\n            }\n            \n            // Check date range\n            $where_conditions[] = \"(start_date IS NULL OR start_date <= NOW())\";\n            $where_conditions[] = \"(end_date IS NULL OR end_date >= NOW())\";\n            \n            $where_clause = implode(\" AND \", $where_conditions);\n            \n            $stmt = $this->db->prepare(\"\n                SELECT * FROM advertisements \n                WHERE $where_clause \n                ORDER BY created_at DESC\n            \");\n            $stmt->execute($params);\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function incrementViewCount($id) {\n        try {\n            $stmt = $this->db->prepare(\"UPDATE advertisements SET view_count = view_count + 1 WHERE id = ?\");\n            $stmt->execute([$id]);\n        } catch (PDOException $e) {\n            // Silent fail for view counting\n        }\n    }\n    \n    public function incrementClickCount($id) {\n        try {\n            $stmt = $this->db->prepare(\"UPDATE advertisements SET click_count = click_count + 1 WHERE id = ?\");\n            $stmt->execute([$id]);\n        } catch (PDOException $e) {\n            // Silent fail for click counting\n        }\n    }\n    \n    public function getAdStats() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT \n                    COUNT(*) as total_ads,\n                    SUM(CASE WHEN is_active = 1 THEN 1 ELSE 0 END) as active_ads,\n                    SUM(view_count) as total_views,\n                    SUM(click_count) as total_clicks\n                FROM advertisements\n            \");\n            $stmt->execute();\n            return $stmt->fetch(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return ['total_ads' => 0, 'active_ads' => 0, 'total_views' => 0, 'total_clicks' => 0];\n        }\n    }\n}\n?>\n\n","size_bytes":5536},"includes/auth.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass Auth {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function register($username, $email, $password, $first_name, $last_name, $phone = '', $address = '', $city = '', $state = '', $zip_code = '') {\n        try {\n            // Check if user already exists\n            $stmt = $this->db->prepare(\"SELECT id FROM users WHERE username = ? OR email = ? LIMIT 1\");\n            $stmt->execute([$username, $email]);\n            \n            if ($stmt->fetch()) {\n                return ['success' => false, 'message' => 'Username or email already exists'];\n            }\n            \n            // Hash password\n            $hashed_password = password_hash($password, PASSWORD_DEFAULT);\n            \n            // Insert user\n            $stmt = $this->db->prepare(\"\n                INSERT INTO users (username, email, password, first_name, last_name, phone, address, city, state, zip_code) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n            \");\n            \n            $stmt->execute([$username, $email, $hashed_password, $first_name, $last_name, $phone, $address, $city, $state, $zip_code]);\n            $user_id = $this->db->lastInsertId();\n            \n            // Add customer role\n            $stmt = $this->db->prepare(\"INSERT INTO user_roles (user_id, role) VALUES (?, 'customer')\");\n            $stmt->execute([$user_id]);\n            \n            return ['success' => true, 'message' => 'Registration successful'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Registration failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function login($username, $password) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT u.*, ur.role \n                FROM users u \n                LEFT JOIN user_roles ur ON u.id = ur.user_id \n                WHERE u.username = ? OR u.email = ?\n                LIMIT 1\n            \");\n            $stmt->execute([$username, $username]);\n            \n            $user = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($user && password_verify($password, $user['password'])) {\n                // Set session variables\n                $_SESSION['user_id'] = $user['id'];\n                $_SESSION['username'] = $user['username'];\n                $_SESSION['user_role'] = $user['role'] ?? 'customer';\n                $_SESSION['first_name'] = $user['first_name'];\n                $_SESSION['last_name'] = $user['last_name'];\n                \n                return ['success' => true, 'message' => 'Login successful'];\n            }\n            \n            return ['success' => false, 'message' => 'Invalid username or password'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Login failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function logout() {\n        session_destroy();\n        return ['success' => true, 'message' => 'Logged out successfully'];\n    }\n    \n    public function get_user_info($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT u.*, ur.role \n                FROM users u \n                LEFT JOIN user_roles ur ON u.id = ur.user_id \n                WHERE u.id = ?\n            \");\n            $stmt->execute([$user_id]);\n            \n            return $stmt->fetch(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n}\n?>\n","size_bytes":3652},"includes/cart.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass CartManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function add_to_cart($user_id, $product_id, $quantity = 1) {\n        try {\n            // Check if product exists and is active\n            $stmt = $this->db->prepare(\"SELECT stock_quantity FROM products WHERE id = ? AND status = 'active'\");\n            $stmt->execute([$product_id]);\n            $product = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$product) {\n                return ['success' => false, 'message' => 'Product not found'];\n            }\n            \n            // Check if item already in cart\n            $stmt = $this->db->prepare(\"SELECT quantity FROM cart WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$user_id, $product_id]);\n            $existing = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($existing) {\n                $new_quantity = $existing['quantity'] + $quantity;\n                \n                if ($new_quantity > $product['stock_quantity']) {\n                    return ['success' => false, 'message' => 'Not enough stock available'];\n                }\n                \n                $stmt = $this->db->prepare(\"UPDATE cart SET quantity = ?, updated_at = NOW() WHERE user_id = ? AND product_id = ?\");\n                $stmt->execute([$new_quantity, $user_id, $product_id]);\n            } else {\n                if ($quantity > $product['stock_quantity']) {\n                    return ['success' => false, 'message' => 'Not enough stock available'];\n                }\n                \n                $stmt = $this->db->prepare(\"INSERT INTO cart (user_id, product_id, quantity) VALUES (?, ?, ?)\");\n                $stmt->execute([$user_id, $product_id, $quantity]);\n            }\n            \n            return ['success' => true, 'message' => 'Item added to cart'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to add to cart: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_cart_items($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT c.*, p.name, p.price, p.sale_price, p.images, p.stock_quantity, v.business_name\n                FROM cart c\n                JOIN products p ON c.product_id = p.id\n                JOIN vendors v ON p.vendor_id = v.id\n                WHERE c.user_id = ? AND p.status = 'active'\n                ORDER BY c.updated_at DESC\n            \");\n            \n            $stmt->execute([$user_id]);\n            $items = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($items as &$item) {\n                $item['images'] = json_decode($item['images'], true) ?: [];\n                $item['current_price'] = $item['sale_price'] ?: $item['price'];\n                $item['total_price'] = $item['current_price'] * $item['quantity'];\n            }\n            \n            return $items;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function update_cart_quantity($user_id, $product_id, $quantity) {\n        try {\n            if ($quantity <= 0) {\n                return $this->remove_from_cart($user_id, $product_id);\n            }\n            \n            // Check stock\n            $stmt = $this->db->prepare(\"SELECT stock_quantity FROM products WHERE id = ?\");\n            $stmt->execute([$product_id]);\n            $product = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($quantity > $product['stock_quantity']) {\n                return ['success' => false, 'message' => 'Not enough stock available'];\n            }\n            \n            $stmt = $this->db->prepare(\"UPDATE cart SET quantity = ?, updated_at = NOW() WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$quantity, $user_id, $product_id]);\n            \n            return ['success' => true, 'message' => 'Cart updated'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to update cart: ' . $e->getMessage()];\n        }\n    }\n    \n    public function remove_from_cart($user_id, $product_id) {\n        try {\n            $stmt = $this->db->prepare(\"DELETE FROM cart WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            return ['success' => true, 'message' => 'Item removed from cart'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to remove from cart: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_cart_count($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT SUM(quantity) as total FROM cart WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            return $result['total'] ?: 0;\n            \n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function get_cart_total($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT SUM(c.quantity * COALESCE(p.sale_price, p.price)) as total\n                FROM cart c\n                JOIN products p ON c.product_id = p.id\n                WHERE c.user_id = ? AND p.status = 'active'\n            \");\n            \n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            return $result['total'] ?: 0;\n            \n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function clear_cart($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"DELETE FROM cart WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            \n            return ['success' => true, 'message' => 'Cart cleared'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to clear cart'];\n        }\n    }\n}\n?>\n","size_bytes":6152},"includes/coupon.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nclass CouponManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    /**\n     * Create a new coupon\n     */\n    public function createCoupon($data) {\n        try {\n            $stmt = $this->db->prepare(\"\n                INSERT INTO coupons (code, name, description, type, value, minimum_amount, maximum_discount, usage_limit, is_active, start_date, end_date) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n            \");\n            \n            $stmt->execute([\n                $data['code'],\n                $data['name'],\n                $data['description'] ?? '',\n                $data['type'],\n                $data['value'],\n                $data['minimum_amount'] ?? 0,\n                $data['maximum_discount'] ?? null,\n                $data['usage_limit'] ?? null,\n                $data['is_active'] ?? true,\n                $data['start_date'] ?? null,\n                $data['end_date'] ?? null\n            ]);\n            \n            $coupon_id = $this->db->lastInsertId();\n            \n            // If it's a free product coupon, add product associations\n            if ($data['type'] === 'free_product' && !empty($data['product_ids'])) {\n                $this->addProductsToCoupon($coupon_id, $data['product_ids']);\n            }\n            \n            return ['success' => true, 'message' => 'Coupon created successfully', 'coupon_id' => $coupon_id];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to create coupon: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Validate and apply a coupon\n     */\n    public function validateCoupon($code, $user_id, $cart_items = []) {\n        try {\n            // Get coupon details\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM coupons \n                WHERE code = ? AND is_active = 1\n            \");\n            $stmt->execute([$code]);\n            $coupon = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$coupon) {\n                return ['success' => false, 'message' => 'Invalid coupon code'];\n            }\n            \n            // Check if coupon is within date range\n            $now = date('Y-m-d H:i:s');\n            if ($coupon['start_date'] && $now < $coupon['start_date']) {\n                return ['success' => false, 'message' => 'Coupon is not yet active'];\n            }\n            if ($coupon['end_date'] && $now > $coupon['end_date']) {\n                return ['success' => false, 'message' => 'Coupon has expired'];\n            }\n            \n            // Check usage limit\n            if ($coupon['usage_limit'] && $coupon['used_count'] >= $coupon['usage_limit']) {\n                return ['success' => false, 'message' => 'Coupon usage limit reached'];\n            }\n            \n            // Check if user has already used this coupon\n            $stmt = $this->db->prepare(\"\n                SELECT COUNT(*) as count FROM coupon_usage \n                WHERE coupon_id = ? AND user_id = ?\n            \");\n            $stmt->execute([$coupon['id'], $user_id]);\n            $usage_count = $stmt->fetch(PDO::FETCH_ASSOC)['count'];\n            \n            if ($usage_count > 0) {\n                return ['success' => false, 'message' => 'You have already used this coupon'];\n            }\n            \n            // Calculate discount\n            $discount = $this->calculateDiscount($coupon, $cart_items);\n            \n            if ($discount['amount'] <= 0) {\n                return ['success' => false, 'message' => 'Coupon does not apply to your cart'];\n            }\n            \n            return [\n                'success' => true,\n                'coupon' => $coupon,\n                'discount' => $discount\n            ];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Error validating coupon: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Calculate discount amount\n     */\n    private function calculateDiscount($coupon, $cart_items) {\n        $total_amount = 0;\n        $applicable_items = [];\n        \n        // Calculate total amount and find applicable items\n        foreach ($cart_items as $item) {\n            $item_total = $item['price'] * $item['quantity'];\n            $total_amount += $item_total;\n            \n            // For free product coupons, check if this product is eligible\n            if ($coupon['type'] === 'free_product') {\n                if ($this->isProductEligibleForCoupon($coupon['id'], $item['product_id'])) {\n                    $applicable_items[] = $item;\n                }\n            } else {\n                $applicable_items[] = $item;\n            }\n        }\n        \n        // Check minimum amount requirement\n        if ($coupon['minimum_amount'] > 0 && $total_amount < $coupon['minimum_amount']) {\n            return ['amount' => 0, 'message' => 'Minimum order amount not met'];\n        }\n        \n        $discount_amount = 0;\n        \n        switch ($coupon['type']) {\n            case 'percentage':\n                $discount_amount = ($total_amount * $coupon['value']) / 100;\n                if ($coupon['maximum_discount'] && $discount_amount > $coupon['maximum_discount']) {\n                    $discount_amount = $coupon['maximum_discount'];\n                }\n                break;\n                \n            case 'fixed':\n                $discount_amount = $coupon['value'];\n                if ($discount_amount > $total_amount) {\n                    $discount_amount = $total_amount;\n                }\n                break;\n                \n            case 'free_product':\n                // For free product coupons, make the entire order free\n                $discount_amount = $total_amount;\n                break;\n        }\n        \n        return [\n            'amount' => $discount_amount,\n            'applicable_items' => $applicable_items,\n            'total_amount' => $total_amount\n        ];\n    }\n    \n    /**\n     * Check if a product is eligible for a free product coupon\n     */\n    private function isProductEligibleForCoupon($coupon_id, $product_id) {\n        $stmt = $this->db->prepare(\"\n            SELECT COUNT(*) as count FROM coupon_products \n            WHERE coupon_id = ? AND product_id = ?\n        \");\n        $stmt->execute([$coupon_id, $product_id]);\n        $result = $stmt->fetch(PDO::FETCH_ASSOC);\n        \n        return $result['count'] > 0;\n    }\n    \n    /**\n     * Record coupon usage\n     */\n    public function recordCouponUsage($coupon_id, $user_id, $order_id = null) {\n        try {\n            // Record usage\n            $stmt = $this->db->prepare(\"\n                INSERT INTO coupon_usage (coupon_id, user_id, order_id) \n                VALUES (?, ?, ?)\n            \");\n            $stmt->execute([$coupon_id, $user_id, $order_id]);\n            \n            // Update usage count\n            $stmt = $this->db->prepare(\"\n                UPDATE coupons SET used_count = used_count + 1 \n                WHERE id = ?\n            \");\n            $stmt->execute([$coupon_id]);\n            \n            return ['success' => true];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to record coupon usage: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Get all coupons for admin\n     */\n    public function getAllCoupons($limit = 50, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM coupons \n                ORDER BY created_at DESC \n                LIMIT ? OFFSET ?\n            \");\n            $stmt->execute([(int)$limit, (int)$offset]);\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    /**\n     * Get coupon by ID\n     */\n    public function getCouponById($coupon_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM coupons WHERE id = ?\n            \");\n            $stmt->execute([$coupon_id]);\n            \n            return $stmt->fetch(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return null;\n        }\n    }\n    \n    /**\n     * Update coupon\n     */\n    public function updateCoupon($coupon_id, $data) {\n        try {\n            $stmt = $this->db->prepare(\"\n                UPDATE coupons SET \n                    code = ?, name = ?, description = ?, type = ?, value = ?, \n                    minimum_amount = ?, maximum_discount = ?, usage_limit = ?, \n                    is_active = ?, start_date = ?, end_date = ?\n                WHERE id = ?\n            \");\n            \n            $stmt->execute([\n                $data['code'],\n                $data['name'],\n                $data['description'] ?? '',\n                $data['type'],\n                $data['value'],\n                $data['minimum_amount'] ?? 0,\n                $data['maximum_discount'] ?? null,\n                $data['usage_limit'] ?? null,\n                $data['is_active'] ?? true,\n                $data['start_date'] ?? null,\n                $data['end_date'] ?? null,\n                $coupon_id\n            ]);\n            \n            return ['success' => true, 'message' => 'Coupon updated successfully'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to update coupon: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Delete coupon\n     */\n    public function deleteCoupon($coupon_id) {\n        try {\n            $stmt = $this->db->prepare(\"DELETE FROM coupons WHERE id = ?\");\n            $stmt->execute([$coupon_id]);\n            \n            return ['success' => true, 'message' => 'Coupon deleted successfully'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to delete coupon: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Add products to a coupon\n     */\n    public function addProductsToCoupon($coupon_id, $product_ids) {\n        try {\n            // Remove existing associations\n            $stmt = $this->db->prepare(\"DELETE FROM coupon_products WHERE coupon_id = ?\");\n            $stmt->execute([$coupon_id]);\n            \n            // Add new associations\n            $stmt = $this->db->prepare(\"INSERT INTO coupon_products (coupon_id, product_id) VALUES (?, ?)\");\n            foreach ($product_ids as $product_id) {\n                $stmt->execute([$coupon_id, $product_id]);\n            }\n            \n            return ['success' => true];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to add products to coupon: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Get products associated with a coupon\n     */\n    public function getCouponProducts($coupon_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.* FROM products p\n                JOIN coupon_products cp ON p.id = cp.product_id\n                WHERE cp.coupon_id = ?\n            \");\n            $stmt->execute([$coupon_id]);\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n}\n?>\n","size_bytes":11485},"includes/order.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass OrderManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function create_order($user_id, $cart_items, $shipping_address, $billing_address, $payment_method, $coupon_code = null, $transaction_id = null) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Calculate totals\n            $subtotal = 0;\n            foreach ($cart_items as $item) {\n                $subtotal += $item['current_price'] * $item['quantity'];\n            }\n            \n            $discount_amount = 0;\n            $coupon_id = null;\n            \n            // Apply coupon if provided\n            if ($coupon_code) {\n                $coupon_result = $this->apply_coupon($coupon_code, $subtotal);\n                if ($coupon_result['success']) {\n                    $discount_amount = $coupon_result['discount'];\n                    $coupon_id = $coupon_result['coupon_id'];\n                }\n            }\n            \n            $tax_amount = ($subtotal - $discount_amount) * 0.08; // 8% tax\n            $shipping_amount = 0; // Free shipping\n            $total_amount = $subtotal + $tax_amount + $shipping_amount - $discount_amount;\n            \n            // Generate order number\n            $order_number = 'ORD-' . date('Y') . '-' . str_pad(rand(1, 999999), 6, '0', STR_PAD_LEFT);\n            \n            // Set order and payment status based on payment method\n            if ($payment_method == 'mobile_money_cameroon') {\n                $order_status = 'pending'; // Pending admin approval\n                $payment_status = 'pending'; // Pending verification\n            } else {\n                $order_status = 'processing'; // Other payments process immediately\n                $payment_status = 'paid';\n            }\n            \n            // Create order\n            $stmt = $this->db->prepare(\"\n                INSERT INTO orders (user_id, order_number, total_amount, tax_amount, shipping_amount, discount_amount, shipping_address, billing_address, status, payment_status) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n            \");\n            \n            $stmt->execute([\n                $user_id, $order_number, $total_amount, $tax_amount, \n                $shipping_amount, $discount_amount, $shipping_address, $billing_address, $order_status, $payment_status\n            ]);\n            \n            $order_id = $this->db->lastInsertId();\n            \n            // Create order items and commission transactions\n            foreach ($cart_items as $item) {\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO order_items (order_id, product_id, vendor_id, quantity, price, total) \n                    VALUES (?, ?, ?, ?, ?, ?)\n                \");\n                \n                $item_total = $item['current_price'] * $item['quantity'];\n                \n                // Get vendor_id from product\n                $stmt2 = $this->db->prepare(\"SELECT vendor_id FROM products WHERE id = ?\");\n                $stmt2->execute([$item['product_id']]);\n                $vendor_id = $stmt2->fetch(PDO::FETCH_ASSOC)['vendor_id'];\n                \n                $stmt->execute([\n                    $order_id, $item['product_id'], $vendor_id, \n                    $item['quantity'], $item['current_price'], $item_total\n                ]);\n                \n                $order_item_id = $this->db->lastInsertId();\n                \n                // Create commission transaction using rate at time of order\n                $this->create_commission_transaction($order_id, $order_item_id, $vendor_id, $item['product_id'], $item_total);\n                \n                // Update product stock\n                $stmt = $this->db->prepare(\"UPDATE products SET stock_quantity = stock_quantity - ? WHERE id = ?\");\n                $stmt->execute([$item['quantity'], $item['product_id']]);\n            }\n            \n            // Create payment record\n            if ($payment_method == 'mobile_money_cameroon') {\n                // For mobile money, store transaction ID and set pending status\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO payments (order_id, user_id, amount, payment_method, status, transaction_reference) \n                    VALUES (?, ?, ?, ?, 'pending', ?)\n                \");\n                $stmt->execute([$order_id, $user_id, $total_amount, $payment_method, $transaction_id]);\n                \n                // Keep order status as pending for admin approval\n            } else {\n                // For other payment methods, mark as completed\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO payments (order_id, user_id, amount, payment_method, status) \n                    VALUES (?, ?, ?, ?, 'paid')\n                \");\n                $stmt->execute([$order_id, $user_id, $total_amount, $payment_method]);\n                \n                // Update order payment status (already set correctly in order creation above)\n            }\n            \n            // Update coupon usage if applied\n            if ($coupon_id) {\n                $stmt = $this->db->prepare(\"UPDATE coupons SET used_count = used_count + 1 WHERE id = ?\");\n                $stmt->execute([$coupon_id]);\n            }\n            \n            // Create shipment record\n            $tracking_number = 'TRK-' . date('Ymd') . '-' . str_pad(rand(1, 99999), 5, '0', STR_PAD_LEFT);\n            \n            if ($payment_method == 'mobile_money_cameroon') {\n                // For mobile money, shipment is pending admin approval\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO shipments (order_id, tracking_number, carrier, status) \n                    VALUES (?, ?, 'Standard Shipping', 'pending_approval')\n                \");\n                $stmt->execute([$order_id, $tracking_number]);\n                \n                $shipment_id = $this->db->lastInsertId();\n                \n                // Add initial tracking history for pending payment\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO tracking_history (shipment_id, status, description) \n                    VALUES (?, 'Payment Verification', 'Order placed. Awaiting mobile money payment verification by admin.')\n                \");\n                $stmt->execute([$shipment_id]);\n            } else {\n                // For other payment methods, normal processing\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO shipments (order_id, tracking_number, carrier, status) \n                    VALUES (?, ?, 'Standard Shipping', 'pending')\n                \");\n                $stmt->execute([$order_id, $tracking_number]);\n                \n                $shipment_id = $this->db->lastInsertId();\n                \n                // Add initial tracking history\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO tracking_history (shipment_id, status, description) \n                    VALUES (?, 'Order Placed', 'Your order has been placed and is being processed')\n                \");\n                $stmt->execute([$shipment_id]);\n            }\n            \n            // Clear cart\n            $stmt = $this->db->prepare(\"DELETE FROM cart WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            \n            $this->db->commit();\n            \n            return [\n                'success' => true, \n                'message' => 'Order placed successfully',\n                'order_id' => $order_id,\n                'order_number' => $order_number,\n                'tracking_number' => $tracking_number\n            ];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Order failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_order_by_id($order_id, $user_id = null) {\n        try {\n            $where_clause = \"o.id = ?\";\n            $params = [$order_id];\n            \n            if ($user_id) {\n                $where_clause .= \" AND o.user_id = ?\";\n                $params[] = $user_id;\n            }\n            \n            $stmt = $this->db->prepare(\"\n                SELECT o.*, u.first_name, u.last_name, u.email, s.tracking_number, s.status as shipment_status\n                FROM orders o\n                JOIN users u ON o.user_id = u.id\n                LEFT JOIN shipments s ON o.id = s.order_id\n                WHERE $where_clause\n            \");\n            \n            $stmt->execute($params);\n            $order = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($order) {\n                // Get order items\n                $stmt = $this->db->prepare(\"\n                    SELECT oi.*, p.name, p.images, v.business_name\n                    FROM order_items oi\n                    JOIN products p ON oi.product_id = p.id\n                    JOIN vendors v ON oi.vendor_id = v.id\n                    WHERE oi.order_id = ?\n                \");\n                $stmt->execute([$order_id]);\n                $order['items'] = $stmt->fetchAll(PDO::FETCH_ASSOC);\n                \n                // Decode images for each item\n                foreach ($order['items'] as &$item) {\n                    $item['images'] = json_decode($item['images'], true) ?: [];\n                }\n            }\n            \n            return $order;\n            \n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function get_user_orders($user_id, $limit = 20, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT o.*, s.tracking_number, s.status as shipment_status\n                FROM orders o\n                LEFT JOIN shipments s ON o.id = s.order_id\n                WHERE o.user_id = ?\n                ORDER BY o.created_at DESC\n                LIMIT ? OFFSET ?\n            \");\n            \n            $stmt->execute([$user_id, $limit, $offset]);\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_vendor_orders($vendor_id, $limit = 20, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT DISTINCT o.*, u.first_name, u.last_name, s.tracking_number, s.status as shipment_status\n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                JOIN users u ON o.user_id = u.id\n                LEFT JOIN shipments s ON o.id = s.order_id\n                WHERE oi.vendor_id = ?\n                ORDER BY o.created_at DESC\n                LIMIT ? OFFSET ?\n            \");\n            \n            $stmt->execute([$vendor_id, $limit, $offset]);\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function update_order_status($order_id, $status) {\n        try {\n            $stmt = $this->db->prepare(\"UPDATE orders SET status = ?, updated_at = ? WHERE id = ?\");\n            $stmt->execute([$status, date('Y-m-d H:i:s'), $order_id]);\n            \n            return ['success' => true, 'message' => 'Order status updated'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to update order status'];\n        }\n    }\n    \n    private function apply_coupon($coupon_code, $subtotal) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM coupons \n                WHERE code = ? AND is_active = 1 \n                AND (expires_at IS NULL OR expires_at > ?)\n                AND (usage_limit IS NULL OR used_count < usage_limit)\n                AND minimum_amount <= ?\n            \");\n            \n            $stmt->execute([$coupon_code, $subtotal, date('Y-m-d H:i:s')]);\n            $coupon = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$coupon) {\n                return ['success' => false, 'message' => 'Invalid or expired coupon'];\n            }\n            \n            $discount = 0;\n            if ($coupon['type'] === 'percentage') {\n                $discount = ($subtotal * $coupon['value']) / 100;\n            } else {\n                $discount = $coupon['value'];\n            }\n            \n            return [\n                'success' => true,\n                'discount' => $discount,\n                'coupon_id' => $coupon['id']\n            ];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Coupon validation failed'];\n        }\n    }\n    \n    public function validate_coupon($coupon_code, $subtotal) {\n        return $this->apply_coupon($coupon_code, $subtotal);\n    }\n    \n    // Additional vendor-specific methods needed by dashboards\n    public function getVendorOrderCount($vendor_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT COUNT(DISTINCT o.id) as count \n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                WHERE oi.vendor_id = ?\n            \");\n            $stmt->execute([$vendor_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['count'];\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function getVendorEarnings($vendor_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT SUM(oi.total) as earnings \n                FROM order_items oi\n                JOIN orders o ON oi.order_id = o.id\n                WHERE oi.vendor_id = ? AND o.status != 'cancelled'\n            \");\n            $stmt->execute([$vendor_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['earnings'] ?: 0;\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function getVendorPendingOrders($vendor_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT DISTINCT o.*, u.first_name, u.last_name, s.tracking_number, s.status as shipment_status\n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                JOIN users u ON o.user_id = u.id\n                LEFT JOIN shipments s ON o.id = s.order_id\n                WHERE oi.vendor_id = ? AND o.status = 'pending'\n                ORDER BY o.created_at DESC\n            \");\n            $stmt->execute([$vendor_id]);\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function getVendorOrders($vendor_id, $limit = 20, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT DISTINCT o.*, u.first_name, u.last_name, s.tracking_number, s.status as shipment_status,\n                       COUNT(oi.id) as item_count\n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                JOIN users u ON o.user_id = u.id\n                LEFT JOIN shipments s ON o.id = s.order_id\n                WHERE oi.vendor_id = ?\n                GROUP BY o.id\n                ORDER BY o.created_at DESC\n                LIMIT ? OFFSET ?\n            \");\n            $stmt->execute([$vendor_id, $limit, $offset]);\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function getUserOrders($user_id, $limit = 20, $offset = 0) {\n        return $this->get_user_orders($user_id, $limit, $offset);\n    }\n    \n    public function getUserOrderCount($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT COUNT(*) as count FROM orders WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['count'];\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function getUserTotalSpent($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT SUM(total_amount) as total FROM orders WHERE user_id = ? AND status != 'cancelled'\");\n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['total'] ?: 0;\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function get_all_pending_orders() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT DISTINCT o.*, u.first_name, u.last_name, u.email as customer_email,\n                       v.business_name as vendor_name, v.id as vendor_id,\n                       GROUP_CONCAT(p.name, ', ') as products\n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                JOIN users u ON o.user_id = u.id\n                JOIN vendors v ON oi.vendor_id = v.id\n                JOIN products p ON oi.product_id = p.id\n                WHERE o.status = 'pending'\n                GROUP BY o.id, v.id\n                ORDER BY o.created_at DESC\n            \");\n            $stmt->execute();\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function notify_vendor_delivery($order_id, $vendor_id, $admin_id) {\n        try {\n            // Get order details\n            $stmt = $this->db->prepare(\"\n                SELECT o.*, v.business_name, vu.email as vendor_email, vu.id as vendor_user_id\n                FROM orders o\n                JOIN order_items oi ON o.id = oi.order_id\n                JOIN vendors v ON oi.vendor_id = v.id\n                JOIN users vu ON v.user_id = vu.id\n                WHERE o.id = ? AND oi.vendor_id = ?\n                LIMIT 1\n            \");\n            $stmt->execute([$order_id, $vendor_id]);\n            $order = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$order) {\n                return ['success' => false, 'message' => 'Order or vendor not found'];\n            }\n            \n            // Send notification to vendor\n            $title = \"Urgent: Complete Delivery for Order #{$order['order_number']}\";\n            $message = \"Please complete the delivery for order #{$order['order_number']} as soon as possible. Customer is waiting for their order.\";\n            \n            $stmt = $this->db->prepare(\"\n                INSERT INTO notifications (user_id, type, title, message) \n                VALUES (?, 'delivery_reminder', ?, ?)\n            \");\n            $stmt->execute([$order['vendor_user_id'], $title, $message]);\n            \n            return ['success' => true, 'message' => \"Delivery reminder sent to {$order['business_name']}\"];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to send notification: ' . $e->getMessage()];\n        }\n    }\n    \n    public function admin_update_order_status($order_id, $status) {\n        try {\n            // Validate status\n            $allowed_statuses = ['pending', 'processing', 'shipped', 'delivered', 'cancelled'];\n            if (!in_array($status, $allowed_statuses)) {\n                return ['success' => false, 'message' => 'Invalid status value'];\n            }\n            \n            $stmt = $this->db->prepare(\"UPDATE orders SET status = ?, updated_at = ? WHERE id = ?\");\n            $stmt->execute([$status, date('Y-m-d H:i:s'), $order_id]);\n            \n            return ['success' => true, 'message' => 'Order status updated successfully'];\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to update order status: ' . $e->getMessage()];\n        }\n    }\n    \n    /**\n     * Create commission transaction for vendor using rate at time of sale\n     * This ensures historical accuracy of commission tracking\n     */\n    private function create_commission_transaction($order_id, $order_item_id, $vendor_id, $product_id, $sale_amount) {\n        try {\n            // Get current active commission rate for vendor\n            $stmt = $this->db->prepare(\"\n                SELECT commission_rate \n                FROM vendor_commissions \n                WHERE vendor_id = ? AND is_active = 1 \n                ORDER BY effective_date DESC \n                LIMIT 1\n            \");\n            $stmt->execute([$vendor_id]);\n            $commission_data = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            // If no commission rate exists, create default 10% rate\n            if (!$commission_data) {\n                $default_rate = 10.00;\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO vendor_commissions (vendor_id, commission_rate, effective_date, is_active, notes) \n                    VALUES (?, ?, CURRENT_TIMESTAMP, 1, 'Default commission rate auto-created')\n                \");\n                $stmt->execute([$vendor_id, $default_rate]);\n                $commission_rate = $default_rate;\n            } else {\n                $commission_rate = $commission_data['commission_rate'];\n            }\n            \n            // Calculate commission amount\n            $commission_amount = ($sale_amount * $commission_rate) / 100;\n            \n            // Determine commission status based on order payment status\n            $stmt = $this->db->prepare(\"SELECT payment_status FROM orders WHERE id = ?\");\n            $stmt->execute([$order_id]);\n            $order = $stmt->fetch(PDO::FETCH_ASSOC);\n            $commission_status = ($order['payment_status'] === 'paid') ? 'pending' : 'pending';\n            \n            // Create commission transaction with historical rate\n            $stmt = $this->db->prepare(\"\n                INSERT INTO commission_transactions \n                (order_id, vendor_id, order_item_id, product_id, sale_amount, commission_rate, commission_amount, status) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n            \");\n            \n            $stmt->execute([\n                $order_id, \n                $vendor_id, \n                $order_item_id, \n                $product_id, \n                $sale_amount, \n                $commission_rate, \n                $commission_amount, \n                $commission_status\n            ]);\n            \n            return true;\n            \n        } catch (PDOException $e) {\n            // Log error but don't break order processing\n            error_log(\"Failed to create commission transaction: \" . $e->getMessage());\n            return false;\n        }\n    }\n    \n    /**\n     * Ensure vendor has active commission rate, create default if needed\n     */\n    public function ensure_vendor_commission_rate($vendor_id, $default_rate = 10.00) {\n        try {\n            // Check if vendor has active commission rate\n            $stmt = $this->db->prepare(\"\n                SELECT id FROM vendor_commissions \n                WHERE vendor_id = ? AND is_active = 1\n            \");\n            $stmt->execute([$vendor_id]);\n            \n            if (!$stmt->fetch()) {\n                // Create default commission rate\n                $stmt = $this->db->prepare(\"\n                    INSERT INTO vendor_commissions (vendor_id, commission_rate, effective_date, is_active, notes) \n                    VALUES (?, ?, CURRENT_TIMESTAMP, 1, 'Default commission rate created')\n                \");\n                $stmt->execute([$vendor_id, $default_rate]);\n                return ['success' => true, 'message' => \"Default {$default_rate}% commission rate created\"];\n            }\n            \n            return ['success' => true, 'message' => 'Commission rate already exists'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to ensure commission rate: ' . $e->getMessage()];\n        }\n    }\n}\n?>\n","size_bytes":24050},"includes/product.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nclass ProductManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function add_product($vendor_id, $category_id, $name, $description, $price, $sale_price, $stock_quantity, $sku, $images, $is_featured = false, $is_flash_deal = false, $flash_deal_end = null) {\n        try {\n            $stmt = $this->db->prepare(\"\n                INSERT INTO products (vendor_id, category_id, name, description, price, sale_price, stock_quantity, sku, images, is_featured, is_flash_deal, flash_deal_end, admin_approved) \n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0)\n            \");\n            \n            $images_json = json_encode($images);\n            \n            $stmt->execute([\n                $vendor_id, $category_id, $name, $description, $price, \n                $sale_price, $stock_quantity, $sku, $images_json, \n                $is_featured, $is_flash_deal, $flash_deal_end\n            ]);\n            \n            return ['success' => true, 'message' => 'Product added successfully and is pending admin approval', 'product_id' => $this->db->lastInsertId()];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to add product: ' . $e->getMessage()];\n        }\n    }\n    \n    // Admin-specific methods for product management\n    public function get_pending_products($limit = 50, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, c.name as category_name, v.business_name, v.email as vendor_email\n                FROM products p \n                LEFT JOIN categories c ON p.category_id = c.id \n                LEFT JOIN vendors v ON p.vendor_id = v.id \n                WHERE p.admin_approved = 0 AND p.status = 'active'\n                ORDER BY p.created_at ASC\n                LIMIT ? OFFSET ?\n            \");\n            \n            $stmt->execute([$limit, $offset]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            // Decode images JSON for each product\n            foreach ($products as &$product) {\n                $product['images'] = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n            }\n            \n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function approve_product($product_id, $admin_id) {\n        try {\n            $stmt = $this->db->prepare(\"UPDATE products SET admin_approved = 1, updated_at = NOW() WHERE id = ?\");\n            $result = $stmt->execute([$product_id]);\n            \n            if ($result && $stmt->rowCount() > 0) {\n                return ['success' => true, 'message' => 'Product approved successfully'];\n            } else {\n                return ['success' => false, 'message' => 'Product not found or already approved'];\n            }\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to approve product: ' . $e->getMessage()];\n        }\n    }\n    \n    public function reject_product($product_id, $admin_id, $reason = '') {\n        try {\n            $stmt = $this->db->prepare(\"UPDATE products SET admin_approved = 0, status = 'inactive', updated_at = NOW() WHERE id = ?\");\n            $result = $stmt->execute([$product_id]);\n            \n            if ($result && $stmt->rowCount() > 0) {\n                return ['success' => true, 'message' => 'Product rejected successfully'];\n            } else {\n                return ['success' => false, 'message' => 'Product not found or already processed'];\n            }\n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to reject product: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_all_products_admin($limit = 50, $offset = 0, $filter = 'all') {\n        try {\n            $where = [];\n            switch ($filter) {\n                case 'pending':\n                    $where[] = \"admin_approved = 0 AND status = 'active'\";\n                    break;\n                case 'approved':\n                    $where[] = \"admin_approved = 1 AND status = 'active'\";\n                    break;\n                case 'rejected':\n                    $where[] = \"admin_approved = 0 AND status = 'inactive'\";\n                    break;\n                default:\n                    break;\n            }\n            $whereClause = $where ? ('WHERE ' . implode(' AND ', $where)) : '';\n            $limitInt = max(1, (int)$limit);\n            $offsetInt = max(0, (int)$offset);\n            \n            $sql = \"SELECT p.*, c.name AS category_name, v.business_name, v.email AS vendor_email\n                    FROM products p\n                    LEFT JOIN categories c ON p.category_id = c.id\n                    LEFT JOIN vendors v ON p.vendor_id = v.id\n                    $whereClause\n                    ORDER BY p.created_at DESC\n                    LIMIT $limitInt OFFSET $offsetInt\";\n            $stmt = $this->db->prepare($sql);\n            $stmt->execute();\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($products as &$product) {\n                $product['images'] = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n            }\n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n\n    public function get_all_products_admin_simple($limit = 50, $offset = 0, $filter = 'all') {\n        try {\n            $where = [];\n            switch ($filter) {\n                case 'pending':\n                    $where[] = \"p.admin_approved = 0 AND p.status = 'active'\";\n                    break;\n                case 'approved':\n                    $where[] = \"p.admin_approved = 1 AND p.status = 'active'\";\n                    break;\n                case 'rejected':\n                    $where[] = \"p.admin_approved = 0 AND p.status = 'inactive'\";\n                    break;\n                default:\n                    break;\n            }\n            $whereClause = $where ? ('WHERE ' . implode(' AND ', $where)) : '';\n            $limitInt = max(1, (int)$limit);\n            $offsetInt = max(0, (int)$offset);\n            $sql = \"SELECT p.*, c.name AS category_name, v.business_name, v.email AS vendor_email\n                    FROM products p\n                    LEFT JOIN categories c ON p.category_id = c.id\n                    LEFT JOIN vendors v ON p.vendor_id = v.id\n                    $whereClause\n                    ORDER BY p.created_at DESC\n                    LIMIT $limitInt OFFSET $offsetInt\";\n            $stmt = $this->db->prepare($sql);\n            $stmt->execute();\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($products as &$product) {\n                $product['images'] = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n            }\n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_products($limit = 20, $offset = 0, $category_id = null, $search = null, $vendor_id = null, $featured_only = false) {\n        try {\n            $where_conditions = [\"p.status IN ('active','out_of_stock')\", \"p.admin_approved = 1\"];\n            $params = [];\n            \n            if ($category_id) {\n                $where_conditions[] = \"p.category_id = ?\";\n                $params[] = $category_id;\n            }\n            \n            if ($search) {\n                $where_conditions[] = \"(p.name LIKE ? OR p.description LIKE ?)\";\n                $params[] = \"%$search%\";\n                $params[] = \"%$search%\";\n            }\n            \n            if ($vendor_id) {\n                $where_conditions[] = \"p.vendor_id = ?\";\n                $params[] = $vendor_id;\n            }\n            \n            if ($featured_only) {\n                $where_conditions[] = \"p.is_featured = 1\";\n            }\n            \n            $where_clause = implode(\" AND \", $where_conditions);\n            \n            $limitInt = max(1, (int)$limit);\n            $offsetInt = max(0, (int)$offset);\n            \n            $sql = \"\n                SELECT \n                    p.*, \n                    c.name AS category_name, \n                    v.business_name, \n                    v.is_verified, \n                    v.verification_badge,\n                    (\n                        SELECT ROUND(AVG(r2.rating), 1) \n                        FROM reviews r2 \n                        WHERE r2.product_id = p.id\n                    ) AS avg_rating,\n                    (\n                        SELECT COUNT(r3.id) \n                        FROM reviews r3 \n                        WHERE r3.product_id = p.id\n                    ) AS review_count\n                FROM products p\n                LEFT JOIN categories c ON p.category_id = c.id\n                LEFT JOIN vendors v ON p.vendor_id = v.id\n                WHERE $where_clause\n                ORDER BY v.is_verified DESC, p.is_featured DESC, p.created_at DESC\n                LIMIT $limitInt OFFSET $offsetInt\n            \";\n            \n            $stmt = $this->db->prepare($sql);\n            $stmt->execute($params);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($products as &$product) {\n                $imgs = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $normalized = [];\n                foreach ($imgs as $img) {\n                    if (!$img) continue;\n                    if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                        $normalized[] = $img;\n                    } elseif (strpos($img, 'uploads/') === 0) {\n                        $normalized[] = $img;\n                    } else {\n                        $normalized[] = 'uploads/products/' . basename($img);\n                    }\n                }\n                $product['images'] = $normalized;\n                $product['avg_rating'] = isset($product['avg_rating']) && $product['avg_rating'] ? (float)$product['avg_rating'] : 0;\n                $product['review_count'] = isset($product['review_count']) ? (int)$product['review_count'] : 0;\n            }\n            \n            return $products;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n\n    public function get_products_simple($limit = 20, $offset = 0, $category_id = null, $search = null) {\n        try {\n            $where = [\"status IN ('active','out_of_stock')\"];\n            $params = [];\n            if ($category_id) {\n                $where[] = 'category_id = ?';\n                $params[] = $category_id;\n            }\n            if ($search) {\n                $where[] = '(name LIKE ? OR description LIKE ?)';\n                $params[] = \"%$search%\";\n                $params[] = \"%$search%\";\n            }\n            $whereClause = implode(' AND ', $where);\n            $stmt = $this->db->prepare(\"SELECT * FROM products WHERE $whereClause ORDER BY created_at DESC LIMIT ? OFFSET ?\");\n            $params[] = $limit;\n            $params[] = $offset;\n            $stmt->execute($params);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($products as &$product) {\n                $imgs = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $normalized = [];\n                foreach ($imgs as $img) {\n                    if (!$img) continue;\n                    // Keep absolute URLs as-is\n                    if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                        $normalized[] = $img;\n                        continue;\n                    }\n                    // Keep existing upload paths\n                    if (strpos($img, 'uploads/') === 0) {\n                        $normalized[] = $img;\n                        continue;\n                    }\n                    // Otherwise treat as bare filename under uploads/products\n                    $base = basename($img);\n                    $normalized[] = 'uploads/products/' . $base;\n                }\n                $product['images'] = $normalized;\n            }\n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n\n    public function get_products_by_category_minimal($category_id, $limit = 20, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT * FROM products WHERE category_id = ? AND status IN ('active','out_of_stock') ORDER BY created_at DESC LIMIT ? OFFSET ?\");\n            $stmt->execute([$category_id, $limit, $offset]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($products as &$product) {\n                $imgs = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $normalized = [];\n                foreach ($imgs as $img) {\n                    if (!$img) continue;\n                    if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                        $normalized[] = $img;\n                    } elseif (strpos($img, 'uploads/') === 0) {\n                        $normalized[] = $img;\n                    } else {\n                        $normalized[] = 'uploads/products/' . basename($img);\n                    }\n                }\n                $product['images'] = $normalized;\n            }\n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_product_by_id($product_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, c.name as category_name, v.business_name, v.is_verified, v.verification_badge, v.logo_path as vendor_logo,\n                       AVG(r.rating) as avg_rating, COUNT(r.id) as review_count\n                FROM products p \n                LEFT JOIN categories c ON p.category_id = c.id \n                LEFT JOIN vendors v ON p.vendor_id = v.id \n                LEFT JOIN reviews r ON p.id = r.product_id\n                WHERE p.id = ? AND p.status = 'active'\n                GROUP BY p.id\n            \");\n            \n            $stmt->execute([$product_id]);\n            $product = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($product) {\n                $product['images'] = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $product['avg_rating'] = $product['avg_rating'] ? round($product['avg_rating'], 1) : 0;\n            }\n            \n            return $product;\n            \n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function get_categories() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT c.*, COUNT(p.id) as product_count \n                FROM categories c \n                LEFT JOIN products p ON c.id = p.category_id AND p.status = 'active'\n                GROUP BY c.id \n                ORDER BY c.name\n            \");\n            $stmt->execute();\n            \n            $categories = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($categories as &$cat) {\n                $img = $cat['image_path'] ?? '';\n                if (!$img) {\n                    continue;\n                }\n                if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                    // keep as-is\n                } elseif (strpos($img, 'uploads/') === 0) {\n                    // already uploads path, keep\n                } else {\n                    $cat['image_path'] = 'uploads/categories/' . basename($img);\n                }\n            }\n            return $categories;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_flash_deals($limit = 10) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, c.name as category_name, v.business_name, v.is_verified,\n                       AVG(r.rating) as avg_rating, COUNT(r.id) as review_count\n                FROM products p \n                LEFT JOIN categories c ON p.category_id = c.id \n                LEFT JOIN vendors v ON p.vendor_id = v.id \n                LEFT JOIN reviews r ON p.id = r.product_id\n                WHERE p.is_flash_deal = 1 AND p.flash_deal_end > NOW() AND p.status = 'active'\n                GROUP BY p.id\n                ORDER BY p.flash_deal_end ASC\n                LIMIT ?\n            \");\n            \n            $stmt->execute([$limit]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($products as &$product) {\n                $product['images'] = json_decode($product['images'], true) ?: [];\n                $product['avg_rating'] = $product['avg_rating'] ? round($product['avg_rating'], 1) : 0;\n            }\n            \n            return $products;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function add_to_recently_viewed($user_id, $product_id) {\n        if (!$user_id) return;\n        \n        try {\n            // Remove if already exists\n            $stmt = $this->db->prepare(\"DELETE FROM recently_viewed WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            // Add new entry\n            $stmt = $this->db->prepare(\"INSERT INTO recently_viewed (user_id, product_id) VALUES (?, ?)\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            // Keep only last 10 items\n            $stmt = $this->db->prepare(\"\n                DELETE FROM recently_viewed \n                WHERE user_id = ? AND id NOT IN (\n                    SELECT id FROM (\n                        SELECT id FROM recently_viewed \n                        WHERE user_id = ? \n                        ORDER BY viewed_at DESC \n                        LIMIT 10\n                    ) as temp\n                )\n            \");\n            $stmt->execute([$user_id, $user_id]);\n            \n        } catch (PDOException $e) {\n            // Ignore errors for recently viewed\n        }\n    }\n    \n    public function get_recently_viewed($user_id, $limit = 10) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, rv.viewed_at\n                FROM recently_viewed rv\n                JOIN products p ON rv.product_id = p.id\n                WHERE rv.user_id = ? AND p.status = 'active'\n                ORDER BY rv.viewed_at DESC\n                LIMIT ?\n            \");\n            \n            $stmt->execute([$user_id, $limit]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($products as &$product) {\n                $product['images'] = json_decode($product['images'], true) ?: [];\n            }\n            \n            return $products;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function add_review($user_id, $product_id, $order_id, $rating, $title, $comment) {\n        try {\n            // Check if user is admin\n            $stmt = $this->db->prepare(\"SELECT role FROM user_roles WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            $user_role = $stmt->fetch(PDO::FETCH_ASSOC);\n            $is_admin = ($user_role && $user_role['role'] === 'admin');\n            \n            // Set verified purchase status (admin reviews are not verified purchases)\n            $is_verified = $is_admin ? false : true;\n            \n            $stmt = $this->db->prepare(\"\n                INSERT INTO reviews (user_id, product_id, order_id, rating, title, comment, is_verified_purchase) \n                VALUES (?, ?, ?, ?, ?, ?, ?)\n            \");\n            \n            // Use NULL for admin reviews instead of 0\n            $review_order_id = $is_admin ? null : $order_id;\n            $stmt->execute([$user_id, $product_id, $review_order_id, $rating, $title, $comment, $is_verified]);\n            \n            return ['success' => true, 'message' => 'Review added successfully'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to add review: ' . $e->getMessage()];\n        }\n    }\n    \n    public function getFeaturedProducts($limit = 10) {\n        return $this->get_products($limit, 0, null, null, null, true);\n    }\n    \n    public function getCategories() {\n        return $this->get_categories();\n    }\n    \n    public function getFlashDeals($limit = 10) {\n        return $this->get_flash_deals($limit);\n    }\n    \n    public function get_product_reviews($product_id, $limit = 10, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT r.*, u.first_name, u.last_name, u.username, COALESCE(ur.role, 'customer') as role\n                FROM reviews r\n                JOIN users u ON r.user_id = u.id\n                LEFT JOIN user_roles ur ON u.id = ur.user_id\n                WHERE r.product_id = ?\n                ORDER BY r.created_at DESC\n                LIMIT ? OFFSET ?\n            \");\n            \n            $stmt->execute([$product_id, (int)$limit, (int)$offset]);\n            $results = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            return $results;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    // Additional vendor-specific methods needed by dashboards\n    public function getVendorProducts($vendor_id, $limit = 20, $offset = 0) {\n        return $this->get_products($limit, $offset, null, null, $vendor_id);\n    }\n\n    public function getVendorProductsSimple($vendor_id, $limit = 50, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\\n                SELECT p.*\\n                FROM products p\\n                WHERE p.vendor_id = ?\\n                ORDER BY p.created_at DESC\\n                LIMIT ? OFFSET ?\\n            \");\n            $stmt->execute([$vendor_id, (int)$limit, (int)$offset]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            foreach ($products as &$product) {\n                $product['images'] = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n            }\n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n\n    public function getVendorProductCount($vendor_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT COUNT(*) as count FROM products WHERE vendor_id = ?\");\n            $stmt->execute([$vendor_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return (int)($result['count'] ?? 0);\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function getVendorTopProducts($vendor_id, $limit = 5) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, SUM(oi.quantity) as total_sold,\n                       AVG(r.rating) as avg_rating, COUNT(r.id) as review_count\n                FROM products p\n                LEFT JOIN order_items oi ON p.id = oi.product_id\n                LEFT JOIN reviews r ON p.id = r.product_id\n                WHERE p.vendor_id = ? AND p.status = 'active'\n                GROUP BY p.id\n                ORDER BY total_sold DESC, p.created_at DESC\n                LIMIT ?\n            \");\n            $stmt->execute([$vendor_id, $limit]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            // Decode images for each product\n            foreach ($products as &$product) {\n                $product['images'] = json_decode($product['images'], true) ?: [];\n                $product['total_sold'] = $product['total_sold'] ?: 0;\n                $product['avg_rating'] = $product['avg_rating'] ? round($product['avg_rating'], 1) : 0;\n            }\n            \n            return $products;\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n\n    public function updateProductStatus($product_id, $status, $vendor_id) {\n        try {\n            // Ensure the product belongs to the vendor\n            $stmt = $this->db->prepare(\"UPDATE products SET status = ?, updated_at = NOW() WHERE id = ? AND vendor_id = ?\");\n            $stmt->execute([$status, $product_id, $vendor_id]);\n            return $stmt->rowCount() > 0;\n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function getWishlistCount($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT COUNT(*) as count FROM wishlist WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['count'];\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n    \n    public function hasUserPurchasedProduct($user_id, $product_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT COUNT(*) as count \n                FROM order_items oi \n                JOIN orders o ON oi.order_id = o.id \n                WHERE o.user_id = ? AND oi.product_id = ? AND o.status = 'completed'\n            \");\n            $stmt->execute([$user_id, $product_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['count'] > 0;\n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function getUserOrdersForProduct($user_id, $product_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT o.id, o.order_number, o.created_at, oi.quantity, oi.price\n                FROM order_items oi \n                JOIN orders o ON oi.order_id = o.id \n                WHERE o.user_id = ? AND oi.product_id = ? AND o.status = 'completed'\n                ORDER BY o.created_at DESC\n            \");\n            $stmt->execute([$user_id, $product_id]);\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    // CamelCase method aliases for compatibility\n    public function addProduct($data) {\n        return $this->add_product(\n            $data['vendor_id'],\n            $data['category_id'],\n            $data['name'],\n            $data['description'],\n            $data['price'],\n            $data['sale_price'] ?? null,\n            $data['stock_quantity'],\n            $data['sku'] ?? null,\n            $data['images'] ?? [],\n            $data['is_featured'] ?? false,\n            $data['is_flash_deal'] ?? false,\n            $data['flash_deal_end'] ?? null\n        );\n    }\n    \n    public function getProducts($limit = 20, $offset = 0, $category_id = null, $search = null, $vendor_id = null, $featured_only = false) {\n        return $this->get_products($limit, $offset, $category_id, $search, $vendor_id, $featured_only);\n    }\n    \n    public function getProductById($product_id) {\n        return $this->get_product_by_id($product_id);\n    }\n\n    // Preview method for admin/vendor dashboards (shows all products regardless of approval)\n    public function get_products_preview($limit = 20, $offset = 0, $category_id = null, $search = null, $vendor_id = null, $featured_only = false) {\n        try {\n            $where_conditions = [\"p.status IN ('active','out_of_stock')\"];\n            $params = [];\n            \n            if ($category_id) {\n                $where_conditions[] = \"p.category_id = ?\";\n                $params[] = $category_id;\n            }\n            \n            if ($search) {\n                $where_conditions[] = \"(p.name LIKE ? OR p.description LIKE ?)\";\n                $params[] = \"%$search%\";\n                $params[] = \"%$search%\";\n            }\n            \n            if ($vendor_id) {\n                $where_conditions[] = \"p.vendor_id = ?\";\n                $params[] = $vendor_id;\n            }\n            \n            if ($featured_only) {\n                $where_conditions[] = \"p.is_featured = 1\";\n            }\n            \n            $where_clause = implode(\" AND \", $where_conditions);\n            \n            $limitInt = max(1, (int)$limit);\n            $offsetInt = max(0, (int)$offset);\n            \n            $sql = \"\n                SELECT \n                    p.*, \n                    c.name AS category_name, \n                    v.business_name, \n                    v.is_verified, \n                    v.verification_badge,\n                    (\n                        SELECT ROUND(AVG(r2.rating), 1) \n                        FROM reviews r2 \n                        WHERE r2.product_id = p.id\n                    ) AS avg_rating,\n                    (\n                        SELECT COUNT(r3.id) \n                        FROM reviews r3 \n                        WHERE r3.product_id = p.id\n                    ) AS review_count\n                FROM products p\n                LEFT JOIN categories c ON p.category_id = c.id\n                LEFT JOIN vendors v ON p.vendor_id = v.id\n                WHERE $where_clause\n                ORDER BY p.admin_approved DESC, v.is_verified DESC, p.is_featured DESC, p.created_at DESC\n                LIMIT $limitInt OFFSET $offsetInt\n            \";\n            \n            $stmt = $this->db->prepare($sql);\n            $stmt->execute($params);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($products as &$product) {\n                $imgs = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $normalized = [];\n                foreach ($imgs as $img) {\n                    if (!$img) continue;\n                    if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                        $normalized[] = $img;\n                    } elseif (strpos($img, 'uploads/') === 0) {\n                        $normalized[] = $img;\n                    } else {\n                        $normalized[] = 'uploads/products/' . basename($img);\n                    }\n                }\n                $product['images'] = $normalized;\n                $product['avg_rating'] = isset($product['avg_rating']) && $product['avg_rating'] ? (float)$product['avg_rating'] : 0;\n                $product['review_count'] = isset($product['review_count']) ? (int)$product['review_count'] : 0;\n            }\n            \n            return $products;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n}\n?>\n","size_bytes":30614},"includes/settings.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\nclass SettingsManager {\n    private $db;\n    private $settings_cache = [];\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n        $this->loadSettings();\n    }\n    \n    private function loadSettings() {\n        try {\n            $stmt = $this->db->prepare(\"SELECT setting_key, setting_value FROM settings\");\n            $stmt->execute();\n            $settings = $stmt->fetchAll(PDO::FETCH_KEY_PAIR);\n            $this->settings_cache = $settings;\n        } catch (PDOException $e) {\n            $this->settings_cache = [];\n        }\n    }\n    \n    public function get($key, $default = null) {\n        return $this->settings_cache[$key] ?? $default;\n    }\n    \n    public function set($key, $value, $type = 'text', $description = '') {\n        try {\n            $stmt = $this->db->prepare(\"\n                INSERT INTO settings (setting_key, setting_value, setting_type, description) \n                VALUES (?, ?, ?, ?) \n                ON DUPLICATE KEY UPDATE \n                setting_value = VALUES(setting_value),\n                setting_type = VALUES(setting_type),\n                description = VALUES(description)\n            \");\n            $stmt->execute([$key, $value, $type, $description]);\n            $this->settings_cache[$key] = $value;\n            return true;\n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function getAll() {\n        try {\n            $stmt = $this->db->prepare(\"SELECT * FROM settings ORDER BY setting_key\");\n            $stmt->execute();\n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function getSiteName() {\n        return $this->get('site_name', 'Market Nest');\n    }\n    \n    public function getSiteDescription() {\n        return $this->get('site_description', 'Your Premier Marketplace Destination');\n    }\n    \n    public function getAdminEmail() {\n        return $this->get('admin_email', 'admin@marketnest.com');\n    }\n    \n    public function getSupportEmail() {\n        return $this->get('support_email', 'support@marketnest.com');\n    }\n    \n    public function isMaintenanceMode() {\n        return $this->get('maintenance_mode', '0') === '1';\n    }\n    \n    public function getMaintenanceMessage() {\n        return $this->get('maintenance_message', 'We are currently performing maintenance. Please check back later.');\n    }\n    \n    public function refreshCache() {\n        $this->loadSettings();\n    }\n}\n?>\n\n","size_bytes":2637},"includes/tracking.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass TrackingManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function get_shipment_by_tracking($tracking_number, $user_id = null) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT s.*, o.order_number, o.user_id, o.total_amount,\n                       u.first_name, u.last_name, u.free_trackings_used\n                FROM shipments s\n                JOIN orders o ON s.order_id = o.id\n                JOIN users u ON o.user_id = u.id\n                WHERE s.tracking_number = ?\n            \");\n            \n            $stmt->execute([$tracking_number]);\n            $shipment = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($shipment) {\n                // Get tracking history\n                $stmt = $this->db->prepare(\"\n                    SELECT * FROM tracking_history \n                    WHERE shipment_id = ? \n                    ORDER BY timestamp ASC\n                \");\n                $stmt->execute([$shipment['id']]);\n                $shipment['history'] = $stmt->fetchAll(PDO::FETCH_ASSOC);\n                \n                // Determine tracking level based on user and payment\n                $shipment['tracking_level'] = $this->get_tracking_level($shipment, $user_id);\n            }\n            \n            return $shipment;\n            \n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function get_tracking_level($shipment, $user_id = null) {\n        // If user is not logged in, only basic tracking\n        if (!$user_id) {\n            return 'basic';\n        }\n        \n        // If it's the shipment owner, check their free tracking usage\n        if ($user_id == $shipment['user_id']) {\n            if ($shipment['free_trackings_used'] < FREE_TRACKING_LIMIT) {\n                return 'basic';\n            }\n        }\n        \n        // Check if user has paid for advanced tracking for this shipment\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT tracking_level FROM tracking_payments \n                WHERE user_id = ? AND shipment_id = ? AND status = 'completed'\n                ORDER BY created_at DESC LIMIT 1\n            \");\n            $stmt->execute([$user_id, $shipment['id']]);\n            $payment = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($payment) {\n                return $payment['tracking_level'];\n            }\n            \n            return 'basic';\n            \n        } catch (PDOException $e) {\n            return 'basic';\n        }\n    }\n    \n    public function increment_free_tracking_usage($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                UPDATE users \n                SET free_trackings_used = free_trackings_used + 1 \n                WHERE id = ?\n            \");\n            $stmt->execute([$user_id]);\n            \n        } catch (PDOException $e) {\n            // Ignore errors\n        }\n    }\n    \n    public function purchase_advanced_tracking($user_id, $shipment_id, $tracking_level, $amount) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Create tracking payment record\n            $stmt = $this->db->prepare(\"\n                INSERT INTO tracking_payments (user_id, shipment_id, tracking_level, amount, status) \n                VALUES (?, ?, ?, ?, 'completed')\n            \");\n            $stmt->execute([$user_id, $shipment_id, $tracking_level, $amount]);\n            \n            $this->db->commit();\n            \n            return ['success' => true, 'message' => 'Advanced tracking purchased successfully'];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Payment failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function update_shipment_status($shipment_id, $status, $location = null, $description = null) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Update shipment (compatible with both MySQL and SQLite)\n            $stmt = $this->db->prepare(\"\n                UPDATE shipments \n                SET status = ?, current_location = ?, updated_at = CURRENT_TIMESTAMP \n                WHERE id = ?\n            \");\n            $stmt->execute([$status, $location, $shipment_id]);\n            \n            // Add tracking history\n            $stmt = $this->db->prepare(\"\n                INSERT INTO tracking_history (shipment_id, status, location, description) \n                VALUES (?, ?, ?, ?)\n            \");\n            $stmt->execute([$shipment_id, $status, $location, $description]);\n            \n            // Update order status if delivered\n            if ($status === 'delivered') {\n                $stmt = $this->db->prepare(\"\n                    UPDATE orders o\n                    JOIN shipments s ON o.id = s.order_id\n                    SET o.status = 'delivered'\n                    WHERE s.id = ?\n                \");\n                $stmt->execute([$shipment_id]);\n                \n                $stmt = $this->db->prepare(\"\n                    UPDATE shipments \n                    SET delivered_at = CURRENT_TIMESTAMP \n                    WHERE id = ?\n                \");\n                $stmt->execute([$shipment_id]);\n            }\n            \n            $this->db->commit();\n            \n            return ['success' => true, 'message' => 'Shipment status updated'];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Update failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_all_shipments($limit = 50, $offset = 0) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT s.*, o.order_number, u.first_name, u.last_name\n                FROM shipments s\n                JOIN orders o ON s.order_id = o.id\n                JOIN users u ON o.user_id = u.id\n                ORDER BY s.created_at DESC\n                LIMIT ? OFFSET ?\n            \");\n            \n            $stmt->execute([$limit, $offset]);\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_tracking_progress_percentage($status) {\n        $progress_map = [\n            'pending' => 10,\n            'picked_up' => 25,\n            'in_transit' => 50,\n            'out_for_delivery' => 75,\n            'delivered' => 100\n        ];\n        \n        return $progress_map[$status] ?? 0;\n    }\n}\n\n// Note: tracking_payments table should be created through the main schema initialization\n?>\n","size_bytes":6847},"includes/vendor.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass VendorManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function submit_application($name, $email, $business_name, $description, $logo_path = null) {\n        try {\n            // Check if email already has an application\n            $stmt = $this->db->prepare(\"SELECT id FROM vendor_applications WHERE email = ? AND status = 'pending'\");\n            $stmt->execute([$email]);\n            \n            if ($stmt->rowCount() > 0) {\n                return ['success' => false, 'message' => 'You already have a pending application'];\n            }\n            \n            // Check if email is already a vendor\n            $stmt = $this->db->prepare(\"\n                SELECT v.id FROM vendors v \n                JOIN users u ON v.user_id = u.id \n                WHERE u.email = ?\n            \");\n            $stmt->execute([$email]);\n            \n            if ($stmt->rowCount() > 0) {\n                return ['success' => false, 'message' => 'This email is already associated with a vendor account'];\n            }\n            \n            // Insert application\n            $stmt = $this->db->prepare(\"\n                INSERT INTO vendor_applications (name, email, business_name, description, logo_path) \n                VALUES (?, ?, ?, ?, ?)\n            \");\n            \n            $stmt->execute([$name, $email, $business_name, $description, $logo_path]);\n            \n            return ['success' => true, 'message' => 'Application submitted successfully! We will review it within 24-48 hours.'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Application failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_pending_applications() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT * FROM vendor_applications \n                WHERE status = 'pending' \n                ORDER BY applied_at DESC\n            \");\n            $stmt->execute();\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function get_all_applications() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT va.*, u.username as reviewed_by_username \n                FROM vendor_applications va \n                LEFT JOIN users u ON va.reviewed_by = u.id \n                ORDER BY va.applied_at DESC\n            \");\n            $stmt->execute();\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function approve_application($application_id, $admin_id) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Get application details\n            $stmt = $this->db->prepare(\"SELECT * FROM vendor_applications WHERE id = ?\");\n            $stmt->execute([$application_id]);\n            $application = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$application) {\n                throw new Exception('Application not found');\n            }\n            \n            // Create user account for vendor\n            $username = $this->generate_unique_username($application['business_name']);\n            $temp_password = bin2hex(random_bytes(8));\n            $hashed_password = password_hash($temp_password, PASSWORD_DEFAULT);\n            \n            $stmt = $this->db->prepare(\"\n                INSERT INTO users (username, email, password, first_name, last_name) \n                VALUES (?, ?, ?, ?, ?)\n            \");\n            $stmt->execute([\n                $username, \n                $application['email'], \n                $hashed_password, \n                $application['name'], \n                'Vendor'\n            ]);\n            \n            $user_id = $this->db->lastInsertId();\n            \n            // Add vendor role\n            $stmt = $this->db->prepare(\"INSERT INTO user_roles (user_id, role) VALUES (?, 'vendor')\");\n            $stmt->execute([$user_id]);\n            \n            // Create vendor record\n            $stmt = $this->db->prepare(\"\n                INSERT INTO vendors (user_id, business_name, description, logo_path) \n                VALUES (?, ?, ?, ?)\n            \");\n            $stmt->execute([\n                $user_id, \n                $application['business_name'], \n                $application['description'], \n                $application['logo_path']\n            ]);\n            \n            // Update application status\n            $stmt = $this->db->prepare(\"\n                UPDATE vendor_applications \n                SET status = 'approved', reviewed_at = NOW(), reviewed_by = ? \n                WHERE id = ?\n            \");\n            $stmt->execute([$admin_id, $application_id]);\n            \n            // Send notification to vendor\n            $this->send_notification($user_id, 'vendor_approved', 'Vendor Application Approved', \n                \"Congratulations! Your vendor application has been approved. Your login credentials: Username: {$username}, Temporary Password: {$temp_password}. Please change your password after first login.\");\n            \n            $this->db->commit();\n            \n            return ['success' => true, 'message' => 'Vendor application approved successfully', 'credentials' => ['username' => $username, 'password' => $temp_password]];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Approval failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function reject_application($application_id, $admin_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                UPDATE vendor_applications \n                SET status = 'rejected', reviewed_at = NOW(), reviewed_by = ? \n                WHERE id = ?\n            \");\n            $stmt->execute([$admin_id, $application_id]);\n            \n            return ['success' => true, 'message' => 'Application rejected'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Rejection failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function assign_badge($vendor_id, $badge_name) {\n        try {\n            $stmt = $this->db->prepare(\"\n                UPDATE vendors \n                SET verification_badge = ?, is_verified = TRUE \n                WHERE id = ?\n            \");\n            $stmt->execute([$badge_name, $vendor_id]);\n            \n            return ['success' => true, 'message' => 'Badge assigned successfully'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Badge assignment failed: ' . $e->getMessage()];\n        }\n    }\n    \n    public function get_all_vendors() {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT v.*, u.username, u.email, u.first_name, u.last_name \n                FROM vendors v \n                JOIN users u ON v.user_id = u.id \n                ORDER BY v.is_verified DESC, v.created_at DESC\n            \");\n            $stmt->execute();\n            \n            return $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function create_vendor_directly($name, $email, $business_name, $description) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Check if email already exists\n            $stmt = $this->db->prepare(\"SELECT id FROM users WHERE email = ?\");\n            $stmt->execute([$email]);\n            \n            if ($stmt->rowCount() > 0) {\n                throw new Exception('User with this email already exists');\n            }\n            \n            // Create user account for vendor\n            $username = $this->generate_unique_username($business_name);\n            $temp_password = bin2hex(random_bytes(8));\n            $hashed_password = password_hash($temp_password, PASSWORD_DEFAULT);\n            \n            $stmt = $this->db->prepare(\"\n                INSERT INTO users (username, email, password, first_name, last_name) \n                VALUES (?, ?, ?, ?, ?)\n            \");\n            $stmt->execute([\n                $username, \n                $email, \n                $hashed_password, \n                $name, \n                'Vendor'\n            ]);\n            \n            $user_id = $this->db->lastInsertId();\n            \n            // Add vendor role\n            $stmt = $this->db->prepare(\"INSERT INTO user_roles (user_id, role) VALUES (?, 'vendor')\");\n            $stmt->execute([$user_id]);\n            \n            // Create vendor record\n            $stmt = $this->db->prepare(\"\n                INSERT INTO vendors (user_id, business_name, description) \n                VALUES (?, ?, ?)\n            \");\n            $stmt->execute([\n                $user_id, \n                $business_name, \n                $description\n            ]);\n            \n            $this->db->commit();\n            \n            return ['success' => true, 'message' => \"Vendor '{$business_name}' created successfully. Login: {$username} / {$temp_password}\"];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Failed to create vendor: ' . $e->getMessage()];\n        }\n    }\n    \n    public function delete_vendor($vendor_id) {\n        try {\n            $this->db->beginTransaction();\n            \n            // Get vendor details first\n            $stmt = $this->db->prepare(\"\n                SELECT v.*, u.username, u.email \n                FROM vendors v \n                JOIN users u ON v.user_id = u.id \n                WHERE v.id = ?\n            \");\n            $stmt->execute([$vendor_id]);\n            $vendor = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if (!$vendor) {\n                throw new Exception('Vendor not found');\n            }\n            \n            // Deactivate products from this vendor\n            $stmt = $this->db->prepare(\"UPDATE products SET status = 'inactive' WHERE vendor_id = ?\");\n            $stmt->execute([$vendor_id]);\n            \n            // Delete vendor record\n            $stmt = $this->db->prepare(\"DELETE FROM vendors WHERE id = ?\");\n            $stmt->execute([$vendor_id]);\n            \n            // Delete user roles\n            $stmt = $this->db->prepare(\"DELETE FROM user_roles WHERE user_id = ?\");\n            $stmt->execute([$vendor['user_id']]);\n            \n            // Delete user account\n            $stmt = $this->db->prepare(\"DELETE FROM users WHERE id = ?\");\n            $stmt->execute([$vendor['user_id']]);\n            \n            $this->db->commit();\n            \n            return ['success' => true, 'message' => \"Vendor '{$vendor['business_name']}' deleted successfully\"];\n            \n        } catch (Exception $e) {\n            $this->db->rollBack();\n            return ['success' => false, 'message' => 'Failed to delete vendor: ' . $e->getMessage()];\n        }\n    }\n\n    private function generate_unique_username($base_name, $max_attempts = 10) {\n        $base_username = strtolower(str_replace(' ', '_', $base_name));\n        \n        for ($attempt = 1; $attempt <= $max_attempts; $attempt++) {\n            $username = $base_username . '_' . random_int(1000, 9999);\n            \n            // Check if username already exists\n            $stmt = $this->db->prepare(\"SELECT id FROM users WHERE username = ?\");\n            $stmt->execute([$username]);\n            \n            if ($stmt->rowCount() === 0) {\n                return $username; // Username is unique\n            }\n        }\n        \n        // If we couldn't generate a unique username after max attempts, \n        // use timestamp to ensure uniqueness\n        return $base_username . '_' . time() . '_' . random_int(100, 999);\n    }\n\n    private function send_notification($user_id, $type, $title, $message) {\n        try {\n            $stmt = $this->db->prepare(\"\n                INSERT INTO notifications (user_id, type, title, message) \n                VALUES (?, ?, ?, ?)\n            \");\n            $stmt->execute([$user_id, $type, $title, $message]);\n            \n        } catch (PDOException $e) {\n            // Log error but don't fail the main operation\n            error_log(\"Notification failed: \" . $e->getMessage());\n        }\n    }\n}\n?>\n","size_bytes":12661},"includes/wishlist.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\n\nclass WishlistManager {\n    private $db;\n    \n    public function __construct() {\n        $database = new Database();\n        $this->db = $database->getConnection();\n    }\n    \n    public function add_to_wishlist($user_id, $product_id) {\n        try {\n            // Check if already in wishlist\n            if ($this->is_in_wishlist($user_id, $product_id)) {\n                return ['success' => false, 'message' => 'Item already in wishlist'];\n            }\n            \n            $stmt = $this->db->prepare(\"INSERT INTO wishlist (user_id, product_id) VALUES (?, ?)\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            return ['success' => true, 'message' => 'Added to wishlist'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to add to wishlist: ' . $e->getMessage()];\n        }\n    }\n    \n    public function remove_from_wishlist($user_id, $product_id) {\n        try {\n            $stmt = $this->db->prepare(\"DELETE FROM wishlist WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            return ['success' => true, 'message' => 'Removed from wishlist'];\n            \n        } catch (PDOException $e) {\n            return ['success' => false, 'message' => 'Failed to remove from wishlist'];\n        }\n    }\n    \n    public function get_wishlist($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"\n                SELECT p.*, w.created_at as added_at\n                FROM wishlist w\n                JOIN products p ON w.product_id = p.id\n                WHERE w.user_id = ? AND p.status = 'active' AND p.admin_approved = 1\n                ORDER BY w.created_at DESC\n            \");\n            \n            $stmt->execute([$user_id]);\n            $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n            \n            foreach ($products as &$product) {\n                $imgs = $product['images'] ? json_decode($product['images'], true) ?: [] : [];\n                $normalized = [];\n                foreach ($imgs as $img) {\n                    if (!$img) continue;\n                    if (strpos($img, 'http://') === 0 || strpos($img, 'https://') === 0) {\n                        $normalized[] = $img;\n                    } elseif (strpos($img, 'uploads/') === 0) {\n                        $normalized[] = $img;\n                    } else {\n                        $normalized[] = 'uploads/products/' . basename($img);\n                    }\n                }\n                $product['images'] = $normalized;\n            }\n            \n            return $products;\n            \n        } catch (PDOException $e) {\n            return [];\n        }\n    }\n    \n    public function is_in_wishlist($user_id, $product_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT id FROM wishlist WHERE user_id = ? AND product_id = ?\");\n            $stmt->execute([$user_id, $product_id]);\n            \n            return $stmt->rowCount() > 0;\n            \n        } catch (PDOException $e) {\n            return false;\n        }\n    }\n    \n    public function getWishlistCount($user_id) {\n        try {\n            $stmt = $this->db->prepare(\"SELECT COUNT(*) as count FROM wishlist WHERE user_id = ?\");\n            $stmt->execute([$user_id]);\n            $result = $stmt->fetch(PDO::FETCH_ASSOC);\n            return $result['count'];\n        } catch (PDOException $e) {\n            return 0;\n        }\n    }\n}\n?>\n","size_bytes":3542},"scripts/add_approval_column.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    // Check if column already exists\n    $stmt = $db->query(\"SHOW COLUMNS FROM products LIKE 'admin_approved'\");\n    if ($stmt->rowCount() == 0) {\n        $db->exec(\"ALTER TABLE products ADD COLUMN admin_approved TINYINT(1) DEFAULT 0\");\n        echo \"Added admin_approved column\\n\";\n    } else {\n        echo \"admin_approved column already exists\\n\";\n    }\n    \n    // Update existing products to be approved (for testing)\n    $db->exec(\"UPDATE products SET admin_approved = 1 WHERE status = 'active'\");\n    echo \"Updated existing active products to approved\\n\";\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":758},"scripts/check_vendor_structure.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    echo \"=== VENDORS TABLE STRUCTURE ===\\n\";\n    $stmt = $db->query('DESCRIBE vendors');\n    foreach($stmt as $row) {\n        echo \"{$row['Field']} - {$row['Type']}\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":370},"scripts/check_vendors.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    echo \"=== VENDORS TABLE ===\\n\";\n    $stmt = $db->query('SELECT id, user_id, business_name FROM vendors LIMIT 5');\n    foreach($stmt as $row) {\n        echo \"Vendor ID: {$row['id']}, User ID: {$row['user_id']}, Business: {$row['business_name']}\\n\";\n    }\n    \n    echo \"\\n=== PRODUCTS TABLE ===\\n\";\n    $stmt = $db->query('SELECT id, vendor_id, name, admin_approved FROM products LIMIT 5');\n    foreach($stmt as $row) {\n        echo \"Product ID: {$row['id']}, Vendor ID: {$row['vendor_id']}, Name: {$row['name']}, Approved: {$row['admin_approved']}\\n\";\n    }\n    \n    echo \"\\n=== USERS TABLE ===\\n\";\n    $stmt = $db->query('SELECT id, first_name, last_name FROM users LIMIT 5');\n    foreach($stmt as $row) {\n        echo \"User ID: {$row['id']}, Name: {$row['first_name']} {$row['last_name']}\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":999},"scripts/create_admin_vendor.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    // Check if admin vendor already exists\n    $stmt = $db->prepare(\"SELECT id FROM vendors WHERE business_name = 'Admin Store'\");\n    $stmt->execute();\n    $adminVendor = $stmt->fetch(PDO::FETCH_ASSOC);\n    \n    if (!$adminVendor) {\n        // Create admin vendor\n        $stmt = $db->prepare(\"\n            INSERT INTO vendors (user_id, business_name, description, is_verified, created_at) \n            VALUES (1, 'Admin Store', 'Official admin store for marketplace products', 1, NOW())\n        \");\n        $stmt->execute();\n        $adminVendorId = $db->lastInsertId();\n        echo \"Created admin vendor with ID: $adminVendorId\\n\";\n    } else {\n        $adminVendorId = $adminVendor['id'];\n        echo \"Admin vendor already exists with ID: $adminVendorId\\n\";\n    }\n    \n    // Update existing products with vendor_id = 0 to use admin vendor\n    $stmt = $db->prepare(\"UPDATE products SET vendor_id = ? WHERE vendor_id = 0\");\n    $stmt->execute([$adminVendorId]);\n    $updated = $stmt->rowCount();\n    echo \"Updated $updated products to use admin vendor\\n\";\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":1256},"scripts/create_placeholders.php":{"content":"<?php\n// Creates 1x1 PNG placeholders for a list of product image filenames\n\n$destDir = __DIR__ . '/../uploads/products';\nif (!is_dir($destDir)) {\n    mkdir($destDir, 0777, true);\n}\n\n$filenames = [\n    'samsung_s23.jpg','samsung_a54.jpg','macbook_air_m2.jpg','macbook_pro14.jpg','apple_watch9.jpg',\n    'airpods_pro2.jpg','canon_m50.jpg','gopro_hero12.jpg','hp_envy.jpg','logitech_mx3s.jpg',\n    'oneplus11.jpg','pixel8.jpg','asus_zephyrus.jpg','thinkpad_x1.jpg','sony_xm5.jpg',\n    'bose_ultra.jpg','dell_xps13.jpg','acer_predator.jpg','seagate_2tb.jpg','samsung_ssd980.jpg'\n];\n\n// 1x1 transparent PNG (base64)\n$pngBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAl0B8k7E8VQAAAAASUVORK5CYII=';\n$pngBytes = base64_decode($pngBase64);\n\n$created = 0;\nforeach ($filenames as $name) {\n    $target = $destDir . '/' . $name;\n    if (!file_exists($target)) {\n        file_put_contents($target, $pngBytes);\n        $created++;\n    }\n}\n\necho \"Ensured \" . count($filenames) . \" files. Created: $created\\n\";\n?>\n\n\n","size_bytes":1028},"scripts/create_settings_tables.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $database = new Database();\n    $db = $database->getConnection();\n    \n    // Create settings table\n    $sql = \"\n    CREATE TABLE IF NOT EXISTS settings (\n        id INT PRIMARY KEY AUTO_INCREMENT,\n        setting_key VARCHAR(100) UNIQUE NOT NULL,\n        setting_value TEXT,\n        setting_type ENUM('text', 'email', 'number', 'boolean', 'json') DEFAULT 'text',\n        description TEXT,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n    )\";\n    $db->exec($sql);\n    echo \"Settings table created successfully.\\n\";\n    \n    // Create advertisements table\n    $sql = \"\n    CREATE TABLE IF NOT EXISTS advertisements (\n        id INT PRIMARY KEY AUTO_INCREMENT,\n        title VARCHAR(200) NOT NULL,\n        content TEXT,\n        image_url VARCHAR(500),\n        video_url VARCHAR(500),\n        link_url VARCHAR(500),\n        ad_type ENUM('banner', 'sidebar', 'popup', 'inline') DEFAULT 'banner',\n        position VARCHAR(50) DEFAULT 'top',\n        is_active BOOLEAN DEFAULT TRUE,\n        start_date DATETIME,\n        end_date DATETIME,\n        click_count INT DEFAULT 0,\n        view_count INT DEFAULT 0,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n    )\";\n    $db->exec($sql);\n    echo \"Advertisements table created successfully.\\n\";\n    \n    // Insert default settings\n    $default_settings = [\n        ['site_name', 'Market Nest', 'text', 'Website name'],\n        ['site_description', 'Your Premier Marketplace Destination', 'text', 'Website description'],\n        ['admin_email', 'admin@marketnest.com', 'email', 'Admin contact email'],\n        ['support_email', 'support@marketnest.com', 'email', 'Support contact email'],\n        ['smtp_host', 'smtp.gmail.com', 'text', 'SMTP server host'],\n        ['smtp_port', '587', 'number', 'SMTP server port'],\n        ['smtp_username', '', 'text', 'SMTP username'],\n        ['smtp_password', '', 'text', 'SMTP password'],\n        ['smtp_encryption', 'tls', 'text', 'SMTP encryption type'],\n        ['stripe_public_key', '', 'text', 'Stripe public key'],\n        ['stripe_secret_key', '', 'text', 'Stripe secret key'],\n        ['paypal_client_id', '', 'text', 'PayPal client ID'],\n        ['paypal_client_secret', '', 'text', 'PayPal client secret'],\n        ['email_notifications', '1', 'boolean', 'Enable email notifications'],\n        ['sms_notifications', '0', 'boolean', 'Enable SMS notifications'],\n        ['order_notifications', '1', 'boolean', 'Enable order notifications'],\n        ['vendor_notifications', '1', 'boolean', 'Enable vendor notifications'],\n        ['maintenance_mode', '0', 'boolean', 'Enable maintenance mode'],\n        ['maintenance_message', 'We are currently performing maintenance. Please check back later.', 'text', 'Maintenance mode message']\n    ];\n    \n    $stmt = $db->prepare(\"\n        INSERT INTO settings (setting_key, setting_value, setting_type, description) \n        VALUES (?, ?, ?, ?) \n        ON DUPLICATE KEY UPDATE setting_value = VALUES(setting_value)\n    \");\n    \n    foreach ($default_settings as $setting) {\n        $stmt->execute($setting);\n    }\n    \n    echo \"Default settings inserted successfully.\\n\";\n    echo \"Database setup completed!\\n\";\n    \n} catch (PDOException $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":3479},"scripts/debug_admin_query.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    echo \"=== DIRECT SQL TEST ===\\n\";\n    \n    // Test the exact query from get_all_products_admin\n    $sql = \"\n        SELECT \n            p.*,\n            c.name AS category_name,\n            v.business_name,\n            v.email AS vendor_email,\n            (\n                SELECT ROUND(AVG(r2.rating),1) FROM reviews r2 WHERE r2.product_id = p.id\n            ) AS avg_rating,\n            (\n                SELECT COUNT(r3.id) FROM reviews r3 WHERE r3.product_id = p.id\n            ) AS review_count\n        FROM products p\n        LEFT JOIN categories c ON p.category_id = c.id\n        LEFT JOIN vendors v ON p.vendor_id = v.id\n        ORDER BY p.created_at DESC\n        LIMIT 10\n    \";\n    \n    $stmt = $db->prepare($sql);\n    $stmt->execute();\n    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    \n    echo \"Direct query returned: \" . count($products) . \" products\\n\";\n    \n    foreach (array_slice($products, 0, 3) as $product) {\n        echo \"ID: {$product['id']}, Name: {$product['name']}, Vendor: {$product['business_name']}, Approved: {$product['admin_approved']}\\n\";\n    }\n    \n    echo \"\\n=== SIMPLE PRODUCTS QUERY ===\\n\";\n    $stmt = $db->query(\"SELECT id, name, vendor_id, admin_approved FROM products LIMIT 5\");\n    foreach($stmt as $row) {\n        echo \"ID: {$row['id']}, Name: {$row['name']}, Vendor ID: {$row['vendor_id']}, Approved: {$row['admin_approved']}\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":1585},"scripts/simple_check.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/database.php';\n\ntry {\n    $db = (new Database())->getConnection();\n    \n    echo \"=== BASIC CHECKS ===\\n\";\n    \n    // Check products count\n    $stmt = $db->query(\"SELECT COUNT(*) as count FROM products\");\n    $count = $stmt->fetch(PDO::FETCH_ASSOC)['count'];\n    echo \"Total products: $count\\n\";\n    \n    // Check vendors count\n    $stmt = $db->query(\"SELECT COUNT(*) as count FROM vendors\");\n    $count = $stmt->fetch(PDO::FETCH_ASSOC)['count'];\n    echo \"Total vendors: $count\\n\";\n    \n    // Check categories count\n    $stmt = $db->query(\"SELECT COUNT(*) as count FROM categories\");\n    $count = $stmt->fetch(PDO::FETCH_ASSOC)['count'];\n    echo \"Total categories: $count\\n\";\n    \n    // Show first few products\n    echo \"\\n=== FIRST 3 PRODUCTS ===\\n\";\n    $stmt = $db->query(\"SELECT id, name, vendor_id, admin_approved FROM products LIMIT 3\");\n    foreach($stmt as $row) {\n        echo \"ID: {$row['id']}, Name: {$row['name']}, Vendor: {$row['vendor_id']}, Approved: {$row['admin_approved']}\\n\";\n    }\n    \n} catch (Exception $e) {\n    echo \"Error: \" . $e->getMessage() . \"\\n\";\n}\n?>\n","size_bytes":1128},"scripts/test_admin_queries.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\nrequire_once __DIR__ . '/../includes/product.php';\n\n$pm = new ProductManager();\n\necho \"=== TESTING ADMIN QUERIES ===\\n\";\n\n$admin = $pm->get_all_products_admin(10, 0, 'all');\necho \"admin_all=\" . count($admin) . \"\\n\";\n\n$pending = $pm->get_pending_products(10, 0);\necho \"pending=\" . count($pending) . \"\\n\";\n\n$approved = $pm->get_all_products_admin(10, 0, 'approved');\necho \"approved=\" . count($approved) . \"\\n\";\n\necho \"\\n=== SAMPLE PRODUCTS ===\\n\";\nforeach (array_slice($admin, 0, 3) as $product) {\n    echo \"ID: {$product['id']}, Name: {$product['name']}, Approved: {$product['admin_approved']}\\n\";\n}\n?>\n","size_bytes":656},"scripts/try_pm.php":{"content":"<?php\nrequire_once __DIR__ . '/../config/config.php';\nrequire_once __DIR__ . '/../includes/product.php';\n\n$pm = new ProductManager();\n$rows = $pm->get_products(20, 0);\necho 'count=' . count($rows) . \"\\n\";\nforeach ($rows as $r) {\n    $img = isset($r['images'][0]) ? $r['images'][0] : 'noimg';\n    echo \"- {$r['id']} {$r['name']} [{$r['status']}] img={$img}\\n\";\n}\n?>\n\n\n","size_bytes":367},"user/dashboard.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\nrequire_once '../includes/order.php';\nrequire_once '../includes/product.php';\n\n// Check if user is logged in\nif (!isLoggedIn()) {\n    header('Location: ../login.php');\n    exit();\n}\n\n$user = getCurrentUser();\nif ($user['role'] !== 'customer') {\n    header('Location: ../index.php');\n    exit();\n}\n\n$orderManager = new OrderManager();\n$productManager = new ProductManager();\n\n// Get user statistics\n$recentOrders = $orderManager->getUserOrders($user['id'], 5);\n$totalOrders = $orderManager->getUserOrderCount($user['id']);\n$totalSpent = $orderManager->getUserTotalSpent($user['id']);\n$wishlistCount = $productManager->getWishlistCount($user['id']);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>My Dashboard - E-Commerce</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Navigation -->\n    <nav class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between h-16\">\n                <div class=\"flex items-center\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\">E-Commerce</a>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo htmlspecialchars($user['first_name']); ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </div>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <!-- Dashboard Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">My Dashboard</h1>\n            <p class=\"text-gray-600 mt-2\">Manage your orders, profile, and preferences</p>\n        </div>\n\n        <!-- Stats Cards -->\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-accent/10 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-accent\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $totalOrders; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-green-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Spent</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">$<?php echo number_format($totalSpent, 2); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-red-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Wishlist Items</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $wishlistCount; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-blue-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Addresses</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">2</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            <!-- Recent Orders -->\n            <div class=\"lg:col-span-2\">\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Recent Orders</h2>\n                    </div>\n                    <div class=\"p-6\">\n                        <?php if (empty($recentOrders)): ?>\n                            <p class=\"text-gray-500 text-center py-8\">No orders yet. <a href=\"../products.php\" class=\"text-primary hover:underline\">Start shopping!</a></p>\n                        <?php else: ?>\n                            <div class=\"space-y-4\">\n                                <?php foreach ($recentOrders as $order): ?>\n                                    <div class=\"border border-gray-200 rounded-lg p-4\">\n                                        <div class=\"flex justify-between items-start\">\n                                            <div>\n                                                <p class=\"font-semibold text-gray-900\">Order #<?php echo $order['order_number']; ?></p>\n                                                <p class=\"text-sm text-gray-600\"><?php echo date('M j, Y', strtotime($order['created_at'])); ?></p>\n                                                <p class=\"text-sm text-gray-600\"><?php echo $order['item_count']; ?> items</p>\n                                            </div>\n                                            <div class=\"text-right\">\n                                                <p class=\"font-semibold text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                                                <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                                    <?php echo $order['status'] === 'delivered' ? 'bg-green-100 text-green-800' : \n                                                        ($order['status'] === 'shipped' ? 'bg-blue-100 text-blue-800' : \n                                                        ($order['status'] === 'processing' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800')); ?>\">\n                                                    <?php echo ucfirst($order['status']); ?>\n                                                </span>\n                                            </div>\n                                        </div>\n                                        <div class=\"mt-3 flex space-x-3\">\n                                            <a href=\"../order-detail.php?id=<?php echo $order['id']; ?>\" class=\"text-primary hover:underline text-sm\">View Details</a>\n                                            <?php if ($order['tracking_number']): ?>\n                                                <a href=\"../track.php?tracking=<?php echo $order['tracking_number']; ?>\" class=\"text-primary hover:underline text-sm\">Track Package</a>\n                                            <?php endif; ?>\n                                        </div>\n                                    </div>\n                                <?php endforeach; ?>\n                            </div>\n                            <div class=\"mt-6 text-center\">\n                                <a href=\"../order-history.php\" class=\"text-primary hover:underline\">View All Orders</a>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Quick Actions -->\n            <div class=\"space-y-6\">\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Quick Actions</h2>\n                    </div>\n                    <div class=\"p-6 space-y-4\">\n                        <a href=\"../products.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">Browse Products</span>\n                        </a>\n                        \n                        <a href=\"../cart.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v5a2 2 0 01-2 2H9a2 2 0 01-2-2v-5m6-5V6a2 2 0 00-2-2H9a2 2 0 00-2 2v3\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">View Cart</span>\n                        </a>\n                        \n                        <a href=\"wishlist.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">My Wishlist</span>\n                        </a>\n                        \n                        <a href=\"profile.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">Edit Profile</span>\n                        </a>\n                        \n                        <a href=\"../track.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">Track Shipment</span>\n                        </a>\n                    </div>\n                </div>\n\n                <!-- Account Info -->\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Account Info</h2>\n                    </div>\n                    <div class=\"p-6\">\n                        <div class=\"space-y-3\">\n                            <div>\n                                <p class=\"text-sm text-gray-600\">Name</p>\n                                <p class=\"font-medium\"><?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?></p>\n                            </div>\n                            <div>\n                                <p class=\"text-sm text-gray-600\">Email</p>\n                                <p class=\"font-medium\"><?php echo htmlspecialchars($user['email']); ?></p>\n                            </div>\n                            <div>\n                                <p class=\"text-sm text-gray-600\">Member Since</p>\n                                <p class=\"font-medium\"><?php echo date('M Y', strtotime($user['created_at'])); ?></p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":14509},"vendor/add-product.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\nrequire_once '../includes/product.php';\n\n// Check if user is logged in and is a vendor\nif (!isLoggedIn()) {\n    header('Location: ../login.php');\n    exit();\n}\n\n$user = getCurrentUser();\nif ($user['role'] !== 'vendor') {\n    header('Location: ../index.php');\n    exit();\n}\n\n// Get vendor business ID\n$database = new Database();\n$db = $database->getConnection();\n$stmt = $db->prepare(\"SELECT id FROM vendors WHERE user_id = ?\");\n$stmt->execute([$user['id']]);\n$vendor_business = $stmt->fetch(PDO::FETCH_ASSOC);\n\nif (!$vendor_business) {\n    $error = 'Vendor business not found. Please contact support.';\n} else {\n    $vendor_id = $vendor_business['id'];\n}\n\n$productManager = new ProductManager();\n$categories = $productManager->getCategories();\n\n$success = false;\n$error = '';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $name = trim($_POST['name']);\n    $description = trim($_POST['description']);\n    $price = floatval($_POST['price']);\n    $category_id = intval($_POST['category_id']);\n    $stock_quantity = intval($_POST['stock_quantity']);\n    $sku = trim($_POST['sku']);\n    $weight = floatval($_POST['weight']);\n    $dimensions = trim($_POST['dimensions']);\n    \n    // Handle image upload\n    $image_url = '';\n    if (isset($_FILES['image']) && $_FILES['image']['error'] === UPLOAD_ERR_OK) {\n        $upload_dir = '../uploads/products/';\n        if (!file_exists($upload_dir)) {\n            mkdir($upload_dir, 0777, true);\n        }\n        \n        $file_extension = pathinfo($_FILES['image']['name'], PATHINFO_EXTENSION);\n        $filename = uniqid() . '.' . $file_extension;\n        $upload_path = $upload_dir . $filename;\n        \n        if (move_uploaded_file($_FILES['image']['tmp_name'], $upload_path)) {\n            $image_url = 'uploads/products/' . $filename;\n        }\n    }\n    \n    if ($name && $description && $price > 0 && $category_id && $stock_quantity >= 0 && isset($vendor_id)) {\n        $result = $productManager->addProduct([\n            'vendor_id' => $vendor_id,\n            'name' => $name,\n            'description' => $description,\n            'price' => $price,\n            'category_id' => $category_id,\n            'stock_quantity' => $stock_quantity,\n            'sku' => $sku,\n            'images' => $image_url ? [$image_url] : []\n        ]);\n        \n        if ($result['success']) {\n            $success = true;\n        } else {\n            $error = $result['message'];\n        }\n    } else {\n        $error = 'Please fill in all required fields.';\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Add Product - Vendor Dashboard</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Navigation -->\n    <nav class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between h-16\">\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\">E-Commerce</a>\n                    <span class=\"text-gray-400\">|</span>\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Vendor</a>\n                    <span class=\"text-gray-400\">></span>\n                    <span class=\"text-gray-700 font-medium\">Add Product</span>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </div>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Add New Product</h1>\n            <p class=\"text-gray-600 mt-2\">Create a new product listing for your store</p>\n        </div>\n\n        <?php if ($success): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                Product added successfully! <a href=\"products.php\" class=\"underline\">View your products</a>\n            </div>\n        <?php endif; ?>\n\n        <?php if ($error): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo htmlspecialchars($error); ?>\n            </div>\n        <?php endif; ?>\n\n        <div class=\"bg-white rounded-lg shadow\">\n            <form method=\"POST\" enctype=\"multipart/form-data\" class=\"p-6 space-y-6\">\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <label for=\"name\" class=\"block text-sm font-medium text-gray-700 mb-2\">Product Name *</label>\n                        <input type=\"text\" id=\"name\" name=\"name\" required \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['name'] ?? ''); ?>\">\n                    </div>\n\n                    <div>\n                        <label for=\"sku\" class=\"block text-sm font-medium text-gray-700 mb-2\">SKU</label>\n                        <input type=\"text\" id=\"sku\" name=\"sku\" \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['sku'] ?? ''); ?>\">\n                    </div>\n                </div>\n\n                <div>\n                    <label for=\"description\" class=\"block text-sm font-medium text-gray-700 mb-2\">Description *</label>\n                    <textarea id=\"description\" name=\"description\" rows=\"4\" required \n                              class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"><?php echo htmlspecialchars($_POST['description'] ?? ''); ?></textarea>\n                </div>\n\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                    <div>\n                        <label for=\"price\" class=\"block text-sm font-medium text-gray-700 mb-2\">Price ($) *</label>\n                        <input type=\"number\" id=\"price\" name=\"price\" step=\"0.01\" min=\"0\" required \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['price'] ?? ''); ?>\">\n                    </div>\n\n                    <div>\n                        <label for=\"category_id\" class=\"block text-sm font-medium text-gray-700 mb-2\">Category *</label>\n                        <select id=\"category_id\" name=\"category_id\" required \n                                class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\">\n                            <option value=\"\">Select Category</option>\n                            <?php foreach ($categories as $category): ?>\n                                <option value=\"<?php echo $category['id']; ?>\" \n                                        <?php echo ($_POST['category_id'] ?? '') == $category['id'] ? 'selected' : ''; ?>>\n                                    <?php echo htmlspecialchars($category['name']); ?>\n                                </option>\n                            <?php endforeach; ?>\n                        </select>\n                    </div>\n\n                    <div>\n                        <label for=\"stock_quantity\" class=\"block text-sm font-medium text-gray-700 mb-2\">Stock Quantity *</label>\n                        <input type=\"number\" id=\"stock_quantity\" name=\"stock_quantity\" min=\"0\" required \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['stock_quantity'] ?? ''); ?>\">\n                    </div>\n                </div>\n\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <label for=\"weight\" class=\"block text-sm font-medium text-gray-700 mb-2\">Weight (lbs)</label>\n                        <input type=\"number\" id=\"weight\" name=\"weight\" step=\"0.01\" min=\"0\" \n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['weight'] ?? ''); ?>\">\n                    </div>\n\n                    <div>\n                        <label for=\"dimensions\" class=\"block text-sm font-medium text-gray-700 mb-2\">Dimensions (L x W x H)</label>\n                        <input type=\"text\" id=\"dimensions\" name=\"dimensions\" placeholder=\"e.g., 10 x 8 x 6 inches\"\n                               class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\"\n                               value=\"<?php echo htmlspecialchars($_POST['dimensions'] ?? ''); ?>\">\n                    </div>\n                </div>\n\n                <div>\n                    <label for=\"image\" class=\"block text-sm font-medium text-gray-700 mb-2\">Product Image</label>\n                    <input type=\"file\" id=\"image\" name=\"image\" accept=\"image/*\" \n                           class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent\">\n                    <p class=\"text-sm text-gray-500 mt-1\">Upload a high-quality image of your product (JPG, PNG, GIF)</p>\n                </div>\n\n                <div class=\"flex justify-end space-x-4\">\n                    <a href=\"dashboard.php\" class=\"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition\">\n                        Cancel\n                    </a>\n                    <button type=\"submit\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n                        Add Product\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</body>\n</html>\n","size_bytes":10996},"vendor/dashboard.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\nrequire_once '../includes/product.php';\nrequire_once '../includes/order.php';\n\n// Check if user is logged in and is a vendor\nif (!isLoggedIn()) {\n    header('Location: ../login.php');\n    exit();\n}\n\n$user = getCurrentUser();\nif ($user['role'] !== 'vendor') {\n    header('Location: ../index.php');\n    exit();\n}\n\n$productManager = new ProductManager();\n$orderManager = new OrderManager();\n\n// Get vendor statistics\n$totalProducts = $productManager->getVendorProductCount($user['id']);\n$totalOrders = $orderManager->getVendorOrderCount($user['id']);\n$totalEarnings = $orderManager->getVendorEarnings($user['id']);\n$pendingOrders = $orderManager->getVendorPendingOrders($user['id']);\n$recentOrders = $orderManager->getVendorOrders($user['id'], 5);\n$topProducts = $productManager->getVendorTopProducts($user['id'], 5);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Vendor Dashboard - E-Commerce</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Navigation -->\n    <nav class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between h-16\">\n                <div class=\"flex items-center\">\n                    <a href=\"../index.php\" class=\"text-2xl font-bold text-accent\">E-Commerce</a>\n                    <span class=\"ml-4 px-3 py-1 bg-accent/10 text-accent text-sm font-medium rounded-full\">Vendor</span>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <span class=\"text-gray-700\">Welcome, <?php echo htmlspecialchars($user['first_name']); ?>!</span>\n                    <a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n                </div>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <!-- Dashboard Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900\">Vendor Dashboard</h1>\n            <p class=\"text-gray-600 mt-2\">Manage your products, orders, and business analytics</p>\n        </div>\n\n        <!-- Stats Cards -->\n        <div class=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-accent/10 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-accent\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Products</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $totalProducts; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-blue-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo $totalOrders; ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-green-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Total Earnings</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\">$<?php echo number_format($totalEarnings, 2); ?></p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-2 bg-yellow-100 rounded-lg\">\n                        <svg class=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <p class=\"text-sm font-medium text-gray-600\">Pending Orders</p>\n                        <p class=\"text-2xl font-semibold text-gray-900\"><?php echo count($pendingOrders); ?></p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            <!-- Recent Orders -->\n            <div class=\"lg:col-span-2 space-y-6\">\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200 flex justify-between items-center\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Recent Orders</h2>\n                        <a href=\"orders.php\" class=\"text-primary hover:underline text-sm\">View All</a>\n                    </div>\n                    <div class=\"p-6\">\n                        <?php if (empty($recentOrders)): ?>\n                            <p class=\"text-gray-500 text-center py-8\">No orders yet.</p>\n                        <?php else: ?>\n                            <div class=\"space-y-4\">\n                                <?php foreach ($recentOrders as $order): ?>\n                                    <div class=\"border border-gray-200 rounded-lg p-4\">\n                                        <div class=\"flex justify-between items-start\">\n                                            <div>\n                                                <p class=\"font-semibold text-gray-900\">Order #<?php echo $order['order_number']; ?></p>\n                                                <p class=\"text-sm text-gray-600\">Customer: <?php echo htmlspecialchars($order['customer_name']); ?></p>\n                                                <p class=\"text-sm text-gray-600\"><?php echo date('M j, Y', strtotime($order['created_at'])); ?></p>\n                                            </div>\n                                            <div class=\"text-right\">\n                                                <p class=\"font-semibold text-gray-900\">$<?php echo number_format($order['total_amount'], 2); ?></p>\n                                                <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                                    <?php echo $order['status'] === 'delivered' ? 'bg-green-100 text-green-800' : \n                                                        ($order['status'] === 'shipped' ? 'bg-blue-100 text-blue-800' : \n                                                        ($order['status'] === 'processing' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800')); ?>\">\n                                                    <?php echo ucfirst($order['status']); ?>\n                                                </span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                <?php endforeach; ?>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n\n                <!-- Top Products -->\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Top Selling Products</h2>\n                    </div>\n                    <div class=\"p-6\">\n                        <?php if (empty($topProducts)): ?>\n                            <p class=\"text-gray-500 text-center py-8\">No sales data yet.</p>\n                        <?php else: ?>\n                            <div class=\"space-y-4\">\n                                <?php foreach ($topProducts as $product): ?>\n                                    <div class=\"flex items-center space-x-4\">\n                                        <img src=\"<?php echo htmlspecialchars($product['image_url'] ?: '/placeholder.svg?height=50&width=50'); ?>\" \n                                             alt=\"<?php echo htmlspecialchars($product['name']); ?>\" \n                                             class=\"w-12 h-12 object-cover rounded-lg\">\n                                        <div class=\"flex-1\">\n                                            <p class=\"font-medium text-gray-900\"><?php echo htmlspecialchars($product['name']); ?></p>\n                                            <p class=\"text-sm text-gray-600\"><?php echo $product['sales_count']; ?> sold</p>\n                                        </div>\n                                        <p class=\"font-semibold text-gray-900\">$<?php echo number_format($product['price'], 2); ?></p>\n                                    </div>\n                                <?php endforeach; ?>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Quick Actions & Analytics -->\n            <div class=\"space-y-6\">\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Quick Actions</h2>\n                    </div>\n                    <div class=\"p-6 space-y-4\">\n                        <a href=\"add-product.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">Add New Product</span>\n                        </a>\n                        \n                        <a href=\"products.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">Manage Products</span>\n                        </a>\n                        \n                        <a href=\"orders.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">View Orders</span>\n                        </a>\n                        \n                        <a href=\"analytics.php\" class=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition\">\n                            <svg class=\"w-5 h-5 text-primary mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\n                            </svg>\n                            <span class=\"text-gray-700\">View Analytics</span>\n                        </a>\n                    </div>\n                </div>\n\n                <!-- Earnings Chart -->\n                <div class=\"bg-white rounded-lg shadow\">\n                    <div class=\"px-6 py-4 border-b border-gray-200\">\n                        <h2 class=\"text-lg font-semibold text-gray-900\">Monthly Earnings</h2>\n                    </div>\n                    <div class=\"p-6\">\n                        <canvas id=\"earningsChart\" width=\"400\" height=\"200\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Sample earnings chart\n        const ctx = document.getElementById('earningsChart').getContext('2d');\n        new Chart(ctx, {\n            type: 'line',\n            data: {\n                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],\n                datasets: [{\n                    label: 'Earnings ($)',\n                    data: [1200, 1900, 3000, 2500, 2200, 3000],\n                    borderColor: '#f97316',\n                    backgroundColor: 'rgba(249, 115, 22, 0.1)',\n                    tension: 0.4\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        display: false\n                    }\n                },\n                scales: {\n                    y: {\n                        beginAtZero: true\n                    }\n                }\n            }\n        });\n    </script>\n</body>\n</html>\n","size_bytes":15247},"vendor/products.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/auth.php';\nrequire_once '../includes/product.php';\n\n// Check if user is logged in\nif (!isLoggedIn()) {\n\theader('Location: ../login.php');\n\texit();\n}\n\n$user = getCurrentUser();\n\n// Authorize: allow if user has 'vendor' role in user_roles or is admin\n$database = new Database();\n$db = $database->getConnection();\n$hasVendorRole = false;\n$hasAdminRole = false;\ntry {\n\t$stmt = $db->prepare(\"SELECT role FROM user_roles WHERE user_id = ?\");\n\t$stmt->execute([$user['id']]);\n\t$roles = $stmt->fetchAll(PDO::FETCH_COLUMN);\n\t$hasVendorRole = in_array('vendor', $roles, true);\n\t$hasAdminRole = in_array('admin', $roles, true);\n} catch (PDOException $e) {\n\t// Fallback to existing role field if query fails\n\t$hasVendorRole = ($user['role'] ?? '') === 'vendor';\n\t$hasAdminRole = ($user['role'] ?? '') === 'admin';\n}\n\nif (!$hasVendorRole && !$hasAdminRole) {\n\theader('Location: ../index.php');\n\texit();\n}\n\n$productManager = new ProductManager();\n\n// Resolve vendor business id from current user\n$stmt = $db->prepare(\"SELECT id FROM vendors WHERE user_id = ?\");\n$stmt->execute([$user['id']]);\n$vendorRow = $stmt->fetch(PDO::FETCH_ASSOC);\n$vendorId = $vendorRow['id'] ?? null;\n\n// Handle product actions\nif (($_POST['action'] ?? '') === 'update_status' && $vendorId) {\n\t$product_id = $_POST['product_id'];\n\t$status = $_POST['status'];\n\t\n\t$productManager->updateProductStatus($product_id, $status, $vendorId);\n\theader('Location: products.php?updated=1');\n\texit();\n}\n\n// Get vendor's products (direct)\n$products = $vendorId ? $productManager->getVendorProductsSimple($vendorId) : [];\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t<title>My Products - Vendor Dashboard</title>\n\t<script src=\"https://cdn.tailwindcss.com\"></script>\n\t<script>\n\t\ttailwind.config = {\n\t\t\ttheme: {\n\t\t\t\textend: {\n\t\t\t\t\tcolors: {\n\t\t\t\t\t\tprimary: '#0f172a',\n\t\t\t\t\t\tsecondary: '#1e293b',\n\t\t\t\t\t\taccent: '#3b82f6',\n\t\t\t\t\t\twarning: '#f59e0b',\n\t\t\t\t\t\tsuccess: '#10b981'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t</script>\n</head>\n<body class=\"bg-gray-50\">\n\t<!-- Navigation -->\n\t<nav class=\"bg-white shadow-sm border-b\">\n\t\t<div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n\t\t\t<div class=\"flex justify-between h-16\">\n\t\t\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t\t\t<a href=\"../index.php\" class=\"text-2xl font-bold text-accent\">E-Commerce</a>\n\t\t\t\t\t<span class=\"text-gray-400\">|</span>\n\t\t\t\t\t<a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Vendor</a>\n\t\t\t\t\t<span class=\"text-gray-400\">></span>\n\t\t\t\t\t<span class=\"text-gray-700 font-medium\">Products</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t\t\t<a href=\"dashboard.php\" class=\"text-gray-700 hover:text-accent\">Dashboard</a>\n\t\t\t\t\t<a href=\"../logout.php\" class=\"bg-accent text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition\">Logout</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</nav>\n\n\t<div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n\t\t<div class=\"flex justify-between items-center mb-8\">\n\t\t\t<div>\n\t\t\t\t<h1 class=\"text-3xl font-bold text-gray-900\">My Products</h1>\n\t\t\t\t<p class=\"text-gray-600 mt-2\">Manage your product listings</p>\n\t\t\t</div>\n\t\t\t<a href=\"add-product.php\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n\t\t\t\tAdd New Product\n\t\t\t</a>\n\t\t</div>\n\n\t\t<?php if (!$vendorId): ?>\n\t\t\t<div class=\"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded mb-6\">\n\t\t\t\tNo vendor profile is linked to your account yet. Please complete your vendor application or contact support.\n\t\t\t</div>\n\t\t<?php endif; ?>\n\n\t\t<?php if (isset($_GET['updated'])): ?>\n\t\t\t<div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n\t\t\t\tProduct updated successfully!\n\t\t\t</div>\n\t\t<?php endif; ?>\n\n\t\t<div class=\"bg-white rounded-lg shadow overflow-hidden\">\n\t\t\t<?php if (empty($products)): ?>\n\t\t\t\t<div class=\"text-center py-12\">\n\t\t\t\t\t<svg class=\"w-16 h-16 text-gray-400 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900 mb-2\">No products yet</h3>\n\t\t\t\t\t<p class=\"text-gray-600 mb-4\">Start by adding your first product to your store.</p>\n\t\t\t\t\t<a href=\"add-product.php\" class=\"bg-accent text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition\">\n\t\t\t\t\t\tAdd Your First Product\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t<?php else: ?>\n\t\t\t\t<div class=\"overflow-x-auto\">\n\t\t\t\t\t<table class=\"min-w-full divide-y divide-gray-200\">\n\t\t\t\t\t\t<thead class=\"bg-gray-50\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Product</th>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Price</th>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Stock</th>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Created</th>\n\t\t\t\t\t\t\t\t<th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody class=\"bg-white divide-y divide-gray-200\">\n\t\t\t\t\t\t\t<?php foreach ($products as $product): ?>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class=\"px-6 py-4 whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<?php $thumb = (!empty($product['images']) && is_array($product['images'])) ? $product['images'][0] : null; ?>\n\t\t\t\t\t\t\t\t\t\t\t<?php if ($thumb): ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php $src = preg_match('/^https?:\\\\/\\\\//', $thumb) ? $thumb : ('../' . $thumb); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?php echo htmlspecialchars($src); ?>\" \n\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"<?php echo htmlspecialchars($product['name']); ?>\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-12 h-12 object-cover rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\n\t\t\t\t\t\t\t\t\t\t\t\t<?php \n\t\t\t\t\t\t\t\t\t\t\t\t\t$name = trim($product['name'] ?? '');\n\t\t\t\t\t\t\t\t\t\t\t\t\t$parts = preg_split('/\\s+/', $name);\n\t\t\t\t\t\t\t\t\t\t\t\t\t$first = strtoupper(substr($parts[0] ?? 'P', 0, 1));\n\t\t\t\t\t\t\t\t\t\t\t\t\t$second = strtoupper(substr($parts[1] ?? '', 0, 1));\n\t\t\t\t\t\t\t\t\t\t\t\t\t$initials = $first . $second;\n\t\t\t\t\t\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-primary text-sm font-semibold\"><?php echo htmlspecialchars($initials); ?></span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ml-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium text-gray-900\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php echo htmlspecialchars($product['name']); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tSKU: <?php echo htmlspecialchars($product['sku'] ?: 'N/A'); ?>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t\t\t$<?php echo number_format($product['price'], 2); ?>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n\t\t\t\t\t\t\t\t\t\t<?php echo $product['stock_quantity']; ?>\n\t\t\t\t\t\t\t\t\t</td>\n                                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                                        <div class=\"space-y-1\">\n                                            <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                                <?php echo $product['status'] === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'; ?>\">\n                                                <?php echo ucfirst($product['status']); ?>\n                                            </span>\n                                            <br>\n                                            <span class=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full \n                                                <?php echo $product['admin_approved'] ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'; ?>\">\n                                                <?php echo $product['admin_approved'] ? 'Approved' : 'Pending Review'; ?>\n                                            </span>\n                                        </div>\n                                    </td>\n\t\t\t\t\t\t\t\t\t<td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<?php echo date('M j, Y', strtotime($product['created_at'])); ?>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2\">\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"previewProduct(<?php echo $product['id']; ?>)\" \n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"text-blue-600 hover:text-blue-800\">Preview</button>\n\t\t\t\t\t\t\t\t\t\t<a href=\"../product-detail.php?id=<?php echo $product['id']; ?>\" \n\t\t\t\t\t\t\t\t\t\t   class=\"text-primary hover:text-blue-600\">View</a>\n\t\t\t\t\t\t\t\t\t\t<form method=\"POST\" class=\"inline\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"update_status\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"product_id\" value=\"<?php echo $product['id']; ?>\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"<?php echo $product['status'] === 'active' ? 'inactive' : 'active'; ?>\">\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"text-primary hover:text-blue-600\">\n\t\t\t\t\t\t\t\t\t\t\t\t<?php echo $product['status'] === 'active' ? 'Deactivate' : 'Activate'; ?>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<?php endforeach; ?>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t<?php endif; ?>\n\t\t</div>\n\t</div>\n\n\t<!-- Preview Modal -->\n\t<div id=\"previewModal\" class=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50\">\n\t\t<div class=\"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white\">\n\t\t\t<div class=\"mt-3\">\n\t\t\t\t<div class=\"flex justify-between items-center mb-4\">\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-gray-900\">Product Preview</h3>\n\t\t\t\t\t<button onclick=\"closePreview()\" class=\"text-gray-400 hover:text-gray-600\">\n\t\t\t\t\t\t<svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"previewContent\" class=\"max-h-96 overflow-y-auto\">\n\t\t\t\t\t<!-- Preview content will be loaded here -->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<script>\n\t\tfunction previewProduct(productId) {\n\t\t\t// Fetch product details and show preview\n\t\t\tfetch(`../api/product-preview.php?id=${productId}`)\n\t\t\t\t.then(response => response.json())\n\t\t\t\t.then(data => {\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tdocument.getElementById('previewContent').innerHTML = data.html;\n\t\t\t\t\t\tdocument.getElementById('previewModal').classList.remove('hidden');\n\t\t\t\t\t} else {\n\t\t\t\t\t\talert('Error loading preview: ' + data.message);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tconsole.error('Error:', error);\n\t\t\t\t\talert('Error loading preview');\n\t\t\t\t});\n\t\t}\n\n\t\tfunction closePreview() {\n\t\t\tdocument.getElementById('previewModal').classList.add('hidden');\n\t\t}\n\n\t\t// Close modal when clicking outside\n\t\tdocument.getElementById('previewModal').addEventListener('click', function(e) {\n\t\t\tif (e.target === this) {\n\t\t\t\tclosePreview();\n\t\t\t}\n\t\t});\n\t</script>\n</body>\n</html>\n","size_bytes":11371},"admin/index.php":{"content":"<?php\n// Redirect to admin dashboard\nheader('Location: dashboard.php');\nexit();","size_bytes":79},"admin/commissions.php":{"content":"<?php\nrequire_once '../config/config.php';\nrequire_once '../includes/vendor.php';\n\nrequire_admin();\n\n// Generate CSRF token\nif (!isset($_SESSION['csrf_token'])) {\n    $_SESSION['csrf_token'] = generate_csrf_token();\n}\n\n$database = new Database();\n$db = $database->getConnection();\n\n// Handle commission rate updates\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['action'])) {\n    if ($_POST['action'] == 'update_rate' && verify_csrf_token($_POST['csrf_token'] ?? '')) {\n        $vendor_id = (int)$_POST['vendor_id'];\n        $new_rate = (float)$_POST['commission_rate'];\n        \n        if ($new_rate >= 0 && $new_rate <= 50) {\n            // Check if vendor has existing commission rate\n            $stmt = $db->prepare(\"SELECT id FROM vendor_commissions WHERE vendor_id = ? AND is_active = 1\");\n            $stmt->execute([$vendor_id]);\n            $existing = $stmt->fetch(PDO::FETCH_ASSOC);\n            \n            if ($existing) {\n                // Deactivate old rate\n                $stmt = $db->prepare(\"UPDATE vendor_commissions SET is_active = 0 WHERE vendor_id = ? AND is_active = 1\");\n                $stmt->execute([$vendor_id]);\n            }\n            \n            // Insert new rate with history tracking\n            $stmt = $db->prepare(\"INSERT INTO vendor_commissions (vendor_id, commission_rate, effective_date, is_active, created_by) VALUES (?, ?, CURRENT_TIMESTAMP, 1, ?)\");\n            $stmt->execute([$vendor_id, $new_rate, $_SESSION['user_id']]);\n            \n            $success = \"Commission rate updated successfully! New rate will apply to future orders.\";\n        } else {\n            $error = \"Commission rate must be between 0% and 50%\";\n        }\n    } elseif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['action'])) {\n        $error = \"Invalid request. Please try again.\";\n    }\n}\n\n// Get all vendors with their commission data using actual commission_transactions\n$stmt = $db->prepare(\"\n    SELECT \n        v.id,\n        v.business_name,\n        v.user_id,\n        u.first_name,\n        u.last_name,\n        u.email,\n        vc.commission_rate,\n        vc.effective_date,\n        COALESCE(ct.total_sales, 0) as total_sales,\n        COALESCE(ct.total_commission, 0) as total_commission,\n        COALESCE(ct.pending_commission, 0) as pending_commission\n    FROM vendors v\n    JOIN users u ON v.user_id = u.id\n    LEFT JOIN vendor_commissions vc ON v.id = vc.vendor_id AND vc.is_active = 1\n    LEFT JOIN (\n        SELECT \n            ct.vendor_id,\n            SUM(ct.sale_amount) as total_sales,\n            SUM(ct.commission_amount) as total_commission,\n            SUM(CASE WHEN ct.status = 'pending' THEN ct.commission_amount ELSE 0 END) as pending_commission\n        FROM commission_transactions ct\n        JOIN orders o ON ct.order_id = o.id\n        WHERE o.status != 'cancelled'\n        GROUP BY ct.vendor_id\n    ) ct ON v.id = ct.vendor_id\n    ORDER BY v.business_name\n\");\n$stmt->execute();\n$vendors = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// Get commission summary using actual commission_transactions\n$stmt = $db->prepare(\"\n    SELECT \n        COUNT(DISTINCT v.id) as total_vendors,\n        AVG(vc.commission_rate) as avg_commission_rate,\n        SUM(COALESCE(ct.total_commission, 0)) as total_commission_earned\n    FROM vendors v\n    LEFT JOIN vendor_commissions vc ON v.id = vc.vendor_id AND vc.is_active = 1\n    LEFT JOIN (\n        SELECT \n            ct.vendor_id,\n            SUM(ct.commission_amount) as total_commission\n        FROM commission_transactions ct\n        JOIN orders o ON ct.order_id = o.id\n        WHERE o.status != 'cancelled'\n        GROUP BY ct.vendor_id\n    ) ct ON v.id = ct.vendor_id\n\");\n$stmt->execute();\n$summary = $stmt->fetch(PDO::FETCH_ASSOC);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Commission Management - Admin</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        primary: '#0f172a',\n                        secondary: '#1e293b',\n                        accent: '#3b82f6',\n                        warning: '#f59e0b',\n                        success: '#10b981'\n                    }\n                }\n            }\n        }\n    </script>\n</head>\n<body class=\"bg-gray-50\">\n    <!-- Navigation -->\n    <nav class=\"bg-white shadow-sm border-b\">\n        <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div class=\"flex justify-between h-16\">\n                <div class=\"flex items-center\">\n                    <a href=\"../index.php\" class=\"flex items-center\">\n                        <div class=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center mr-3\">\n                            <span class=\"text-white font-bold text-lg\">MN</span>\n                        </div>\n                        <span class=\"text-xl font-bold text-primary\"><?php echo SITE_NAME; ?></span>\n                    </a>\n                </div>\n                <div class=\"flex items-center space-x-4\">\n                    <a href=\"dashboard.php\" class=\"text-gray-600 hover:text-primary\">Dashboard</a>\n                    <a href=\"analytics.php\" class=\"text-gray-600 hover:text-primary\">Analytics</a>\n                    <a href=\"orders.php\" class=\"text-gray-600 hover:text-primary\">Orders</a>\n                    <a href=\"commissions.php\" class=\"text-primary font-medium\">Commissions</a>\n                    <a href=\"../logout.php\" class=\"bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary\">Logout</a>\n                </div>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n        <!-- Header -->\n        <div class=\"mb-8\">\n            <h1 class=\"text-3xl font-bold text-primary\">Commission Management</h1>\n            <p class=\"text-gray-600 mt-2\">Manage vendor commission rates and track earnings</p>\n        </div>\n\n        <?php if (isset($success)): ?>\n            <div class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6\">\n                <?php echo $success; ?>\n            </div>\n        <?php endif; ?>\n\n        <?php if (isset($error)): ?>\n            <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6\">\n                <?php echo $error; ?>\n            </div>\n        <?php endif; ?>\n\n        <!-- Summary Stats -->\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-3 rounded-full bg-blue-100 text-blue-600\">\n                        <svg class=\"h-8 w-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <h3 class=\"text-lg font-semibold text-gray-900\"><?php echo $summary['total_vendors']; ?></h3>\n                        <p class=\"text-gray-600\">Total Vendors</p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-3 rounded-full bg-green-100 text-green-600\">\n                        <svg class=\"h-8 w-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <h3 class=\"text-lg font-semibold text-gray-900\"><?php echo number_format($summary['avg_commission_rate'], 1); ?>%</h3>\n                        <p class=\"text-gray-600\">Average Commission</p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"bg-white rounded-lg shadow p-6\">\n                <div class=\"flex items-center\">\n                    <div class=\"p-3 rounded-full bg-yellow-100 text-yellow-600\">\n                        <svg class=\"h-8 w-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"ml-4\">\n                        <h3 class=\"text-lg font-semibold text-gray-900\"><?php echo format_currency($summary['total_commission_earned'] ?? 0); ?></h3>\n                        <p class=\"text-gray-600\">Total Earned</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Vendors Commission Table -->\n        <div class=\"bg-white rounded-lg shadow overflow-hidden\">\n            <div class=\"px-6 py-4 border-b border-gray-200\">\n                <h2 class=\"text-xl font-semibold text-gray-900\">Vendor Commission Rates</h2>\n            </div>\n            <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                        <tr>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Contact</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Commission Rate</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Total Sales</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Commission Earned</th>\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                        <?php foreach ($vendors as $vendor): ?>\n                        <tr>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">\n                                <div class=\"text-sm font-medium text-gray-900\"><?php echo htmlspecialchars($vendor['business_name']); ?></div>\n                                <div class=\"text-sm text-gray-500\">ID: <?php echo $vendor['id']; ?></div>\n                            </td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">\n                                <div class=\"text-sm text-gray-900\"><?php echo htmlspecialchars($vendor['first_name'] . ' ' . $vendor['last_name']); ?></div>\n                                <div class=\"text-sm text-gray-500\"><?php echo htmlspecialchars($vendor['email']); ?></div>\n                            </td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">\n                                <form method=\"POST\" class=\"flex items-center space-x-2\">\n                                    <input type=\"hidden\" name=\"csrf_token\" value=\"<?php echo $_SESSION['csrf_token']; ?>\">\n                                    <input type=\"hidden\" name=\"action\" value=\"update_rate\">\n                                    <input type=\"hidden\" name=\"vendor_id\" value=\"<?php echo $vendor['id']; ?>\">\n                                    <input type=\"number\" \n                                           name=\"commission_rate\" \n                                           value=\"<?php echo $vendor['commission_rate'] ?? 10; ?>\" \n                                           step=\"0.1\" \n                                           min=\"0\" \n                                           max=\"50\"\n                                           class=\"w-20 px-2 py-1 border border-gray-300 rounded text-sm\">\n                                    <span class=\"text-sm text-gray-500\">%</span>\n                                    <button type=\"submit\" class=\"bg-accent text-white px-3 py-1 rounded text-xs hover:bg-blue-600\">Update</button>\n                                </form>\n                            </td>\n                            <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                <?php echo format_currency($vendor['total_sales'] ?? 0); ?>\n                            </td>\n                            <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                <?php echo format_currency($vendor['total_commission'] ?? 0); ?>\n                            </td>\n                            <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                <a href=\"#\" class=\"text-accent hover:text-blue-600\">View Details</a>\n                            </td>\n                        </tr>\n                        <?php endforeach; ?>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n</body>\n</html>","size_bytes":13809},"scripts/setup_default_commission_rates.php":{"content":"<?php\n/**\n * Setup Default Commission Rates Script\n * This script ensures all vendors have active commission rates\n */\n\nrequire_once __DIR__ . '/../config/config.php';\nrequire_once __DIR__ . '/../includes/order.php';\n\n// Only allow admin execution\nif (php_sapi_name() !== 'cli') {\n    require_admin();\n}\n\n$database = new Database();\n$db = $database->getConnection();\n$order_manager = new OrderManager();\n\ntry {\n    echo \"Setting up default commission rates for vendors...\\n\\n\";\n    \n    // Find vendors without active commission rates\n    $stmt = $db->prepare(\"\n        SELECT v.id, v.business_name, v.user_id \n        FROM vendors v\n        LEFT JOIN vendor_commissions vc ON v.id = vc.vendor_id AND vc.is_active = 1\n        WHERE vc.id IS NULL\n    \");\n    $stmt->execute();\n    $vendors_without_rates = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    \n    if (empty($vendors_without_rates)) {\n        echo \"✅ All vendors already have commission rates set up.\\n\";\n    } else {\n        $default_rate = 10.00; // 10% default commission rate\n        $created_count = 0;\n        \n        foreach ($vendors_without_rates as $vendor) {\n            $result = $order_manager->ensure_vendor_commission_rate($vendor['id'], $default_rate);\n            \n            if ($result['success']) {\n                echo \"✅ Created {$default_rate}% commission rate for: {$vendor['business_name']}\\n\";\n                $created_count++;\n            } else {\n                echo \"❌ Failed to create rate for {$vendor['business_name']}: {$result['message']}\\n\";\n            }\n        }\n        \n        echo \"\\n📊 Summary:\\n\";\n        echo \"- Total vendors processed: \" . count($vendors_without_rates) . \"\\n\";\n        echo \"- Commission rates created: {$created_count}\\n\";\n        echo \"- Default rate: {$default_rate}%\\n\";\n    }\n    \n    // Display current commission rates\n    echo \"\\n📋 Current Vendor Commission Rates:\\n\";\n    echo str_repeat(\"-\", 70) . \"\\n\";\n    \n    $stmt = $db->prepare(\"\n        SELECT \n            v.business_name,\n            vc.commission_rate,\n            vc.effective_date,\n            CASE WHEN vc.is_active THEN 'Active' ELSE 'Inactive' END as status\n        FROM vendors v\n        LEFT JOIN vendor_commissions vc ON v.id = vc.vendor_id AND vc.is_active = 1\n        ORDER BY v.business_name\n    \");\n    $stmt->execute();\n    $all_rates = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    \n    foreach ($all_rates as $rate) {\n        $commission_info = $rate['commission_rate'] ? \n            \"{$rate['commission_rate']}% ({$rate['status']}) - Since \" . date('Y-m-d', strtotime($rate['effective_date'])) : \n            \"No rate set\";\n        \n        printf(\"%-30s: %s\\n\", \n            substr($rate['business_name'], 0, 29),\n            $commission_info\n        );\n    }\n    \n    echo \"\\n✅ Commission rate setup completed!\\n\";\n    \n} catch (Exception $e) {\n    echo \"❌ Error setting up commission rates: \" . $e->getMessage() . \"\\n\";\n    exit(1);\n}\n?>","size_bytes":2953}},"version":1}